(function(){"use strict";const _=(t,e)=>Array.from(t.querySelectorAll(e)),k=(t,e,n,o)=>t&&t.addEventListener(e,n,o),ct=(t,e=300)=>{let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>t(...o),e)}},m={courses:[],filtered:[],sort:{key:null,dir:1},view:{panel:"list",term:"first"}},K="wd-courses-capture";function at(){let t=document.getElementById(K);return t||(t=document.createElement("div"),t.id=K,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function dt(t){const e=chrome.runtime.getURL("src/panel.html"),n=chrome.runtime.getURL("src/panel.css"),[o,r]=await Promise.all([fetch(e).then(c=>c.text()),fetch(n).then(c=>c.text())]);t.innerHTML="";const s=document.createElement("style");s.textContent=r,t.appendChild(s);const i=document.createElement("div");i.innerHTML=o,t.appendChild(i);const l=t.querySelector("#wd-logo");return l&&(l.src=chrome.runtime.getURL("src/W.svg")),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead"),tabButtons:t.querySelectorAll(".tab-button"),panels:t.querySelectorAll(".widget-panel"),scheduleGrid:t.querySelector("#schedule-grid"),termButtons:t.querySelectorAll(".term-button")}}const P=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function ut(t){const n=(t?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return n?n[1]:null}function mt(t){const n=Array.from(t.querySelectorAll('th[data-automation-id^="columnHeader"]')).map((l,c)=>{const d=z(l),u=ut(l);return{el:l,pos:c,key:u,text:d,norm:P(d)}}).filter(l=>l.text);function o(l){const c=l.map(P);let d=n.find(u=>c.includes(u.norm));return d||(d=n.find(u=>c.some(p=>u.norm.includes(p))),d||null)}const r={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},s={},i={};for(const[l,c]of Object.entries(r)){const d=o(c);s[l]=d?d.key:null,i[l]=d?d.pos:-1}return{colMap:s,posMap:i}}function z(t){if(!t)return"";const e=t.querySelector("button[title]");return e?(e.getAttribute("title")||"").trim():(t.textContent||"").trim()}function ft(t){let e=String(t||"").replace(/\u00A0/g," ").trim();if(!e)return null;e=e.replace(/\s*\n\s*/g," ").trim();const n=e.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!n)return null;const o=n[1].trim(),s=n[2].trim().split(/\s*[-–—]\s*/).map(c=>c.trim()).filter(Boolean);let i="",l="";return i=s[0],l=s.slice(1).join(" - ").trim(),l=l.replace(/\s*:\s*/g,`:
`),{code:o,section_number:i,title:l,full:e}}function U(t){const e=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return e?e[0].replace(/\s+/g," ").trim():""}function pt(t){if(!t)return console.log("extractMeetingLinesFromCell failed 1"),[];let n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean);n.length||(n=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(l=>(l.getAttribute("data-automation-label")||l.getAttribute("title")||l.textContent||"").trim()).filter(Boolean)),n.length||(n=String(t.innerText||"").split(`
`).map(i=>i.trim()).filter(Boolean));const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,s=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(i=>o.test(i)&&r.test(i)&&s.test(i))}function ht(t){if(!t)return[];const n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean),o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,s=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(i=>o.test(i)&&r.test(i)&&s.test(i))}function gt(t){const e=String(t||"").split("|").map(c=>c.trim()).filter(Boolean),o=(e.find(c=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(c))||"").split(/\s+/).join(" / "),r=e.find(c=>/\d{1,2}:\d{2}/.test(c)&&/-/.test(c))||"",s=e.find(c=>/\([A-Z]{2,}\)/.test(c))||"",i=e.find(c=>/^Floor:/i.test(c))||"",l=e.find(c=>/^Room:/i.test(c))||"";return{days:o,time:r,location:[s,[i,l].join(" | ")].filter(Boolean).join(`
`)}}function yt(t){return String(t||"").split(/\r?\n/).map(e=>e.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function W(t){const e=String(t||"").match(/\b(\d{4}-\d{2}-\d{2})\b/);return e?e[1]:""}function bt(t){if(!t)return console.log("failed extracting instuctor name:",t),"";const e=t.querySelector('[data-automation-id="promptOption"]'),n=(e&&(e.getAttribute("data-automation-label")||e.getAttribute("title")||e.textContent)||t.textContent||"").trim();return console.log("sucsessfully extracted instuctor name:",t,n),n}function St(t){if(!t)return!1;const e=(t.innerText||t.textContent||"").trim();return/online learning/i.test(e)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(o=>{const r=(o.getAttribute("data-automation-label")||o.getAttribute("title")||o.textContent||"").trim();return/online learning/i.test(r)})}function xt(){const t=_(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const e of t){const o=_(e,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(i=>P(z(i)));if(!(o.some(i=>i.includes("section"))&&(o.some(i=>i.includes("instructor"))||o.some(i=>i.includes("meeting"))||o.some(i=>i.includes("instructional format"))||o.some(i=>i.includes("format"))||o.some(i=>i.includes("status")))))continue;const s=_(e,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(s.length)return{root:e,rows:s}}return null}async function V(){const t=xt();let e=[];if(t){const n=mt(t.root);for(const o of t.rows){const r=vt(o,n);(r.code||r.title)&&Object.values(r).join("").trim()&&e.push(r)}}return Et(e)}function Et(t){const e=r=>[r.code,r.title,r.section_number].join("|").toLowerCase(),n=new Set,o=[];for(const r of t){const s=e(r);n.has(s)||(n.add(s),o.push(r))}return o}function vt(t,e){const{colMap:n,posMap:o}=e,r=_(t,"td, [role='gridcell']"),s=(t.innerText||"").trim();function i(h){const lt=(h.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return lt?lt[1]:null}const l=new Map;r.forEach(h=>{const C=i(h);C&&!l.has(C)&&l.set(C,h)});const c=h=>{const C=n[h];if(C!=null&&l.has(C))return l.get(C);const A=o[h];return A!=null&&A>=0&&A<r.length?r[A]:null},d=h=>{const C=n[h];if(C!=null&&l.has(C))return(l.get(C).innerText||"").trim();const A=o[h];return A!=null&&A>=0&&A<r.length?(r[A].innerText||"").trim():""},u=_(t,'[data-automation-id="promptOption"]');let p=null;for(const h of u){const C=h.getAttribute("data-automation-label")||h.getAttribute("title")||h.getAttribute("aria-label")||h.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(C)){p=h;break}}!p&&u.length>0&&(p=u[0]);const v=p&&(p.getAttribute("data-automation-label")||p.getAttribute("title")||p.getAttribute("aria-label")||p.textContent)||"",L=d("title"),R=d("code"),B=d("section"),w=d("meeting"),b=d("instructionalFormat"),M=d("startDate");let y="",a=L||"",g="";const S=ft(v);S&&(y=S.code,g=S.section_number,a=S.title),y||(y=U(R)||U(L)||U(s)||"");const E=h=>/\b(lab|laboratory|labratory)\b/i.test(String(h||"")),f=h=>/\bseminar\b/i.test(String(h||"")),x=E(b)||E(B)||E(a)||E(v)||E(s),T=f(b)||f(B)||f(a)||f(v)||f(s),Z=c("instructor");let Y="";x||T?Y="N/A":Y=bt(Z)||(d("instructor")||"").trim();let F;const X=n.meeting;let N=null;X!=null&&l.has(X)?N=l.get(X):o.meeting!=null&&o.meeting>=0&&o.meeting<r.length&&(N=r[o.meeting]);let q=N?pt(N):[];q.length||(q=ht(t));let $={days:"",time:"",location:""},Nt=W(q[0])||W(M);if(q.length){const h=q[0];$=gt(h)}else F=(w||"").trim();const Pt=c("deliveryMode");St(Pt)&&($.location="Online"),$.days||$.time||$.location?(F=[$.days,$.time].filter(Boolean).join(" | "),$.location?F+=`
${$.location}`:F+=`
Online`):F=(w||"").trim();const Ut=(b||"").trim();return{code:y,title:a,section_number:g,instructor:Y,meeting:yt(F),instructionalFormat:Ut,startDate:Nt,meetingLines:q,isLab:x,isSeminar:T}}const J=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function H(t,e){t.tableBody.innerHTML="";const n=document.createDocumentFragment();e.forEach(o=>{const r=document.createElement("tr"),s=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":"";r.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${s?`<div class="muted">${s}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const i=String(o.meeting||"").split(`
`),l=(i[0]||"").trim(),c=(i[1]||"").trim();return`
            ${l?`<span class="meeting-pill">${J(l)}</span>`:""}
            ${c?`<div class="meeting-sub">${J(c)}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,n.appendChild(r)}),t.tableBody.appendChild(n)}function Q(t){if(t=(t||"").trim().toLowerCase(),!t){m.filtered=[...m.courses];return}m.filtered=m.courses.filter(e=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(n=>(e[n]||"").toLowerCase().includes(t)))}function O(t){if(!t)return;const e=m.sort.key===t?-m.sort.dir:1;m.sort={key:t,dir:e};const n=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});m.filtered.sort((o,r)=>e*n.compare(o[t]||"",r[t]||""))}function Ct(t){const e=_(t.tableHead,"th[data-key]");e.forEach(n=>{k(n,"click",()=>{const o=n.getAttribute("data-key");O(o),H(t,m.filtered),e.forEach(r=>r.classList.remove("sorted-asc","sorted-desc")),n.classList.add(m.sort.dir===1?"sorted-asc":"sorted-desc")})})}const I=["Mon","Tue","Wed","Thu","Fri"],tt=8,G=22,j=30,D=[];for(let t=tt;t<G;t++)D.push(t*60),D.push(t*60+30);D.push(G*60);const wt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,Lt=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,et={first:["09","08"],second:["01","12"]};function nt(t){if(!t)return null;const e=t.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!e)return null;let n=Number.parseInt(e[1],10);const o=Number.parseInt(e[2],10),r=e[3].toLowerCase();return r==="p"&&n!==12&&(n+=12),r==="a"&&n===12&&(n=0),n*60+o}function Tt(t){const e=String(t||"").match(wt)||[],n=String(t||"").match(Lt)||[];if(e.length===0||n.length<2)return null;const o=nt(n[0]),r=nt(n[1]);return o==null||r==null||r<=o?null:{days:[...new Set(e)],startMinutes:o,endMinutes:r,timeLabel:`${n[0]} - ${n[1]}`}}function At(t){if(!t)return null;const e=t.split("-")[1];return et.first.includes(e)?"first":et.second.includes(e)?"second":null}function ot(t){const e=tt*60,n=G*60;return Math.max(e,Math.min(n,t))}function Mt(t){return Math.floor(t/j)*j}function $t(t){return Math.ceil(t/j)*j}function rt(t){return D.indexOf(t)}function Rt(t,e){const n=new Map;I.forEach(s=>n.set(s,[]));const o=new Set;let r=0;return t.forEach(s=>{const i=s.startDate||W(s.meetingLines?.[0])||"";if(At(i)!==e)return;(s.meetingLines?.length?s.meetingLines:[]).forEach(d=>{const u=Tt(d);if(!u)return;let p=ot(u.startMinutes),v=ot(u.endMinutes);p=Mt(p),v=$t(v);const L=rt(p),R=rt(v);if(L===-1||R===-1||R<=L)return;const B=R-L;u.days.forEach(w=>{if(!n.has(w))return;const b=[w,s.code||"",s.title||"",u.timeLabel,L,B].join("|");o.has(b)||(o.add(b),n.get(w).push({id:r++,code:s.code||"",title:s.title||"",timeLabel:u.timeLabel,rowStart:L,rowSpan:B,startIdx:L,endIdx:R}))})})}),I.forEach(s=>{n.get(s).sort((i,l)=>i.startIdx-l.startIdx||i.endIdx-l.endIdx)}),n}function Bt(t){const e=new Map;return I.forEach(n=>{const o=(t.get(n)||[]).slice().sort((l,c)=>l.startIdx-c.startIdx||l.endIdx-c.endIdx),r=[];let s=null,i=null;for(let l=0;l<D.length-1;l++){const c=o.filter(u=>u.startIdx<=l&&u.endIdx>l),d=c.length?c.map(u=>u.id).sort((u,p)=>u-p).join("|"):null;if(!d){s&&r.push(s),s=null,i=null;continue}if(s&&d===i){s.end=l+1;continue}s&&r.push(s),s={start:l,end:l+1,events:c,hasConflict:c.length>1},i=d}s&&r.push(s),e.set(n,r)}),e}function kt(t){const e=Math.floor(t/60),n=t%60,o=String(e),r=String(n).padStart(2,"0");return`${o}:${r}`}function It(){const t=document.createElement("div");t.className="schedule-table-wrap";const e=document.createElement("table");e.className="schedule-table";const n=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time">Time</th>
    ${I.map(i=>`<th class="schedule-day-head" data-day="${i}">${i}</th>`).join("")}
  `,n.appendChild(o),e.appendChild(n);const r=document.createElement("tbody");for(let i=0;i<D.length;i++){const l=document.createElement("tr"),c=document.createElement("td");c.className="schedule-time",c.textContent=kt(D[i]),l.appendChild(c),I.forEach(d=>{const u=document.createElement("td");u.className="schedule-cell",u.dataset.day=d,u.dataset.row=String(i);const p=document.createElement("div");p.className="schedule-cell-inner",u.appendChild(p),l.appendChild(u)}),r.appendChild(l)}e.appendChild(r),t.appendChild(e);const s=document.createElement("div");return s.className="schedule-overlay",t.appendChild(s),t}function st(t,e){return!(t.right<=e.left||t.left>=e.right||t.bottom<=e.top||t.top>=e.bottom)}function Dt(t,e){const n=Math.max(t.left,e.left),o=Math.min(t.right,e.right),r=Math.max(t.top,e.top),s=Math.min(t.bottom,e.bottom);return o<=n||s<=r?null:{left:n,right:o,top:r,bottom:s,width:o-n,height:s-r}}function _t(t){const e=parseFloat(t.style.left)||0,n=parseFloat(t.style.top)||0,o=parseFloat(t.style.width)||0,r=parseFloat(t.style.height)||0;return{left:e,top:n,right:e+o,bottom:n+r,width:o,height:r}}function Ft(t,e){for(const n of e)if(st(t,n))return!0;return!1}function qt(t,e,n){const o=t.querySelector(".schedule-overlay");o.innerHTML="";const r=t.querySelector(".schedule-table"),s=r.querySelector("tbody tr"),i=r.querySelector('tbody tr td.schedule-cell[data-day="Mon"]'),l=r.querySelector("thead th.schedule-time");if(!s||!i||!l)return;const c=l.getBoundingClientRect().width,d=i.getBoundingClientRect().width,u=r.querySelector("thead").getBoundingClientRect().height,p=s.getBoundingClientRect().height,v=[];I.forEach((b,M)=>{(e.get(b)||[]).forEach(a=>{const g=c+M*d,S=u+a.rowStart*p,E=a.rowSpan*p,f=document.createElement("div");f.className="schedule-entry-float",f.style.left=`${g}px`,f.style.top=`${S}px`,f.style.width=`${d}px`,f.style.height=`${E}px`;const x=document.createElement("div");x.className="schedule-entry-overlap-layer",f.appendChild(x);const T=document.createElement("div");T.className="schedule-entry-text",T.innerHTML=`
        <div class="schedule-entry-title">${a.code||a.title}</div>
        <div class="schedule-entry-time">${a.timeLabel}</div>
      `,f.appendChild(T),o.appendChild(f),v.push({el:f,day:b,ev:a,rect:_t(f),overlapLayerEl:x,overlaps:[],textEl:T})})});for(let b=0;b<v.length;b++)for(let M=b+1;M<v.length;M++){const y=v[b],a=v[M];if(y.day!==a.day||!st(y.rect,a.rect))continue;const g=Dt(y.rect,a.rect);if(!g)continue;y.el.style.opacity="0.6",a.el.style.opacity="0.6",y.el.classList.add("is-overlap"),a.el.classList.add("is-overlap");const S={left:g.left-y.rect.left,top:g.top-y.rect.top,width:g.width,height:g.height},E={left:g.left-a.rect.left,top:g.top-a.rect.top,width:g.width,height:g.height},f=document.createElement("div");f.className="schedule-entry-overlap-rect",f.style.left=`${S.left}px`,f.style.top=`${S.top}px`,f.style.width=`${S.width}px`,f.style.height=`${S.height}px`,y.overlapLayerEl.appendChild(f);const x=document.createElement("div");x.className="schedule-entry-overlap-rect",x.style.left=`${E.left}px`,x.style.top=`${E.top}px`,x.style.width=`${E.width}px`,x.style.height=`${E.height}px`,a.overlapLayerEl.appendChild(x)}const L=14,R=30,B=6,w=6;I.forEach(b=>{const M=v.filter(a=>a.day===b).sort((a,g)=>a.rect.top-g.rect.top),y=[];M.forEach(a=>{const g=a.rect.left+B;let S=a.rect.top+w,E=0;const f=a.rect.width-B*2,x=26;for(;E<R;){const T={left:g,top:S,right:g+f,bottom:S+x};if(T.bottom>a.rect.bottom-w)break;if(!Ft(T,y)){const Z=S-a.rect.top;a.textEl.style.transform=`translateY(${Z}px)`,y.push(T);return}S+=L,E++}a.textEl.style.transform=`translateY(${w}px)`,y.push({left:g,top:a.rect.top+w,right:g+f,bottom:a.rect.top+w+x})})})}function Ht(t,e,n){if(!t.scheduleGrid)return;t.scheduleGrid.innerHTML="";const o=Rt(e,n);Bt(o);const r=It();t.scheduleGrid.appendChild(r),qt(r,o)}const it=t=>{if(t==null)return"";const e=String(t);return/[",\n]/.test(e)?`"${e.replace(/"/g,'""')}"`:e},Ot=(t,e)=>{const n=e.map(it).join(","),o=t.map(r=>e.map(s=>it(r[s]??"")).join(",")).join(`
`);return n+`
`+o};function jt(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],e=Ot(m.filtered,t),n=new Blob([e],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="captured-courses.csv",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(o),r.remove()},100)}(()=>{console.log("[WD] content script loaded");async function t(){const e=at(),n=await dt(e),o=()=>{Ht(n,m.filtered,m.view.term)},r=s=>{m.view.panel=s,n.panels.forEach(i=>{i.classList.toggle("is-active",i.dataset.panel===s)}),n.tabButtons.forEach(i=>{i.classList.toggle("is-active",i.dataset.panel===s)}),n.widget.classList.toggle("is-schedule-view",s==="schedule")};n.tabButtons.forEach(s=>{k(s,"click",()=>{r(s.dataset.panel),s.dataset.panel==="schedule"&&o()})}),n.termButtons.forEach(s=>{k(s,"click",()=>{m.view.term=s.dataset.term,n.termButtons.forEach(i=>{i.classList.toggle("is-active",i.dataset.term===m.view.term)}),o()})}),k(n.button,"click",()=>{n.widget.classList.toggle("is-hidden")}),k(n.refresh,"click",async()=>{m.courses=await V(),Q(n.search.value),O(m.sort.key||"code"),H(n,m.filtered),o()}),k(n.exportBtn,"click",jt),k(n.search,"input",ct(()=>{Q(n.search.value),O(m.sort.key||"code"),H(n,m.filtered),o()},100)),Ct(n),m.courses=await V(),m.filtered=[...m.courses],O("code"),H(n,m.filtered),o(),r(m.view.panel)}document.readyState==="complete"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})()})();
//# sourceMappingURL=content.js.map
