const U=(t,n)=>Array.from(t.querySelectorAll(n)),E=(t,n,e,o)=>t&&t.addEventListener(n,e,o),St=(t,n=300)=>{let e;return(...o)=>{clearTimeout(e),e=setTimeout(()=>t(...o),n)}},u={courses:[],filtered:[],savedSchedules:[],sort:{key:null,dir:1},view:{panel:"list",semester:"first"}},ot="wd-courses-capture";function bt(){let t=document.getElementById(ot);return t||(t=document.createElement("div"),t.id=ot,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function Ct(t){const n=chrome.runtime.getURL("src/panel.html"),e=["formatting/general.css","formatting/widget-shell.css","formatting/widget-buttons.css","formatting/floating-button.css","formatting/course-list.css","formatting/schedule-view.css","formatting/schedule-view-events.css","formatting/settings.css","colors/course-list-colors.css","colors/general-colors.css","colors/schedule-view-colors.css","colors/widget-functionality-colors.css","colors/settings-colors.css"],[o,...s]=await Promise.all([fetch(n).then(d=>d.text()),...e.map(d=>fetch(chrome.runtime.getURL(`src/css/${d}`)).then(l=>l.text()))]),r=s.join(`
`);t.innerHTML="";const i=document.createElement("style");if(i.textContent=r,t.appendChild(i),!document.querySelector('link[href*="Material+Symbols"]')){const d=document.createElement("link");d.rel="stylesheet",d.href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200",document.head.appendChild(d)}const a=document.createElement("div");return a.innerHTML=o,t.appendChild(a),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),saveScheduleBtn:t.querySelector("#widget-save-schedule"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),settingsBtn:t.querySelector(".settings"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead"),tabButtons:t.querySelectorAll(".tab-button"),panels:t.querySelectorAll(".widget-panel"),scheduleGrid:t.querySelector("#schedule-grid"),semesterButtons:t.querySelectorAll(".semester-button"),savedDropdown:t.querySelector("#schedule-saved-dropdown"),savedMenu:t.querySelector("#schedule-saved-menu"),footerConflicts:t.querySelector("#widget-conflicts"),saveModal:t.querySelector("#schedule-save-modal"),saveModalTitle:t.querySelector("#schedule-modal-title"),saveModalMessage:t.querySelector("#schedule-modal-message"),saveModalField:t.querySelector("#schedule-modal-field"),saveModalInput:t.querySelector("#schedule-modal-input"),saveModalCancel:t.querySelector(".schedule-modal-cancel"),saveModalConfirm:t.querySelector(".schedule-modal-confirm")}}const V=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function Mt(t){const e=(t?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return e?e[1]:null}function wt(t){const e=Array.from(t.querySelectorAll('th[data-automation-id^="columnHeader"]')).map((a,d)=>{const l=ft(a),c=Mt(a);return{el:a,pos:d,key:c,text:l,norm:V(l)}}).filter(a=>a.text);function o(a){const d=a.map(V);let l=e.find(c=>d.includes(c.norm));return l||(l=e.find(c=>d.some(m=>c.norm.includes(m))),l||null)}const s={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},r={},i={};for(const[a,d]of Object.entries(s)){const l=o(d);r[a]=l?l.key:null,i[a]=l?l.pos:-1}return{colMap:r,posMap:i}}function ft(t){if(!t)return"";const n=t.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(t.textContent||"").trim()}function Et(t){let n=String(t||"").replace(/\u00A0/g," ").trim();if(!n)return null;n=n.replace(/\s*\n\s*/g," ").trim();const e=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!e)return null;const o=e[1].trim(),r=e[2].trim().split(/\s*[-–—]\s*/).map(d=>d.trim()).filter(Boolean);let i="",a="";return i=r[0],a=r.slice(1).join(" - ").trim(),a=a.replace(/\s*:\s*/g,`:
`),{code:o,section_number:i,title:a,full:n}}function K(t){const n=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return n?n[0].replace(/\s+/g," ").trim():""}function Lt(t){if(!t)return[];let e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean);e.length||(e=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(a=>(a.getAttribute("data-automation-label")||a.getAttribute("title")||a.textContent||"").trim()).filter(Boolean)),e.length||(e=String(t.innerText||"").split(`
`).map(i=>i.trim()).filter(Boolean));const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,s=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,r=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(i=>o.test(i)&&s.test(i)&&r.test(i))}function xt(t){if(!t)return[];const e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean),o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,s=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,r=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(i=>o.test(i)&&s.test(i)&&r.test(i))}function At(t){const n=String(t||""),e=n.split("|").map(m=>m.trim()).filter(Boolean),s=(e.find(m=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(m))||"").split(/\s+/).join(" / "),r=e.find(m=>/\d{1,2}:\d{2}/.test(m)&&/-/.test(m))||"",i=e.find(m=>/\([A-Z]{2,}\)/.test(m))||"",a=n.match(/\bfloor\b\s*[:\-]?\s*(-?[A-Za-z0-9]+)/i),d=n.match(/\b(room|rm)\b\s*[:\-]?\s*([A-Za-z0-9]+)/i),l=a?`Floor: ${a[1]}`:"",c=d?`Room: ${d[2]}`:"";return{days:s,time:r,location:[i,[l,c].filter(Boolean).join(" | ")].filter(Boolean).join(`
`)}}function Tt(t){return String(t||"").split(/\r?\n/).map(n=>n.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function Q(t){const n=String(t||"").match(/\b(\d{4}-\d{2}-\d{2})\b/);return n?n[1]:""}function Dt(t){if(!t)return"";const n=t.querySelector('[data-automation-id="promptOption"]');return(n&&(n.getAttribute("data-automation-label")||n.getAttribute("title")||n.textContent)||t.textContent||"").trim()}function Bt(t){if(!t)return!1;const n=(t.innerText||t.textContent||"").trim();return/online learning/i.test(n)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(o=>{const s=(o.getAttribute("data-automation-label")||o.getAttribute("title")||o.textContent||"").trim();return/online learning/i.test(s)})}function $t(){const t=U(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const n of t){const o=U(n,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(i=>V(ft(i)));if(!(o.some(i=>i.includes("section"))&&(o.some(i=>i.includes("instructor"))||o.some(i=>i.includes("meeting"))||o.some(i=>i.includes("instructional format"))||o.some(i=>i.includes("format"))||o.some(i=>i.includes("status")))))continue;const r=U(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(r.length)return{root:n,rows:r}}return null}async function st(){const t=$t();let n=[];if(t){const e=wt(t.root);for(const o of t.rows){const s=kt(o,e);(s.code||s.title)&&Object.values(s).join("").trim()&&n.push(s)}}return It(n)}function It(t){const n=s=>[s.code,s.title,s.section_number].join("|").toLowerCase(),e=new Set,o=[];for(const s of t){const r=n(s);e.has(r)||(e.add(r),o.push(s))}return o}function kt(t,n){const{colMap:e,posMap:o}=n,s=U(t,"td, [role='gridcell']"),r=(t.innerText||"").trim();function i(p){const nt=(p.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return nt?nt[1]:null}const a=new Map;s.forEach(p=>{const L=i(p);L&&!a.has(L)&&a.set(L,p)});const d=p=>{const L=e[p];if(L!=null&&a.has(L))return a.get(L);const k=o[p];return k!=null&&k>=0&&k<s.length?s[k]:null},l=p=>{const L=e[p];if(L!=null&&a.has(L))return(a.get(L).innerText||"").trim();const k=o[p];return k!=null&&k>=0&&k<s.length?(s[k].innerText||"").trim():""},c=U(t,'[data-automation-id="promptOption"]');let m=null;for(const p of c){const L=p.getAttribute("data-automation-label")||p.getAttribute("title")||p.getAttribute("aria-label")||p.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(L)){m=p;break}}!m&&c.length>0&&(m=c[0]);const v=m&&(m.getAttribute("data-automation-label")||m.getAttribute("title")||m.getAttribute("aria-label")||m.textContent)||"",C=l("title"),M=l("code"),D=l("section"),R=l("meeting"),$=l("instructionalFormat"),_=l("startDate");let H="",T=C||"",W="";const j=Et(v);j&&(H=j.code,W=j.section_number,T=j.title),H||(H=K(M)||K(C)||K(r)||"");const q=p=>/\b(lab|laboratory|labratory)\b/i.test(String(p||"")),F=p=>/\bseminar\b/i.test(String(p||"")),B=p=>/\bdiscussion\b/i.test(String(p||"")),x=q($)||q(D)||q(T)||q(v)||q(r),I=F($)||F(D)||F(T)||F(v)||F(r),w=B($)||B(D)||B(T)||B(v)||B(r),f=d("instructor");let g="";x||I?g="N/A":g=Dt(f)||(l("instructor")||"").trim();let S;const A=e.meeting;let h=null;A!=null&&a.has(A)?h=a.get(A):o.meeting!=null&&o.meeting>=0&&o.meeting<s.length&&(h=s[o.meeting]);let y=h?Lt(h):[];y.length||(y=xt(t));let b={days:"",time:"",location:""},P=Q(y[0])||Q(_);if(y.length){const p=y[0];b=At(p)}else S=(R||"").trim();const z=d("deliveryMode");Bt(z)&&(b.location="Online"),b.days||b.time||b.location?(S=[b.days,b.time].filter(Boolean).join(" | "),b.location?S+=`
${b.location}`:S+=`
Online`):S=(R||"").trim();const vt=($||"").trim();return{code:H,title:T,section_number:W,instructor:g,meeting:Tt(S),instructionalFormat:vt,startDate:P,meetingLines:y,isLab:x,isSeminar:I,isDiscussion:w}}const rt=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function Ft(t){return String(t||"").replace(/[\u00A0\u200B-\u200D\uFEFF]/g," ").replace(/[ \t]+\n/g,`
`).replace(/\n[ \t]+/g,`
`).replace(/\n{2,}/g,`
`).trim()}function G(t,n){t.tableBody.innerHTML="";const e=document.createDocumentFragment();n.forEach(o=>{const s=document.createElement("tr"),r=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":o.isDiscussion?"[Discussion]":"";s.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${r?`<div class="muted">${r}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const i=Ft(o.meeting).split(`
`),a=(i[0]||"").trim(),d=i.slice(1).map(l=>l.replace(/[\u00A0\u200B-\u200D\uFEFF]/g,"").trim()).filter(Boolean).join(`
`);return`
            ${a?`<span class="meeting-pill">${rt(a).trim()}</span>`:""}
            ${d?`<div class="meeting-sub">${rt(d).trim()}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,e.appendChild(s)}),t.tableBody.appendChild(e)}function it(t){if(t=(t||"").trim().toLowerCase(),!t){u.filtered=[...u.courses];return}u.filtered=u.courses.filter(n=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(e=>(n[e]||"").toLowerCase().includes(t)))}function Y(t){if(!t)return;const n=u.sort.key===t?-u.sort.dir:1;u.sort={key:t,dir:n};const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});u.filtered.sort((o,s)=>n*e.compare(o[t]||"",s[t]||""))}function Rt(t){const n=U(t.tableHead,"th[data-key]");n.forEach(e=>{E(e,"click",()=>{const o=e.getAttribute("data-key");Y(o),G(t,u.filtered),n.forEach(s=>s.classList.remove("sorted-asc","sorted-desc")),e.classList.add(u.sort.dir===1?"sorted-asc":"sorted-desc")})})}const N=["Mon","Tue","Wed","Thu","Fri"],ht=8,et=21,X=30,O=[];for(let t=ht;t<et;t++)O.push(t*60),O.push(t*60+30);O.push(et*60);const qt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,Nt=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,at={first:["09","08"],second:["01","12"]};function lt(t){if(!t)return null;const n=t.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let e=Number.parseInt(n[1],10);const o=Number.parseInt(n[2],10),s=n[3].toLowerCase();return s==="p"&&e!==12&&(e+=12),s==="a"&&e===12&&(e=0),e*60+o}function Ot(t){const n=String(t||"").match(qt)||[],e=String(t||"").match(Nt)||[];if(n.length===0||e.length<2)return null;const o=lt(e[0]),s=lt(e[1]);return o==null||s==null||s<=o?null:{days:[...new Set(n)],startMinutes:o,endMinutes:s,timeLabel:`${e[0]} - ${e[1]}`}}function _t(t){if(!t)return null;const n=t.split("-")[1];return at.first.includes(n)?"first":at.second.includes(n)?"second":null}function ct(t){const n=ht*60,e=et*60;return Math.max(n,Math.min(e,t))}function Ht(t){return Math.floor(t/X)*X}function jt(t){return Math.ceil(t/X)*X}function dt(t){return O.indexOf(t)}function Pt(t,n){const e=new Map;N.forEach(r=>e.set(r,[]));const o=new Set;let s=0;return t.forEach(r=>{const i=r.startDate||Q(r.meetingLines?.[0])||"",a=_t(i);if(a!==a)return;const d=r.meetingLines?.length?r.meetingLines:[],l=r.isLab?"[Laboratory]":r.isSeminar?"[Seminar]":r.isDiscussion?"[Discussion]":"";d.forEach(c=>{const m=Ot(c);if(!m)return;let v=ct(m.startMinutes),C=ct(m.endMinutes);v=Ht(v),C=jt(C);const M=dt(v),D=dt(C);if(M===-1||D===-1||D<=M)return;const R=D-M;m.days.forEach($=>{if(!e.has($))return;const _=[$,r.code||"",r.title||"",m.timeLabel,M,R].join("|");o.has(_)||(o.add(_),e.get($).push({id:s++,code:r.code||"",title:r.title||"",label:l,timeLabel:m.timeLabel,rowStart:M,rowSpan:R,startIdx:M,endIdx:D}))})})}),N.forEach(r=>{e.get(r).sort((i,a)=>i.startIdx-a.startIdx||i.endIdx-a.endIdx)}),e}function Ut(t){const n=new Map;return N.forEach(e=>{const o=(t.get(e)||[]).slice().sort((a,d)=>a.startIdx-d.startIdx||a.endIdx-d.endIdx),s=[];let r=null,i=null;for(let a=0;a<O.length-1;a++){const d=o.filter(c=>c.startIdx<=a&&c.endIdx>a),l=d.length?d.map(c=>c.id).sort((c,m)=>c-m).join("|"):null;if(!l){r&&s.push(r),r=null,i=null;continue}if(r&&l===i){r.end=a+1;continue}r&&s.push(r),r={start:a,end:a+1,events:d,hasConflict:d.length>1},i=l}r&&s.push(r),n.set(e,s)}),n}function Wt(t){const n=new Set,e=[];return t.forEach(o=>{o.forEach(s=>{if(!s.hasConflict)return;const r=[...new Set(s.events.map(a=>a.code||a.title).filter(Boolean))];if(r.length<2)return;r.sort((a,d)=>a.localeCompare(d));const i=r.join("|");n.has(i)||(n.add(i),e.push(r))})}),e}function Gt(t,n){if(!t?.footerConflicts)return;if(!n.length){t.footerConflicts.textContent="";return}const e=n.map(o=>`[${o.join(", ")}]`).join(" ");t.footerConflicts.textContent=`⚠️ The following classes are in conflict: ${e}`}function Yt(t){const n=Math.floor(t/60),e=t%60,o=String(n),s=String(e).padStart(2,"0");return`${o}:${s}`}function Zt(){const t=document.createElement("div");t.className="schedule-table-wrap";const n=document.createElement("table");n.className="schedule-table";const e=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time"></th>
    ${N.map(i=>`<th class="schedule-day-head" data-day="${i}">${i}</th>`).join("")}
  `,e.appendChild(o),n.appendChild(e);const s=document.createElement("tbody");for(let i=0;i<O.length;i++){const a=document.createElement("tr"),d=document.createElement("td");d.className="schedule-time",d.textContent=Yt(O[i]),a.appendChild(d),N.forEach(l=>{const c=document.createElement("td");c.className="schedule-cell",c.dataset.day=l,c.dataset.row=String(i);const m=document.createElement("div");m.className="schedule-cell-inner",c.appendChild(m),a.appendChild(c)}),s.appendChild(a)}n.appendChild(s),t.appendChild(n);const r=document.createElement("div");return r.className="schedule-overlay",t.appendChild(r),t}function pt(t,n){return!(t.right<=n.left||t.left>=n.right||t.bottom<=n.top||t.top>=n.bottom)}function Xt(t,n){const e=Math.max(t.left,n.left),o=Math.min(t.right,n.right),s=Math.max(t.top,n.top),r=Math.min(t.bottom,n.bottom);return o<=e||r<=s?null:{left:e,right:o,top:s,bottom:r,width:o-e,height:r-s}}function zt(t){const n=parseFloat(t.style.left)||0,e=parseFloat(t.style.top)||0,o=parseFloat(t.style.width)||0,s=parseFloat(t.style.height)||0;return{left:n,top:e,right:n+o,bottom:e+s,width:o,height:s}}function Kt(t,n){for(const e of n)if(pt(t,e))return!0;return!1}function Jt(t,n,e,o){const s=t.querySelector(".schedule-overlay");s.innerHTML="";const r=t.querySelector(".schedule-table"),i=r.querySelector("tbody tr"),a=r.querySelector('tbody tr td.schedule-cell[data-day="Mon"]'),d=r.querySelector("thead th.schedule-time");if(!i||!a||!d)return;const l=d.getBoundingClientRect().width,c=a.getBoundingClientRect().width,m=r.querySelector("thead").getBoundingClientRect().height,v=i.getBoundingClientRect().height,C=getComputedStyle(a),M=parseFloat(C.borderLeftWidth)||0,D=parseFloat(C.borderTopWidth)||0,R=parseFloat(C.borderRightWidth)||0,$=parseFloat(C.borderBottomWidth)||0,_=(M+R)/2,H=(D+$)/2,T=[];N.forEach((x,I)=>{(n.get(x)||[]).forEach(f=>{const g=l+I*c,S=m+f.rowStart*v,A=f.rowSpan*v,h=document.createElement("div");h.className="schedule-entry-float",h.style.left=`${g+M}px`,h.style.top=`${S+D}px`,h.style.width=`${c-_}px`,h.style.height=`${A-H}px`;const y=document.createElement("div");y.className="schedule-entry-overlap-layer",h.appendChild(y);const b=document.createElement("div");b.className="schedule-entry-text";const P=f.code||f.title,z=f.label?`${P} ${f.label}`:P;b.innerHTML=`
        <div class="schedule-entry-title">${z}</div>
        <div class="schedule-entry-time">${f.timeLabel}</div>
      `,h.appendChild(b),s.appendChild(h),T.push({el:h,day:x,ev:f,rect:zt(h),overlapLayerEl:y,overlaps:[],textEl:b})})});const W=x=>{};for(let x=0;x<T.length;x++)for(let I=x+1;I<T.length;I++){const w=T[x],f=T[I];if(w.day!==f.day||!pt(w.rect,f.rect))continue;const g=Xt(w.rect,f.rect);if(!g)continue;w.el.style.opacity="0.75",f.el.style.opacity="0.75",w.el.classList.add("is-overlap"),f.el.classList.add("is-overlap"),W(w.el),W(f.el);const S={left:g.left-w.rect.left,top:g.top-w.rect.top,width:g.width,height:g.height},A={left:g.left-f.rect.left,top:g.top-f.rect.top,width:g.width,height:g.height},h=document.createElement("div");h.className="schedule-entry-overlap-rect",h.style.left=`${S.left}px`,h.style.top=`${S.top}px`,h.style.width=`${S.width}px`,h.style.height=`${S.height}px`,w.overlapLayerEl.appendChild(h);const y=document.createElement("div");y.className="schedule-entry-overlap-rect",y.style.left=`${A.left}px`,y.style.top=`${A.top}px`,y.style.width=`${A.width}px`,y.style.height=`${A.height}px`,f.overlapLayerEl.appendChild(y)}const j=25,q=30,F=6,B=0;N.forEach(x=>{const I=T.filter(f=>f.day===x).sort((f,g)=>f.rect.top-g.rect.top),w=[];I.forEach(f=>{const g=f.rect.left+F;let S=f.rect.top+B,A=0;const h=f.rect.width-F*2,y=26;for(;A<q;){const b={left:g,top:S,right:g+h,bottom:S+y};if(b.bottom>f.rect.bottom-B)break;if(!Kt(b,w)){const P=S-f.rect.top;f.textEl.style.transform=`translateY(${P}px)`,w.push(b);return}S+=j,A++}f.textEl.style.transform=`translateY(${B}px)`,w.push({left:g,top:f.rect.top+B,right:g+h,bottom:f.rect.top+B+y})})})}function Vt(t,n,e){if(!t.scheduleGrid)return;t.scheduleGrid.innerHTML="";const o=Pt(n),s=Ut(o),r=Wt(s),i=Zt();t.scheduleGrid.appendChild(i),Jt(i,o),Gt(t,r)}const ut=t=>{if(t==null)return"";const n=String(t);return/[",\n]/.test(n)?`"${n.replace(/"/g,'""')}"`:n},Qt=(t,n)=>{const e=n.map(ut).join(","),o=t.map(s=>n.map(r=>ut(s[r]??"")).join(",")).join(`
`);return e+`
`+o};function te(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],n=Qt(u.filtered,t),e=new Blob([n],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(e),s=document.createElement("a");s.href=o,s.download="captured-courses.csv",document.body.appendChild(s),s.click(),setTimeout(()=>{URL.revokeObjectURL(o),s.remove()},100)}const Z="wdSavedSchedules",gt=6,ee=t=>typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t||[])),tt=t=>Array.isArray(t)?t.filter(n=>n&&Array.isArray(n.courses)).map(n=>({id:n.id,name:n.name||"Untitled",savedAt:n.savedAt||new Date().toISOString(),courses:n.courses})):[],yt=typeof chrome<"u"&&chrome.storage&&chrome.storage.local;async function ne(){if(yt)return new Promise(t=>{chrome.storage.local.get([Z],n=>{t(tt(n?.[Z]||[]))})});try{const t=localStorage.getItem(Z);return t?tt(JSON.parse(t)):[]}catch(t){return console.warn("[WD] Failed to load saved schedules",t),[]}}async function mt(t){const n=tt(t);if(yt)return new Promise(e=>{chrome.storage.local.set({[Z]:n},e)});try{localStorage.setItem(Z,JSON.stringify(n))}catch(e){console.warn("[WD] Failed to save schedules",e)}}function oe(t,n){return{id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,name:t||"Untitled",savedAt:new Date().toISOString(),courses:ee(n||[])}}function se(t){const n=t.courses?.length||0,e=new Date(t.savedAt),o=Number.isNaN(e.getTime())?t.savedAt:e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return`${n} courses · Saved ${o}`}function J(t,n){if(t.savedMenu){if(t.savedMenu.innerHTML="",!n.length){const e=document.createElement("div");e.className="schedule-saved-empty",e.textContent="No saved schedules yet.",t.savedMenu.appendChild(e);return}n.forEach(e=>{const o=document.createElement("div");o.className="schedule-saved-card",o.dataset.id=e.id;const s=document.createElement("div");s.className="schedule-saved-card-header";const r=document.createElement("div"),i=document.createElement("div");i.className="schedule-saved-title",i.textContent=e.name;const a=document.createElement("div");a.className="schedule-saved-meta",a.textContent=se(e),r.appendChild(i),r.appendChild(a),s.appendChild(r);const d=document.createElement("div");d.className="schedule-saved-actions";const l=document.createElement("button");l.type="button",l.className="schedule-saved-action",l.dataset.action="load",l.textContent="Load";const c=document.createElement("button");c.type="button",c.className="schedule-saved-action delete",c.dataset.action="delete",c.textContent="Delete",d.appendChild(l),d.appendChild(c),o.appendChild(s),o.appendChild(d),t.savedMenu.appendChild(o)})}}function re(t){return t.length<gt}function ie(){return gt}(()=>{console.log("[WD] content script loaded");async function t(){const n=bt(),e=await Ct(n);e.button.classList.toggle("is-collapsed",e.widget.classList.contains("is-hidden"));const o=()=>{Vt(e,u.filtered)},s=l=>{u.view.panel=l,e.panels.forEach(c=>{c.classList.toggle("is-active",c.dataset.panel===l)}),e.tabButtons.forEach(c=>{c.classList.toggle("is-active",c.dataset.panel===l)}),e.widget.classList.toggle("is-schedule-view",l==="schedule")},r=()=>{e.widget.classList.toggle("is-hidden"),e.button.classList.toggle("is-collapsed",e.widget.classList.contains("is-hidden"))};let i=null;const a=l=>{e.saveModal&&(e.saveModal.classList.add("is-hidden"),e.saveModal.setAttribute("aria-hidden","true"),i&&(i(l),i=null))},d=({title:l,message:c,confirmLabel:m="Save",showInput:v=!0,showCancel:C=!0})=>e.saveModal?(e.saveModalTitle.textContent=l,e.saveModalMessage.textContent=c,e.saveModalConfirm.textContent=m,e.saveModalField.classList.toggle("is-hidden",!v),e.saveModalCancel.classList.toggle("is-hidden",!C),e.saveModalInput.value="",e.saveModalInput.classList.remove("is-invalid"),e.saveModal.classList.remove("is-hidden"),e.saveModal.setAttribute("aria-hidden","false"),v?e.saveModalInput.focus():e.saveModalConfirm.focus(),new Promise(M=>{i=M})):Promise.resolve(null);e.saveModal&&(E(e.saveModal,"click",l=>{if(l.target===e.saveModal){a(null);return}const c=l.target.closest("[data-action]")?.dataset.action;if(c){if(c==="close"||c==="cancel"){a(null);return}if(c==="confirm"){if(!e.saveModalField.classList.contains("is-hidden")){const m=e.saveModalInput.value.trim();if(!m){e.saveModalInput.classList.add("is-invalid"),e.saveModalInput.focus();return}a(m);return}a(!0)}}}),E(e.saveModalInput,"input",()=>{e.saveModalInput.classList.remove("is-invalid")}),E(e.saveModalInput,"keydown",l=>{l.key==="Enter"&&e.saveModalConfirm.click()}),E(document,"keydown",l=>{l.key==="Escape"&&e.saveModal&&!e.saveModal.classList.contains("is-hidden")&&a(null)})),e.tabButtons.forEach(l=>{E(l,"click",()=>{s(l.dataset.panel),l.dataset.panel==="schedule"&&o()})}),e.semesterButtons.forEach(l=>{E(l,"click",()=>{u.view.semester=l.dataset.semester,e.semesterButtons.forEach(c=>{c.classList.toggle("is-active",c.dataset.semester===u.view.semester)}),o()})}),E(e.button,"click",r),E(document,"click",l=>{if(!e.savedDropdown?.open)return;const c=l.composedPath?l.composedPath():[];c.includes(e.savedDropdown)||!c.length&&e.savedDropdown.contains(l.target)||(e.savedDropdown.open=!1)}),chrome.runtime.onMessage.addListener(l=>{l?.type==="TOGGLE_WIDGET"&&r()}),E(e.refresh,"click",async()=>{u.courses=await st(),it(e.search.value),Y(u.sort.key||"code"),G(e,u.filtered),o()}),E(e.exportBtn,"click",te),E(e.saveScheduleBtn,"click",async()=>{if(!re(u.savedSchedules)){await d({title:"Schedule limit reached",message:`You can only save up to ${ie()} schedules. Delete one to save another.`,confirmLabel:"Got it",showInput:!1,showCancel:!1});return}const l=await d({title:"Save schedule",message:"Name this schedule so you can find it later.",confirmLabel:"Save",showInput:!0,showCancel:!0});if(!l)return;const c=oe(l,u.filtered);u.savedSchedules=[c,...u.savedSchedules],await mt(u.savedSchedules),J(e,u.savedSchedules),e.savedDropdown&&(e.savedDropdown.open=!0)}),E(e.savedMenu,"click",async l=>{const c=l.target.closest("[data-action]");if(!c)return;const v=c.closest(".schedule-saved-card")?.dataset.id;if(!v)return;if(c.dataset.action==="delete"){u.savedSchedules=u.savedSchedules.filter(M=>M.id!==v),await mt(u.savedSchedules),J(e,u.savedSchedules);return}const C=u.savedSchedules.find(M=>M.id===v);C&&(u.courses=[...C.courses],u.filtered=[...C.courses],e.search.value="",Y(u.sort.key||"code"),G(e,u.filtered),o(),s("schedule"),e.savedDropdown&&(e.savedDropdown.open=!1))}),E(e.settingsBtn,"click",()=>{e.widget.classList.remove("is-hidden"),e.button.classList.remove("is-collapsed"),s("settings")}),E(e.search,"input",St(()=>{it(e.search.value),Y(u.sort.key||"code"),G(e,u.filtered),o()},100)),Rt(e),u.savedSchedules=await ne(),J(e,u.savedSchedules),u.courses=await st(),u.filtered=[...u.courses],Y("code"),G(e,u.filtered),o(),s(u.view.panel)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();
//# sourceMappingURL=content.js.map
