{"version":3,"file":"content.js","sources":["../src/utilities/debugTool.js","../src/utilities/dom.js","../src/core/state.js","../src/utilities/shadowMount.js","../src/panel/loadPanel.js","../src/extraction/grid.js","../src/extraction/parsers/sectionLinkInfo.js","../src/extraction/parsers/meetingPatternsInfo.js","../src/extraction/rowCellReader.js","../src/extraction/extractCourses.js","../src/panel/renderRows.js","../src/panel/panelInteractions.js","../src/panel/scheduleView.js","../src/export-logic/export-ics.js","../src/panel/scheduleStorage.js","../src/content.js"],"sourcesContent":["const logConfiguration = {\r\n  global: true, // master switch (all logs everywhere)\r\n  local: {}, // per-scope switch: { \"schedule\": true/false, ... }\r\n  log: {}, // per-log switch: { \"schedule.render\": true/false, ... }\r\n};\r\n\r\n// this function updates the logging configuration state:\r\n// debugLog({ global: false })                    -> turns ALL logs off (global control)\r\n// debugLog({ local: { schedule: true } })        -> turns logs ON for the \"schedule\" module (local control)\r\n// debugLog({ log: { \"schedule.render\": false }}) -> disables logging for the \"schedule.render\" function (specific log control)\r\nexport const debugLog = ({ global, local, log } = {}) => {\r\n  if (typeof global === \"boolean\") logConfiguration.global = global;\r\n\r\n  if (local && typeof local === \"object\") {\r\n    for (const [k, v] of Object.entries(local)) {\r\n      if (typeof v === \"boolean\") logConfiguration.local[k] = v;\r\n    }\r\n  }\r\n\r\n  if (log && typeof log === \"object\") {\r\n    for (const [k, v] of Object.entries(log)) {\r\n      if (typeof v === \"boolean\") logConfiguration.log[k] = v;\r\n    }\r\n  }\r\n};\r\n\r\n// quick read of current config settings (for debugging this file)\r\nexport const getLogConfiguration = () => ({\r\n  global: logConfiguration.global,\r\n  local: { ...logConfiguration.local },\r\n  log: { ...logConfiguration.log },\r\n});\r\n\r\n// logic to decide if a log should print\r\nconst loggingIsOn = (scope, id) => {\r\n  if (!logConfiguration.global) return false; // If global logging is off, return immediately\r\n\r\n  if (scope && logConfiguration.local[scope] === false) return false; // Local control check\r\n  if (id && logConfiguration.log[id] === false) return false; // Specific log control\r\n\r\n  return true; // Default: logs are ON\r\n};\r\n\r\n// main logger factory for a given scope (file/module), eg. const D = debugFor(\"schedule\");\r\nexport const debugFor = (scope) => {\r\n  const prefix = scope ? `[Workday - Schedule Tool (file: ${scope})]\\n` : \"[Workday - Schedule Tool]\\n\"; // prefix at the start of all logs\r\n\r\n  // .log can either be the message (string), .log(\"message\"), or a meta object, .log({ id: \"schedule.render\" }, \"message\"),\r\n  // or both, .log({ id: \"schedule.render\", on: false }, \"message\")\r\n  // ...rest means it can also take in any additional arguments (an object, an array, etc.)\r\n  const log = (metaOrMsg, ...rest) => {\r\n    let meta = null;\r\n    let args = null;\r\n\r\n    if (metaOrMsg && typeof metaOrMsg === \"object\" && !Array.isArray(metaOrMsg)) {\r\n      meta = metaOrMsg;\r\n      args = rest;\r\n    } else {\r\n      meta = null;\r\n      args = [metaOrMsg, ...rest];\r\n    }\r\n\r\n    const id = meta?.id;\r\n    const forceOn = meta?.on === true; // if forceOn is true, this forces the log to show regardless of global/local/log settings.\r\n    const forceOff = meta?.on === false; // if forceOff is true, immediately return (log is disabled for this specific call).\r\n\r\n    if (forceOff) return;\r\n    if (!forceOn && !loggingIsOn(scope, id)) return;\r\n\r\n    console.log(prefix, ...args);\r\n  };\r\n\r\n  // same as log but for warnings\r\n  const warning = (metaOrMsg, ...rest) => {\r\n    let meta = null;\r\n    let args = null;\r\n\r\n    if (metaOrMsg && typeof metaOrMsg === \"object\" && !Array.isArray(metaOrMsg)) {\r\n      meta = metaOrMsg;\r\n      args = rest;\r\n    } else {\r\n      args = [metaOrMsg, ...rest];\r\n    }\r\n\r\n    const id = meta?.id;\r\n    const forceOn = meta?.on === true;\r\n    const forceOff = meta?.on === false;\r\n\r\n    if (forceOff) return;\r\n    if (!forceOn && !loggingIsOn(scope, id)) return;\r\n\r\n    console.log(\"‚ö†Ô∏è\", prefix, ...args);\r\n  };\r\n\r\n  // same as log but for errors\r\n  const error = (metaOrMsg, ...rest) => {\r\n    let meta = null;\r\n    let args = null;\r\n\r\n    if (metaOrMsg && typeof metaOrMsg === \"object\" && !Array.isArray(metaOrMsg)) {\r\n      meta = metaOrMsg;\r\n      args = rest;\r\n    } else {\r\n      args = [metaOrMsg, ...rest];\r\n    }\r\n\r\n    const id = meta?.id;\r\n    const forceOn = meta?.on === true;\r\n    const forceOff = meta?.on === false;\r\n\r\n    if (forceOff) return;\r\n    if (!forceOn && !loggingIsOn(scope, id)) return;\r\n\r\n    console.log(\"üö©\", prefix, ...args);\r\n  };\r\n\r\n  // Convenience toggles for this scope (still goes through debugLog under the hood)\r\n  const on = () => debugLog({ local: { [scope]: true } });\r\n  const off = () => debugLog({ local: { [scope]: false } });\r\n\r\n  return { log, warn: warning, error, on, off };\r\n};\r\n","import { debugFor } from \"./debugTool.js\";\r\nconst debug = debugFor(\"dom\");\r\n\r\n// shortcut for querySelector in shadowDom\r\nexport const $ = (root, sel) => {\r\n  debug.log(\"Querying single element:\", { root, sel });\r\n  return root.querySelector(sel);\r\n};\r\n\r\n// shortcut for querySelectorAll in shadowDom, turns result into an array\r\nexport const $$ = (root, sel) => {\r\n  debug.log(\"Querying multiple elements:\", { root, sel });\r\n  return Array.from(root.querySelectorAll(sel));\r\n};\r\n\r\n// if el exists, attaches event listener to el\r\nexport const on = (el, ev, fn, opts) => {\r\n  if (el) {\r\n    debug.log(\"Attaching event listener:\", { el, ev, opts });\r\n    el.addEventListener(ev, fn, opts);\r\n  }\r\n};\r\n\r\n// limits how often a function is called, sets a timer and function can only be called again after timer is complete\r\nexport const debounce = (fn, ms = 300) => {\r\n  let t;\r\n  return (...a) => {\r\n    debug.log(\"Debouncing function call with delay:\", { fn, ms, args: a });\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n};\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"state\");\r\n\r\nexport const STATE = {\r\n  // list of courses extracted from workday\r\n  courses: [],\r\n\r\n  // list of filtered courses, used for searching and sorting\r\n  filtered: [],\r\n\r\n  // list of user saved schedules\r\n  savedSchedules: [],\r\n\r\n  // tracks current sorting state, key: field name, dir: 1 ascending, -1 descending eg. STATE.sort = { key: \"startTime\", dir: -1 };\r\n  sort: { key: null, dir: 1 },\r\n\r\n  // tracks viewing state, panel: current extension page, semester: current semester tab\r\n  view: {\r\n    panel: \"list\",\r\n    semester: \"first\",\r\n  },\r\n\r\n  setCourses(newCourses) {\r\n    this.courses = newCourses;\r\n    debug.log(\"Courses updated:\", newCourses);\r\n  },\r\n\r\n  setFiltered(filteredCourses) {\r\n    this.filtered = filteredCourses;\r\n    debug.log(\"Filtered courses updated:\", filteredCourses);\r\n  },\r\n\r\n  setSavedSchedules(saved) {\r\n    this.savedSchedules = saved;\r\n    debug.log(\"Saved schedules updated:\", saved);\r\n  },\r\n\r\n  setSort(sortState) {\r\n    this.sort = sortState;\r\n    debug.log(\"Sorting state updated:\", sortState);\r\n  },\r\n\r\n  setView(viewState) {\r\n    this.view = viewState;\r\n    debug.log(\"View state updated:\", viewState);\r\n  },\r\n};\r\n","import { debugFor } from \"./debugTool.js\";\r\nconst debug = debugFor(\"shadowMount\");\r\n\r\n// extension ID\r\nconst EXT_ID = \"Workday - Schedule Tool\";\r\n\r\n// first time it's called it mounts the extension, in subsequent calls it returns the extension's shadow root\r\nexport function ensureMount() {\r\n  let host = document.getElementById(EXT_ID);\r\n\r\n  if (host) {\r\n    debug.log(\"Returning existing shadow root:\", host);\r\n    return host.shadowRoot;\r\n  }\r\n\r\n  // creates container for extension, sets styles, then appends extension to the page\r\n  host = document.createElement(\"div\");\r\n  host.id = EXT_ID;\r\n  host.style.all = \"initial\";\r\n  host.style.position = \"fixed\";\r\n  host.style.bottom = \"16px\";\r\n  host.style.right = \"16px\";\r\n  host.style.zIndex = \"999999999\";\r\n  host.attachShadow({ mode: \"open\" });\r\n  document.documentElement.appendChild(host);\r\n\r\n  debug.log(\"Mounted new extension container:\", host);\r\n  return host.shadowRoot;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"loadPanel\");\r\n\r\nexport async function loadPanel(shadow) {\r\n  const htmlUrl = chrome.runtime.getURL(\"src/panel.html\");\r\n  const cssFiles = [\r\n    \"formatting/general.css\",\r\n    \"formatting/widget-shell.css\",\r\n    \"formatting/widget-buttons.css\",\r\n    \"formatting/floating-button.css\",\r\n    \"formatting/course-list.css\",\r\n    \"formatting/schedule-view.css\",\r\n    \"formatting/schedule-view-events.css\",\r\n    \"formatting/settings.css\",\r\n    \"colors/course-list-colors.css\",\r\n    \"colors/general-colors.css\",\r\n    \"colors/schedule-view-colors.css\",\r\n    \"colors/widget-functionality-colors.css\",\r\n    \"colors/settings-colors.css\",\r\n  ];\r\n\r\n  debug.log(\"Fetching HTML and CSS files...\");\r\n\r\n  const [html, ...cssParts] = await Promise.all([\r\n    fetch(htmlUrl).then((r) => r.text()),\r\n    ...cssFiles.map((file) => fetch(chrome.runtime.getURL(`src/css/${file}`)).then((r) => r.text())),\r\n  ]);\r\n\r\n  const css = cssParts.join(\"\\n\");\r\n  debug.log(\"CSS files fetched and concatenated:\", { cssParts });\r\n\r\n  shadow.innerHTML = \"\"; // Clear previous content\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = css;\r\n  shadow.appendChild(style);\r\n  debug.log(\"Appended styles to shadow DOM.\");\r\n\r\n  // Check if Material Symbols font is already included, if not, append it\r\n  if (!document.querySelector('link[href*=\"Material+Symbols\"]')) {\r\n    const link = document.createElement(\"link\");\r\n    link.rel = \"stylesheet\";\r\n    link.href =\r\n      \"https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\";\r\n    document.head.appendChild(link);\r\n    debug.log(\"Appended Material Symbols font to document head.\");\r\n  }\r\n\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.innerHTML = html;\r\n  shadow.appendChild(wrap);\r\n  debug.log(\"Appended HTML content to shadow DOM.\");\r\n\r\n  // Return an object with all the necessary DOM elements from the shadow root\r\n  const elements = {\r\n    button: shadow.querySelector(\"#floating-button\"),\r\n    widget: shadow.querySelector(\".widget\"),\r\n    root: shadow,\r\n    search: shadow.querySelector(\"#widget-search\"),\r\n    saveScheduleBtn: shadow.querySelector(\"#widget-save-schedule\"),\r\n    refresh: shadow.querySelector(\"#widget-refresh\"),\r\n    exportDropdown: shadow.querySelector(\"#widget-export\"),\r\n    exportButton: shadow.querySelector(\"#widget-export-button\"),\r\n    exportMenu: shadow.querySelector(\"#widget-export-menu\"),\r\n    helpBtn: shadow.querySelector(\".help\"),\r\n    settingsBtn: shadow.querySelector(\".settings\"),\r\n    tableBody: shadow.querySelector(\"tbody\"),\r\n    tableHead: shadow.querySelector(\"thead\"),\r\n    tabButtons: shadow.querySelectorAll(\".tab-button\"),\r\n    panels: shadow.querySelectorAll(\".widget-panel\"),\r\n    scheduleGrid: shadow.querySelector(\"#schedule-grid\"),\r\n    semesterButtons: shadow.querySelectorAll(\".semester-button\"),\r\n    savedDropdown: shadow.querySelector(\"#schedule-saved-dropdown\"),\r\n    savedMenu: shadow.querySelector(\"#schedule-saved-menu\"),\r\n    footerConflicts: shadow.querySelector(\"#widget-conflicts\"),\r\n    saveModal: shadow.querySelector(\"#schedule-save-modal\"),\r\n    saveModalTitle: shadow.querySelector(\"#schedule-modal-title\"),\r\n    saveModalMessage: shadow.querySelector(\"#schedule-modal-message\"),\r\n    saveModalField: shadow.querySelector(\"#schedule-modal-field\"),\r\n    saveModalInput: shadow.querySelector(\"#schedule-modal-input\"),\r\n    saveModalCancel: shadow.querySelector(\".schedule-modal-cancel\"),\r\n    saveModalConfirm: shadow.querySelector(\".schedule-modal-confirm\"),\r\n  };\r\n\r\n  debug.log(\"DOM elements loaded:\", elements);\r\n\r\n  return elements;\r\n}\r\n","// src/extraction/grid.js\r\nimport { $$ } from \"../utilities/dom\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"grid\");\r\n\r\n// -------------------------\r\n// Text helpers\r\n// -------------------------\r\nexport const normalizeText = (s) =>\r\n  String(s || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .replace(/\\s+/g, \" \")\r\n    .trim()\r\n    .toLowerCase();\r\n\r\nexport function getHeaderText(headerEl) {\r\n  if (!headerEl) return \"\";\r\n\r\n  const btn = headerEl.querySelector(\"button[title]\");\r\n  if (btn) return (btn.getAttribute(\"title\") || \"\").trim();\r\n\r\n  return (headerEl.textContent || \"\").trim();\r\n}\r\n\r\n// -------------------------\r\n// Header maps\r\n// -------------------------\r\nfunction getHeaderKey(el) {\r\n  const a = el?.getAttribute?.(\"data-automation-id\") || \"\";\r\n  const m = a.match(/^columnHeader(\\d+\\.\\d+)$/);\r\n  return m ? m[1] : null; // \"252.9\"\r\n}\r\n\r\nexport function buildHeaderMaps(gridRoot) {\r\n  const headerEls = Array.from(gridRoot.querySelectorAll('th[data-automation-id^=\"columnHeader\"]'));\r\n\r\n  debug.log({ id: \"buildHeaderMaps.headers\" }, \"Header elements found:\", headerEls.length);\r\n\r\n  const headers = headerEls\r\n    .map((el, pos) => {\r\n      const text = getHeaderText(el);\r\n      const key = getHeaderKey(el); // \"252.9\"\r\n      return { el, pos, key, text, norm: normalizeText(text) };\r\n    })\r\n    .filter((h) => h.text);\r\n\r\n  debug.log(\r\n    { id: \"buildHeaderMaps.parsedHeaders\" },\r\n    \"Parsed headers:\",\r\n    headers.map((h) => ({ pos: h.pos, key: h.key, text: h.text, norm: h.norm }))\r\n  );\r\n\r\n  function findHeader(needles) {\r\n    const ns = needles.map(normalizeText);\r\n    let hit = headers.find((h) => ns.includes(h.norm));\r\n    if (hit) return hit;\r\n    hit = headers.find((h) => ns.some((n) => h.norm.includes(n)));\r\n    return hit || null;\r\n  }\r\n\r\n  const KEYS = {\r\n    instructor: [\"instructor\", \"instructors\"],\r\n    meeting: [\"meeting patterns\", \"meeting pattern\"],\r\n    deliveryMode: [\"delivery mode\"],\r\n    title: [\"title\", \"course listing\"],\r\n    section: [\"section\"],\r\n    instructionalFormat: [\"instructional format\"],\r\n    startDate: [\"start date\", \"start\"],\r\n  };\r\n\r\n  const colMap = {};\r\n  const posMap = {};\r\n\r\n  for (const [key, needles] of Object.entries(KEYS)) {\r\n    const hit = findHeader(needles);\r\n    colMap[key] = hit ? hit.key : null; // store \"252.9\"\r\n    posMap[key] = hit ? hit.pos : -1;\r\n\r\n    debug.log({ id: \"buildHeaderMaps.map\" }, \"Mapped header:\", {\r\n      key,\r\n      needles,\r\n      hit: hit ? { pos: hit.pos, colKey: hit.key, text: hit.text } : null,\r\n    });\r\n  }\r\n\r\n  return { colMap, posMap };\r\n}\r\n\r\n// -------------------------\r\n// Grid/table finding\r\n// -------------------------\r\nexport function findWorkdayGrid() {\r\n  const roots = $$(\r\n    document,\r\n    `\r\n  table,\r\n  [role=\"table\"],\r\n  [role=\"grid\"],\r\n  div[data-automation-id*=\"grid\"],\r\n  div[data-automation-id*=\"Grid\"],\r\n  div[data-automation-id=\"gridContainer\"],\r\n  div[data-automation-id=\"responsiveDataTable\"],\r\n  div[data-automation-id=\"tableContainer\"]\r\n`\r\n  );\r\n\r\n  debug.log({ id: \"findWorkdayGrid.roots\" }, \"Candidate roots found:\", roots.length);\r\n\r\n  for (const root of roots) {\r\n    const headerEls = $$(\r\n      root,\r\n      `\r\n  thead th,\r\n  [role=\"columnheader\"],\r\n  div[data-automation-id*=\"columnHeader\"],\r\n  .wd-GridHeaderCell,\r\n  .grid-column-header\r\n`\r\n    );\r\n\r\n    const headerText = headerEls.map((h) => normalizeText(getHeaderText(h)));\r\n\r\n    // still require \"section\" + at least one other expected header\r\n    const looksRight =\r\n      headerText.some((t) => t.includes(\"section\")) &&\r\n      (headerText.some((t) => t.includes(\"instructor\")) ||\r\n        headerText.some((t) => t.includes(\"meeting\")) ||\r\n        headerText.some((t) => t.includes(\"instructional format\")) ||\r\n        headerText.some((t) => t.includes(\"format\")) ||\r\n        headerText.some((t) => t.includes(\"status\")));\r\n\r\n    debug.log({ id: \"findWorkdayGrid.scanRoot\" }, \"Scanning root:\", {\r\n      headerCount: headerEls.length,\r\n      looksRight,\r\n      headerText,\r\n    });\r\n\r\n    if (!looksRight) continue;\r\n\r\n    const rows = $$(root, \"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row\");\r\n\r\n    debug.log({ id: \"findWorkdayGrid.rows\" }, \"Rows found for matching root:\", rows.length);\r\n\r\n    if (rows.length) return { root, rows };\r\n  }\r\n\r\n  debug.log({ id: \"findWorkdayGrid.none\" }, \"No matching table/grid found\");\r\n  return null;\r\n}\r\n","import { debugFor } from \"../../utilities/debugTool\";\r\n\r\nconst debug = debugFor(\"sectionLinkInfo\");\r\n\r\n/* Parse the Workday \"promptOption\" section link string. */\r\nexport function parseSectionLinkString(input) {\r\n  let str = String(input || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .trim();\r\n\r\n  debug.log({ id: \"parseSectionLinkString.input\" }, \"Raw input:\", input);\r\n\r\n  if (!str) return null;\r\n\r\n  // keep ALL lines; Workday wraps titles with \\n\r\n  str = str.replace(/\\s*\\n\\s*/g, \" \").trim();\r\n\r\n  debug.log({ id: \"parseSectionLinkString.normalized\" }, \"Normalized string:\", str);\r\n\r\n  // REQUIRED pattern:\r\n  const m = str.match(/^\\s*([A-Z][A-Z0-9_]*\\s*\\d{3}[A-Z]?)\\s*-\\s*(.+?)\\s*$/);\r\n  if (!m) {\r\n    debug.log({ id: \"parseSectionLinkString.noMatch\" }, \"String did not match expected pattern\");\r\n    return null;\r\n  }\r\n\r\n  const baseCode = m[1].trim(); // \"COSC_O 222\"\r\n  const rest = m[2].trim(); // \"L2D - Data Structures\" or \"101 - Data Structures\"\r\n\r\n  debug.log({ id: \"parseSectionLinkString.match\" }, \"Regex match:\", { baseCode, rest });\r\n\r\n  // Split rest into section token + title\r\n  const parts = rest\r\n    .split(/\\s*[-‚Äì‚Äî]\\s*/)\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  let sectionToken = \"\";\r\n  let parsedTitle = \"\";\r\n\r\n  sectionToken = parts[0];\r\n  parsedTitle = parts.slice(1).join(\" - \").trim();\r\n\r\n  parsedTitle = parsedTitle.replace(/\\s*:\\s*/g, \":\\n\");\r\n\r\n  const result = {\r\n    code: baseCode,\r\n    section_number: sectionToken,\r\n    title: parsedTitle,\r\n    full: str,\r\n  };\r\n\r\n  debug.log({ id: \"parseSectionLinkString.result\" }, \"Parsed section link result:\", result);\r\n\r\n  return result;\r\n}\r\n\r\nexport function guessClassCode(text) {\r\n  const m = String(text || \"\").match(/[A-Z][A-Z0-9_]*\\s*\\d{2,3}[A-Z]?/);\r\n\r\n  const out = m ? m[0].replace(/\\s+/g, \" \").trim() : \"\";\r\n\r\n  debug.log({ id: \"guessClassCode\" }, \"Guessed class code:\", { input: text, out });\r\n\r\n  return out;\r\n}\r\n","import { debugFor } from \"../../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"meetingPatternsInfo\");\r\n\r\nconst DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\nconst TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\nconst DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\nexport function extractMeetingLines(containerEl) {\r\n  if (!containerEl) {\r\n    debug.log({ id: \"extractMeetingLines.missing\" }, \"No container element provided\");\r\n    return [];\r\n  }\r\n\r\n  const items = Array.from(containerEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n  const lines = items.map((el) => (el.getAttribute(\"aria-label\") || \"\").trim()).filter(Boolean);\r\n\r\n  debug.log({ id: \"extractMeetingLines.items\" }, \"Menu item lines:\", { count: lines.length });\r\n\r\n  const filtered = lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n\r\n  debug.log({ id: \"extractMeetingLines.filtered\" }, \"Filtered meeting lines:\", {\r\n    before: lines.length,\r\n    after: filtered.length,\r\n  });\r\n\r\n  return filtered;\r\n}\r\n\r\nexport function isOnlineDelivery(deliveryModeCellEl) {\r\n  if (!deliveryModeCellEl) {\r\n    debug.log({ id: \"isOnlineDelivery.missing\" }, \"No delivery mode cell provided\");\r\n    return false;\r\n  }\r\n\r\n  const txt = (deliveryModeCellEl.innerText || deliveryModeCellEl.textContent || \"\").trim();\r\n  if (/online learning/i.test(txt)) {\r\n    debug.log({ id: \"isOnlineDelivery.match.direct\" }, \"Matched online learning from cell text\", txt);\r\n    return true;\r\n  }\r\n\r\n  const prompts = Array.from(deliveryModeCellEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n\r\n  const matched = prompts.some((el) => {\r\n    const label = el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\";\r\n    return /online learning/i.test(label);\r\n  });\r\n\r\n  debug.log({ id: \"isOnlineDelivery.match.prompts\" }, \"Checked prompt options for online learning\", {\r\n    promptCount: prompts.length,\r\n    matched,\r\n  });\r\n\r\n  return matched;\r\n}\r\n\r\n// Back-compat exports (optional, but keeps other files working)\r\nexport function extractMeetingLinesFromCell(meetingEl) {\r\n  return extractMeetingLines(meetingEl);\r\n}\r\n\r\nexport function extractMeetingLinesFromRow(rowEl) {\r\n  return extractMeetingLines(rowEl);\r\n}\r\n\r\nexport function formatMeetingLineForPanel(line) {\r\n  const raw = String(line || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .trim();\r\n\r\n  // Workday often gives:\r\n  // \"YYYY-MM-DD - YYYY-MM-DD | Tue / Thu | 12:30 p.m. - 2:00 p.m. Engineering ... (EME) Floor: 1 | Room: 0050\"\r\n  const parts = raw\r\n    .split(\"|\")\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  // Days usually live in their own \"|\" part\r\n  const dayPartRaw = parts.find((p) => /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i.test(p) && !/\\d{1,2}:\\d{2}/.test(p)) || \"\";\r\n\r\n  const dayPart = dayPartRaw.replace(/\\s*\\/\\s*/g, \" / \").trim();\r\n\r\n  // ‚úÖ Extract ONLY the time range (and nothing after it)\r\n  const timeMatch = raw.match(/(\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\s*-\\s*\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?)/i);\r\n  const timePart = timeMatch ? timeMatch[1].replace(/\\s+/g, \" \").trim() : \"\";\r\n\r\n  // ‚úÖ Building is whatever comes AFTER the time range, up until Floor/Room (if present)\r\n  let buildingPart = \"\";\r\n  if (timeMatch) {\r\n    const afterTime = raw.slice(timeMatch.index + timeMatch[1].length);\r\n    buildingPart = afterTime\r\n      .replace(/^[\\s|.\\-‚Äì‚Äî:]+/, \"\") // strip leading separators like \".\" or \"|\"\r\n      .split(/\\b(floor|room|rm)\\b/i)[0] // stop before floor/room\r\n      .trim();\r\n  }\r\n\r\n  // ‚úÖ find Floor/Room anywhere\r\n  const floorMatch = raw.match(/\\bfloor\\b\\s*[:\\-]?\\s*(-?[A-Za-z0-9]+)/i);\r\n  const roomMatch = raw.match(/\\b(room|rm)\\b\\s*[:\\-]?\\s*([A-Za-z0-9]+)/i);\r\n\r\n  const floorPart = floorMatch ? `Floor: ${floorMatch[1]}` : \"\";\r\n  const roomPart = roomMatch ? `Room: ${roomMatch[2]}` : \"\";\r\n\r\n  return {\r\n    days: dayPart,\r\n    time: timePart,\r\n    location: [buildingPart, [floorPart, roomPart].filter(Boolean).join(\" | \")].filter(Boolean).join(\"\\n\"),\r\n  };\r\n}\r\n\r\nexport function normalizeMeetingPatternsText(text) {\r\n  // preserve line breaks, normalize each line\r\n  const normalized = String(text || \"\")\r\n    .split(/\\r?\\n/)\r\n    .map((line) => line.replace(/\\s+/g, \" \").trim())\r\n    .filter(Boolean)\r\n    .join(\"\\n\");\r\n\r\n  debug.log({ id: \"normalizeMeetingPatternsText\" }, \"Normalized meeting patterns text:\", {\r\n    beforeLen: String(text || \"\").length,\r\n    afterLen: normalized.length,\r\n  });\r\n\r\n  return normalized;\r\n}\r\n\r\nexport function extractStartDate(line) {\r\n  const match = String(line || \"\").match(/\\b(\\d{4}-\\d{2}-\\d{2})\\b/);\r\n  const out = match ? match[1] : \"\";\r\n\r\n  debug.log({ id: \"extractStartDate\" }, \"Extracted start date:\", { line, out });\r\n\r\n  return out;\r\n}\r\n","// src/extraction/rowCellReader.js\r\nimport { $$ } from \"../utilities/dom\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"rowCellReader\");\r\n\r\n// maps row cells to Workday keys (e.g., \"252.9\" from \"<div id='gen-dwr-comp-252.9-...'>\")\r\nfunction getCellWorkdayKey(cell) {\r\n  const inner = cell.querySelector('[id^=\"gen-dwr-comp-\"]');\r\n  const id = inner?.id || \"\";\r\n  const m = id.match(/^gen-dwr-comp-(\\d+\\.\\d+)-/);\r\n  return m ? m[1] : null;\r\n}\r\n\r\nexport function createRowCellReader(rowEl, headerMaps) {\r\n  const { colMap: colHeaderMap } = headerMaps || {};\r\n\r\n  const cellsInRow = $$(rowEl, \"td, [role='gridcell']\");\r\n\r\n  debug.log({ id: \"createRowCellReader.start\" }, \"Creating row cell reader:\", {\r\n    cellCount: cellsInRow.length,\r\n  });\r\n\r\n  // store first cell for each Workday key\r\n  const cellByCol = new Map();\r\n  cellsInRow.forEach((cell) => {\r\n    const key = getCellWorkdayKey(cell);\r\n    if (key && !cellByCol.has(key)) cellByCol.set(key, cell);\r\n  });\r\n\r\n  // returns the cell element for a given header name\r\n  const getCellByHeader = (keyName) => {\r\n    const colKey = colHeaderMap?.[keyName];\r\n    if (colKey == null) return null;\r\n    return cellByCol.get(colKey) || null;\r\n  };\r\n\r\n  // returns the text of a cell element for a given header name\r\n  const readCellTextByHeader = (keyName) => {\r\n    const el = getCellByHeader(keyName);\r\n    return (el?.innerText || \"\").trim();\r\n  };\r\n\r\n  return {\r\n    cellsInRow,\r\n    cellByCol,\r\n    getCellByHeader,\r\n    readCellTextByHeader,\r\n  };\r\n}\r\n","// src/extraction/courseExtraction.js\r\nimport { $$ } from \"../utilities/dom.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nimport { buildHeaderMaps, findWorkdayGrid } from \"./grid.js\";\r\nimport { parseSectionLinkString } from \"./parsers/sectionLinkInfo.js\";\r\nimport {\r\n  extractMeetingLinesFromCell,\r\n  formatMeetingLineForPanel,\r\n  normalizeMeetingPatternsText,\r\n  extractStartDate,\r\n  isOnlineDelivery,\r\n} from \"./parsers/meetingPatternsInfo.js\";\r\nimport { createRowCellReader } from \"./rowCellReader.js\";\r\n\r\nconst debug = debugFor(\"courseExtraction\");\r\n\r\n// extracts course data from the table rows\r\nexport async function extractCoursesData() {\r\n  debug.log({ id: \"extractCoursesData.start\" }, \"Starting course extraction\");\r\n\r\n  const found = findWorkdayGrid();\r\n  let courses = [];\r\n\r\n  debug.log(\r\n    { id: \"extractCoursesData.tables\" },\r\n    \"findWorkdayGrid() result:\",\r\n    found\r\n      ? {\r\n          hasRoot: !!found.root,\r\n          rowCount: found.rows?.length || 0,\r\n        }\r\n      : null\r\n  );\r\n\r\n  // if tables exist, build position based header maps\r\n  if (found) {\r\n    const headerMaps = buildHeaderMaps(found.root);\r\n\r\n    debug.log({ id: \"extractCoursesData.headerMaps\" }, \"Built header maps:\", headerMaps);\r\n\r\n    for (const row of found.rows) {\r\n      const c = extractFromRow(row, headerMaps);\r\n      if (c && (c.code || c.title) && Object.values(c).join(\"\").trim()) courses.push(c);\r\n    }\r\n  }\r\n\r\n  // removes duplcicate courses\r\n  const unique = removeDuplicateCourses(courses);\r\n\r\n  debug.log({ id: \"extractCoursesData.done\" }, \"Extraction complete:\", {\r\n    total: courses.length,\r\n    unique: unique.length,\r\n  });\r\n\r\n  return unique; // returns a list of all unique course objects\r\n}\r\n\r\nfunction removeDuplicateCourses(allCourses) {\r\n  const key = (course) => [course.code, course.title, course.section_number].join(\"|\").toLowerCase();\r\n  const seen = new Set();\r\n  const uniqueCourses = [];\r\n\r\n  // only add course to seen list if its not already there\r\n  for (const course of allCourses) {\r\n    const courseKey = key(course);\r\n    if (!seen.has(courseKey)) {\r\n      seen.add(courseKey);\r\n      uniqueCourses.push(course);\r\n    }\r\n  }\r\n\r\n  debug.log({ id: \"removeDuplicateCourses\" }, \"Deduped courses:\", {\r\n    allCourses: allCourses,\r\n    UniqueCourses: uniqueCourses,\r\n    removed: allCourses.length - uniqueCourses.length,\r\n  });\r\n\r\n  return uniqueCourses; // returns a list of all unique course objects\r\n}\r\n\r\n// takes table row and turns it into a single course object\r\nexport function extractFromRow(row, headerMaps) {\r\n  const { getCellByHeader, readCellTextByHeader } = createRowCellReader(row, headerMaps);\r\n\r\n  debug.log({ id: \"extractFromRow.start\" }, \"Extracting row\");\r\n\r\n  // a list of all the links in the row\r\n  const allLinksInRow = $$(row, '[data-automation-id=\"promptOption\"]');\r\n\r\n  // returns first link to match expected section link format\r\n  const sectionLinkEl = allLinksInRow.find((el) => {\r\n    const text =\r\n      el.getAttribute(\"data-automation-label\") ||\r\n      el.getAttribute(\"title\") ||\r\n      el.getAttribute(\"aria-label\") ||\r\n      el.textContent ||\r\n      \"\";\r\n    return /^[A-Z][A-Z0-9_]*\\s*\\d{2,3}-/.test(text);\r\n  });\r\n\r\n  // finds text in the section link element\r\n  const sectionLinkText =\r\n    (sectionLinkEl &&\r\n      (sectionLinkEl.getAttribute(\"data-automation-label\") ||\r\n        sectionLinkEl.getAttribute(\"title\") ||\r\n        sectionLinkEl.getAttribute(\"aria-label\") ||\r\n        sectionLinkEl.textContent)) ||\r\n    \"\";\r\n\r\n  // if there are no links in the row, skip that row\r\n  const sectionDetails = parseSectionLinkString(sectionLinkText);\r\n  if (!sectionDetails) {\r\n    debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: no parsable promptOption\", {\r\n      promptOptions: allLinksInRow.length,\r\n      sectionLinkString: sectionLinkText,\r\n    });\r\n    return null;\r\n  }\r\n\r\n  debug.log({ id: \"extractFromRow.sectionLink\" }, \"Section link:\", {\r\n    promptOptions: allLinksInRow.length,\r\n    hasMatch: !!sectionLinkEl,\r\n    sectionLinkString: sectionLinkText,\r\n  });\r\n\r\n  const instructionalFormatText = readCellTextByHeader(\"instructionalFormat\");\r\n  const startDateText = readCellTextByHeader(\"startDate\");\r\n\r\n  // extracting infomation from the section link text\r\n  const code = sectionDetails.code;\r\n  const title = sectionDetails.title;\r\n  const section_number = sectionDetails.section_number;\r\n\r\n  debug.log({ id: \"extractFromRow.coreParse\" }, \"Core parse result:\", {\r\n    code,\r\n    title,\r\n    section_number,\r\n  });\r\n\r\n  // determine whether this row is for a course, lab, seminar, or discussion\r\n  const labLike = (s) => /\\b(laboratory)\\b/i.test(String(s || \"\"));\r\n  const seminarLike = (s) => /\\bseminar\\b/i.test(String(s || \"\"));\r\n  const discussionLike = (s) => /\\bdiscussion\\b/i.test(String(s || \"\"));\r\n\r\n  const isLab = labLike(instructionalFormatText);\r\n  const isSeminar = seminarLike(instructionalFormatText);\r\n  const isDiscussion = discussionLike(instructionalFormatText);\r\n\r\n  // if row is a lab or seminar, do not set instructor\r\n  let instructor = \"N/A\";\r\n\r\n  if (!isLab && !isSeminar) {\r\n    const instructorText = readCellTextByHeader(\"instructor\");\r\n\r\n    if (!instructorText) {\r\n      debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: missing instructor cell\", {\r\n        code,\r\n        section_number,\r\n      });\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // find meeting cell\r\n  const meetingEl = getCellByHeader(\"meeting\");\r\n  if (!meetingEl) {\r\n    debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: missing meeting cell\", {\r\n      code,\r\n      section_number,\r\n    });\r\n    return null;\r\n  }\r\n\r\n  // extract meeting lines from the meeting cell\r\n  const meetingLines = extractMeetingLinesFromCell(meetingEl) || [];\r\n  if (!meetingLines.length) {\r\n    debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: no meeting lines found in meeting cell\", {\r\n      code,\r\n      section_number,\r\n    });\r\n    return null;\r\n  }\r\n\r\n  const meetingObj = formatMeetingLineForPanel(meetingLines[0]);\r\n\r\n  // delivery mode is OPTIONAL (some grids don't have it)\r\n  const deliveryModeEl = getCellByHeader(\"deliveryMode\");\r\n\r\n  // ‚úÖ fix: only treat as online if we can actually detect it\r\n  const isOnline = deliveryModeEl ? isOnlineDelivery(deliveryModeEl) : false;\r\n\r\n  if (isOnline) meetingObj.location = \"Online\";\r\n\r\n  let meeting = [meetingObj.days, meetingObj.time].filter(Boolean).join(\" | \");\r\n  meeting += `\\n${meetingObj.location || (isOnline ? \"Online\" : \"\")}`.trim();\r\n\r\n  const startDate = extractStartDate(meetingLines[0]) || extractStartDate(startDateText);\r\n\r\n  const result = {\r\n    code,\r\n    title,\r\n    section_number,\r\n    instructor,\r\n    meeting: normalizeMeetingPatternsText(meeting),\r\n    instructionalFormat: (instructionalFormatText || \"\").trim(),\r\n    startDate,\r\n    meetingLines: meetingLines,\r\n    isLab,\r\n    isSeminar,\r\n    isDiscussion,\r\n  };\r\n\r\n  debug.log({ id: \"extractFromRow.result\" }, \"Extracted course:\", {\r\n    code: result.code,\r\n    title: result.title,\r\n    section_number: result.section_number,\r\n    isLab: result.isLab,\r\n    isSeminar: result.isSeminar,\r\n    isDiscussion: result.isDiscussion,\r\n    isOnline,\r\n  });\r\n\r\n  return result;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"renderRows\");\r\n\r\nexport const escHTML = (s) => {\r\n  const result = String(s ?? \"\")\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n  debug.log(\"Escaped HTML:\", { input: s, output: result });\r\n  return result;\r\n};\r\n\r\nfunction cleanLines(text) {\r\n  const cleaned = String(text || \"\")\r\n    .replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \" \") // kill nbsp/zero-width\r\n    .replace(/[ \\t]+\\n/g, \"\\n\") // trailing spaces before newline\r\n    .replace(/\\n[ \\t]+/g, \"\\n\") // leading spaces after newline\r\n    .replace(/\\n{2,}/g, \"\\n\") // collapse multiple newlines\r\n    .trim();\r\n  debug.log(\"Cleaned text lines:\", { input: text, output: cleaned });\r\n  return cleaned;\r\n}\r\n\r\nexport function renderRows(ctx, rows) {\r\n  debug.log(\"Rendering rows:\", rows);\r\n  ctx.tableBody.innerHTML = \"\";\r\n  const frag = document.createDocumentFragment();\r\n\r\n  rows.forEach((c) => {\r\n    const tr = document.createElement(\"tr\");\r\n\r\n    const badge = c.isLab ? \"[Laboratory]\" : c.isSeminar ? \"[Seminar]\" : c.isDiscussion ? \"[Discussion]\" : \"\";\r\n\r\n    tr.innerHTML = `\r\n      <td class=\"title\">\r\n        <div class=\"title-main\">${c.title || \"\"}</div>\r\n        ${badge ? `<div class=\"muted\">${badge}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"code\">${c.code || \"\"}</td>\r\n      <td class=\"sect\">${(c.section_number || \"\").trim()}</td>\r\n      <td class=\"instructor\">${c.instructor || \"\"}</td>\r\n      <td class=\"meeting\">\r\n        ${(() => {\r\n          const parts = cleanLines(c.meeting).split(\"\\n\");\r\n          const main = (parts[0] || \"\").trim();\r\n          const sub = parts\r\n            .slice(1)\r\n            .map((s) => s.replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \"\").trim())\r\n            .filter(Boolean)\r\n            .join(\"\\n\");\r\n          debug.log(\"Processed meeting details:\", { main, sub });\r\n          return `\r\n            ${main ? `<span class=\"meeting-pill\">${escHTML(main).trim()}</span>` : \"\"}\r\n            ${sub ? `<div class=\"meeting-sub\">${escHTML(sub).trim()}</div>` : \"\"}\r\n          `;\r\n        })()}\r\n      </td>\r\n      <td class=\"instructionalFormat\">${c.instructionalFormat || \"\"}</td>\r\n    `;\r\n\r\n    frag.appendChild(tr);\r\n  });\r\n\r\n  ctx.tableBody.appendChild(frag);\r\n  debug.log(\"Rows rendered and added to table body.\");\r\n}\r\n","import { $$, on } from \"../utilities/dom.js\";\r\nimport { STATE } from \"../core/state.js\";\r\nimport { renderRows } from \"./renderRows.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"panelInteractions\");\r\n\r\nexport function applySearchFilter(q) {\r\n  q = (q || \"\").trim().toLowerCase();\r\n  debug.log(\"Search query received:\", q);\r\n\r\n  if (!q) {\r\n    STATE.filtered = [...STATE.courses];\r\n    debug.log(\"Search filter cleared, resetting filtered courses:\", STATE.filtered);\r\n    return;\r\n  }\r\n\r\n  STATE.filtered = STATE.courses.filter((c) => {\r\n    return [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"].some((k) =>\r\n      (c[k] || \"\").toLowerCase().includes(q)\r\n    );\r\n  });\r\n  debug.log(\"Search filter applied, filtered courses:\", STATE.filtered);\r\n}\r\n\r\nexport function sortBy(key) {\r\n  if (!key) return;\r\n\r\n  const dir = STATE.sort.key === key ? -STATE.sort.dir : 1;\r\n  STATE.sort = { key, dir };\r\n  debug.log(\"Sorting by key:\", key, \"Direction:\", dir);\r\n\r\n  const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: \"base\" });\r\n  STATE.filtered.sort((a, b) => dir * collator.compare(a[key] || \"\", b[key] || \"\"));\r\n  debug.log(\"Sorted filtered courses:\", STATE.filtered);\r\n}\r\n\r\nexport function wireSorting(ctx) {\r\n  const headCells = $$(ctx.tableHead, \"th[data-key]\");\r\n  debug.log(\"Table header cells with sorting keys:\", headCells);\r\n\r\n  headCells.forEach((th) => {\r\n    on(th, \"click\", () => {\r\n      const key = th.getAttribute(\"data-key\");\r\n      debug.log(\"Sorting header clicked, sorting by:\", key);\r\n      sortBy(key);\r\n      renderRows(ctx, STATE.filtered);\r\n\r\n      headCells.forEach((h) => h.classList.remove(\"sorted-asc\", \"sorted-desc\"));\r\n      th.classList.add(STATE.sort.dir === 1 ? \"sorted-asc\" : \"sorted-desc\");\r\n      debug.log(\"Updated sorting classes:\", {\r\n        sortedAsc: th.classList.contains(\"sorted-asc\"),\r\n        sortedDesc: th.classList.contains(\"sorted-desc\"),\r\n      });\r\n    });\r\n  });\r\n}\r\n","import { extractStartDate } from \"../extraction/parsers/meetingPatternsInfo.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"scheduleView\");\r\n\r\nconst DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"];\r\nconst START_HOUR = 8;\r\nconst END_HOUR = 21; // last visible hour (exclusive end)\r\nconst SLOT_MINUTES = 30;\r\n\r\n// Build slot start times: 8:00, 8:30, 9:00, ...\r\nconst SLOTS = [];\r\nfor (let h = START_HOUR; h < END_HOUR; h++) {\r\n  SLOTS.push(h * 60);\r\n  SLOTS.push(h * 60 + 30);\r\n}\r\nSLOTS.push(END_HOUR * 60);\r\n\r\nconst DAY_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\nconst TIME_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/gi;\r\n\r\nconst SEMESTER_MONTHS = {\r\n  first: [\"09\", \"08\"],\r\n  second: [\"01\", \"12\"],\r\n};\r\n\r\nfunction parseTimeToken(token) {\r\n  if (!token) return null;\r\n\r\n  const match = token.trim().match(/(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i);\r\n  if (!match) return null;\r\n\r\n  let hours = Number.parseInt(match[1], 10);\r\n  const minutes = Number.parseInt(match[2], 10);\r\n  const period = match[3].toLowerCase();\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return hours * 60 + minutes;\r\n}\r\n\r\nfunction parseMeetingLine(line) {\r\n  const days = String(line || \"\").match(DAY_REGEX) || [];\r\n  const timeTokens = String(line || \"\").match(TIME_REGEX) || [];\r\n\r\n  if (days.length === 0 || timeTokens.length < 2) return null;\r\n\r\n  const startMinutes = parseTimeToken(timeTokens[0]);\r\n  const endMinutes = parseTimeToken(timeTokens[1]);\r\n\r\n  if (startMinutes == null || endMinutes == null) return null;\r\n\r\n  if (endMinutes <= startMinutes) return null;\r\n\r\n  debug.log(\"Parsed meeting line:\", { days, timeTokens, startMinutes, endMinutes });\r\n\r\n  return {\r\n    days: [...new Set(days)],\r\n    startMinutes,\r\n    endMinutes,\r\n    timeLabel: `${timeTokens[0]} - ${timeTokens[1]}`,\r\n  };\r\n}\r\n\r\nfunction getSemester(startDate) {\r\n  if (!startDate) return null;\r\n\r\n  const month = startDate.split(\"-\")[1];\r\n\r\n  const semester = SEMESTER_MONTHS.first.includes(month)\r\n    ? \"first\"\r\n    : SEMESTER_MONTHS.second.includes(month)\r\n    ? \"second\"\r\n    : null;\r\n\r\n  debug.log(\"Determined semester for startDate:\", { startDate, semester });\r\n  return semester;\r\n}\r\n\r\nfunction clampToGrid(minutes) {\r\n  const min = START_HOUR * 60;\r\n  const max = END_HOUR * 60;\r\n  return Math.max(min, Math.min(max, minutes));\r\n}\r\n\r\nfunction snapDownToSlot(minutes) {\r\n  return Math.floor(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction snapUpToSlot(minutes) {\r\n  return Math.ceil(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction slotIndexOf(minutes) {\r\n  return SLOTS.indexOf(minutes);\r\n}\r\n\r\nfunction buildDayEvents(courses, semester) {\r\n  debug.log(\"Building day events for semester:\", semester);\r\n  const eventsByDay = new Map();\r\n  DAYS.forEach((d) => eventsByDay.set(d, []));\r\n\r\n  const seen = new Set();\r\n  let eventId = 0;\r\n\r\n  courses.forEach((course) => {\r\n    const startDate = course.startDate || extractStartDate(course.meetingLines?.[0]) || \"\";\r\n\r\n    const courseSemester = getSemester(startDate);\r\n\r\n    if (courseSemester !== semester) return;\r\n\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n\r\n    const label = course.isLab\r\n      ? \"[Laboratory]\"\r\n      : course.isSeminar\r\n      ? \"[Seminar]\"\r\n      : course.isDiscussion\r\n      ? \"[Discussion]\"\r\n      : \"\";\r\n\r\n    lines.forEach((line) => {\r\n      const parsed = parseMeetingLine(line);\r\n      if (!parsed) return;\r\n\r\n      let startMin = clampToGrid(parsed.startMinutes);\r\n      let endMin = clampToGrid(parsed.endMinutes);\r\n\r\n      startMin = snapDownToSlot(startMin);\r\n      endMin = snapUpToSlot(endMin);\r\n\r\n      const startIdx = slotIndexOf(startMin);\r\n      const endIdx = slotIndexOf(endMin);\r\n\r\n      if (startIdx === -1 || endIdx === -1 || endIdx <= startIdx) return;\r\n\r\n      const rowSpan = endIdx - startIdx;\r\n\r\n      parsed.days.forEach((day) => {\r\n        if (!eventsByDay.has(day)) return;\r\n\r\n        const key = [day, course.code || \"\", course.title || \"\", parsed.timeLabel, startIdx, rowSpan].join(\"|\");\r\n\r\n        if (seen.has(key)) return;\r\n        seen.add(key);\r\n\r\n        eventsByDay.get(day).push({\r\n          id: eventId++,\r\n          code: course.code || \"\",\r\n          title: course.title || \"\",\r\n          label,\r\n          timeLabel: parsed.timeLabel,\r\n\r\n          rowStart: startIdx,\r\n          rowSpan,\r\n\r\n          startIdx,\r\n          endIdx,\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  DAYS.forEach((day) => {\r\n    eventsByDay.get(day).sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n  });\r\n\r\n  debug.log(\"Built day events:\", eventsByDay);\r\n  return eventsByDay;\r\n}\r\n\r\nfunction addConflicts(eventsByDay) {\r\n  debug.log(\"Adding conflicts to events...\");\r\n  const groupedByDay = new Map();\r\n\r\n  DAYS.forEach((day) => {\r\n    const events = (eventsByDay.get(day) || []).slice().sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n\r\n    const groups = [];\r\n\r\n    let current = null;\r\n    let currentKey = null;\r\n\r\n    for (let r = 0; r < SLOTS.length - 1; r++) {\r\n      const active = events.filter((ev) => ev.startIdx <= r && ev.endIdx > r);\r\n      const key = active.length\r\n        ? active\r\n            .map((ev) => ev.id)\r\n            .sort((a, b) => a - b)\r\n            .join(\"|\")\r\n        : null;\r\n\r\n      if (!key) {\r\n        if (current) groups.push(current);\r\n        current = null;\r\n        currentKey = null;\r\n        continue;\r\n      }\r\n\r\n      if (current && key === currentKey) {\r\n        current.end = r + 1;\r\n        continue;\r\n      }\r\n\r\n      if (current) groups.push(current);\r\n\r\n      current = {\r\n        start: r,\r\n        end: r + 1,\r\n        events: active,\r\n        hasConflict: active.length > 1,\r\n      };\r\n      currentKey = key;\r\n    }\r\n\r\n    if (current) groups.push(current);\r\n\r\n    groupedByDay.set(day, groups);\r\n  });\r\n\r\n  debug.log(\"Grouped events with conflicts:\", groupedByDay);\r\n  return groupedByDay;\r\n}\r\n\r\nfunction getConflictSummaries(groupedByDay) {\r\n  const seen = new Set();\r\n  const conflicts = [];\r\n\r\n  groupedByDay.forEach((groups) => {\r\n    groups.forEach((group) => {\r\n      if (!group.hasConflict) return;\r\n\r\n      const codes = [...new Set(group.events.map((ev) => ev.code || ev.title).filter(Boolean))];\r\n\r\n      if (codes.length < 2) return;\r\n\r\n      codes.sort((a, b) => a.localeCompare(b));\r\n\r\n      const key = codes.join(\"|\");\r\n      if (seen.has(key)) return;\r\n      seen.add(key);\r\n      conflicts.push(codes);\r\n    });\r\n  });\r\n\r\n  debug.log(\"Conflict summaries:\", conflicts);\r\n  return conflicts;\r\n}\r\n\r\nfunction updateConflictFooter(ctx, conflicts) {\r\n  if (!ctx?.footerConflicts) return;\r\n\r\n  if (!conflicts.length) {\r\n    ctx.footerConflicts.textContent = \"\";\r\n    return;\r\n  }\r\n\r\n  const conflictList = conflicts.map((codes) => `[${codes.join(\", \")}]`).join(\" \");\r\n\r\n  ctx.footerConflicts.textContent = `‚ö†Ô∏è The following classes are in conflict: ${conflictList}`;\r\n}\r\n\r\nfunction formatSlotLabel(minutes) {\r\n  const h24 = Math.floor(minutes / 60);\r\n  const m = minutes % 60;\r\n\r\n  const hh = String(h24);\r\n  const mm = String(m).padStart(2, \"0\");\r\n  return `${hh}:${mm}`;\r\n}\r\n\r\nfunction buildScheduleTable() {\r\n  // Wrap so we can overlay blocks on top of the table\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.className = \"schedule-table-wrap\";\r\n\r\n  const table = document.createElement(\"table\");\r\n  table.className = \"schedule-table\";\r\n\r\n  const thead = document.createElement(\"thead\");\r\n  const headRow = document.createElement(\"tr\");\r\n\r\n  headRow.innerHTML = `\r\n    <th class=\"schedule-time\"></th>\r\n    ${DAYS.map((day) => `<th class=\"schedule-day-head\" data-day=\"${day}\">${day}</th>`).join(\"\")}\r\n  `;\r\n\r\n  thead.appendChild(headRow);\r\n  table.appendChild(thead);\r\n\r\n  const tbody = document.createElement(\"tbody\");\r\n\r\n  for (let r = 0; r < SLOTS.length; r++) {\r\n    const row = document.createElement(\"tr\");\r\n\r\n    // Time label column\r\n    const timeTd = document.createElement(\"td\");\r\n    timeTd.className = \"schedule-time\";\r\n    timeTd.textContent = formatSlotLabel(SLOTS[r]);\r\n    row.appendChild(timeTd);\r\n\r\n    // Day columns (NO MERGING / NO ROWSPAN)\r\n    DAYS.forEach((day) => {\r\n      const td = document.createElement(\"td\");\r\n      td.className = \"schedule-cell\";\r\n      td.dataset.day = day;\r\n      td.dataset.row = String(r);\r\n\r\n      // Optional: inner div if you want future per-cell stuff\r\n      const inner = document.createElement(\"div\");\r\n      inner.className = \"schedule-cell-inner\";\r\n      td.appendChild(inner);\r\n\r\n      row.appendChild(td);\r\n    });\r\n\r\n    tbody.appendChild(row);\r\n  }\r\n\r\n  table.appendChild(tbody);\r\n  wrap.appendChild(table);\r\n\r\n  // Overlay layer that will hold the floating blocks\r\n  const overlay = document.createElement(\"div\");\r\n  overlay.className = \"schedule-overlay\";\r\n  wrap.appendChild(overlay);\r\n\r\n  return wrap;\r\n}\r\n\r\nfunction rectFromBlock(el) {\r\n  return el.getBoundingClientRect();\r\n}\r\n\r\nfunction renderOverlayBlocks(wrap, eventsByDay, groupedByDay) {\r\n  const overlay = wrap.querySelector(\".schedule-overlay\");\r\n  overlay.innerHTML = \"\";\r\n\r\n  const table = wrap.querySelector(\".schedule-table\");\r\n\r\n  const firstBodyRow = table.querySelector(\"tbody tr\");\r\n  const firstDayCell = table.querySelector('tbody tr td.schedule-cell[data-day=\"Mon\"]');\r\n  const timeTh = table.querySelector(\"thead th.schedule-time\");\r\n\r\n  if (!firstBodyRow || !firstDayCell || !timeTh) return;\r\n\r\n  const timeColWidth = timeTh.getBoundingClientRect().width;\r\n  const dayColWidth = firstDayCell.getBoundingClientRect().width;\r\n  const headerHeight = table.querySelector(\"thead\").getBoundingClientRect().height;\r\n  const rowHeight = firstBodyRow.getBoundingClientRect().height;\r\n\r\n  // --- derive border from CSS (no magic numbers) ---\r\n  const cellStyles = getComputedStyle(firstDayCell);\r\n  const borderLeft = parseFloat(cellStyles.borderLeftWidth) || 0;\r\n  const borderTop = parseFloat(cellStyles.borderTopWidth) || 0;\r\n  const borderRight = parseFloat(cellStyles.borderRightWidth) || 0;\r\n  const borderBottom = parseFloat(cellStyles.borderBottomWidth) || 0;\r\n\r\n  // If borders are uniform, these will be the same; otherwise we keep X/Y separate.\r\n  const borderX = (borderLeft + borderRight) / 2;\r\n  const borderY = (borderTop + borderBottom) / 2;\r\n\r\n  // --- build blocks first (one per event), store rects for overlap detection ---\r\n  const placedBlocks = []; // { el, day, ev, rect, overlapLayerEl, overlaps: [] }\r\n\r\n  DAYS.forEach((day, dayIndex) => {\r\n    const events = eventsByDay.get(day) || [];\r\n\r\n    events.forEach((ev) => {\r\n      const left = timeColWidth + dayIndex * dayColWidth;\r\n      const top = headerHeight + ev.rowStart * rowHeight;\r\n      const height = ev.rowSpan * rowHeight;\r\n\r\n      const block = document.createElement(\"div\");\r\n      block.className = \"schedule-entry-float\";\r\n\r\n      // inset by borders so the block sits inside the cell gridlines\r\n      block.style.left = `${left + borderLeft}px`;\r\n      block.style.top = `${top + borderTop}px`;\r\n      block.style.width = `${dayColWidth - borderX}px`;\r\n      block.style.height = `${height - borderY}px`;\r\n\r\n      // overlap layer (red rectangles go here)\r\n      const overlapLayer = document.createElement(\"div\");\r\n      overlapLayer.className = \"schedule-entry-overlap-layer\";\r\n      block.appendChild(overlapLayer);\r\n\r\n      // text wrapper (MUST be above overlap layer)\r\n      const text = document.createElement(\"div\");\r\n      text.className = \"schedule-entry-text\";\r\n      const title = ev.code || ev.title;\r\n      const titleLabel = ev.label ? `${title} ${ev.label}` : title;\r\n      text.innerHTML = `\r\n        <div class=\"schedule-entry-title\">${titleLabel}</div>\r\n        <div class=\"schedule-entry-time\">${ev.timeLabel}</div>\r\n      `;\r\n      block.appendChild(text);\r\n\r\n      overlay.appendChild(block);\r\n\r\n      placedBlocks.push({\r\n        el: block,\r\n        day,\r\n        ev,\r\n        rect: rectFromBlock(block),\r\n        overlapLayerEl: overlapLayer,\r\n        overlaps: [],\r\n        textEl: text,\r\n      });\r\n    });\r\n  });\r\n\r\n  debug.log(\"Rendered overlay blocks:\", placedBlocks);\r\n}\r\n\r\nexport function renderSchedule(ctx, courses, semester) {\r\n  // pick the container in your panel where the schedule should render\r\n  const host =\r\n    ctx?.scheduleRoot ||\r\n    ctx?.scheduleGrid ||\r\n    ctx?.schedulePanel ||\r\n    ctx?.scheduleContainer ||\r\n    ctx?.scheduleView ||\r\n    ctx?.schedule;\r\n\r\n  if (!host) {\r\n    debug.warn(\"renderSchedule: no schedule host found on ctx\");\r\n    return;\r\n  }\r\n\r\n  const eventsByDay = buildDayEvents(courses || [], semester);\r\n  const groupedByDay = addConflicts(eventsByDay);\r\n  const conflicts = getConflictSummaries(groupedByDay);\r\n\r\n  host.innerHTML = \"\";\r\n  const tableWrap = buildScheduleTable();\r\n  host.appendChild(tableWrap);\r\n\r\n  renderOverlayBlocks(tableWrap, eventsByDay, groupedByDay);\r\n  updateConflictFooter(ctx, conflicts);\r\n}\r\n","import { STATE } from \"../core/state\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"export-ics\");\r\n\r\n// calendar timezone for DTSTART/DTEND (local class times) and RRULE UNTIL (UTC \"Z\" per spec)\r\nconst TZID = \"America/Vancouver\";\r\n\r\n// converts a Date object into this format: YYYYMMDDTHHMMSSZ\r\nconst formatDateTimeUTC = (date) => {\r\n  const y = date.getUTCFullYear();\r\n  const m = pad(date.getUTCMonth() + 1);\r\n  const d = pad(date.getUTCDate());\r\n  const hh = pad(date.getUTCHours());\r\n  const mm = pad(date.getUTCMinutes());\r\n  const ss = pad(date.getUTCSeconds());\r\n  debug.log(\"Formatting UTC Date:\", { y, m, d, hh, mm, ss });\r\n  return `${y}${m}${d}T${hh}${mm}${ss}Z`;\r\n};\r\n\r\n// maps ui's day labels to iCalendar day codes\r\nconst DAY_CODES = {\r\n  Mon: \"MO\",\r\n  Tue: \"TU\",\r\n  Wed: \"WE\",\r\n  Thu: \"TH\",\r\n  Fri: \"FR\",\r\n  Sat: \"SA\",\r\n  Sun: \"SU\",\r\n};\r\n\r\n// used to extract dates, times, and days from a meeting line string\r\nconst date_range_REGEX = /(\\d{4}-\\d{2}-\\d{2})\\s*-\\s*(\\d{4}-\\d{2}-\\d{2})/;\r\nconst time_range_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?\\s*-\\s*(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i;\r\nconst days_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\n\r\n// forces numbers to two digits\r\nconst padNumbers = (value) => String(value).padStart(2, \"0\");\r\n\r\n// ICS date format: YYYYMMDD\r\nconst formatDate = (date) => {\r\n  const year = date.getFullYear();\r\n  const month = padNumbers(date.getMonth() + 1);\r\n  const day = padNumbers(date.getDate());\r\n  debug.log(\"Formatted Date:\", { year, month, day });\r\n  return `${year}${month}${day}`;\r\n};\r\n\r\n// ICS datetime format (local): YYYYMMDDTHHMMSS\r\nconst formatDateTime = (date) => {\r\n  const datePart = formatDate(date);\r\n  const hours = padNumbers(date.getHours());\r\n  const minutes = padNumbers(date.getMinutes());\r\n\r\n  debug.log(\"Formatted DateTime:\", { datePart, hours, minutes });\r\n  return `${datePart}T${hours}${minutes}00`;\r\n};\r\n\r\n// ‚Äúp‚Äù adds 12, unless it‚Äôs 12pm already, ‚Äúa‚Äù turns 12am into 0\r\n// eg. parseTime(\"11\",\"30\",\"p\") -> { hours: 23, minutes: 30 }\r\nconst parseTime = (hoursToken, minutesToken, periodToken) => {\r\n  let hours = Number.parseInt(hoursToken, 10);\r\n  const minutes = Number.parseInt(minutesToken, 10);\r\n  const period = periodToken.toLowerCase();\r\n\r\n  debug.log(\"Parsing Time:\", { hours, minutes, period });\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return { hours, minutes };\r\n};\r\n\r\n// parses meeting line into structured data\r\nconst parseMeetingLine = (line) => {\r\n  const dateMatch = String(line || \"\").match(date_range_REGEX);\r\n  const timeMatch = String(line || \"\").match(time_range_REGEX);\r\n  const days = String(line || \"\").match(days_REGEX) || [];\r\n\r\n  if (!dateMatch || !timeMatch || !days.length) return null;\r\n\r\n  debug.log(\"Parsed Meeting Line:\", { dateMatch, timeMatch, days });\r\n\r\n  const startDate = dateMatch[1];\r\n  const endDate = dateMatch[2];\r\n\r\n  const startTime = parseTime(timeMatch[1], timeMatch[2], timeMatch[3]);\r\n  const endTime = parseTime(timeMatch[4], timeMatch[5], timeMatch[6]);\r\n\r\n  const uniqueDays = [...new Set(days.map((day) => DAY_CODES[day]).filter(Boolean))];\r\n\r\n  return {\r\n    startDate,\r\n    endDate,\r\n    days: uniqueDays,\r\n    startTime,\r\n    endTime,\r\n  };\r\n};\r\n\r\n// finds location from meeting line\r\nconst extractLocation = (line) => {\r\n  const parts = String(line || \"\")\r\n    .split(\"|\")\r\n    .map((part) => part.trim())\r\n    .filter(Boolean);\r\n\r\n  const locationPart = parts.find((part) => /\\([A-Z]{2,}\\)/.test(part));\r\n  if (locationPart) return locationPart;\r\n\r\n  const onlinePart = parts.find((part) => /online/i.test(part));\r\n  if (onlinePart) return onlinePart;\r\n\r\n  return \"\";\r\n};\r\n\r\n// finds the first calendar date on/after startDate that matches one of the meeting days\r\nconst findFirstValidDate = (startDate, dayCodes) => {\r\n  const start = new Date(`${startDate}T00:00:00`);\r\n\r\n  for (let offset = 0; offset < 7; offset += 1) {\r\n    const date = new Date(start);\r\n    date.setDate(start.getDate() + offset);\r\n    const code = Object.values(DAY_CODES)[date.getDay() === 0 ? 6 : date.getDay() - 1];\r\n    if (dayCodes.includes(code)) return date;\r\n  }\r\n\r\n  return start;\r\n};\r\n\r\n// builds an event object from course and meeting line data\r\nconst buildClassEvent = (course, line) => {\r\n  const parsed = parseMeetingLine(line);\r\n  if (!parsed) return null;\r\n\r\n  const firstDate = findFirstValidDate(parsed.startDate, parsed.days);\r\n  const startDate = new Date(firstDate);\r\n  startDate.setHours(parsed.startTime.hours, parsed.startTime.minutes, 0, 0);\r\n\r\n  const endDate = new Date(firstDate);\r\n  endDate.setHours(parsed.endTime.hours, parsed.endTime.minutes, 0, 0);\r\n\r\n  const summaryParts = [course.code, course.title].filter(Boolean);\r\n  const descriptionLines = [\r\n    course.title ? `Title: ${course.title}` : null,\r\n    course.code ? `Code: ${course.code}` : null,\r\n    course.section_number ? `Section: ${course.section_number}` : null,\r\n    course.instructor ? `Instructor: ${course.instructor}` : null,\r\n    course.instructionalFormat ? `Format: ${course.instructionalFormat}` : null,\r\n    course.meeting ? `Meeting: ${course.meeting}` : null,\r\n  ].filter(Boolean);\r\n\r\n  const untilLocal = new Date(`${parsed.endDate}T23:59:59`);\r\n  const untilDate = formatDateTimeUTC(untilLocal);\r\n\r\n  debug.log(\"Built Class Event:\", { course, parsed, startDate, endDate, summaryParts, descriptionLines, untilDate });\r\n\r\n  return {\r\n    uid: `${course.code || \"course\"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,\r\n    summary: summaryParts.join(\" - \") || \"Scheduled Course\",\r\n    description: descriptionLines.join(\"\\\\n\"),\r\n    location: extractLocation(line),\r\n    dtstart: formatDateTime(startDate),\r\n    dtend: formatDateTime(endDate),\r\n    rrule: `FREQ=WEEKLY;BYDAY=${parsed.days.join(\",\")};UNTIL=${untilDate}`,\r\n  };\r\n};\r\n\r\n// loops through every course in the schedule and builds the full ICS file\r\nconst buildICSFile = (courses) => {\r\n  const events = [];\r\n\r\n  courses.forEach((course) => {\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n    lines.forEach((line) => {\r\n      const event = buildClassEvent(course, line);\r\n      if (event) events.push(event);\r\n    });\r\n  });\r\n\r\n  const lines = [\r\n    \"BEGIN:VCALENDAR\",\r\n    \"VERSION:2.0\",\r\n    \"PRODID:-//Workday Extension//Schedule Export//EN\",\r\n    \"CALSCALE:GREGORIAN\",\r\n    `X-WR-TIMEZONE:${TZID}`,\r\n  ];\r\n\r\n  events.forEach((event) => {\r\n    lines.push(\"BEGIN:VEVENT\");\r\n    lines.push(`UID:${event.uid}`);\r\n    lines.push(`SUMMARY:${event.summary}`);\r\n    if (event.description) lines.push(`DESCRIPTION:${event.description}`);\r\n    if (event.location) lines.push(`LOCATION:${event.location}`);\r\n    lines.push(`DTSTART;TZID=${TZID}:${event.dtstart}`);\r\n    lines.push(`DTEND;TZID=${TZID}:${event.dtend}`);\r\n    lines.push(`RRULE:${event.rrule}`);\r\n    lines.push(\"END:VEVENT\");\r\n  });\r\n\r\n  lines.push(\"END:VCALENDAR\");\r\n  debug.log(\"ICS File Generated:\", lines);\r\n  return lines.join(\"\\r\\n\");\r\n};\r\n\r\n// generates the ICS string from the current filtered courses, wraps it in a Blob (file-like object)\r\n// creates a temporary URL for it and a hidden <a> then ‚Äúclicks‚Äù it to download\r\n// cleans up the URL + anchor afterward\r\nexport function exportICS() {\r\n  const ics = buildICSFile(STATE.filtered || []);\r\n  const blob = new Blob([ics], { type: \"text/calendar;charset=utf-8\" });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = \"workday-schedule.ics\";\r\n  document.body.appendChild(a);\r\n  a.click();\r\n\r\n  debug.log(\"Download Triggered for ICS file\");\r\n\r\n  setTimeout(() => {\r\n    URL.revokeObjectURL(url);\r\n    a.remove();\r\n  }, 100);\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"scheduleStorage\");\r\n\r\nconst STORAGE_KEY = \"wdSavedSchedules\";\r\nconst MAX_SCHEDULES = 6;\r\n\r\nconst cloneCourses = (courses) => {\r\n  if (typeof structuredClone === \"function\") {\r\n    return structuredClone(courses);\r\n  }\r\n  return JSON.parse(JSON.stringify(courses || []));\r\n};\r\n\r\nconst sanitizeSchedules = (schedules) => {\r\n  if (!Array.isArray(schedules)) return [];\r\n  return schedules\r\n    .filter((schedule) => schedule && Array.isArray(schedule.courses))\r\n    .map((schedule) => ({\r\n      id: schedule.id,\r\n      name: schedule.name || \"Untitled\",\r\n      savedAt: schedule.savedAt || new Date().toISOString(),\r\n      courses: schedule.courses,\r\n    }));\r\n};\r\n\r\nconst useChromeStorage = typeof chrome !== \"undefined\" && chrome.storage && chrome.storage.local;\r\n\r\nexport async function loadSavedSchedules() {\r\n  debug.log(\"Loading saved schedules...\");\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.get([STORAGE_KEY], (result) => {\r\n        const sanitized = sanitizeSchedules(result?.[STORAGE_KEY] || []);\r\n        debug.log(\"Schedules loaded from Chrome Storage:\", sanitized);\r\n        resolve(sanitized);\r\n      });\r\n    });\r\n  }\r\n\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) {\r\n      debug.log(\"No schedules found in localStorage.\");\r\n      return [];\r\n    }\r\n    const sanitized = sanitizeSchedules(JSON.parse(raw));\r\n    debug.log(\"Schedules loaded from localStorage:\", sanitized);\r\n    return sanitized;\r\n  } catch (error) {\r\n    console.warn(\"[WD] Failed to load saved schedules\", error);\r\n    debug.error(\"Error loading schedules from localStorage:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function persistSavedSchedules(schedules) {\r\n  const sanitized = sanitizeSchedules(schedules);\r\n  debug.log(\"Persisting saved schedules:\", sanitized);\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.set({ [STORAGE_KEY]: sanitized }, () => {\r\n        debug.log(\"Schedules saved to Chrome Storage.\");\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(sanitized));\r\n    debug.log(\"Schedules saved to localStorage.\");\r\n  } catch (error) {\r\n    console.warn(\"[WD] Failed to save schedules\", error);\r\n    debug.error(\"Error saving schedules to localStorage:\", error);\r\n  }\r\n}\r\n\r\nexport function createScheduleSnapshot(name, courses) {\r\n  const id =\r\n    typeof crypto !== \"undefined\" && crypto.randomUUID\r\n      ? crypto.randomUUID()\r\n      : `${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n\r\n  const snapshot = {\r\n    id,\r\n    name: name || \"Untitled\",\r\n    savedAt: new Date().toISOString(),\r\n    courses: cloneCourses(courses || []),\r\n  };\r\n  debug.log(\"Created schedule snapshot:\", snapshot);\r\n  return snapshot;\r\n}\r\n\r\nexport function formatScheduleMeta(schedule) {\r\n  const count = schedule.courses?.length || 0;\r\n  const savedDate = new Date(schedule.savedAt);\r\n  const dateLabel = Number.isNaN(savedDate.getTime())\r\n    ? schedule.savedAt\r\n    : savedDate.toLocaleDateString(undefined, {\r\n        year: \"numeric\",\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n      });\r\n  return `${count} courses ¬∑ Saved ${dateLabel}`;\r\n}\r\n\r\nexport function renderSavedSchedules(ctx, schedules) {\r\n  debug.log(\"Rendering saved schedules:\", schedules);\r\n  if (!ctx.savedMenu) return;\r\n  ctx.savedMenu.innerHTML = \"\";\r\n\r\n  if (!schedules.length) {\r\n    const empty = document.createElement(\"div\");\r\n    empty.className = \"schedule-saved-empty\";\r\n    empty.textContent = \"No saved schedules yet.\";\r\n    ctx.savedMenu.appendChild(empty);\r\n    debug.log(\"No saved schedules to render.\");\r\n    return;\r\n  }\r\n\r\n  schedules.forEach((schedule) => {\r\n    const card = document.createElement(\"div\");\r\n    card.className = \"schedule-saved-card\";\r\n    card.dataset.id = schedule.id;\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"schedule-saved-card-header\";\r\n\r\n    const info = document.createElement(\"div\");\r\n    const title = document.createElement(\"div\");\r\n    title.className = \"schedule-saved-title\";\r\n    title.textContent = schedule.name;\r\n\r\n    const meta = document.createElement(\"div\");\r\n    meta.className = \"schedule-saved-meta\";\r\n    meta.textContent = formatScheduleMeta(schedule);\r\n\r\n    info.appendChild(title);\r\n    info.appendChild(meta);\r\n    header.appendChild(info);\r\n\r\n    const actions = document.createElement(\"div\");\r\n    actions.className = \"schedule-saved-actions\";\r\n\r\n    const loadButton = document.createElement(\"button\");\r\n    loadButton.type = \"button\";\r\n    loadButton.className = \"schedule-saved-action\";\r\n    loadButton.dataset.action = \"load\";\r\n    loadButton.textContent = \"Load\";\r\n\r\n    const deleteButton = document.createElement(\"button\");\r\n    deleteButton.type = \"button\";\r\n    deleteButton.className = \"schedule-saved-action delete\";\r\n    deleteButton.dataset.action = \"delete\";\r\n    deleteButton.textContent = \"Delete\";\r\n\r\n    actions.appendChild(loadButton);\r\n    actions.appendChild(deleteButton);\r\n\r\n    card.appendChild(header);\r\n    card.appendChild(actions);\r\n    ctx.savedMenu.appendChild(card);\r\n    debug.log(\"Rendered schedule card:\", schedule);\r\n  });\r\n}\r\n\r\nexport function canSaveMoreSchedules(schedules) {\r\n  debug.log(\"Checking if more schedules can be saved. Current count:\", schedules.length);\r\n  return schedules.length < MAX_SCHEDULES;\r\n}\r\n\r\nexport function getMaxScheduleCount() {\r\n  return MAX_SCHEDULES;\r\n}\r\n","import { on, debounce } from \"./utilities/dom.js\";\r\nimport { STATE } from \"./core/state.js\";\r\nimport { ensureMount } from \"./utilities/shadowMount.js\";\r\nimport { loadPanel } from \"./panel/loadPanel.js\";\r\nimport { extractCoursesData } from \"./extraction/index.js\";\r\nimport { applySearchFilter, sortBy, wireSorting } from \"./panel/panelInteractions.js\";\r\nimport { renderRows } from \"./panel/renderRows.js\";\r\nimport { renderSchedule } from \"./panel/scheduleView.js\";\r\nimport { exportICS } from \"./export-logic/export-ics.js\";\r\nimport {\r\n  canSaveMoreSchedules,\r\n  createScheduleSnapshot,\r\n  getMaxScheduleCount,\r\n  loadSavedSchedules,\r\n  persistSavedSchedules,\r\n  renderSavedSchedules,\r\n} from \"./panel/scheduleStorage.js\";\r\n\r\n(() => {\r\n  console.log(\"[WD] content script loaded\");\r\n\r\n  async function boot() {\r\n    const shadow = ensureMount();\r\n    const ctx = await loadPanel(shadow);\r\n\r\n    ctx.button.classList.toggle(\"is-collapsed\", ctx.widget.classList.contains(\"is-hidden\"));\r\n\r\n    const updateSchedule = () => {\r\n      renderSchedule(ctx, STATE.filtered, STATE.view.semester);\r\n    };\r\n\r\n    const setActivePanel = (panel) => {\r\n      STATE.view.panel = panel;\r\n\r\n      ctx.panels.forEach((el) => {\r\n        el.classList.toggle(\"is-active\", el.dataset.panel === panel);\r\n      });\r\n\r\n      ctx.tabButtons.forEach((btn) => {\r\n        btn.classList.toggle(\"is-active\", btn.dataset.panel === panel);\r\n      });\r\n\r\n      ctx.widget.classList.toggle(\"is-schedule-view\", panel === \"schedule\");\r\n      ctx.widget.classList.toggle(\"is-settings-view\", panel === \"settings\");\r\n      ctx.widget.classList.toggle(\"is-help-view\", panel === \"help\");\r\n    };\r\n\r\n    const toggleWidget = () => {\r\n      ctx.widget.classList.toggle(\"is-hidden\");\r\n      ctx.button.classList.toggle(\"is-collapsed\", ctx.widget.classList.contains(\"is-hidden\"));\r\n    };\r\n\r\n    // ---------------------------\r\n    // Save Schedule Modal\r\n    // ---------------------------\r\n    let resolveScheduleModal = null;\r\n\r\n    const closeScheduleModal = (value) => {\r\n      if (!ctx.saveModal) return;\r\n\r\n      ctx.saveModal.classList.add(\"is-hidden\");\r\n      ctx.saveModal.setAttribute(\"aria-hidden\", \"true\");\r\n\r\n      if (resolveScheduleModal) {\r\n        resolveScheduleModal(value);\r\n        resolveScheduleModal = null;\r\n      }\r\n    };\r\n\r\n    const openScheduleModal = ({ title, message, confirmLabel = \"Save\", showInput = true, showCancel = true }) => {\r\n      if (!ctx.saveModal) return Promise.resolve(null);\r\n\r\n      ctx.saveModalTitle.textContent = title;\r\n      ctx.saveModalMessage.textContent = message;\r\n      ctx.saveModalConfirm.textContent = confirmLabel;\r\n\r\n      ctx.saveModalField.classList.toggle(\"is-hidden\", !showInput);\r\n      ctx.saveModalCancel.classList.toggle(\"is-hidden\", !showCancel);\r\n\r\n      ctx.saveModalInput.value = \"\";\r\n      ctx.saveModalInput.classList.remove(\"is-invalid\");\r\n\r\n      ctx.saveModal.classList.remove(\"is-hidden\");\r\n      ctx.saveModal.setAttribute(\"aria-hidden\", \"false\");\r\n\r\n      if (showInput) ctx.saveModalInput.focus();\r\n      else ctx.saveModalConfirm.focus();\r\n\r\n      return new Promise((resolve) => {\r\n        resolveScheduleModal = resolve;\r\n      });\r\n    };\r\n\r\n    if (ctx.saveModal) {\r\n      on(ctx.saveModal, \"click\", (event) => {\r\n        if (event.target === ctx.saveModal) {\r\n          closeScheduleModal(null);\r\n          return;\r\n        }\r\n\r\n        const action = event.target.closest(\"[data-action]\")?.dataset.action;\r\n        if (!action) return;\r\n\r\n        if (action === \"close\" || action === \"cancel\") {\r\n          closeScheduleModal(null);\r\n          return;\r\n        }\r\n\r\n        if (action === \"confirm\") {\r\n          if (!ctx.saveModalField.classList.contains(\"is-hidden\")) {\r\n            const value = ctx.saveModalInput.value.trim();\r\n            if (!value) {\r\n              ctx.saveModalInput.classList.add(\"is-invalid\");\r\n              ctx.saveModalInput.focus();\r\n              return;\r\n            }\r\n            closeScheduleModal(value);\r\n            return;\r\n          }\r\n\r\n          closeScheduleModal(true);\r\n        }\r\n      });\r\n\r\n      on(ctx.saveModalInput, \"input\", () => {\r\n        ctx.saveModalInput.classList.remove(\"is-invalid\");\r\n      });\r\n\r\n      on(ctx.saveModalInput, \"keydown\", (event) => {\r\n        if (event.key === \"Enter\") ctx.saveModalConfirm.click();\r\n      });\r\n\r\n      on(document, \"keydown\", (event) => {\r\n        if (event.key === \"Escape\" && ctx.saveModal && !ctx.saveModal.classList.contains(\"is-hidden\")) {\r\n          closeScheduleModal(null);\r\n        }\r\n      });\r\n    }\r\n\r\n    // ---------------------------\r\n    // Tabs + semester toggles\r\n    // ---------------------------\r\n    ctx.tabButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        setActivePanel(btn.dataset.panel);\r\n        if (btn.dataset.panel === \"schedule\") updateSchedule();\r\n      });\r\n    });\r\n\r\n    ctx.semesterButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        STATE.view.semester = btn.dataset.semester;\r\n\r\n        ctx.semesterButtons.forEach((semesterBtn) => {\r\n          semesterBtn.classList.toggle(\"is-active\", semesterBtn.dataset.semester === STATE.view.semester);\r\n        });\r\n\r\n        updateSchedule();\r\n      });\r\n    });\r\n\r\n    on(ctx.button, \"click\", toggleWidget);\r\n\r\n    // ---------------------------\r\n    // Export dropdown\r\n    // ---------------------------\r\n    const setExportOpen = (isOpen) => {\r\n      if (!ctx.exportDropdown || !ctx.exportButton) return;\r\n      ctx.exportDropdown.classList.toggle(\"is-open\", isOpen);\r\n      ctx.exportButton.setAttribute(\"aria-expanded\", String(isOpen));\r\n    };\r\n\r\n    on(ctx.exportButton, \"click\", () => {\r\n      const isOpen = ctx.exportDropdown?.classList.contains(\"is-open\");\r\n      setExportOpen(!isOpen);\r\n    });\r\n\r\n    on(document, \"click\", (event) => {\r\n      if (!ctx.exportDropdown?.classList.contains(\"is-open\")) return;\r\n\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.exportDropdown)) return;\r\n\r\n      setExportOpen(false);\r\n    });\r\n\r\n    // Close Saved Schedules dropdown if user clicks outside\r\n    on(document, \"click\", (event) => {\r\n      if (!ctx.savedDropdown?.open) return;\r\n\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.savedDropdown)) return;\r\n\r\n      ctx.savedDropdown.open = false;\r\n    });\r\n\r\n    on(ctx.root, \"click\", (event) => {\r\n      if (!ctx.exportDropdown?.open) return;\r\n\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.exportDropdown)) return;\r\n\r\n      ctx.exportDropdown.open = false;\r\n    });\r\n\r\n    // ---------------------------\r\n    // Messages\r\n    // ---------------------------\r\n    chrome.runtime.onMessage.addListener((message) => {\r\n      if (message?.type === \"TOGGLE_WIDGET\") toggleWidget();\r\n    });\r\n\r\n    // ---------------------------\r\n    // Refresh (re-extract)\r\n    // ---------------------------\r\n    on(ctx.refresh, \"click\", async () => {\r\n      STATE.courses = await extractCoursesData();\r\n      applySearchFilter(ctx.search.value);\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n    });\r\n\r\n    // ---------------------------\r\n    // Export actions\r\n    // ---------------------------\r\n    const handleExport = async (type) => {\r\n      if (type === \"ics\") exportICS();\r\n    };\r\n\r\n    on(ctx.exportMenu, \"click\", async (event) => {\r\n      const action = event.target.closest(\"[data-export]\");\r\n      if (!action) return;\r\n      setExportOpen(false);\r\n      await handleExport(action.dataset.export);\r\n    });\r\n\r\n    // ---------------------------\r\n    // Save schedules\r\n    // ---------------------------\r\n    on(ctx.saveScheduleBtn, \"click\", async () => {\r\n      if (!canSaveMoreSchedules(STATE.savedSchedules)) {\r\n        await openScheduleModal({\r\n          title: \"Schedule limit reached\",\r\n          message: `You can only save up to ${getMaxScheduleCount()} schedules. Delete one to save another.`,\r\n          confirmLabel: \"Got it\",\r\n          showInput: false,\r\n          showCancel: false,\r\n        });\r\n        return;\r\n      }\r\n\r\n      const name = await openScheduleModal({\r\n        title: \"Save schedule\",\r\n        message: \"Name this schedule so you can find it later.\",\r\n        confirmLabel: \"Save\",\r\n        showInput: true,\r\n        showCancel: true,\r\n      });\r\n      if (!name) return;\r\n\r\n      const snapshot = createScheduleSnapshot(name, STATE.filtered);\r\n      STATE.savedSchedules = [snapshot, ...STATE.savedSchedules];\r\n      await persistSavedSchedules(STATE.savedSchedules);\r\n      renderSavedSchedules(ctx, STATE.savedSchedules);\r\n      if (ctx.savedDropdown) ctx.savedDropdown.open = true;\r\n    });\r\n\r\n    on(ctx.savedMenu, \"click\", async (event) => {\r\n      const actionButton = event.target.closest(\"[data-action]\");\r\n      if (!actionButton) return;\r\n\r\n      const card = actionButton.closest(\".schedule-saved-card\");\r\n      const scheduleId = card?.dataset.id;\r\n      if (!scheduleId) return;\r\n\r\n      if (actionButton.dataset.action === \"delete\") {\r\n        const selected = STATE.savedSchedules.find((schedule) => schedule.id === scheduleId);\r\n        if (!selected) return;\r\n\r\n        const confirmed = await openScheduleModal({\r\n          title: \"Permanently Delete Schedule?\",\r\n          message: `This action will permanently delete \"${selected.name}\".`,\r\n          confirmLabel: \"Delete\",\r\n          showInput: false,\r\n          showCancel: true,\r\n        });\r\n        if (!confirmed) return;\r\n\r\n        STATE.savedSchedules = STATE.savedSchedules.filter((schedule) => schedule.id !== scheduleId);\r\n        await persistSavedSchedules(STATE.savedSchedules);\r\n        renderSavedSchedules(ctx, STATE.savedSchedules);\r\n        return;\r\n      }\r\n\r\n      const selected = STATE.savedSchedules.find((schedule) => schedule.id === scheduleId);\r\n      if (!selected) return;\r\n\r\n      STATE.courses = [...selected.courses];\r\n      STATE.filtered = [...selected.courses];\r\n      ctx.search.value = \"\";\r\n\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n\r\n      setActivePanel(\"schedule\");\r\n      if (ctx.savedDropdown) ctx.savedDropdown.open = false;\r\n    });\r\n\r\n    // ---------------------------\r\n    // Settings/help shortcuts\r\n    // ---------------------------\r\n    on(ctx.settingsBtn, \"click\", () => {\r\n      ctx.widget.classList.remove(\"is-hidden\");\r\n      ctx.button.classList.remove(\"is-collapsed\");\r\n      setActivePanel(\"settings\");\r\n    });\r\n\r\n    on(ctx.helpBtn, \"click\", () => {\r\n      ctx.widget.classList.remove(\"is-hidden\");\r\n      ctx.button.classList.remove(\"is-collapsed\");\r\n      setActivePanel(\"help\");\r\n    });\r\n\r\n    // ---------------------------\r\n    // Search filter\r\n    // ---------------------------\r\n    on(\r\n      ctx.search,\r\n      \"input\",\r\n      debounce(() => {\r\n        applySearchFilter(ctx.search.value);\r\n        sortBy(STATE.sort.key || \"code\");\r\n        renderRows(ctx, STATE.filtered);\r\n        updateSchedule();\r\n      }, 100)\r\n    );\r\n\r\n    wireSorting(ctx);\r\n\r\n    // ---------------------------\r\n    // Initial load\r\n    // ---------------------------\r\n    STATE.savedSchedules = await loadSavedSchedules();\r\n    renderSavedSchedules(ctx, STATE.savedSchedules);\r\n\r\n    STATE.courses = await extractCoursesData();\r\n    STATE.filtered = [...STATE.courses];\r\n\r\n    sortBy(\"code\");\r\n    renderRows(ctx, STATE.filtered);\r\n    updateSchedule();\r\n\r\n    setActivePanel(STATE.view.panel);\r\n  }\r\n\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();\r\n"],"names":["logConfiguration","debugLog","global","local","log","k","v","loggingIsOn","scope","id","debugFor","prefix","metaOrMsg","rest","meta","args","forceOn","debug","$$","root","sel","on","el","ev","fn","opts","debounce","ms","a","STATE","EXT_ID","ensureMount","host","loadPanel","shadow","htmlUrl","cssFiles","html","cssParts","r","file","css","style","link","wrap","elements","normalizeText","s","getHeaderText","headerEl","btn","getHeaderKey","m","buildHeaderMaps","gridRoot","headerEls","headers","pos","text","key","h","findHeader","needles","ns","hit","n","KEYS","colMap","posMap","findWorkdayGrid","roots","headerText","looksRight","t","rows","parseSectionLinkString","input","str","baseCode","parts","p","sectionToken","parsedTitle","result","DATE_RE","TIME_RE","DAY_RE","extractMeetingLines","containerEl","lines","filtered","isOnlineDelivery","deliveryModeCellEl","txt","prompts","matched","label","extractMeetingLinesFromCell","meetingEl","formatMeetingLineForPanel","line","raw","dayPart","timeMatch","timePart","buildingPart","floorMatch","roomMatch","floorPart","roomPart","normalizeMeetingPatternsText","normalized","extractStartDate","match","out","getCellWorkdayKey","cell","createRowCellReader","rowEl","headerMaps","colHeaderMap","cellsInRow","cellByCol","getCellByHeader","keyName","colKey","extractCoursesData","found","courses","row","c","extractFromRow","unique","removeDuplicateCourses","allCourses","course","seen","uniqueCourses","courseKey","readCellTextByHeader","allLinksInRow","sectionLinkEl","sectionLinkText","sectionDetails","instructionalFormatText","startDateText","code","title","section_number","labLike","seminarLike","discussionLike","isLab","isSeminar","isDiscussion","instructor","meetingLines","meetingObj","deliveryModeEl","isOnline","meeting","startDate","escHTML","cleanLines","cleaned","renderRows","ctx","frag","tr","badge","main","sub","applySearchFilter","q","sortBy","dir","collator","b","wireSorting","headCells","th","DAYS","START_HOUR","END_HOUR","SLOT_MINUTES","SLOTS","DAY_REGEX","TIME_REGEX","SEMESTER_MONTHS","parseTimeToken","token","hours","minutes","period","parseMeetingLine","days","timeTokens","startMinutes","endMinutes","getSemester","month","semester","clampToGrid","min","max","snapDownToSlot","snapUpToSlot","slotIndexOf","buildDayEvents","eventsByDay","d","eventId","parsed","startMin","endMin","startIdx","endIdx","rowSpan","day","addConflicts","groupedByDay","events","groups","current","currentKey","active","getConflictSummaries","conflicts","group","codes","updateConflictFooter","conflictList","formatSlotLabel","h24","hh","mm","buildScheduleTable","table","thead","headRow","tbody","timeTd","td","inner","overlay","rectFromBlock","renderOverlayBlocks","firstBodyRow","firstDayCell","timeTh","timeColWidth","dayColWidth","headerHeight","rowHeight","cellStyles","borderLeft","borderTop","borderRight","borderBottom","borderX","borderY","placedBlocks","dayIndex","left","top","height","block","overlapLayer","titleLabel","renderSchedule","tableWrap","TZID","formatDateTimeUTC","date","y","ss","DAY_CODES","date_range_REGEX","time_range_REGEX","days_REGEX","padNumbers","value","formatDate","year","formatDateTime","datePart","parseTime","hoursToken","minutesToken","periodToken","dateMatch","endDate","startTime","endTime","uniqueDays","extractLocation","part","locationPart","onlinePart","findFirstValidDate","dayCodes","start","offset","buildClassEvent","firstDate","summaryParts","descriptionLines","untilLocal","untilDate","buildICSFile","event","exportICS","ics","blob","url","STORAGE_KEY","MAX_SCHEDULES","cloneCourses","sanitizeSchedules","schedules","schedule","useChromeStorage","loadSavedSchedules","resolve","sanitized","error","persistSavedSchedules","createScheduleSnapshot","name","snapshot","formatScheduleMeta","count","savedDate","dateLabel","renderSavedSchedules","empty","card","header","info","actions","loadButton","deleteButton","canSaveMoreSchedules","getMaxScheduleCount","boot","updateSchedule","setActivePanel","panel","toggleWidget","resolveScheduleModal","closeScheduleModal","openScheduleModal","message","confirmLabel","showInput","showCancel","action","semesterBtn","setExportOpen","isOpen","handleExport","type","actionButton","scheduleId","selected"],"mappings":"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"}