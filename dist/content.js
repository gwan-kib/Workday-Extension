(function(){"use strict";const I={global:!0,local:{},log:{}},ie=({global:e,local:n,log:t}={})=>{if(typeof e=="boolean"&&(I.global=e),n&&typeof n=="object")for(const[o,s]of Object.entries(n))typeof s=="boolean"&&(I.local[o]=s);if(t&&typeof t=="object")for(const[o,s]of Object.entries(t))typeof s=="boolean"&&(I.log[o]=s)},X=(e,n)=>!(!I.global||e&&I.local[e]===!1||n&&I.log[n]===!1),C=e=>{const n=e?`[Workday - Schedule Tool (file: ${e})]
`:`[Workday - Schedule Tool]
`;return{log:(i,...d)=>{let c=null,m=null;i&&typeof i=="object"&&!Array.isArray(i)?(c=i,m=d):(c=null,m=[i,...d]);const l=c?.id,u=c?.on===!0;c?.on!==!1&&(!u&&!X(e,l)||console.log(n,...m))},warn:(i,...d)=>{let c=null,m=null;i&&typeof i=="object"&&!Array.isArray(i)?(c=i,m=d):m=[i,...d];const l=c?.id,u=c?.on===!0;c?.on!==!1&&(!u&&!X(e,l)||console.log("‚ö†Ô∏è",n,...m))},error:(i,...d)=>{let c=null,m=null;i&&typeof i=="object"&&!Array.isArray(i)?(c=i,m=d):m=[i,...d];const l=c?.id,u=c?.on===!0;c?.on!==!1&&(!u&&!X(e,l)||console.log("üö©",n,...m))},on:()=>ie({local:{[e]:!0}}),off:()=>ie({local:{[e]:!1}})}},J=C("dom"),B=(e,n)=>(J.log("Querying multiple elements:",{root:e,sel:n}),Array.from(e.querySelectorAll(n))),f=(e,n,t,o)=>{e&&(J.log("Attaching event listener:",{el:e,ev:n,opts:o}),e.addEventListener(n,t,o))},Me=(e,n=300)=>{let t;return(...o)=>{J.log("Debouncing function call with delay:",{fn:e,ms:n,args:o}),clearTimeout(t),t=setTimeout(()=>e(...o),n)}},g={courses:[],filtered:[],savedSchedules:[],sort:{key:null,dir:1},view:{panel:"list",semester:"first"}},ae=C("shadowMount"),le="Workday - Schedule Tool";function Ee(){let e=document.getElementById(le);return e?(ae.log("Returning existing shadow root:",e),e.shadowRoot):(e=document.createElement("div"),e.id=le,e.style.all="initial",e.style.position="fixed",e.style.bottom="16px",e.style.right="16px",e.style.zIndex="999999999",e.attachShadow({mode:"open"}),document.documentElement.appendChild(e),ae.log("Mounted new extension container:",e),e.shadowRoot)}const F=C("loadPanel");async function Te(e){const n=chrome.runtime.getURL("src/panel.html"),t=["formatting/general.css","formatting/widget-shell.css","formatting/widget-buttons.css","formatting/floating-button.css","formatting/course-list.css","formatting/schedule-view.css","formatting/schedule-view-events.css","formatting/settings.css","colors/course-list-colors.css","colors/general-colors.css","colors/schedule-view-colors.css","colors/widget-functionality-colors.css","colors/settings-colors.css"];F.log("Fetching HTML and CSS files...");const[o,...s]=await Promise.all([fetch(n).then(c=>c.text()),...t.map(c=>fetch(chrome.runtime.getURL(`src/css/${c}`)).then(m=>m.text()))]),r=s.join(`
`);F.log("CSS files fetched and concatenated:",{cssParts:s}),e.innerHTML="";const a=document.createElement("style");if(a.textContent=r,e.appendChild(a),F.log("Appended styles to shadow DOM."),!document.querySelector('link[href*="Material+Symbols"]')){const c=document.createElement("link");c.rel="stylesheet",c.href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200",document.head.appendChild(c),F.log("Appended Material Symbols font to document head.")}const i=document.createElement("div");i.innerHTML=o,e.appendChild(i),F.log("Appended HTML content to shadow DOM.");const d={button:e.querySelector("#floating-button"),widget:e.querySelector(".widget"),root:e,search:e.querySelector("#widget-search"),saveScheduleBtn:e.querySelector("#widget-save-schedule"),refresh:e.querySelector("#widget-refresh"),exportDropdown:e.querySelector("#widget-export"),exportButton:e.querySelector("#widget-export-button"),exportMenu:e.querySelector("#widget-export-menu"),helpBtn:e.querySelector(".help"),settingsBtn:e.querySelector(".settings"),tableBody:e.querySelector("tbody"),tableHead:e.querySelector("thead"),tabButtons:e.querySelectorAll(".tab-button"),panels:e.querySelectorAll(".widget-panel"),scheduleGrid:e.querySelector("#schedule-grid"),semesterButtons:e.querySelectorAll(".semester-button"),savedDropdown:e.querySelector("#schedule-saved-dropdown"),savedMenu:e.querySelector("#schedule-saved-menu"),footerConflicts:e.querySelector("#widget-conflicts"),saveModal:e.querySelector("#schedule-save-modal"),saveModalTitle:e.querySelector("#schedule-modal-title"),saveModalMessage:e.querySelector("#schedule-modal-message"),saveModalField:e.querySelector("#schedule-modal-field"),saveModalInput:e.querySelector("#schedule-modal-input"),saveModalCancel:e.querySelector(".schedule-modal-cancel"),saveModalConfirm:e.querySelector(".schedule-modal-confirm")};return F.log("DOM elements loaded:",d),d}const A=C("grid"),Q=e=>String(e||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function ce(e){if(!e)return"";const n=e.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(e.textContent||"").trim()}function xe(e){const t=(e?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return t?t[1]:null}function ke(e){const n=Array.from(e.querySelectorAll('th[data-automation-id^="columnHeader"]'));A.log({id:"buildHeaderMaps.headers"},"Header elements found:",n.length);const t=n.map((i,d)=>{const c=ce(i),m=xe(i);return{el:i,pos:d,key:m,text:c,norm:Q(c)}}).filter(i=>i.text);A.log({id:"buildHeaderMaps.parsedHeaders"},"Parsed headers:",t.map(i=>({pos:i.pos,key:i.key,text:i.text,norm:i.norm})));function o(i){const d=i.map(Q);let c=t.find(m=>d.includes(m.norm));return c||(c=t.find(m=>d.some(l=>m.norm.includes(l))),c||null)}const s={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},r={},a={};for(const[i,d]of Object.entries(s)){const c=o(d);r[i]=c?c.key:null,a[i]=c?c.pos:-1,A.log({id:"buildHeaderMaps.map"},"Mapped header:",{key:i,needles:d,hit:c?{pos:c.pos,colKey:c.key,text:c.text}:null})}return{colMap:r,posMap:a}}function $e(){const e=B(document,`
  table,
  [role="table"],
  [role="grid"],
  div[data-automation-id*="grid"],
  div[data-automation-id*="Grid"],
  div[data-automation-id="gridContainer"],
  div[data-automation-id="responsiveDataTable"],
  div[data-automation-id="tableContainer"]
`);A.log({id:"findWorkdayGrid.roots"},"Candidate roots found:",e.length);for(const n of e){const t=B(n,`
  thead th,
  [role="columnheader"],
  div[data-automation-id*="columnHeader"],
  .wd-GridHeaderCell,
  .grid-column-header
`),o=t.map(a=>Q(ce(a))),s=o.some(a=>a.includes("section"))&&(o.some(a=>a.includes("instructor"))||o.some(a=>a.includes("meeting"))||o.some(a=>a.includes("instructional format"))||o.some(a=>a.includes("format"))||o.some(a=>a.includes("status")));if(A.log({id:"findWorkdayGrid.scanRoot"},"Scanning root:",{headerCount:t.length,looksRight:s,headerText:o}),!s)continue;const r=B(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(A.log({id:"findWorkdayGrid.rows"},"Rows found for matching root:",r.length),r.length)return{root:n,rows:r}}return A.log({id:"findWorkdayGrid.none"},"No matching table/grid found"),null}const q=C("sectionLinkInfo");function Ae(e){let n=String(e||"").replace(/\u00A0/g," ").trim();if(q.log({id:"parseSectionLinkString.input"},"Raw input:",e),!n)return null;n=n.replace(/\s*\n\s*/g," ").trim(),q.log({id:"parseSectionLinkString.normalized"},"Normalized string:",n);const t=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!t)return q.log({id:"parseSectionLinkString.noMatch"},"String did not match expected pattern"),null;const o=t[1].trim(),s=t[2].trim();q.log({id:"parseSectionLinkString.match"},"Regex match:",{baseCode:o,rest:s});const r=s.split(/\s*[-‚Äì‚Äî]\s*/).map(c=>c.trim()).filter(Boolean);let a="",i="";a=r[0],i=r.slice(1).join(" - ").trim(),i=i.replace(/\s*:\s*/g,`:
`);const d={code:o,section_number:a,title:i,full:n};return q.log({id:"parseSectionLinkString.result"},"Parsed section link result:",d),d}const x=C("meetingPatternsInfo"),Re=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,Ie=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,Be=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;function Fe(e){if(!e)return x.log({id:"extractMeetingLines.missing"},"No container element provided"),[];const t=Array.from(e.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean);x.log({id:"extractMeetingLines.items"},"Menu item lines:",{count:t.length});const o=t.filter(s=>Re.test(s)&&Ie.test(s)&&Be.test(s));return x.log({id:"extractMeetingLines.filtered"},"Filtered meeting lines:",{before:t.length,after:o.length}),o}function Ne(e){if(!e)return x.log({id:"isOnlineDelivery.missing"},"No delivery mode cell provided"),!1;const n=(e.innerText||e.textContent||"").trim();if(/online learning/i.test(n))return x.log({id:"isOnlineDelivery.match.direct"},"Matched online learning from cell text",n),!0;const t=Array.from(e.querySelectorAll('[data-automation-id="promptOption"]')),o=t.some(s=>{const r=s.getAttribute("data-automation-label")||s.getAttribute("title")||s.textContent||"";return/online learning/i.test(r)});return x.log({id:"isOnlineDelivery.match.prompts"},"Checked prompt options for online learning",{promptCount:t.length,matched:o}),o}function Oe(e){return Fe(e)}function He(e){const n=String(e||"").replace(/\u00A0/g," ").trim(),s=(n.split("|").map(u=>u.trim()).filter(Boolean).find(u=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i.test(u)&&!/\d{1,2}:\d{2}/.test(u))||"").replace(/\s*\/\s*/g," / ").trim(),r=n.match(/(\d{1,2}:\d{2}\s*[ap]\.?m\.?\s*-\s*\d{1,2}:\d{2}\s*[ap]\.?m\.?)/i),a=r?r[1].replace(/\s+/g," ").trim():"";let i="";r&&(i=n.slice(r.index+r[1].length).replace(/^[\s|.\-‚Äì‚Äî:]+/,"").split(/\b(floor|room|rm)\b/i)[0].trim());const d=n.match(/\bfloor\b\s*[:\-]?\s*(-?[A-Za-z0-9]+)/i),c=n.match(/\b(room|rm)\b\s*[:\-]?\s*([A-Za-z0-9]+)/i),m=d?`Floor: ${d[1]}`:"",l=c?`Room: ${c[2]}`:"";return{days:s,time:a,location:[i,[m,l].filter(Boolean).join(" | ")].filter(Boolean).join(`
`)}}function qe(e){const n=String(e||"").split(/\r?\n/).map(t=>t.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`);return x.log({id:"normalizeMeetingPatternsText"},"Normalized meeting patterns text:",{beforeLen:String(e||"").length,afterLen:n.length}),n}function ee(e){const n=String(e||"").match(/\b(\d{4}-\d{2}-\d{2})\b/),t=n?n[1]:"";return x.log({id:"extractStartDate"},"Extracted start date:",{line:e,out:t}),t}const Pe=C("rowCellReader");function Ue(e){const o=(e.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return o?o[1]:null}function je(e,n){const{colMap:t}=n||{},o=B(e,"td, [role='gridcell']");Pe.log({id:"createRowCellReader.start"},"Creating row cell reader:",{cellCount:o.length});const s=new Map;o.forEach(i=>{const d=Ue(i);d&&!s.has(d)&&s.set(d,i)});const r=i=>{const d=t?.[i];return d==null?null:s.get(d)||null};return{cellsInRow:o,cellByCol:s,getCellByHeader:r,readCellTextByHeader:i=>(r(i)?.innerText||"").trim()}}const L=C("courseExtraction");async function de(){L.log({id:"extractCoursesData.start"},"Starting course extraction");const e=$e();let n=[];if(L.log({id:"extractCoursesData.tables"},"findWorkdayGrid() result:",e?{hasRoot:!!e.root,rowCount:e.rows?.length||0}:null),e){const o=ke(e.root);L.log({id:"extractCoursesData.headerMaps"},"Built header maps:",o);for(const s of e.rows){const r=_e(s,o);r&&(r.code||r.title)&&Object.values(r).join("").trim()&&n.push(r)}}const t=We(n);return L.log({id:"extractCoursesData.done"},"Extraction complete:",{total:n.length,unique:t.length}),t}function We(e){const n=s=>[s.code,s.title,s.section_number].join("|").toLowerCase(),t=new Set,o=[];for(const s of e){const r=n(s);t.has(r)||(t.add(r),o.push(s))}return L.log({id:"removeDuplicateCourses"},"Deduped courses:",{allCourses:e,UniqueCourses:o,removed:e.length-o.length}),o}function _e(e,n){const{getCellByHeader:t,readCellTextByHeader:o}=je(e,n);L.log({id:"extractFromRow.start"},"Extracting row");const s=B(e,'[data-automation-id="promptOption"]'),r=s.find(y=>{const H=y.getAttribute("data-automation-label")||y.getAttribute("title")||y.getAttribute("aria-label")||y.textContent||"";return/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(H)}),a=r&&(r.getAttribute("data-automation-label")||r.getAttribute("title")||r.getAttribute("aria-label")||r.textContent)||"",i=Ae(a);if(!i)return L.warn({id:"extractFromRow.skip"},"Skipping row: no parsable promptOption",{promptOptions:s.length,sectionLinkString:a}),null;L.log({id:"extractFromRow.sectionLink"},"Section link:",{promptOptions:s.length,hasMatch:!!r,sectionLinkString:a});const d=o("instructionalFormat"),c=o("startDate"),m=i.code,l=i.title,u=i.section_number;L.log({id:"extractFromRow.coreParse"},"Core parse result:",{code:m,title:l,section_number:u});const S=y=>/\b(laboratory)\b/i.test(String(y||"")),p=y=>/\bseminar\b/i.test(String(y||"")),v=y=>/\bdiscussion\b/i.test(String(y||"")),w=S(d),T=p(d),M=v(d);let V="N/A";if(!w&&!T&&!o("instructor"))return L.warn({id:"extractFromRow.skip"},"Skipping row: missing instructor cell",{code:m,section_number:u}),null;const _=t("meeting");if(!_)return L.warn({id:"extractFromRow.skip"},"Skipping row: missing meeting cell",{code:m,section_number:u}),null;const O=Oe(_)||[];if(!O.length)return L.warn({id:"extractFromRow.skip"},"Skipping row: no meeting lines found in meeting cell",{code:m,section_number:u}),null;const G=He(O[0]),D=t("deliveryMode"),z=D?Ne(D):!1;z&&(G.location="Online");let K=[G.days,G.time].filter(Boolean).join(" | ");K+=`
${G.location||(z?"Online":"")}`.trim();const re=ee(O[0])||ee(c),h={code:m,title:l,section_number:u,instructor:V,meeting:qe(K),instructionalFormat:(d||"").trim(),startDate:re,meetingLines:O,isLab:w,isSeminar:T,isDiscussion:M};return L.log({id:"extractFromRow.result"},"Extracted course:",{code:h.code,title:h.title,section_number:h.section_number,isLab:h.isLab,isSeminar:h.isSeminar,isDiscussion:h.isDiscussion,isOnline:z}),h}const P=C("renderRows"),ue=e=>{const n=String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");return P.log("Escaped HTML:",{input:e,output:n}),n};function Ge(e){const n=String(e||"").replace(/[\u00A0\u200B-\u200D\uFEFF]/g," ").replace(/[ \t]+\n/g,`
`).replace(/\n[ \t]+/g,`
`).replace(/\n{2,}/g,`
`).trim();return P.log("Cleaned text lines:",{input:e,output:n}),n}function U(e,n){P.log("Rendering rows:",n),e.tableBody.innerHTML="";const t=document.createDocumentFragment();n.forEach(o=>{const s=document.createElement("tr"),r=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":o.isDiscussion?"[Discussion]":"";s.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${r?`<div class="muted">${r}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const a=Ge(o.meeting).split(`
`),i=(a[0]||"").trim(),d=a.slice(1).map(c=>c.replace(/[\u00A0\u200B-\u200D\uFEFF]/g,"").trim()).filter(Boolean).join(`
`);return P.log("Processed meeting details:",{main:i,sub:d}),`
            ${i?`<span class="meeting-pill">${ue(i).trim()}</span>`:""}
            ${d?`<div class="meeting-sub">${ue(d).trim()}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,t.appendChild(s)}),e.tableBody.appendChild(t),P.log("Rows rendered and added to table body.")}const k=C("panelInteractions");function me(e){if(e=(e||"").trim().toLowerCase(),k.log("Search query received:",e),!e){g.filtered=[...g.courses],k.log("Search filter cleared, resetting filtered courses:",g.filtered);return}g.filtered=g.courses.filter(n=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(t=>(n[t]||"").toLowerCase().includes(e))),k.log("Search filter applied, filtered courses:",g.filtered)}function j(e){if(!e)return;const n=g.sort.key===e?-g.sort.dir:1;g.sort={key:e,dir:n},k.log("Sorting by key:",e,"Direction:",n);const t=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});g.filtered.sort((o,s)=>n*t.compare(o[e]||"",s[e]||"")),k.log("Sorted filtered courses:",g.filtered)}function ze(e){const n=B(e.tableHead,"th[data-key]");k.log("Table header cells with sorting keys:",n),n.forEach(t=>{f(t,"click",()=>{const o=t.getAttribute("data-key");k.log("Sorting header clicked, sorting by:",o),j(o),U(e,g.filtered),n.forEach(s=>s.classList.remove("sorted-asc","sorted-desc")),t.classList.add(g.sort.dir===1?"sorted-asc":"sorted-desc"),k.log("Updated sorting classes:",{sortedAsc:t.classList.contains("sorted-asc"),sortedDesc:t.classList.contains("sorted-desc")})})})}const E=C("scheduleView"),N=["Mon","Tue","Wed","Thu","Fri"],ge=8,te=21,Y=30,R=[];for(let e=ge;e<te;e++)R.push(e*60),R.push(e*60+30);R.push(te*60);const Ye=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,Ze=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,fe={first:["09","08"],second:["01","12"]};function pe(e){if(!e)return null;const n=e.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let t=Number.parseInt(n[1],10);const o=Number.parseInt(n[2],10),s=n[3].toLowerCase();return s==="p"&&t!==12&&(t+=12),s==="a"&&t===12&&(t=0),t*60+o}function Ve(e){const n=String(e||"").match(Ye)||[],t=String(e||"").match(Ze)||[];if(n.length===0||t.length<2)return null;const o=pe(t[0]),s=pe(t[1]);return o==null||s==null||s<=o?null:(E.log("Parsed meeting line:",{days:n,timeTokens:t,startMinutes:o,endMinutes:s}),{days:[...new Set(n)],startMinutes:o,endMinutes:s,timeLabel:`${t[0]} - ${t[1]}`})}function Ke(e){if(!e)return null;const n=e.split("-")[1],t=fe.first.includes(n)?"first":fe.second.includes(n)?"second":null;return E.log("Determined semester for startDate:",{startDate:e,semester:t}),t}function he(e){const n=ge*60,t=te*60;return Math.max(n,Math.min(t,e))}function Xe(e){return Math.floor(e/Y)*Y}function Je(e){return Math.ceil(e/Y)*Y}function Se(e){return R.indexOf(e)}function Qe(e,n){E.log("Building day events for semester:",n);const t=new Map;N.forEach(r=>t.set(r,[]));const o=new Set;let s=0;return e.forEach(r=>{const a=r.startDate||ee(r.meetingLines?.[0])||"";if(Ke(a)!==n)return;const d=r.meetingLines?.length?r.meetingLines:[],c=r.isLab?"[Laboratory]":r.isSeminar?"[Seminar]":r.isDiscussion?"[Discussion]":"";d.forEach(m=>{const l=Ve(m);if(!l)return;let u=he(l.startMinutes),S=he(l.endMinutes);u=Xe(u),S=Je(S);const p=Se(u),v=Se(S);if(p===-1||v===-1||v<=p)return;const w=v-p;l.days.forEach(T=>{if(!t.has(T))return;const M=[T,r.code||"",r.title||"",l.timeLabel,p,w].join("|");o.has(M)||(o.add(M),t.get(T).push({id:s++,code:r.code||"",title:r.title||"",label:c,timeLabel:l.timeLabel,rowStart:p,rowSpan:w,startIdx:p,endIdx:v}))})})}),N.forEach(r=>{t.get(r).sort((a,i)=>a.startIdx-i.startIdx||a.endIdx-i.endIdx)}),E.log("Built day events:",t),t}function et(e){E.log("Adding conflicts to events...");const n=new Map;return N.forEach(t=>{const o=(e.get(t)||[]).slice().sort((i,d)=>i.startIdx-d.startIdx||i.endIdx-d.endIdx),s=[];let r=null,a=null;for(let i=0;i<R.length-1;i++){const d=o.filter(m=>m.startIdx<=i&&m.endIdx>i),c=d.length?d.map(m=>m.id).sort((m,l)=>m-l).join("|"):null;if(!c){r&&s.push(r),r=null,a=null;continue}if(r&&c===a){r.end=i+1;continue}r&&s.push(r),r={start:i,end:i+1,events:d,hasConflict:d.length>1},a=c}r&&s.push(r),n.set(t,s)}),E.log("Grouped events with conflicts:",n),n}function tt(e){const n=new Set,t=[];return e.forEach(o=>{o.forEach(s=>{if(!s.hasConflict)return;const r=[...new Set(s.events.map(i=>i.code||i.title).filter(Boolean))];if(r.length<2)return;r.sort((i,d)=>i.localeCompare(d));const a=r.join("|");n.has(a)||(n.add(a),t.push(r))})}),E.log("Conflict summaries:",t),t}function nt(e,n){if(!e?.footerConflicts)return;if(!n.length){e.footerConflicts.textContent="";return}const t=n.map(o=>`[${o.join(", ")}]`).join(" ");e.footerConflicts.textContent=`‚ö†Ô∏è The following classes are in conflict: ${t}`}function ot(e){const n=Math.floor(e/60),t=e%60,o=String(n),s=String(t).padStart(2,"0");return`${o}:${s}`}function st(){const e=document.createElement("div");e.className="schedule-table-wrap";const n=document.createElement("table");n.className="schedule-table";const t=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time"></th>
    ${N.map(a=>`<th class="schedule-day-head" data-day="${a}">${a}</th>`).join("")}
  `,t.appendChild(o),n.appendChild(t);const s=document.createElement("tbody");for(let a=0;a<R.length;a++){const i=document.createElement("tr"),d=document.createElement("td");d.className="schedule-time",d.textContent=ot(R[a]),i.appendChild(d),N.forEach(c=>{const m=document.createElement("td");m.className="schedule-cell",m.dataset.day=c,m.dataset.row=String(a);const l=document.createElement("div");l.className="schedule-cell-inner",m.appendChild(l),i.appendChild(m)}),s.appendChild(i)}n.appendChild(s),e.appendChild(n);const r=document.createElement("div");return r.className="schedule-overlay",e.appendChild(r),e}function rt(e){return e.getBoundingClientRect()}function it(e,n,t){const o=e.querySelector(".schedule-overlay");o.innerHTML="";const s=e.querySelector(".schedule-table"),r=s.querySelector("tbody tr"),a=s.querySelector('tbody tr td.schedule-cell[data-day="Mon"]'),i=s.querySelector("thead th.schedule-time");if(!r||!a||!i)return;const d=i.getBoundingClientRect().width,c=a.getBoundingClientRect().width,m=s.querySelector("thead").getBoundingClientRect().height,l=r.getBoundingClientRect().height,u=getComputedStyle(a),S=parseFloat(u.borderLeftWidth)||0,p=parseFloat(u.borderTopWidth)||0,v=parseFloat(u.borderRightWidth)||0,w=parseFloat(u.borderBottomWidth)||0,T=(S+v)/2,M=(p+w)/2,V=[];N.forEach((_,O)=>{(n.get(_)||[]).forEach(D=>{const z=d+O*c,K=m+D.rowStart*l,re=D.rowSpan*l,h=document.createElement("div");h.className="schedule-entry-float",h.style.left=`${z+S}px`,h.style.top=`${K+p}px`,h.style.width=`${c-T}px`,h.style.height=`${re-M}px`;const y=document.createElement("div");y.className="schedule-entry-overlap-layer",h.appendChild(y);const H=document.createElement("div");H.className="schedule-entry-text";const De=D.code||D.title,Mt=D.label?`${De} ${D.label}`:De;H.innerHTML=`
        <div class="schedule-entry-title">${Mt}</div>
        <div class="schedule-entry-time">${D.timeLabel}</div>
      `,h.appendChild(H),o.appendChild(h),V.push({el:h,day:_,ev:D,rect:rt(h),overlapLayerEl:y,overlaps:[],textEl:H})})}),E.log("Rendered overlay blocks:",V)}function at(e,n,t){const o=e?.scheduleRoot||e?.scheduleGrid||e?.schedulePanel||e?.scheduleContainer||e?.scheduleView||e?.schedule;if(!o){E.warn("renderSchedule: no schedule host found on ctx");return}const s=Qe(n||[],t),r=et(s),a=tt(r);o.innerHTML="";const i=st();o.appendChild(i),it(i,s),nt(e,a)}const $=C("export-ics"),ne="America/Vancouver",lt=e=>{const n=e.getUTCFullYear(),t=pad(e.getUTCMonth()+1),o=pad(e.getUTCDate()),s=pad(e.getUTCHours()),r=pad(e.getUTCMinutes()),a=pad(e.getUTCSeconds());return $.log("Formatting UTC Date:",{y:n,m:t,d:o,hh:s,mm:r,ss:a}),`${n}${t}${o}T${s}${r}${a}Z`},ye={Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA",Sun:"SU"},ct=/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/,dt=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?\s*-\s*(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i,ut=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,Z=e=>String(e).padStart(2,"0"),mt=e=>{const n=e.getFullYear(),t=Z(e.getMonth()+1),o=Z(e.getDate());return $.log("Formatted Date:",{year:n,month:t,day:o}),`${n}${t}${o}`},be=e=>{const n=mt(e),t=Z(e.getHours()),o=Z(e.getMinutes());return $.log("Formatted DateTime:",{datePart:n,hours:t,minutes:o}),`${n}T${t}${o}00`},ve=(e,n,t)=>{let o=Number.parseInt(e,10);const s=Number.parseInt(n,10),r=t.toLowerCase();return $.log("Parsing Time:",{hours:o,minutes:s,period:r}),r==="p"&&o!==12&&(o+=12),r==="a"&&o===12&&(o=0),{hours:o,minutes:s}},gt=e=>{const n=String(e||"").match(ct),t=String(e||"").match(dt),o=String(e||"").match(ut)||[];if(!n||!t||!o.length)return null;$.log("Parsed Meeting Line:",{dateMatch:n,timeMatch:t,days:o});const s=n[1],r=n[2],a=ve(t[1],t[2],t[3]),i=ve(t[4],t[5],t[6]),d=[...new Set(o.map(c=>ye[c]).filter(Boolean))];return{startDate:s,endDate:r,days:d,startTime:a,endTime:i}},ft=e=>{const n=String(e||"").split("|").map(s=>s.trim()).filter(Boolean),t=n.find(s=>/\([A-Z]{2,}\)/.test(s));if(t)return t;const o=n.find(s=>/online/i.test(s));return o||""},pt=(e,n)=>{const t=new Date(`${e}T00:00:00`);for(let o=0;o<7;o+=1){const s=new Date(t);s.setDate(t.getDate()+o);const r=Object.values(ye)[s.getDay()===0?6:s.getDay()-1];if(n.includes(r))return s}return t},ht=(e,n)=>{const t=gt(n);if(!t)return null;const o=pt(t.startDate,t.days),s=new Date(o);s.setHours(t.startTime.hours,t.startTime.minutes,0,0);const r=new Date(o);r.setHours(t.endTime.hours,t.endTime.minutes,0,0);const a=[e.code,e.title].filter(Boolean),i=[e.title?`Title: ${e.title}`:null,e.code?`Code: ${e.code}`:null,e.section_number?`Section: ${e.section_number}`:null,e.instructor?`Instructor: ${e.instructor}`:null,e.instructionalFormat?`Format: ${e.instructionalFormat}`:null,e.meeting?`Meeting: ${e.meeting}`:null].filter(Boolean),d=new Date(`${t.endDate}T23:59:59`),c=lt(d);return $.log("Built Class Event:",{course:e,parsed:t,startDate:s,endDate:r,summaryParts:a,descriptionLines:i,untilDate:c}),{uid:`${e.code||"course"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,summary:a.join(" - ")||"Scheduled Course",description:i.join("\\n"),location:ft(n),dtstart:be(s),dtend:be(r),rrule:`FREQ=WEEKLY;BYDAY=${t.days.join(",")};UNTIL=${c}`}},St=e=>{const n=[];e.forEach(o=>{(o.meetingLines?.length?o.meetingLines:[]).forEach(r=>{const a=ht(o,r);a&&n.push(a)})});const t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Workday Extension//Schedule Export//EN","CALSCALE:GREGORIAN",`X-WR-TIMEZONE:${ne}`];return n.forEach(o=>{t.push("BEGIN:VEVENT"),t.push(`UID:${o.uid}`),t.push(`SUMMARY:${o.summary}`),o.description&&t.push(`DESCRIPTION:${o.description}`),o.location&&t.push(`LOCATION:${o.location}`),t.push(`DTSTART;TZID=${ne}:${o.dtstart}`),t.push(`DTEND;TZID=${ne}:${o.dtend}`),t.push(`RRULE:${o.rrule}`),t.push("END:VEVENT")}),t.push("END:VCALENDAR"),$.log("ICS File Generated:",t),t.join(`\r
`)};function yt(){const e=St(g.filtered||[]),n=new Blob([e],{type:"text/calendar;charset=utf-8"}),t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download="workday-schedule.ics",document.body.appendChild(o),o.click(),$.log("Download Triggered for ICS file"),setTimeout(()=>{URL.revokeObjectURL(t),o.remove()},100)}const b=C("scheduleStorage"),W="wdSavedSchedules",we=6,bt=e=>typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e||[])),oe=e=>Array.isArray(e)?e.filter(n=>n&&Array.isArray(n.courses)).map(n=>({id:n.id,name:n.name||"Untitled",savedAt:n.savedAt||new Date().toISOString(),courses:n.courses})):[],Ce=typeof chrome<"u"&&chrome.storage&&chrome.storage.local;async function vt(){if(b.log("Loading saved schedules..."),Ce)return new Promise(e=>{chrome.storage.local.get([W],n=>{const t=oe(n?.[W]||[]);b.log("Schedules loaded from Chrome Storage:",t),e(t)})});try{const e=localStorage.getItem(W);if(!e)return b.log("No schedules found in localStorage."),[];const n=oe(JSON.parse(e));return b.log("Schedules loaded from localStorage:",n),n}catch(e){return console.warn("[WD] Failed to load saved schedules",e),b.error("Error loading schedules from localStorage:",e),[]}}async function Le(e){const n=oe(e);if(b.log("Persisting saved schedules:",n),Ce)return new Promise(t=>{chrome.storage.local.set({[W]:n},()=>{b.log("Schedules saved to Chrome Storage."),t()})});try{localStorage.setItem(W,JSON.stringify(n)),b.log("Schedules saved to localStorage.")}catch(t){console.warn("[WD] Failed to save schedules",t),b.error("Error saving schedules to localStorage:",t)}}function wt(e,n){const o={id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,name:e||"Untitled",savedAt:new Date().toISOString(),courses:bt(n||[])};return b.log("Created schedule snapshot:",o),o}function Ct(e){const n=e.courses?.length||0,t=new Date(e.savedAt),o=Number.isNaN(t.getTime())?e.savedAt:t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return`${n} courses ¬∑ Saved ${o}`}function se(e,n){if(b.log("Rendering saved schedules:",n),!!e.savedMenu){if(e.savedMenu.innerHTML="",!n.length){const t=document.createElement("div");t.className="schedule-saved-empty",t.textContent="No saved schedules yet.",e.savedMenu.appendChild(t),b.log("No saved schedules to render.");return}n.forEach(t=>{const o=document.createElement("div");o.className="schedule-saved-card",o.dataset.id=t.id;const s=document.createElement("div");s.className="schedule-saved-card-header";const r=document.createElement("div"),a=document.createElement("div");a.className="schedule-saved-title",a.textContent=t.name;const i=document.createElement("div");i.className="schedule-saved-meta",i.textContent=Ct(t),r.appendChild(a),r.appendChild(i),s.appendChild(r);const d=document.createElement("div");d.className="schedule-saved-actions";const c=document.createElement("button");c.type="button",c.className="schedule-saved-action",c.dataset.action="load",c.textContent="Load";const m=document.createElement("button");m.type="button",m.className="schedule-saved-action delete",m.dataset.action="delete",m.textContent="Delete",d.appendChild(c),d.appendChild(m),o.appendChild(s),o.appendChild(d),e.savedMenu.appendChild(o),b.log("Rendered schedule card:",t)})}}function Lt(e){return b.log("Checking if more schedules can be saved. Current count:",e.length),e.length<we}function Dt(){return we}(()=>{console.log("[WD] content script loaded");async function e(){const n=Ee(),t=await Te(n);t.button.classList.toggle("is-collapsed",t.widget.classList.contains("is-hidden"));const o=()=>{at(t,g.filtered,g.view.semester)},s=l=>{g.view.panel=l,t.panels.forEach(u=>{u.classList.toggle("is-active",u.dataset.panel===l)}),t.tabButtons.forEach(u=>{u.classList.toggle("is-active",u.dataset.panel===l)}),t.widget.classList.toggle("is-schedule-view",l==="schedule"),t.widget.classList.toggle("is-settings-view",l==="settings"),t.widget.classList.toggle("is-help-view",l==="help")},r=()=>{t.widget.classList.toggle("is-hidden"),t.button.classList.toggle("is-collapsed",t.widget.classList.contains("is-hidden"))};let a=null;const i=l=>{t.saveModal&&(t.saveModal.classList.add("is-hidden"),t.saveModal.setAttribute("aria-hidden","true"),a&&(a(l),a=null))},d=({title:l,message:u,confirmLabel:S="Save",showInput:p=!0,showCancel:v=!0})=>t.saveModal?(t.saveModalTitle.textContent=l,t.saveModalMessage.textContent=u,t.saveModalConfirm.textContent=S,t.saveModalField.classList.toggle("is-hidden",!p),t.saveModalCancel.classList.toggle("is-hidden",!v),t.saveModalInput.value="",t.saveModalInput.classList.remove("is-invalid"),t.saveModal.classList.remove("is-hidden"),t.saveModal.setAttribute("aria-hidden","false"),p?t.saveModalInput.focus():t.saveModalConfirm.focus(),new Promise(w=>{a=w})):Promise.resolve(null);t.saveModal&&(f(t.saveModal,"click",l=>{if(l.target===t.saveModal){i(null);return}const u=l.target.closest("[data-action]")?.dataset.action;if(u){if(u==="close"||u==="cancel"){i(null);return}if(u==="confirm"){if(!t.saveModalField.classList.contains("is-hidden")){const S=t.saveModalInput.value.trim();if(!S){t.saveModalInput.classList.add("is-invalid"),t.saveModalInput.focus();return}i(S);return}i(!0)}}}),f(t.saveModalInput,"input",()=>{t.saveModalInput.classList.remove("is-invalid")}),f(t.saveModalInput,"keydown",l=>{l.key==="Enter"&&t.saveModalConfirm.click()}),f(document,"keydown",l=>{l.key==="Escape"&&t.saveModal&&!t.saveModal.classList.contains("is-hidden")&&i(null)})),t.tabButtons.forEach(l=>{f(l,"click",()=>{s(l.dataset.panel),l.dataset.panel==="schedule"&&o()})}),t.semesterButtons.forEach(l=>{f(l,"click",()=>{g.view.semester=l.dataset.semester,t.semesterButtons.forEach(u=>{u.classList.toggle("is-active",u.dataset.semester===g.view.semester)}),o()})}),f(t.button,"click",r);const c=l=>{!t.exportDropdown||!t.exportButton||(t.exportDropdown.classList.toggle("is-open",l),t.exportButton.setAttribute("aria-expanded",String(l)))};f(t.exportButton,"click",()=>{const l=t.exportDropdown?.classList.contains("is-open");c(!l)}),f(document,"click",l=>{!t.exportDropdown?.classList.contains("is-open")||(l.composedPath?l.composedPath():[]).includes(t.exportDropdown)||c(!1)}),f(document,"click",l=>{!t.savedDropdown?.open||(l.composedPath?l.composedPath():[]).includes(t.savedDropdown)||(t.savedDropdown.open=!1)}),f(t.root,"click",l=>{!t.exportDropdown?.open||(l.composedPath?l.composedPath():[]).includes(t.exportDropdown)||(t.exportDropdown.open=!1)}),chrome.runtime.onMessage.addListener(l=>{l?.type==="TOGGLE_WIDGET"&&r()}),f(t.refresh,"click",async()=>{g.courses=await de(),me(t.search.value),j(g.sort.key||"code"),U(t,g.filtered),o()});const m=async l=>{l==="ics"&&yt()};f(t.exportMenu,"click",async l=>{const u=l.target.closest("[data-export]");u&&(c(!1),await m(u.dataset.export))}),f(t.saveScheduleBtn,"click",async()=>{if(!Lt(g.savedSchedules)){await d({title:"Schedule limit reached",message:`You can only save up to ${Dt()} schedules. Delete one to save another.`,confirmLabel:"Got it",showInput:!1,showCancel:!1});return}const l=await d({title:"Save schedule",message:"Name this schedule so you can find it later.",confirmLabel:"Save",showInput:!0,showCancel:!0});if(!l)return;const u=wt(l,g.filtered);g.savedSchedules=[u,...g.savedSchedules],await Le(g.savedSchedules),se(t,g.savedSchedules),t.savedDropdown&&(t.savedDropdown.open=!0)}),f(t.savedMenu,"click",async l=>{const u=l.target.closest("[data-action]");if(!u)return;const p=u.closest(".schedule-saved-card")?.dataset.id;if(!p)return;if(u.dataset.action==="delete"){const w=g.savedSchedules.find(M=>M.id===p);if(!w||!await d({title:"Permanently Delete Schedule?",message:`This action will permanently delete "${w.name}".`,confirmLabel:"Delete",showInput:!1,showCancel:!0}))return;g.savedSchedules=g.savedSchedules.filter(M=>M.id!==p),await Le(g.savedSchedules),se(t,g.savedSchedules);return}const v=g.savedSchedules.find(w=>w.id===p);v&&(g.courses=[...v.courses],g.filtered=[...v.courses],t.search.value="",j(g.sort.key||"code"),U(t,g.filtered),o(),s("schedule"),t.savedDropdown&&(t.savedDropdown.open=!1))}),f(t.settingsBtn,"click",()=>{t.widget.classList.remove("is-hidden"),t.button.classList.remove("is-collapsed"),s("settings")}),f(t.helpBtn,"click",()=>{t.widget.classList.remove("is-hidden"),t.button.classList.remove("is-collapsed"),s("help")}),f(t.search,"input",Me(()=>{me(t.search.value),j(g.sort.key||"code"),U(t,g.filtered),o()},100)),ze(t),g.savedSchedules=await vt(),se(t,g.savedSchedules),g.courses=await de(),g.filtered=[...g.courses],j("code"),U(t,g.filtered),o(),s(g.view.panel)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})()})();
//# sourceMappingURL=content.js.map
