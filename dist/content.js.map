{"version":3,"file":"content.js","sources":["../src/utilities/dom.js","../src/core/state.js","../src/utilities/shadowMount.js","../src/panel/loadPanel.js","../src/extraction/headerMaps.js","../src/extraction/sectionLinkInfo.js","../src/extraction/meetingPatternsInfo.js","../src/extraction/instructorInfo.js","../src/extraction/onlineClassCheck.js","../src/extraction/findingTables.js","../src/extraction/courseExtraction.js","../src/panel/renderRows.js","../src/panel/panelInteractions.js","../src/panel/scheduleView.js","../src/exporting/cvs.js","../src/content.js"],"sourcesContent":["export const $ = (root, sel) => root.querySelector(sel);\r\n\r\nexport const $$ = (root, sel) =>\r\n  Array.from(root.querySelectorAll(sel));\r\n\r\nexport const on = (el, ev, fn, opts) =>\r\n  el && el.addEventListener(ev, fn, opts);\r\n\r\nexport const debounce = (fn, ms = 300) => {\r\n  let t;\r\n  return (...a) => {\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n};","export const STATE = {\r\n    courses: [],\r\n    filtered: [],\r\n    sort: { key: null, dir: 1 }, // 1 asc, -1 desc\r\n    view: {\r\n            panel: \"list\",\r\n            term: \"first\",\r\n        },\r\n};","const EXT_ID = \"wd-courses-capture\";\r\n\r\nexport function ensureMount() {\r\n  let host = document.getElementById(EXT_ID);\r\n  if (host) return host.shadowRoot;\r\n\r\n  host = document.createElement(\"div\");\r\n  host.id = EXT_ID;\r\n  host.style.all = \"initial\";\r\n  host.style.position = \"fixed\";\r\n  host.style.bottom = \"16px\";\r\n  host.style.right = \"16px\";\r\n  host.style.zIndex = \"2147483647\";\r\n  host.attachShadow({ mode: \"open\" });\r\n  document.documentElement.appendChild(host);\r\n\r\n  return host.shadowRoot;\r\n}\r\n","export async function loadPanel(shadow) {\r\n  const htmlUrl = chrome.runtime.getURL(\"src/panel.html\");\r\n  const cssUrl = chrome.runtime.getURL(\"src/panel.css\");\r\n\r\n  const [html, css] = await Promise.all([\r\n    fetch(htmlUrl).then((r) => r.text()),\r\n    fetch(cssUrl).then((r) => r.text()),\r\n  ]);\r\n\r\n  shadow.innerHTML = \"\";\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = css;\r\n  shadow.appendChild(style);\r\n\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.innerHTML = html;\r\n  shadow.appendChild(wrap);\r\n\r\n  const logoImg = shadow.querySelector(\"#wd-logo\");\r\n  if (logoImg)\r\n    logoImg.src = chrome.runtime.getURL(\"src/W.svg\");\r\n\r\n  return {\r\n    button: shadow.querySelector(\"#floating-button\"),\r\n    widget: shadow.querySelector(\".widget\"),\r\n    search: shadow.querySelector(\"#widget-search\"),\r\n    refresh: shadow.querySelector(\"#widget-refresh\"),\r\n    exportBtn: shadow.querySelector(\"#widget-export\"),\r\n    tableBody: shadow.querySelector(\"tbody\"),\r\n    tableHead: shadow.querySelector(\"thead\"),\r\n    tabButtons: shadow.querySelectorAll(\".tab-button\"),\r\n    panels: shadow.querySelectorAll(\".widget-panel\"),\r\n    scheduleGrid: shadow.querySelector(\"#schedule-grid\"),\r\n    termButtons: shadow.querySelectorAll(\".term-button\"),\r\n  };\r\n}","export const normalizeText = (s) => String(s || \"\")\r\n      .replace(/\\u00A0/g, \" \")\r\n      .replace(/\\s+/g, \" \")\r\n      .trim()\r\n      .toLowerCase();\r\n\r\nfunction getHeaderKey(el) {\r\n  const a = el?.getAttribute?.(\"data-automation-id\") || \"\";\r\n  const m = a.match(/^columnHeader(\\d+\\.\\d+)$/);\r\n  return m ? m[1] : null; // \"252.9\"\r\n}\r\n\r\nexport function buildHeaderMaps(gridRoot) {\r\n  const headerEls = Array.from(\r\n    gridRoot.querySelectorAll('th[data-automation-id^=\"columnHeader\"]')\r\n  );\r\n\r\n  const headers = headerEls\r\n    .map((el, pos) => {\r\n      const text = getHeaderText(el);\r\n      const key = getHeaderKey(el); // <-- \"252.9\"\r\n      return { el, pos, key, text, norm: normalizeText(text) };\r\n    })\r\n    .filter((h) => h.text);\r\n\r\n  function findHeader(needles) {\r\n    const ns = needles.map(normalizeText);\r\n    let hit = headers.find(h => ns.includes(h.norm));\r\n    if (hit) return hit;\r\n    hit = headers.find(h => ns.some(n => h.norm.includes(n)));\r\n    return hit || null;\r\n  }\r\n\r\n  const KEYS = {\r\n    instructor: [\"instructor\", \"instructors\"],\r\n    meeting: [\"meeting patterns\", \"meeting pattern\"],\r\n    deliveryMode: [\"delivery mode\"],\r\n    title: [\"title\", \"course listing\"],\r\n    section: [\"section\"],\r\n    instructionalFormat: [\"instructional format\"],\r\n     startDate: [\"start date\", \"start\"],\r\n  };\r\n\r\n  const colMap = {};\r\n  const posMap = {};\r\n\r\n  for (const [key, needles] of Object.entries(KEYS)) {\r\n    const hit = findHeader(needles);\r\n    colMap[key] = hit ? hit.key : null; // <-- store \"252.9\"\r\n    posMap[key] = hit ? hit.pos : -1;\r\n  }\r\n\r\n  return { colMap, posMap };\r\n}\r\n\r\nexport function getHeaderText(headerEl) {\r\n  if (!headerEl) return \"\";\r\n\r\n  const btn = headerEl.querySelector(\"button[title]\");\r\n  if (btn) return (btn.getAttribute(\"title\") || \"\").trim();\r\n\r\n  return (headerEl.textContent || \"\").trim();\r\n}","/* Parse the Workday \"promptOption\" section link string. */\r\nexport function parseSectionLinkString(input) {\r\n    let str = String(input || \"\").replace(/\\u00A0/g, \" \").trim();\r\n\r\n    if (!str)\r\n        return null;\r\n\r\n    // keep ALL lines; Workday wraps titles with \\n\r\n    str = str.replace(/\\s*\\n\\s*/g, \" \").trim();\r\n\r\n    // REQUIRED pattern:\r\n    const m = str.match(/^\\s*([A-Z][A-Z0-9_]*\\s*\\d{3}[A-Z]?)\\s*-\\s*(.+?)\\s*$/);\r\n    if (!m)\r\n        return null;\r\n\r\n    const baseCode = m[1].trim(); // \"COSC_O 222\"\r\n    const rest = m[2].trim();     // \"L2D - Data Structures\" or \"101 - Data Structures\"\r\n\r\n    // Split rest into section token + title\r\n    const parts = rest.split(/\\s*[-–—]\\s*/).map((p) => p.trim()).filter(Boolean);\r\n\r\n    let sectionToken = \"\";\r\n    let parsedTitle = \"\";\r\n\r\n    sectionToken = parts[0];\r\n    parsedTitle = parts.slice(1).join(\" - \").trim();\r\n\r\n    parsedTitle = parsedTitle.replace(/\\s*:\\s*/g, \":\\n\");\r\n\r\n    return {\r\n      code: baseCode,\r\n      section_number: sectionToken,\r\n      title: parsedTitle,\r\n      full: str,\r\n    };\r\n}\r\n\r\nexport function guessClassCode(text) {\r\n    const m = String(text || \"\").match(/[A-Z][A-Z0-9_]*\\s*\\d{2,3}[A-Z]?/);\r\n    \r\n    return m ? m[0].replace(/\\s+/g, \" \").trim() : \"\";\r\n}","export function extractMeetingLinesFromCell(meetingEl) {\r\n    if (!meetingEl) {\r\n      console.log(\"extractMeetingLinesFromCell failed 1\");\r\n      return [];\r\n    }\r\n\r\n    // BEST SOURCE: menu items expose full meeting strings in aria-label\r\n    const menuItems = Array.from(\r\n      meetingEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]')\r\n    );\r\n\r\n    let lines = menuItems\r\n      .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n      .filter(Boolean);\r\n\r\n    // fallback: promptOption text (sometimes present)\r\n    if (!lines.length) {\r\n      const prompts = Array.from(\r\n        meetingEl.querySelectorAll('[data-automation-id=\"promptOption\"]')\r\n      );\r\n      lines = prompts\r\n        .map((el) =>\r\n          (\r\n            el.getAttribute(\"data-automation-label\") ||\r\n            el.getAttribute(\"title\") ||\r\n            el.textContent ||\r\n            \"\"\r\n          ).trim()\r\n        )\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // final fallback: innerText split\r\n    if (!lines.length) {\r\n      lines = String(meetingEl.innerText || \"\")\r\n        .split(\"\\n\")\r\n        .map((s) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // only keep real meeting sentences\r\n    const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n    const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n    const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n    return lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n}\r\n\r\nexport function extractMeetingLinesFromRow(rowEl) {\r\n    if (!rowEl)\r\n        return [];\r\n\r\n    const items = Array.from(rowEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n    const lines = items\r\n        .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n        .filter(Boolean);\r\n\r\n    const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n    const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n    const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n    return lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n}\r\n\r\nexport function formatMeetingLineForPanel(line) {\r\n    const parts = String(line || \"\")\r\n      .split(\"|\")\r\n      .map((p) => p.trim())\r\n      .filter(Boolean);\r\n\r\n    const dayPartRaw = parts.find((p) => /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/.test(p)) || \"\";\r\n    const dayPart = dayPartRaw.split(/\\s+/).join(\" / \");\r\n\r\n    const timePart = parts.find((p) => /\\d{1,2}:\\d{2}/.test(p) && /-/.test(p)) || \"\";\r\n    const buildingPart = parts.find((p) => /\\([A-Z]{2,}\\)/.test(p)) || \"\"; // \"Library (LIB)\"\r\n    const floorPart = parts.find((p) => /^Floor:/i.test(p)) || \"\";\r\n    const roomPart = parts.find((p) => /^Room:/i.test(p)) || \"\";\r\n\r\n    return {\r\n      days: dayPart,\r\n      time: timePart,\r\n      location: [buildingPart, [floorPart, roomPart].join(\" | \")].filter(Boolean).join(\"\\n\"),\r\n    };\r\n}\r\n\r\nexport function normalizeMeetingPatternsText(text) {\r\n    // preserve line breaks, normalize each line\r\n    return String(text || \"\")\r\n      .split(/\\r?\\n/)\r\n      .map((line) => line.replace(/\\s+/g, \" \").trim())\r\n      .filter(Boolean)\r\n      .join(\"\\n\");\r\n}\r\n\r\nexport function extractStartDate(line) {\r\n    const match = String(line || \"\").match(/\\b(\\d{4}-\\d{2}-\\d{2})\\b/);\r\n    return match ? match[1] : \"\";\r\n}","export function extractInstructorNamesFromCell(instructorEl) {\r\n    if (!instructorEl) {\r\n      console.log(\"failed extracting instuctor name:\", instructorEl);\r\n      return \"\";\r\n    }\r\n    \r\n    const prompt = instructorEl.querySelector('[data-automation-id=\"promptOption\"]');\r\n    const txt = (\r\n      (prompt && (prompt.getAttribute(\"data-automation-label\") || prompt.getAttribute(\"title\") || prompt.textContent)) ||\r\n      instructorEl.textContent || \"\").trim();\r\n      console.log(\"sucsessfully extracted instuctor name:\", instructorEl, txt);\r\n    return txt;\r\n}","export function onlineClassCheck(deliveryModeCellEl) {\r\n    if (!deliveryModeCellEl) return false;\r\n\r\n    const txt = (deliveryModeCellEl.innerText || deliveryModeCellEl.textContent || \"\").trim();\r\n    if (/online learning/i.test(txt)) return true;\r\n\r\n    const prompts = Array.from(deliveryModeCellEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n    return prompts.some((el) => {\r\n      const label = (el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\").trim();\r\n      return /online learning/i.test(label);\r\n    });\r\n  }","import { $$ } from \"../utilities/dom\"\r\nimport { normalizeText, getHeaderText } from \"./headerMaps.js\"\r\n\r\n// Find any likely Workday grid/table on the page\r\nexport function findingTables() {\r\n    const roots = $$(\r\n      document,\r\n      'table, [role=\"table\"], div[data-automation-id*=\"grid\"], div[role=\"grid\"]'\r\n    );\r\n\r\n    for (const root of roots) {\r\n      const headerEls = $$(\r\n        root,\r\n        \"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header\"\r\n      );\r\n\r\n      const headerText = headerEls.map((h) => normalizeText(getHeaderText(h)));\r\n\r\n      // still require \"section\" + at least one other expected header\r\n      const looksRight =\r\n        headerText.some((t) => t.includes(\"section\")) &&\r\n        (headerText.some((t) => t.includes(\"instructor\")) ||\r\n          headerText.some((t) => t.includes(\"meeting\")) ||\r\n          headerText.some((t) => t.includes(\"instructional format\")) ||\r\n          headerText.some((t) => t.includes(\"format\")) ||\r\n          headerText.some((t) => t.includes(\"status\")));\r\n\r\n      if (!looksRight) \r\n        continue;\r\n\r\n      const rows = $$(\r\n        root,\r\n        \"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row\"\r\n      );\r\n\r\n      if (rows.length)\r\n        return { root, rows };\r\n    }\r\n\r\n    return null;\r\n  }","import { $$ } from \"../utilities/dom\"\r\nimport { buildHeaderMaps, getColIndex } from \"./headerMaps.js\"\r\nimport { parseSectionLinkString, guessClassCode } from \"./sectionLinkInfo.js\"\r\nimport { extractMeetingLinesFromCell, extractMeetingLinesFromRow, formatMeetingLineForPanel, normalizeMeetingPatternsText, extractStartDate } from \"./meetingPatternsInfo.js\"\r\nimport { extractInstructorNamesFromCell } from \"./instructorInfo.js\"\r\nimport { onlineClassCheck } from \"./onlineClassCheck.js\"\r\nimport { findingTables } from \"./findingTables.js\"\r\n\r\nexport async function extractAllCourses() {\r\n    const found = findingTables();\r\n    let courses = [];\r\n\r\n    if (found) {\r\n      const headerMaps = buildHeaderMaps(found.root);\r\n\r\n      for (const row of found.rows) {\r\n        const c = extractFromRow(row, headerMaps);\r\n        if ((c.code || c.title)\r\n            && Object.values(c).join(\"\").trim()) courses.push(c);\r\n      }\r\n    }\r\n\r\n    return findUniqueCourses(courses);\r\n}\r\n\r\nfunction findUniqueCourses(list) {\r\n    const key = (c) => [c.code, c.title, c.section_number].join(\"|\").toLowerCase();\r\n    const seen = new Set();\r\n    const out = [];\r\n\r\n    for (const c of list) {\r\n      const k = key(c);\r\n      if (!seen.has(k)) {\r\n        seen.add(k);\r\n        out.push(c);\r\n      }\r\n    }\r\n\r\n    return out;\r\n  }\r\n\r\nexport function extractFromRow(row, headerMaps) {\r\n    const { colMap, posMap } = headerMaps;\r\n\r\n    const cells = $$(row, \"td, [role='gridcell']\");\r\n    const allText = (row.innerText || \"\").trim();\r\n\r\n   // map row cells by position (1-based)\r\n  function getCellKey(cell) {\r\n  // looks inside the cell for the container with id like \"gen-dwr-comp-252.9-640\"\r\n  const inner = cell.querySelector('[id^=\"gen-dwr-comp-\"]');\r\n  const id = inner?.id || \"\";\r\n  const m = id.match(/^gen-dwr-comp-(\\d+\\.\\d+)-/);\r\n  return m ? m[1] : null; // \"252.9\"\r\n}\r\n\r\n// map row cells by Workday key (e.g., \"252.9\"), not by position\r\nconst cellByCol = new Map();\r\ncells.forEach((cell) => {\r\n  const key = getCellKey(cell);\r\n  if (key && !cellByCol.has(key))\r\n    cellByCol.set(key, cell);\r\n});\r\n\r\n\r\n\r\n   const getCellEl = (keyName) => {\r\n  const key = colMap[keyName]; // e.g., \"252.9\"\r\n  if (key != null && cellByCol.has(key))\r\n    return cellByCol.get(key);\r\n\r\n  const pos = posMap[keyName];\r\n  if (pos != null && pos >= 0 && pos < cells.length)\r\n    return cells[pos];\r\n\r\n  return null;\r\n};\r\n\r\n\r\n    const readByKey = (key) => {\r\n      const col = colMap[key];\r\n      if (col != null && cellByCol.has(col)) {\r\n        return (cellByCol.get(col).innerText || \"\").trim();\r\n      }\r\n\r\n      const pos = posMap[key];\r\n      if (pos != null && pos >= 0 && pos < cells.length) {\r\n        return (cells[pos].innerText || \"\").trim();\r\n      }\r\n      return \"\";\r\n    };\r\n\r\n    // ✅ Search the entire row for the promptOption link (most reliable)\r\n    const allPromptOptions = $$(row, '[data-automation-id=\"promptOption\"]');\r\n    let sectionLinkEl = null;\r\n\r\n    for (const el of allPromptOptions) {\r\n      const text =\r\n        el.getAttribute(\"data-automation-label\") ||\r\n        el.getAttribute(\"title\") ||\r\n        el.getAttribute(\"aria-label\") ||\r\n        el.textContent ||\r\n        \"\";\r\n      if (/^[A-Z][A-Z0-9_]*\\s*\\d{2,3}-/.test(text)) {\r\n        sectionLinkEl = el;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sectionLinkEl && allPromptOptions.length > 0) {\r\n      sectionLinkEl = allPromptOptions[0];\r\n    }\r\n\r\n    const sectionLinkString =\r\n      (sectionLinkEl &&\r\n        (sectionLinkEl.getAttribute(\"data-automation-label\") ||\r\n          sectionLinkEl.getAttribute(\"title\") ||\r\n          sectionLinkEl.getAttribute(\"aria-label\") ||\r\n          sectionLinkEl.textContent)) ||\r\n      \"\";\r\n\r\n    const titleCell = readByKey(\"title\");\r\n    const codeCell = readByKey(\"code\");\r\n    const sectCell = readByKey(\"section\");\r\n    const meetingCell = readByKey(\"meeting\");\r\n    const instructionalFormatCell = readByKey(\"instructionalFormat\"); \r\n         const startDateCell = readByKey(\"startDate\");\r\n\r\n    // ---------- Core parse: (code + section + title) from the same string ----------\r\n    let code = \"\";\r\n    let title = titleCell || \"\";\r\n    let section_number = \"\";\r\n\r\n    const parsed = parseSectionLinkString(sectionLinkString);\r\n    if (parsed) {\r\n      code = parsed.code;\r\n      section_number = parsed.section_number;\r\n      title = parsed.title;\r\n    }\r\n\r\n    if (!code)\r\n        code = guessClassCode(codeCell) || guessClassCode(titleCell) || guessClassCode(allText) || \"\";\r\n\r\n    // ---------- Lab / Seminar detection ----------\r\n    const labLike = (s) => /\\b(lab|laboratory|labratory)\\b/i.test(String(s || \"\"));\r\n    const seminarLike = (s) => /\\bseminar\\b/i.test(String(s || \"\"));\r\n\r\n    const isLab =\r\n      labLike(instructionalFormatCell) ||\r\n      labLike(sectCell) ||\r\n      labLike(title) ||\r\n      labLike(sectionLinkString) ||\r\n      labLike(allText)\r\n\r\n    const isSeminar =\r\n      seminarLike(instructionalFormatCell) ||\r\n      seminarLike(sectCell) ||\r\n      seminarLike(title) ||\r\n      seminarLike(sectionLinkString) ||\r\n      seminarLike(allText)\r\n\r\n    // ---------- Instructor ----------\r\n\r\n    const instructorEl = getCellEl(\"instructor\"); // uses colMap/posMap + cellByCol\r\n\r\n    let instructor = \"\";\r\n\r\n    if (isLab || isSeminar) {\r\n      instructor = \"N/A\";\r\n    } else {\r\n      instructor =\r\n        extractInstructorNamesFromCell(instructorEl) ||\r\n        (readByKey(\"instructor\") || \"\").trim();\r\n    }\r\n\r\n\r\n    // ---------- Meeting ----------\r\n    let meeting;\r\n\r\n    const meetingCol = colMap.meeting;\r\n    let meetingEl = null;\r\n\r\n    if (meetingCol != null && cellByCol.has(meetingCol)) {\r\n      meetingEl = cellByCol.get(meetingCol);\r\n    } else if (posMap.meeting != null && posMap.meeting >= 0 && posMap.meeting < cells.length) {\r\n      meetingEl = cells[posMap.meeting];\r\n    }\r\n\r\n    let lines = meetingEl ? extractMeetingLinesFromCell(meetingEl) : [];\r\n    if (!lines.length)\r\n        lines = extractMeetingLinesFromRow(row);\r\n\r\n    let meetingObj = { days: \"\", time: \"\", location: \"\" };\r\n    let startDate = extractStartDate(lines[0]) || extractStartDate(startDateCell);\r\n\r\n    if (lines.length) {\r\n      const firstLine = lines[0];\r\n      meetingObj = formatMeetingLineForPanel(firstLine);\r\n    } else {\r\n      meeting = (meetingCell || \"\").trim();\r\n    }\r\n\r\n    const deliveryModeCell = getCellEl(\"deliveryMode\");\r\n    const isOnlineDelivery = onlineClassCheck(deliveryModeCell);\r\n\r\n    if (isOnlineDelivery) {\r\n      meetingObj.location = \"Online\";\r\n    }\r\n\r\n    if (meetingObj.days || meetingObj.time || meetingObj.location) {\r\n      meeting = [meetingObj.days, meetingObj.time].filter(Boolean).join(\" | \");\r\n      if (meetingObj.location)\r\n        meeting += `\\n${meetingObj.location}`;\r\n      else meeting += `\\nOnline`;\r\n    } else {\r\n      meeting = (meetingCell || \"\").trim();\r\n    }\r\n\r\n    // ---------- Instructional Format (was \"status\") ----------\r\n    const instructionalFormat = (instructionalFormatCell || \"\").trim();\r\n\r\n    return {\r\n      code,\r\n      title,\r\n      section_number,\r\n      instructor,\r\n      meeting: normalizeMeetingPatternsText(meeting),\r\n      instructionalFormat, // ✅ renamed field\r\n            startDate,\r\n      meetingLines: lines,\r\n      isLab,\r\n      isSeminar,\r\n    };\r\n}","export const escHTML = (s) => {\r\n  return String(s ?? \"\")\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n}\r\n\r\n\r\nexport function renderRows(ctx, rows) {\r\n  ctx.tableBody.innerHTML = \"\";\r\n  const frag = document.createDocumentFragment();\r\n\r\n  rows.forEach((c) => {\r\n    const tr = document.createElement(\"tr\");\r\n\r\n    const badge =\r\n      c.isLab ? \"[Laboratory]\" :\r\n      c.isSeminar ? \"[Seminar]\" :\r\n      \"\";\r\n\r\n    tr.innerHTML = `\r\n      <td class=\"title\">\r\n        <div class=\"title-main\">${c.title || \"\"}</div>\r\n        ${badge ? `<div class=\"muted\">${badge}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"code\">${c.code || \"\"}</td>\r\n      <td class=\"sect\">${(c.section_number || \"\").trim()}</td>\r\n      <td class=\"instructor\">${c.instructor || \"\"}</td>\r\n      <td class=\"meeting\">\r\n        ${(() => {\r\n          const parts = String(c.meeting || \"\").split(\"\\n\");\r\n          const main = (parts[0] || \"\").trim();   // \"Wed / Fri | 12:30 p.m. - 2:00 p.m.\"\r\n          const sub  = (parts[1] || \"\").trim();   // \"Online\" OR \"Library (LIB) | Floor: 3 | Room: 317\"\r\n\r\n          return `\r\n            ${main ? `<span class=\"meeting-pill\">${escHTML(main)}</span>` : \"\"}\r\n            ${sub  ? `<div class=\"meeting-sub\">${escHTML(sub)}</div>` : \"\"}\r\n          `;\r\n        })()}\r\n      </td>\r\n      <td class=\"instructionalFormat\">${c.instructionalFormat || \"\"}</td>\r\n    `;\r\n\r\n    frag.appendChild(tr);\r\n  });\r\n\r\n  ctx.tableBody.appendChild(frag);\r\n}","import { $$, on } from \"../utilities/dom.js\"\r\nimport { STATE } from \"../core/state.js\"\r\nimport { renderRows } from \"./renderRows.js\"\r\n\r\nexport function applySearchFilter(q) {\r\n    q = (q || \"\").trim().toLowerCase();\r\n    if (!q) {\r\n      STATE.filtered = [...STATE.courses];\r\n\r\n      return;\r\n    }\r\n    STATE.filtered = STATE.courses.filter((c) => {\r\n      return [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"].some(\r\n        (k) => (c[k] || \"\").toLowerCase().includes(q)\r\n      );\r\n    });\r\n}\r\n\r\nexport function sortBy(key) {\r\n    if (!key)\r\n        return;\r\n    \r\n    const dir = STATE.sort.key === key ? -STATE.sort.dir : 1;\r\n    STATE.sort = { key, dir };\r\n\r\n    const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: \"base\" });\r\n    STATE.filtered.sort((a, b) => dir * collator.compare(a[key] || \"\", b[key] || \"\"));\r\n}\r\n\r\nexport function wireSorting(ctx) {\r\n    const headCells = $$(ctx.tableHead, \"th[data-key]\");\r\n    headCells.forEach((th) => {\r\n      on(th, \"click\", () => {\r\n        const key = th.getAttribute(\"data-key\");\r\n        sortBy(key);\r\n        renderRows(ctx, STATE.filtered);\r\n\r\n        headCells.forEach((h) => h.classList.remove(\"sorted-asc\", \"sorted-desc\"));\r\n        th.classList.add(STATE.sort.dir === 1 ? \"sorted-asc\" : \"sorted-desc\");\r\n      });\r\n    });\r\n}","import { extractStartDate } from \"../extraction/meetingPatternsInfo.js\";\r\n\r\nconst DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"];\r\n\r\n// 30-min grid so 12:30 fits naturally\r\nconst START_HOUR = 8;\r\nconst END_HOUR = 22;           // last visible hour (exclusive end)\r\nconst SLOT_MINUTES = 30;\r\n\r\n// Build slot start times: 8:00, 8:30, 9:00, ...\r\nconst SLOTS = [];\r\nfor (let h = START_HOUR; h < END_HOUR; h++) {\r\n  SLOTS.push(h * 60);\r\n  SLOTS.push(h * 60 + 30);\r\n}\r\nSLOTS.push(END_HOUR * 60);\r\n\r\nconst DAY_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\nconst TIME_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/gi;\r\n\r\nconst SEMESTER_MONTHS = {\r\n  first: [\"09\", \"08\"],\r\n  second: [\"01\", \"12\"],\r\n};\r\n\r\nfunction parseTimeToken(token) {\r\n  if (!token)\r\n    return null;\r\n\r\n  const match = token.trim().match(/(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i);\r\n  if (!match)\r\n    return null;\r\n\r\n  let hours = Number.parseInt(match[1], 10);\r\n  const minutes = Number.parseInt(match[2], 10);\r\n  const period = match[3].toLowerCase();\r\n\r\n  if (period === \"p\" && hours !== 12)\r\n    hours += 12;\r\n  if (period === \"a\" && hours === 12)\r\n    hours = 0;\r\n\r\n  return hours * 60 + minutes;\r\n}\r\n\r\nfunction parseMeetingLine(line) {\r\n  const days = String(line || \"\").match(DAY_REGEX) || [];\r\n  const timeTokens = String(line || \"\").match(TIME_REGEX) || [];\r\n\r\n  if (days.length === 0 || timeTokens.length < 2)\r\n    return null;\r\n\r\n  const startMinutes = parseTimeToken(timeTokens[0]);\r\n  const endMinutes = parseTimeToken(timeTokens[1]);\r\n\r\n  if (startMinutes == null || endMinutes == null)\r\n    return null;\r\n\r\n  if (endMinutes <= startMinutes)\r\n    return null;\r\n\r\n  return {\r\n    days: [...new Set(days)],\r\n    startMinutes,\r\n    endMinutes,\r\n    timeLabel: `${timeTokens[0]} - ${timeTokens[1]}`,\r\n  };\r\n}\r\n\r\nfunction getSemester(startDate) {\r\n  if (!startDate)\r\n    return null;\r\n\r\n  const month = startDate.split(\"-\")[1];\r\n\r\n  if (SEMESTER_MONTHS.first.includes(month))\r\n    return \"first\";\r\n  if (SEMESTER_MONTHS.second.includes(month))\r\n    return \"second\";\r\n\r\n  return null;\r\n}\r\n\r\nfunction clampToGrid(minutes) {\r\n  const min = START_HOUR * 60;\r\n  const max = END_HOUR * 60;\r\n  return Math.max(min, Math.min(max, minutes));\r\n}\r\n\r\nfunction snapDownToSlot(minutes) {\r\n  return Math.floor(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction snapUpToSlot(minutes) {\r\n  return Math.ceil(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction slotIndexOf(minutes) {\r\n  return SLOTS.indexOf(minutes);\r\n}\r\n\r\nfunction buildDayEvents(courses, term) {\r\n  const eventsByDay = new Map();\r\n  DAYS.forEach((d) => eventsByDay.set(d, []));\r\n\r\n  const seen = new Set();\r\n  let eventId = 0;\r\n\r\n  courses.forEach((course) => {\r\n    const startDate = course.startDate || extractStartDate(course.meetingLines?.[0]) || \"\";\r\n    const semester = getSemester(startDate);\r\n\r\n    if (semester !== term)\r\n      return;\r\n\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n\r\n    lines.forEach((line) => {\r\n      const parsed = parseMeetingLine(line);\r\n      if (!parsed)\r\n        return;\r\n\r\n      let startMin = clampToGrid(parsed.startMinutes);\r\n      let endMin = clampToGrid(parsed.endMinutes);\r\n\r\n      startMin = snapDownToSlot(startMin);\r\n      endMin = snapUpToSlot(endMin);\r\n\r\n      const startIdx = slotIndexOf(startMin);\r\n      const endIdx = slotIndexOf(endMin);\r\n\r\n      if (startIdx === -1 || endIdx === -1 || endIdx <= startIdx)\r\n        return;\r\n\r\n      const rowSpan = endIdx - startIdx;\r\n\r\n      parsed.days.forEach((day) => {\r\n        if (!eventsByDay.has(day))\r\n          return;\r\n\r\n        const key = [\r\n          day,\r\n          course.code || \"\",\r\n          course.title || \"\",\r\n          parsed.timeLabel,\r\n          startIdx,\r\n          rowSpan,\r\n        ].join(\"|\");\r\n\r\n        if (seen.has(key))\r\n          return;\r\n        seen.add(key);\r\n\r\n        eventsByDay.get(day).push({\r\n          id: eventId++,\r\n          code: course.code || \"\",\r\n          title: course.title || \"\",\r\n          timeLabel: parsed.timeLabel,\r\n\r\n          rowStart: startIdx,\r\n          rowSpan,\r\n\r\n          startIdx,\r\n          endIdx,\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  DAYS.forEach((day) => {\r\n    eventsByDay.get(day).sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n  });\r\n\r\n  return eventsByDay;\r\n}\r\n\r\n// Build overlap groups per DAY column.\r\n// Each group becomes ONE rowspan cell; if group has 2+ events, it’s a conflict cluster.\r\nfunction addConflicts(eventsByDay) {\r\n  const groupedByDay = new Map();\r\n\r\n  DAYS.forEach((day) => {\r\n    const events = (eventsByDay.get(day) || [])\r\n      .slice()\r\n      .sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n\r\n    const groups = [];\r\n\r\n      let current = null;\r\n    let currentKey = null;\r\n\r\n    for (let r = 0; r < SLOTS.length - 1; r++) {\r\n      const active = events.filter((ev) => ev.startIdx <= r && ev.endIdx > r);\r\n      const key = active.length\r\n        ? active.map((ev) => ev.id).sort((a, b) => a - b).join(\"|\")\r\n        : null;\r\n\r\n      if (!key) {\r\n        if (current)\r\n          groups.push(current);\r\n        current = null;\r\n        currentKey = null;\r\n        continue;\r\n      }\r\n\r\n      if (current && key === currentKey) {\r\n        current.end = r + 1;\r\n        continue;\r\n      }\r\n\r\n      if (current)\r\n        groups.push(current);\r\n\r\n      current = {\r\n        start: r,\r\n        end: r + 1,\r\n        events: active,\r\n        hasConflict: active.length > 1,\r\n      };\r\n      currentKey = key;\r\n    }\r\n\r\n    if (current)\r\n      groups.push(current);\r\n\r\n    groupedByDay.set(day, groups);\r\n  });\r\n\r\n  return groupedByDay;\r\n}\r\n\r\nfunction formatSlotLabel(minutes) {\r\n  const h24 = Math.floor(minutes / 60);\r\n  const m = minutes % 60;\r\n\r\n  const hh = String(h24);\r\n  const mm = String(m).padStart(2, \"0\");\r\n  return `${hh}:${mm}`;\r\n}\r\n\r\nfunction toLocalRect(parentRect, childRect) {\r\n  return {\r\n    left: childRect.left - parentRect.left,\r\n    top: childRect.top - parentRect.top,\r\n    right: childRect.right - parentRect.left,\r\n    bottom: childRect.bottom - parentRect.top,\r\n    width: childRect.width,\r\n    height: childRect.height,\r\n  };\r\n}\r\n\r\n// Given an intersection rect (LOCAL to a block) and a \"no-paint\" rect (LOCAL),\r\n// return up to 4 rectangles that represent intersection minus noPaint.\r\nfunction subtractRect(inter, cut) {\r\n  // compute overlap in local space\r\n  const o = rectIntersection(\r\n    { left: inter.left, top: inter.top, right: inter.right, bottom: inter.bottom },\r\n    { left: cut.left, top: cut.top, right: cut.right, bottom: cut.bottom }\r\n  );\r\n  if (!o) return [inter];\r\n\r\n  const out = [];\r\n\r\n  // top slice\r\n  if (o.top > inter.top) {\r\n    out.push({ left: inter.left, top: inter.top, right: inter.right, bottom: o.top });\r\n  }\r\n  // bottom slice\r\n  if (o.bottom < inter.bottom) {\r\n    out.push({ left: inter.left, top: o.bottom, right: inter.right, bottom: inter.bottom });\r\n  }\r\n  // left slice\r\n  if (o.left > inter.left) {\r\n    out.push({ left: inter.left, top: o.top, right: o.left, bottom: o.bottom });\r\n  }\r\n  // right slice\r\n  if (o.right < inter.right) {\r\n    out.push({ left: o.right, top: o.top, right: inter.right, bottom: o.bottom });\r\n  }\r\n\r\n  // normalize + remove zero areas\r\n  return out\r\n    .map((r) => ({ ...r, width: r.right - r.left, height: r.bottom - r.top }))\r\n    .filter((r) => r.width > 0 && r.height > 0);\r\n}\r\n\r\n\r\nfunction buildScheduleTable() {\r\n  // Wrap so we can overlay blocks on top of the table\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.className = \"schedule-table-wrap\";\r\n\r\n  const table = document.createElement(\"table\");\r\n  table.className = \"schedule-table\";\r\n\r\n  const thead = document.createElement(\"thead\");\r\n  const headRow = document.createElement(\"tr\");\r\n\r\n  headRow.innerHTML = `\r\n    <th class=\"schedule-time\">Time</th>\r\n    ${DAYS.map((day) => `<th class=\"schedule-day-head\" data-day=\"${day}\">${day}</th>`).join(\"\")}\r\n  `;\r\n\r\n  thead.appendChild(headRow);\r\n  table.appendChild(thead);\r\n\r\n  const tbody = document.createElement(\"tbody\");\r\n\r\n  for (let r = 0; r < SLOTS.length; r++) {\r\n    const row = document.createElement(\"tr\");\r\n\r\n    // Time label column\r\n    const timeTd = document.createElement(\"td\");\r\n    timeTd.className = \"schedule-time\";\r\n    timeTd.textContent = formatSlotLabel(SLOTS[r]);\r\n    row.appendChild(timeTd);\r\n\r\n    // Day columns (NO MERGING / NO ROWSPAN)\r\n    DAYS.forEach((day) => {\r\n      const td = document.createElement(\"td\");\r\n      td.className = \"schedule-cell\";\r\n      td.dataset.day = day;\r\n      td.dataset.row = String(r);\r\n\r\n      // Optional: inner div if you want future per-cell stuff\r\n      const inner = document.createElement(\"div\");\r\n      inner.className = \"schedule-cell-inner\";\r\n      td.appendChild(inner);\r\n\r\n      row.appendChild(td);\r\n    });\r\n\r\n    tbody.appendChild(row);\r\n  }\r\n\r\n  table.appendChild(tbody);\r\n  wrap.appendChild(table);\r\n\r\n  // Overlay layer that will hold the floating blocks\r\n  const overlay = document.createElement(\"div\");\r\n  overlay.className = \"schedule-overlay\";\r\n  wrap.appendChild(overlay);\r\n\r\n  return wrap;\r\n}\r\n\r\nfunction rectsOverlap(a, b) {\r\n  return !(a.right <= b.left || a.left >= b.right || a.bottom <= b.top || a.top >= b.bottom);\r\n}\r\n\r\nfunction rectIntersection(a, b) {\r\n  const left = Math.max(a.left, b.left);\r\n  const right = Math.min(a.right, b.right);\r\n  const top = Math.max(a.top, b.top);\r\n  const bottom = Math.min(a.bottom, b.bottom);\r\n  if (right <= left || bottom <= top) return null;\r\n  return { left, right, top, bottom, width: right - left, height: bottom - top };\r\n}\r\n\r\nfunction rectFromBlock(block) {\r\n  const x = parseFloat(block.style.left) || 0;\r\n  const y = parseFloat(block.style.top) || 0;\r\n  const w = parseFloat(block.style.width) || 0;\r\n  const h = parseFloat(block.style.height) || 0;\r\n  return { left: x, top: y, right: x + w, bottom: y + h, width: w, height: h };\r\n}\r\n\r\n// text collision check (within overlay coordinate space)\r\nfunction textBoxOverlapsAny(candidate, existing) {\r\n  for (const r of existing) {\r\n    if (rectsOverlap(candidate, r)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction renderOverlayBlocks(wrap, eventsByDay, groupedByDay) {\r\n  const overlay = wrap.querySelector(\".schedule-overlay\");\r\n  overlay.innerHTML = \"\";\r\n\r\n  const table = wrap.querySelector(\".schedule-table\");\r\n\r\n  const firstBodyRow = table.querySelector(\"tbody tr\");\r\n  const firstDayCell = table.querySelector('tbody tr td.schedule-cell[data-day=\"Mon\"]');\r\n  const timeTh = table.querySelector(\"thead th.schedule-time\");\r\n\r\n  if (!firstBodyRow || !firstDayCell || !timeTh) return;\r\n\r\n  const timeColWidth = timeTh.getBoundingClientRect().width;\r\n  const dayColWidth = firstDayCell.getBoundingClientRect().width;\r\n  const headerHeight = table.querySelector(\"thead\").getBoundingClientRect().height;\r\n  const rowHeight = firstBodyRow.getBoundingClientRect().height;\r\n\r\n  // --- build blocks first (one per event), store rects for overlap detection ---\r\n  const placedBlocks = []; // { el, day, ev, rect, overlapLayerEl, overlaps: [] }\r\n\r\n  DAYS.forEach((day, dayIndex) => {\r\n    const events = eventsByDay.get(day) || [];\r\n\r\n    events.forEach((ev) => {\r\n      const left = timeColWidth + dayIndex * dayColWidth;\r\n      const top = headerHeight + ev.rowStart * rowHeight;\r\n      const height = ev.rowSpan * rowHeight;\r\n\r\n      const block = document.createElement(\"div\");\r\n      block.className = \"schedule-entry-float\";\r\n\r\n      block.style.left = `${left}px`;\r\n      block.style.top = `${top}px`;\r\n      block.style.width = `${dayColWidth}px`;\r\n      block.style.height = `${height}px`;\r\n\r\n      // overlap layer (red rectangles go here)\r\n      const overlapLayer = document.createElement(\"div\");\r\n      overlapLayer.className = \"schedule-entry-overlap-layer\";\r\n      block.appendChild(overlapLayer);\r\n\r\n      // text wrapper (MUST be above overlap layer)\r\n      const text = document.createElement(\"div\");\r\n      text.className = \"schedule-entry-text\";\r\n      text.innerHTML = `\r\n        <div class=\"schedule-entry-title\">${ev.code || ev.title}</div>\r\n        <div class=\"schedule-entry-time\">${ev.timeLabel}</div>\r\n      `;\r\n      block.appendChild(text);\r\n\r\n      overlay.appendChild(block);\r\n\r\n      placedBlocks.push({\r\n        el: block,\r\n        day,\r\n        ev,\r\n        rect: rectFromBlock(block),\r\n        overlapLayerEl: overlapLayer,\r\n        overlaps: [],\r\n        textEl: text,\r\n      });\r\n    });\r\n  });\r\n\r\n  // --- detect overlaps + apply opacity + add red intersection rects ---\r\n  for (let i = 0; i < placedBlocks.length; i++) {\r\n    for (let j = i + 1; j < placedBlocks.length; j++) {\r\n      const A = placedBlocks[i];\r\n      const B = placedBlocks[j];\r\n\r\n      // only compare blocks in same day column (since different columns can't overlap)\r\n      if (A.day !== B.day) continue;\r\n\r\n      if (!rectsOverlap(A.rect, B.rect)) continue;\r\n\r\n      const inter = rectIntersection(A.rect, B.rect);\r\n      if (!inter) continue;\r\n\r\n      // mark both as conflicted\r\n      A.el.style.opacity = \"0.6\";\r\nB.el.style.opacity = \"0.6\";\r\n\r\nA.el.classList.add(\"is-overlap\");\r\nB.el.classList.add(\"is-overlap\");\r\n\r\n\r\n      // intersection rect coordinates relative to each block\r\n      const aLocal = {\r\n        left: inter.left - A.rect.left,\r\n        top: inter.top - A.rect.top,\r\n        width: inter.width,\r\n        height: inter.height,\r\n      };\r\n      const bLocal = {\r\n        left: inter.left - B.rect.left,\r\n        top: inter.top - B.rect.top,\r\n        width: inter.width,\r\n        height: inter.height,\r\n      };\r\n\r\n      const aRed = document.createElement(\"div\");\r\n      aRed.className = \"schedule-entry-overlap-rect\";\r\n      aRed.style.left = `${aLocal.left}px`;\r\n      aRed.style.top = `${aLocal.top}px`;\r\n      aRed.style.width = `${aLocal.width}px`;\r\n      aRed.style.height = `${aLocal.height}px`;\r\n      A.overlapLayerEl.appendChild(aRed);\r\n\r\n      const bRed = document.createElement(\"div\");\r\n      bRed.className = \"schedule-entry-overlap-rect\";\r\n      bRed.style.left = `${bLocal.left}px`;\r\n      bRed.style.top = `${bLocal.top}px`;\r\n      bRed.style.width = `${bLocal.width}px`;\r\n      bRed.style.height = `${bLocal.height}px`;\r\n      B.overlapLayerEl.appendChild(bRed);\r\n    }\r\n  }\r\n\r\n  // --- text placement: push down if text area overlaps already-placed text ---\r\n  // We do this per-day so text collisions only matter inside a column.\r\n  const TEXT_STEP_PX = 14;        // \"preset amount\"\r\n  const MAX_TRIES = 30;           // prevents infinite loops\r\n  const H_PAD = 6;                // match your block padding roughly\r\n  const V_PAD = 6;\r\n\r\n  DAYS.forEach((day) => {\r\n    const blocks = placedBlocks\r\n      .filter((b) => b.day === day)\r\n      .sort((a, b) => a.rect.top - b.rect.top);\r\n\r\n    const usedTextRects = []; // in overlay coords\r\n\r\n    blocks.forEach((b) => {\r\n      // base text box estimate (good enough without measuring)\r\n      const baseX = b.rect.left + H_PAD;\r\n      let y = b.rect.top + V_PAD;\r\n\r\n      // We will position the text wrapper inside the block by translateY\r\n      // but collision checking is in absolute overlay coords.\r\n      let tries = 0;\r\n\r\n      // Estimate width/height of text area; if you want exact, swap to getBoundingClientRect after layout.\r\n      const estW = b.rect.width - H_PAD * 2;\r\n      const estH = 26; // title + time on 10px font\r\n\r\n      while (tries < MAX_TRIES) {\r\n        const candidate = {\r\n          left: baseX,\r\n          top: y,\r\n          right: baseX + estW,\r\n          bottom: y + estH,\r\n        };\r\n\r\n        // must also stay inside the block vertically\r\n        if (candidate.bottom > b.rect.bottom - V_PAD) break;\r\n\r\n        if (!textBoxOverlapsAny(candidate, usedTextRects)) {\r\n          // place it: move text wrapper down inside the block\r\n          const localY = y - b.rect.top;\r\n          b.textEl.style.transform = `translateY(${localY}px)`;\r\n          usedTextRects.push(candidate);\r\n          return;\r\n        }\r\n\r\n        y += TEXT_STEP_PX;\r\n        tries++;\r\n      }\r\n\r\n      // fallback: just keep at top if no free spot found\r\n      b.textEl.style.transform = `translateY(${V_PAD}px)`;\r\n      usedTextRects.push({\r\n        left: baseX,\r\n        top: b.rect.top + V_PAD,\r\n        right: baseX + estW,\r\n        bottom: b.rect.top + V_PAD + estH,\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\n\r\nexport function renderSchedule(ctx, courses, term) {\r\n  if (!ctx.scheduleGrid) return;\r\n\r\n  ctx.scheduleGrid.innerHTML = \"\";\r\n\r\n  const eventsByDay = buildDayEvents(courses, term);\r\n  const groupedByDay = addConflicts(eventsByDay);\r\n\r\n  const wrap = buildScheduleTable();\r\n  ctx.scheduleGrid.appendChild(wrap);\r\n\r\n  // overlay needs DOM measurements, so do it after append\r\n  renderOverlayBlocks(wrap, eventsByDay, groupedByDay);\r\n}\r\n","import { STATE } from \"../core/state\"\r\n\r\nexport const csvEscape = (v) => {\r\n    if (v == null)\r\n        return \"\";\r\n\r\n    const s = String(v);\r\n    \r\n    return /[\",\\n]/.test(s) ? `\"${s.replace(/\"/g, '\"\"')}\"` : s;\r\n};\r\n  \r\nexport const toCSV = (rows, headers) => {\r\n    const head = headers.map(csvEscape).join(\",\");\r\n    const body = rows\r\n      .map((r) => headers.map((h) => csvEscape(r[h] ?? \"\")).join(\",\"))\r\n      .join(\"\\n\");\r\n\r\n    return head + \"\\n\" + body;\r\n};\r\n\r\nexport function exportCSV() {\r\n    const headers = [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"];\r\n    const csv = toCSV(STATE.filtered, headers);\r\n\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"captured-courses.csv\";\r\n    document.body.appendChild(a);\r\n    a.click();\r\n\r\n    setTimeout(() => {\r\n      URL.revokeObjectURL(url);\r\n      a.remove();\r\n    }, 100);\r\n}","import { on, debounce } from \"./utilities/dom.js\"\r\nimport { STATE } from \"./core/state.js\"\r\nimport { ensureMount } from \"./utilities/shadowMount.js\"\r\nimport { loadPanel } from \"./panel/loadPanel.js\"\r\nimport { extractAllCourses } from \"./extraction/courseExtraction.js\"\r\nimport { applySearchFilter, sortBy, wireSorting } from \"./panel/panelInteractions.js\"\r\nimport { renderRows } from \"./panel/renderRows.js\"\r\nimport { renderSchedule } from \"./panel/scheduleView.js\"\r\nimport { exportCSV } from \"./exporting/cvs.js\"\r\n\r\n(() => {\r\n  console.log(\"[WD] content script loaded\");\r\n  async function boot() {\r\n    const shadow = ensureMount();\r\n    const ctx = await loadPanel(shadow);\r\n     const updateSchedule = () => {\r\n      renderSchedule(ctx, STATE.filtered, STATE.view.term);\r\n    };\r\n\r\n    const setActivePanel = (panel) => {\r\n      STATE.view.panel = panel;\r\n      ctx.panels.forEach((el) => {\r\n        el.classList.toggle(\"is-active\", el.dataset.panel === panel);\r\n      });\r\n      ctx.tabButtons.forEach((btn) => {\r\n        btn.classList.toggle(\"is-active\", btn.dataset.panel === panel);\r\n      });\r\n      ctx.widget.classList.toggle(\"is-schedule-view\", panel === \"schedule\");\r\n    };\r\n\r\n    ctx.tabButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        setActivePanel(btn.dataset.panel);\r\n        if (btn.dataset.panel === \"schedule\")\r\n          updateSchedule();\r\n      });\r\n    });\r\n\r\n    ctx.termButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        STATE.view.term = btn.dataset.term;\r\n        ctx.termButtons.forEach((termBtn) => {\r\n          termBtn.classList.toggle(\"is-active\", termBtn.dataset.term === STATE.view.term);\r\n        });\r\n        updateSchedule();\r\n      });\r\n    });\r\n\r\n    on(ctx.button, \"click\", () => {\r\n      ctx.widget.classList.toggle(\"is-hidden\");\r\n    });\r\n\r\n    on(ctx.refresh, \"click\", async () => {\r\n      STATE.courses = await extractAllCourses();\r\n      applySearchFilter(ctx.search.value);\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n    });\r\n\r\n    on(ctx.exportBtn, \"click\", exportCSV);\r\n\r\n    on(\r\n      ctx.search,\r\n      \"input\",\r\n      debounce(() => {\r\n        applySearchFilter(ctx.search.value);\r\n        sortBy(STATE.sort.key || \"code\");\r\n        renderRows(ctx, STATE.filtered);\r\n         updateSchedule();\r\n      }, 100)\r\n    );\r\n\r\n    wireSorting(ctx);\r\n\r\n    STATE.courses = await extractAllCourses();\r\n    STATE.filtered = [...STATE.courses];\r\n    sortBy(\"code\");\r\n    renderRows(ctx, STATE.filtered);\r\n        updateSchedule();\r\n    setActivePanel(STATE.view.panel);\r\n  }\r\n\r\n  if (document.readyState === \"complete\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();"],"names":["$$","root","sel","on","el","ev","fn","opts","debounce","ms","t","a","STATE","EXT_ID","ensureMount","host","loadPanel","shadow","htmlUrl","cssUrl","html","css","r","style","wrap","logoImg","normalizeText","s","getHeaderKey","m","buildHeaderMaps","gridRoot","headers","pos","text","getHeaderText","key","h","findHeader","needles","ns","hit","n","KEYS","colMap","posMap","headerEl","btn","parseSectionLinkString","input","str","baseCode","parts","p","sectionToken","parsedTitle","guessClassCode","extractMeetingLinesFromCell","meetingEl","lines","DATE_RE","TIME_RE","DAY_RE","extractMeetingLinesFromRow","rowEl","formatMeetingLineForPanel","line","dayPart","timePart","buildingPart","floorPart","roomPart","normalizeMeetingPatternsText","extractStartDate","match","extractInstructorNamesFromCell","instructorEl","prompt","txt","onlineClassCheck","deliveryModeCellEl","label","findingTables","roots","headerText","rows","extractAllCourses","found","courses","headerMaps","row","c","extractFromRow","findUniqueCourses","list","seen","out","k","cells","allText","getCellKey","cell","cellByCol","getCellEl","keyName","readByKey","col","allPromptOptions","sectionLinkEl","sectionLinkString","titleCell","codeCell","sectCell","meetingCell","instructionalFormatCell","startDateCell","code","title","section_number","parsed","labLike","seminarLike","isLab","isSeminar","instructor","meeting","meetingCol","meetingObj","startDate","firstLine","deliveryModeCell","instructionalFormat","escHTML","renderRows","ctx","frag","tr","badge","main","sub","applySearchFilter","q","sortBy","dir","collator","b","wireSorting","headCells","th","DAYS","START_HOUR","END_HOUR","SLOT_MINUTES","SLOTS","DAY_REGEX","TIME_REGEX","SEMESTER_MONTHS","parseTimeToken","token","hours","minutes","period","parseMeetingLine","days","timeTokens","startMinutes","endMinutes","getSemester","month","clampToGrid","min","max","snapDownToSlot","snapUpToSlot","slotIndexOf","buildDayEvents","term","eventsByDay","d","eventId","course","startMin","endMin","startIdx","endIdx","rowSpan","day","addConflicts","groupedByDay","events","groups","current","currentKey","active","formatSlotLabel","h24","hh","mm","buildScheduleTable","table","thead","headRow","tbody","timeTd","td","inner","overlay","rectsOverlap","rectIntersection","left","right","top","bottom","rectFromBlock","block","x","y","w","textBoxOverlapsAny","candidate","existing","renderOverlayBlocks","firstBodyRow","firstDayCell","timeTh","timeColWidth","dayColWidth","headerHeight","rowHeight","placedBlocks","dayIndex","height","overlapLayer","i","j","A","B","inter","aLocal","bLocal","aRed","bRed","TEXT_STEP_PX","MAX_TRIES","H_PAD","V_PAD","blocks","usedTextRects","baseX","tries","estW","estH","localY","renderSchedule","csvEscape","v","toCSV","head","body","exportCSV","csv","blob","url","boot","updateSchedule","setActivePanel","panel","termBtn"],"mappings":"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"}