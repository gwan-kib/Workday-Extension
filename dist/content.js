(function(){"use strict";const y=(t,e)=>Array.from(t.querySelectorAll(e)),S=(t,e,n,o)=>t&&t.addEventListener(e,n,o),G=(t,e=300)=>{let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>t(...o),e)}},u={courses:[],filtered:[],sort:{key:null,dir:1}},q="wd-courses-capture";function V(){let t=document.getElementById(q);return t||(t=document.createElement("div"),t.id=q,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function N(t){const e=chrome.runtime.getURL("src/panel.html"),n=chrome.runtime.getURL("src/panel.css"),[o,r]=await Promise.all([fetch(e).then(l=>l.text()),fetch(n).then(l=>l.text())]);t.innerHTML="";const c=document.createElement("style");c.textContent=r,t.appendChild(c);const i=document.createElement("div");i.innerHTML=o,t.appendChild(i);const s=t.querySelector("#wd-logo");return s&&(s.src=chrome.runtime.getURL("src/W.svg")),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead")}}const R=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function X(t){const n=(t?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return n?n[1]:null}function J(t){const n=Array.from(t.querySelectorAll('th[data-automation-id^="columnHeader"]')).map((s,l)=>{const d=j(s),p=X(s);return{el:s,pos:l,key:p,text:d,norm:R(d)}}).filter(s=>s.text);function o(s){const l=s.map(R);let d=n.find(p=>l.includes(p.norm));return d||(d=n.find(p=>l.some(f=>p.norm.includes(f))),d||null)}const r={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"]},c={},i={};for(const[s,l]of Object.entries(r)){const d=o(l);c[s]=d?d.key:null,i[s]=d?d.pos:-1}return{colMap:c,posMap:i}}function j(t){if(!t)return"";const e=t.querySelector("button[title]");return e?(e.getAttribute("title")||"").trim():(t.textContent||"").trim()}function Q(t){let e=String(t||"").replace(/\u00A0/g," ").trim();if(!e)return null;e=e.replace(/\s*\n\s*/g," ").trim();const n=e.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!n)return null;const o=n[1].trim(),c=n[2].trim().split(/\s*[-–—]\s*/).map(l=>l.trim()).filter(Boolean);let i="",s="";return i=c[0],s=c.slice(1).join(" - ").trim(),s=s.replace(/\s*:\s*/g,`:
`),{code:o,section_number:i,title:s,full:e}}function E(t){const e=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return e?e[0].replace(/\s+/g," ").trim():""}function tt(t){if(!t)return console.log("extractMeetingLinesFromCell failed 1"),[];let n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean);n.length||(n=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(s=>(s.getAttribute("data-automation-label")||s.getAttribute("title")||s.textContent||"").trim()).filter(Boolean)),n.length||(n=String(t.innerText||"").split(`
`).map(i=>i.trim()).filter(Boolean));const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(i=>o.test(i)&&r.test(i)&&c.test(i))}function et(t){if(!t)return[];const n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean),o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(i=>o.test(i)&&r.test(i)&&c.test(i))}function nt(t){const e=String(t||"").split("|").map(l=>l.trim()).filter(Boolean),o=(e.find(l=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(l))||"").split(/\s+/).join(" / "),r=e.find(l=>/\d{1,2}:\d{2}/.test(l)&&/-/.test(l))||"",c=e.find(l=>/\([A-Z]{2,}\)/.test(l))||"",i=e.find(l=>/^Floor:/i.test(l))||"",s=e.find(l=>/^Room:/i.test(l))||"";return{days:o,time:r,location:[c,i,s].filter(Boolean).join(" | ")}}function ot(t){return String(t||"").split(/\r?\n/).map(e=>e.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function rt(t){if(!t)return console.log("failed extracting instuctor name:",t),"";const e=t.querySelector('[data-automation-id="promptOption"]'),n=(e&&(e.getAttribute("data-automation-label")||e.getAttribute("title")||e.textContent)||t.textContent||"").trim();return console.log("sucsessfully extracted instuctor name:",t,n),n}function it(t){if(!t)return!1;const e=(t.innerText||t.textContent||"").trim();return/online learning/i.test(e)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(o=>{const r=(o.getAttribute("data-automation-label")||o.getAttribute("title")||o.textContent||"").trim();return/online learning/i.test(r)})}function st(){const t=y(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const e of t){const o=y(e,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(i=>R(j(i)));if(!(o.some(i=>i.includes("section"))&&(o.some(i=>i.includes("instructor"))||o.some(i=>i.includes("meeting"))||o.some(i=>i.includes("instructional format"))||o.some(i=>i.includes("format"))||o.some(i=>i.includes("status")))))continue;const c=y(e,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(c.length)return{root:e,rows:c}}return null}async function O(){const t=st();let e=[];if(t){const n=J(t.root);for(const o of t.rows){const r=ct(o,n);(r.code||r.title)&&Object.values(r).join("").trim()&&e.push(r)}}return lt(e)}function lt(t){const e=r=>[r.code,r.title,r.section_number].join("|").toLowerCase(),n=new Set,o=[];for(const r of t){const c=e(r);n.has(c)||(n.add(c),o.push(r))}return o}function ct(t,e){const{colMap:n,posMap:o}=e,r=y(t,"td, [role='gridcell']"),c=(t.innerText||"").trim();function i(a){const Y=(a.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return Y?Y[1]:null}const s=new Map;r.forEach(a=>{const m=i(a);m&&!s.has(m)&&s.set(m,a)});const l=a=>{const m=n[a];if(m!=null&&s.has(m))return s.get(m);const g=o[a];return g!=null&&g>=0&&g<r.length?r[g]:null},d=a=>{const m=n[a];if(m!=null&&s.has(m))return(s.get(m).innerText||"").trim();const g=o[a];return g!=null&&g>=0&&g<r.length?(r[g].innerText||"").trim():""},p=y(t,'[data-automation-id="promptOption"]');let f=null;for(const a of p){const m=a.getAttribute("data-automation-label")||a.getAttribute("title")||a.getAttribute("aria-label")||a.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(m)){f=a;break}}!f&&p.length>0&&(f=p[0]);const F=f&&(f.getAttribute("data-automation-label")||f.getAttribute("title")||f.getAttribute("aria-label")||f.textContent)||"",D=d("title"),mt=d("code"),U=d("section"),Z=d("meeting"),B=d("instructionalFormat");let T="",w=D||"",W="";const v=Q(F);v&&(T=v.code,W=v.section_number,w=v.title),T||(T=E(mt)||E(D)||E(c)||"");const A=a=>/\b(lab|laboratory|labratory)\b/i.test(String(a||"")),x=a=>/\bseminar\b/i.test(String(a||"")),K=A(B)||A(U)||A(w)||A(F)||A(c),z=x(B)||x(U)||x(w)||x(F)||x(c),ft=l("instructor");let $="";K||z?$="N/A":$=rt(ft)||(d("instructor")||"").trim();let h;const _=n.meeting;let k=null;_!=null&&s.has(_)?k=s.get(_):o.meeting!=null&&o.meeting>=0&&o.meeting<r.length&&(k=r[o.meeting]);let M=k?tt(k):[];M.length||(M=et(t));let b={days:"",time:"",location:""};if(M.length){const a=M[0];b=nt(a)}else h=(Z||"").trim();const gt=l("deliveryMode");it(gt)&&(b.location="Online"),b.days||b.time||b.location?(h=[b.days,b.time].filter(Boolean).join(" | "),b.location?h+=`
${b.location}`:h+=`
Online`):h=(Z||"").trim();const pt=(B||"").trim();return{code:T,title:w,section_number:W,instructor:$,meeting:ot(h),instructionalFormat:pt,isLab:K,isSeminar:z}}const H=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function C(t,e){t.tableBody.innerHTML="";const n=document.createDocumentFragment();e.forEach(o=>{const r=document.createElement("tr"),c=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":"";r.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${c?`<div class="muted">${c}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const i=String(o.meeting||"").split(`
`),s=(i[0]||"").trim(),l=(i[1]||"").trim();return`
            ${s?`<span class="meeting-pill">${H(s)}</span>`:""}
            ${l?`<div class="meeting-sub">${H(l)}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,n.appendChild(r)}),t.tableBody.appendChild(n)}function I(t){if(t=(t||"").trim().toLowerCase(),!t){u.filtered=[...u.courses];return}u.filtered=u.courses.filter(e=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(n=>(e[n]||"").toLowerCase().includes(t)))}function L(t){if(!t)return;const e=u.sort.key===t?-u.sort.dir:1;u.sort={key:t,dir:e};const n=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});u.filtered.sort((o,r)=>e*n.compare(o[t]||"",r[t]||""))}function at(t){const e=y(t.tableHead,"th[data-key]");e.forEach(n=>{S(n,"click",()=>{const o=n.getAttribute("data-key");L(o),C(t,u.filtered),e.forEach(r=>r.classList.remove("sorted-asc","sorted-desc")),n.classList.add(u.sort.dir===1?"sorted-asc":"sorted-desc")})})}const P=t=>{if(t==null)return"";const e=String(t);return/[",\n]/.test(e)?`"${e.replace(/"/g,'""')}"`:e},ut=(t,e)=>{const n=e.map(P).join(","),o=t.map(r=>e.map(c=>P(r[c]??"")).join(",")).join(`
`);return n+`
`+o};function dt(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],e=ut(u.filtered,t),n=new Blob([e],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download="captured-courses.csv",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(o),r.remove()},100)}(()=>{console.log("[WD] content script loaded");async function t(){const e=V(),n=await N(e);S(n.button,"click",()=>{n.widget.classList.toggle("is-hidden")}),S(n.refresh,"click",async()=>{u.courses=await O(),I(n.search.value),L(u.sort.key||"code"),C(n,u.filtered)}),S(n.exportBtn,"click",dt),S(n.search,"input",G(()=>{I(n.search.value),L(u.sort.key||"code"),C(n,u.filtered)},100)),at(n),u.courses=await O(),u.filtered=[...u.courses],L("code"),C(n,u.filtered)}document.readyState==="complete"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})()})();
//# sourceMappingURL=content.js.map
