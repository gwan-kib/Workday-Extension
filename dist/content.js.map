{"version":3,"file":"content.js","sources":["../src/utilities/dom.js","../src/core/state.js","../src/utilities/shadowMount.js","../src/panel/loadPanel.js","../src/extraction/headerMaps.js","../src/extraction/sectionLinkInfo.js","../src/extraction/meetingPatternsInfo.js","../src/extraction/instructorInfo.js","../src/extraction/onlineClassCheck.js","../src/extraction/findingTables.js","../src/extraction/courseExtraction.js","../src/panel/renderRows.js","../src/panel/panelInteractions.js","../src/panel/scheduleView.js","../src/export-logic/export-ics.js","../src/panel/scheduleStorage.js","../src/content.js"],"sourcesContent":["import { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"dom\");\r\n\r\n// shortcut for querySelector in shadowDom\r\nexport const $ = (root, sel) => {\r\n  debug.log(\"Querying single element:\", { root, sel });\r\n  return root.querySelector(sel);\r\n};\r\n\r\n// shortcut for querySelectorAll in shadowDom, turns result into an array\r\nexport const $$ = (root, sel) => {\r\n  debug.log(\"Querying multiple elements:\", { root, sel });\r\n  return Array.from(root.querySelectorAll(sel));\r\n};\r\n\r\n// if el exists, attaches event listener to el\r\nexport const on = (el, ev, fn, opts) => {\r\n  if (el) {\r\n    debug.log(\"Attaching event listener:\", { el, ev, opts });\r\n    el.addEventListener(ev, fn, opts);\r\n  }\r\n};\r\n\r\n// limits how often a function is called, sets a timer and function can only be called again after timer is complete\r\nexport const debounce = (fn, ms = 300) => {\r\n  let t;\r\n  return (...a) => {\r\n    debug.log(\"Debouncing function call with delay:\", { fn, ms, args: a });\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n};\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"state\");\r\n\r\nexport const STATE = {\r\n  // list of courses extracted from workday\r\n  courses: [],\r\n\r\n  // list of filtered courses, used for searching and sorting\r\n  filtered: [],\r\n\r\n  // list of user saved schedules\r\n  savedSchedules: [],\r\n\r\n  // tracks current sorting state, key: field name, dir: 1 ascending, -1 descending eg. STATE.sort = { key: \"startTime\", dir: -1 };\r\n  sort: { key: null, dir: 1 },\r\n\r\n  // tracks viewing state, panel: current extension page, semester: current semester tab\r\n  view: {\r\n    panel: \"list\",\r\n    semester: \"first\",\r\n  },\r\n\r\n  setCourses(newCourses) {\r\n    this.courses = newCourses;\r\n    debug.log(\"Courses updated:\", newCourses);\r\n  },\r\n\r\n  setFiltered(filteredCourses) {\r\n    this.filtered = filteredCourses;\r\n    debug.log(\"Filtered courses updated:\", filteredCourses);\r\n  },\r\n\r\n  setSavedSchedules(saved) {\r\n    this.savedSchedules = saved;\r\n    debug.log(\"Saved schedules updated:\", saved);\r\n  },\r\n\r\n  setSort(sortState) {\r\n    this.sort = sortState;\r\n    debug.log(\"Sorting state updated:\", sortState);\r\n  },\r\n\r\n  setView(viewState) {\r\n    this.view = viewState;\r\n    debug.log(\"View state updated:\", viewState);\r\n  },\r\n};\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"shadowMount\");\r\n\r\n// extension ID\r\nconst EXT_ID = \"Workday - Schedule Tool\";\r\n\r\n// first time it's called it mounts the extension, in subsequent calls it returns the extension's shadow root\r\nexport function ensureMount() {\r\n  let host = document.getElementById(EXT_ID);\r\n\r\n  if (host) {\r\n    debug.log(\"Returning existing shadow root:\", host);\r\n    return host.shadowRoot;\r\n  }\r\n\r\n  // creates container for extension, sets styles, then appends extension to the page\r\n  host = document.createElement(\"div\");\r\n  host.id = EXT_ID;\r\n  host.style.all = \"initial\";\r\n  host.style.position = \"fixed\";\r\n  host.style.bottom = \"16px\";\r\n  host.style.right = \"16px\";\r\n  host.style.zIndex = \"999999999\";\r\n  host.attachShadow({ mode: \"open\" });\r\n  document.documentElement.appendChild(host);\r\n\r\n  debug.log(\"Mounted new extension container:\", host);\r\n  return host.shadowRoot;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"loadPanel\");\r\n\r\nexport async function loadPanel(shadow) {\r\n  const htmlUrl = chrome.runtime.getURL(\"src/panel.html\");\r\n  const cssFiles = [\r\n    \"formatting/general.css\",\r\n    \"formatting/widget-shell.css\",\r\n    \"formatting/widget-buttons.css\",\r\n    \"formatting/floating-button.css\",\r\n    \"formatting/course-list.css\",\r\n    \"formatting/schedule-view.css\",\r\n    \"formatting/schedule-view-events.css\",\r\n    \"formatting/settings.css\",\r\n    \"colors/course-list-colors.css\",\r\n    \"colors/general-colors.css\",\r\n    \"colors/schedule-view-colors.css\",\r\n    \"colors/widget-functionality-colors.css\",\r\n    \"colors/settings-colors.css\",\r\n  ];\r\n\r\n  debug.log(\"Fetching HTML and CSS files...\");\r\n\r\n  const [html, ...cssParts] = await Promise.all([\r\n    fetch(htmlUrl).then((r) => r.text()),\r\n    ...cssFiles.map((file) => fetch(chrome.runtime.getURL(`src/css/${file}`)).then((r) => r.text())),\r\n  ]);\r\n\r\n  const css = cssParts.join(\"\\n\");\r\n  debug.log(\"CSS files fetched and concatenated:\", { cssParts });\r\n\r\n  shadow.innerHTML = \"\"; // Clear previous content\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = css;\r\n  shadow.appendChild(style);\r\n  debug.log(\"Appended styles to shadow DOM.\");\r\n\r\n  // Check if Material Symbols font is already included, if not, append it\r\n  if (!document.querySelector('link[href*=\"Material+Symbols\"]')) {\r\n    const link = document.createElement(\"link\");\r\n    link.rel = \"stylesheet\";\r\n    link.href =\r\n      \"https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\";\r\n    document.head.appendChild(link);\r\n    debug.log(\"Appended Material Symbols font to document head.\");\r\n  }\r\n\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.innerHTML = html;\r\n  shadow.appendChild(wrap);\r\n  debug.log(\"Appended HTML content to shadow DOM.\");\r\n\r\n  // Return an object with all the necessary DOM elements from the shadow root\r\n  const elements = {\r\n    button: shadow.querySelector(\"#floating-button\"),\r\n    widget: shadow.querySelector(\".widget\"),\r\n    root: shadow,\r\n    search: shadow.querySelector(\"#widget-search\"),\r\n    saveScheduleBtn: shadow.querySelector(\"#widget-save-schedule\"),\r\n    refresh: shadow.querySelector(\"#widget-refresh\"),\r\n    exportDropdown: shadow.querySelector(\"#widget-export\"),\r\n    exportButton: shadow.querySelector(\"#widget-export-button\"),\r\n    exportMenu: shadow.querySelector(\"#widget-export-menu\"),\r\n    helpBtn: shadow.querySelector(\".help\"),\r\n    settingsBtn: shadow.querySelector(\".settings\"),\r\n    tableBody: shadow.querySelector(\"tbody\"),\r\n    tableHead: shadow.querySelector(\"thead\"),\r\n    tabButtons: shadow.querySelectorAll(\".tab-button\"),\r\n    panels: shadow.querySelectorAll(\".widget-panel\"),\r\n    scheduleGrid: shadow.querySelector(\"#schedule-grid\"),\r\n    semesterButtons: shadow.querySelectorAll(\".semester-button\"),\r\n    savedDropdown: shadow.querySelector(\"#schedule-saved-dropdown\"),\r\n    savedMenu: shadow.querySelector(\"#schedule-saved-menu\"),\r\n    footerConflicts: shadow.querySelector(\"#widget-conflicts\"),\r\n    saveModal: shadow.querySelector(\"#schedule-save-modal\"),\r\n    saveModalTitle: shadow.querySelector(\"#schedule-modal-title\"),\r\n    saveModalMessage: shadow.querySelector(\"#schedule-modal-message\"),\r\n    saveModalField: shadow.querySelector(\"#schedule-modal-field\"),\r\n    saveModalInput: shadow.querySelector(\"#schedule-modal-input\"),\r\n    saveModalCancel: shadow.querySelector(\".schedule-modal-cancel\"),\r\n    saveModalConfirm: shadow.querySelector(\".schedule-modal-confirm\"),\r\n  };\r\n\r\n  debug.log(\"DOM elements loaded:\", elements);\r\n\r\n  return elements;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"headerMaps\");\r\n\r\nexport const normalizeText = (s) =>\r\n  String(s || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .replace(/\\s+/g, \" \")\r\n    .trim()\r\n    .toLowerCase();\r\n\r\nfunction getHeaderKey(el) {\r\n  const a = el?.getAttribute?.(\"data-automation-id\") || \"\";\r\n  const m = a.match(/^columnHeader(\\d+\\.\\d+)$/);\r\n  return m ? m[1] : null; // \"252.9\"\r\n}\r\n\r\nexport function buildHeaderMaps(gridRoot) {\r\n  const headerEls = Array.from(gridRoot.querySelectorAll('th[data-automation-id^=\"columnHeader\"]'));\r\n\r\n  debug.log({ id: \"buildHeaderMaps.headers\" }, \"Header elements found:\", headerEls.length);\r\n\r\n  const headers = headerEls\r\n    .map((el, pos) => {\r\n      const text = getHeaderText(el);\r\n      const key = getHeaderKey(el); // <-- \"252.9\"\r\n      return { el, pos, key, text, norm: normalizeText(text) };\r\n    })\r\n    .filter((h) => h.text);\r\n\r\n  debug.log(\r\n    { id: \"buildHeaderMaps.parsedHeaders\" },\r\n    \"Parsed headers:\",\r\n    headers.map((h) => ({ pos: h.pos, key: h.key, text: h.text, norm: h.norm }))\r\n  );\r\n\r\n  function findHeader(needles) {\r\n    const ns = needles.map(normalizeText);\r\n    let hit = headers.find((h) => ns.includes(h.norm));\r\n    if (hit) return hit;\r\n    hit = headers.find((h) => ns.some((n) => h.norm.includes(n)));\r\n    return hit || null;\r\n  }\r\n\r\n  const KEYS = {\r\n    instructor: [\"instructor\", \"instructors\"],\r\n    meeting: [\"meeting patterns\", \"meeting pattern\"],\r\n    deliveryMode: [\"delivery mode\"],\r\n    title: [\"title\", \"course listing\"],\r\n    section: [\"section\"],\r\n    instructionalFormat: [\"instructional format\"],\r\n    startDate: [\"start date\", \"start\"],\r\n  };\r\n\r\n  const colMap = {};\r\n  const posMap = {};\r\n\r\n  for (const [key, needles] of Object.entries(KEYS)) {\r\n    const hit = findHeader(needles);\r\n    colMap[key] = hit ? hit.key : null; // <-- store \"252.9\"\r\n    posMap[key] = hit ? hit.pos : -1;\r\n\r\n    debug.log({ id: \"buildHeaderMaps.map\" }, \"Mapped header:\", {\r\n      key,\r\n      needles,\r\n      hit: hit ? { pos: hit.pos, colKey: hit.key, text: hit.text } : null,\r\n    });\r\n  }\r\n\r\n  return { colMap, posMap };\r\n}\r\n\r\nexport function getHeaderText(headerEl) {\r\n  if (!headerEl) return \"\";\r\n\r\n  const btn = headerEl.querySelector(\"button[title]\");\r\n  if (btn) return (btn.getAttribute(\"title\") || \"\").trim();\r\n\r\n  return (headerEl.textContent || \"\").trim();\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"sectionLinkInfo\");\r\n\r\n/* Parse the Workday \"promptOption\" section link string. */\r\nexport function parseSectionLinkString(input) {\r\n  let str = String(input || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .trim();\r\n\r\n  debug.log({ id: \"parseSectionLinkString.input\" }, \"Raw input:\", input);\r\n\r\n  if (!str) return null;\r\n\r\n  // keep ALL lines; Workday wraps titles with \\n\r\n  str = str.replace(/\\s*\\n\\s*/g, \" \").trim();\r\n\r\n  debug.log({ id: \"parseSectionLinkString.normalized\" }, \"Normalized string:\", str);\r\n\r\n  // REQUIRED pattern:\r\n  const m = str.match(/^\\s*([A-Z][A-Z0-9_]*\\s*\\d{3}[A-Z]?)\\s*-\\s*(.+?)\\s*$/);\r\n  if (!m) {\r\n    debug.log({ id: \"parseSectionLinkString.noMatch\" }, \"String did not match expected pattern\");\r\n    return null;\r\n  }\r\n\r\n  const baseCode = m[1].trim(); // \"COSC_O 222\"\r\n  const rest = m[2].trim(); // \"L2D - Data Structures\" or \"101 - Data Structures\"\r\n\r\n  debug.log({ id: \"parseSectionLinkString.match\" }, \"Regex match:\", { baseCode, rest });\r\n\r\n  // Split rest into section token + title\r\n  const parts = rest\r\n    .split(/\\s*[-–—]\\s*/)\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  let sectionToken = \"\";\r\n  let parsedTitle = \"\";\r\n\r\n  sectionToken = parts[0];\r\n  parsedTitle = parts.slice(1).join(\" - \").trim();\r\n\r\n  parsedTitle = parsedTitle.replace(/\\s*:\\s*/g, \":\\n\");\r\n\r\n  const result = {\r\n    code: baseCode,\r\n    section_number: sectionToken,\r\n    title: parsedTitle,\r\n    full: str,\r\n  };\r\n\r\n  debug.log({ id: \"parseSectionLinkString.result\" }, \"Parsed section link result:\", result);\r\n\r\n  return result;\r\n}\r\n\r\nexport function guessClassCode(text) {\r\n  const m = String(text || \"\").match(/[A-Z][A-Z0-9_]*\\s*\\d{2,3}[A-Z]?/);\r\n\r\n  const out = m ? m[0].replace(/\\s+/g, \" \").trim() : \"\";\r\n\r\n  debug.log({ id: \"guessClassCode\" }, \"Guessed class code:\", { input: text, out });\r\n\r\n  return out;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"meetingPatternsInfo\");\r\n\r\nexport function extractMeetingLinesFromCell(meetingEl) {\r\n  if (!meetingEl) {\r\n    debug.log({ id: \"extractMeetingLinesFromCell.missing\" }, \"No meeting element provided\");\r\n    return [];\r\n  }\r\n\r\n  // BEST SOURCE: menu items expose full meeting strings in aria-label\r\n  const menuItems = Array.from(meetingEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n\r\n  let lines = menuItems.map((el) => (el.getAttribute(\"aria-label\") || \"\").trim()).filter(Boolean);\r\n\r\n  debug.log({ id: \"extractMeetingLinesFromCell.menuItems\" }, \"Menu item lines:\", { count: lines.length });\r\n\r\n  // fallback: promptOption text (sometimes present)\r\n  if (!lines.length) {\r\n    const prompts = Array.from(meetingEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n    lines = prompts\r\n      .map((el) =>\r\n        (el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\").trim()\r\n      )\r\n      .filter(Boolean);\r\n\r\n    debug.log({ id: \"extractMeetingLinesFromCell.prompts\" }, \"PromptOption lines (fallback):\", { count: lines.length });\r\n  }\r\n\r\n  // final fallback: innerText split\r\n  if (!lines.length) {\r\n    lines = String(meetingEl.innerText || \"\")\r\n      .split(\"\\n\")\r\n      .map((s) => s.trim())\r\n      .filter(Boolean);\r\n\r\n    debug.log({ id: \"extractMeetingLinesFromCell.innerText\" }, \"InnerText lines (final fallback):\", {\r\n      count: lines.length,\r\n    });\r\n  }\r\n\r\n  // only keep real meeting sentences\r\n  const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n  const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n  const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n  const filtered = lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n\r\n  debug.log({ id: \"extractMeetingLinesFromCell.filtered\" }, \"Filtered meeting lines:\", {\r\n    before: lines.length,\r\n    after: filtered.length,\r\n  });\r\n\r\n  return filtered;\r\n}\r\n\r\nexport function extractMeetingLinesFromRow(rowEl) {\r\n  if (!rowEl) return [];\r\n\r\n  const items = Array.from(rowEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n  const lines = items.map((el) => (el.getAttribute(\"aria-label\") || \"\").trim()).filter(Boolean);\r\n\r\n  debug.log({ id: \"extractMeetingLinesFromRow.items\" }, \"Row menu item lines:\", { count: lines.length });\r\n\r\n  const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n  const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n  const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n  const filtered = lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n\r\n  debug.log({ id: \"extractMeetingLinesFromRow.filtered\" }, \"Filtered row meeting lines:\", {\r\n    before: lines.length,\r\n    after: filtered.length,\r\n  });\r\n\r\n  return filtered;\r\n}\r\n\r\nexport function formatMeetingLineForPanel(line) {\r\n  const raw = String(line || \"\");\r\n\r\n  const parts = raw\r\n    .split(\"|\")\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  const dayPartRaw = parts.find((p) => /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/.test(p)) || \"\";\r\n  const dayPart = dayPartRaw.split(/\\s+/).join(\" / \");\r\n\r\n  const timePart = parts.find((p) => /\\d{1,2}:\\d{2}/.test(p) && /-/.test(p)) || \"\";\r\n\r\n  const buildingPart = parts.find((p) => /\\([A-Z]{2,}\\)/.test(p)) || \"\";\r\n\r\n  // ✅ find Floor/Room anywhere in the full string (handles \"Floor 3\", \"Floor: 3\", \"Rm 210\", etc.)\r\n  const floorMatch = raw.match(/\\bfloor\\b\\s*[:\\-]?\\s*(-?[A-Za-z0-9]+)/i);\r\n  const roomMatch = raw.match(/\\b(room|rm)\\b\\s*[:\\-]?\\s*([A-Za-z0-9]+)/i);\r\n\r\n  const floorPart = floorMatch ? `Floor: ${floorMatch[1]}` : \"\";\r\n  const roomPart = roomMatch ? `Room: ${roomMatch[2]}` : \"\";\r\n\r\n  const formatted = {\r\n    days: dayPart,\r\n    time: timePart,\r\n    location: [buildingPart, [floorPart, roomPart].filter(Boolean).join(\" | \")].filter(Boolean).join(\"\\n\"),\r\n  };\r\n\r\n  debug.log({ id: \"formatMeetingLineForPanel\" }, \"Formatted meeting line:\", { raw, formatted });\r\n\r\n  return formatted;\r\n}\r\n\r\nexport function normalizeMeetingPatternsText(text) {\r\n  // preserve line breaks, normalize each line\r\n  const normalized = String(text || \"\")\r\n    .split(/\\r?\\n/)\r\n    .map((line) => line.replace(/\\s+/g, \" \").trim())\r\n    .filter(Boolean)\r\n    .join(\"\\n\");\r\n\r\n  debug.log({ id: \"normalizeMeetingPatternsText\" }, \"Normalized meeting patterns text:\", {\r\n    beforeLen: String(text || \"\").length,\r\n    afterLen: normalized.length,\r\n  });\r\n\r\n  return normalized;\r\n}\r\n\r\nexport function extractStartDate(line) {\r\n  const match = String(line || \"\").match(/\\b(\\d{4}-\\d{2}-\\d{2})\\b/);\r\n  const out = match ? match[1] : \"\";\r\n\r\n  debug.log({ id: \"extractStartDate\" }, \"Extracted start date:\", { line, out });\r\n\r\n  return out;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"instructorInfo\");\r\n\r\nexport function extractInstructorNamesFromCell(instructorEl) {\r\n  if (!instructorEl) {\r\n    debug.log({ id: \"extractInstructorNamesFromCell.missing\" }, \"No instructor element provided\");\r\n    return \"\";\r\n  }\r\n\r\n  const prompt = instructorEl.querySelector('[data-automation-id=\"promptOption\"]');\r\n  const txt = (\r\n    (prompt && (prompt.getAttribute(\"data-automation-label\") || prompt.getAttribute(\"title\") || prompt.textContent)) ||\r\n    instructorEl.textContent ||\r\n    \"\"\r\n  ).trim();\r\n\r\n  debug.log({ id: \"extractInstructorNamesFromCell.result\" }, \"Extracted instructor text:\", {\r\n    hasPrompt: !!prompt,\r\n    txt,\r\n  });\r\n\r\n  return txt;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"onlineClassCheck\");\r\n\r\nexport function onlineClassCheck(deliveryModeCellEl) {\r\n  if (!deliveryModeCellEl) {\r\n    debug.log({ id: \"onlineClassCheck.missing\" }, \"No delivery mode cell provided\");\r\n    return false;\r\n  }\r\n\r\n  const txt = (deliveryModeCellEl.innerText || deliveryModeCellEl.textContent || \"\").trim();\r\n  if (/online learning/i.test(txt)) {\r\n    debug.log({ id: \"onlineClassCheck.match.direct\" }, \"Matched online learning from cell text\", txt);\r\n    return true;\r\n  }\r\n\r\n  const prompts = Array.from(deliveryModeCellEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n\r\n  const matched = prompts.some((el) => {\r\n    const label = (el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\").trim();\r\n    return /online learning/i.test(label);\r\n  });\r\n\r\n  debug.log({ id: \"onlineClassCheck.match.prompts\" }, \"Checked prompt options for online learning\", {\r\n    promptCount: prompts.length,\r\n    matched,\r\n  });\r\n\r\n  return matched;\r\n}\r\n","import { $$ } from \"../utilities/dom\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nimport { normalizeText, getHeaderText } from \"./headerMaps.js\";\r\n\r\nconst debug = debugFor(\"findingTables\");\r\n\r\n// Find any likely Workday grid/table on the page\r\nexport function findingTables() {\r\n  const roots = $$(document, 'table, [role=\"table\"], div[data-automation-id*=\"grid\"], div[role=\"grid\"]');\r\n\r\n  debug.log({ id: \"findingTables.roots\" }, \"Candidate roots found:\", roots.length);\r\n\r\n  for (const root of roots) {\r\n    const headerEls = $$(root, \"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header\");\r\n\r\n    const headerText = headerEls.map((h) => normalizeText(getHeaderText(h)));\r\n\r\n    // still require \"section\" + at least one other expected header\r\n    const looksRight =\r\n      headerText.some((t) => t.includes(\"section\")) &&\r\n      (headerText.some((t) => t.includes(\"instructor\")) ||\r\n        headerText.some((t) => t.includes(\"meeting\")) ||\r\n        headerText.some((t) => t.includes(\"instructional format\")) ||\r\n        headerText.some((t) => t.includes(\"format\")) ||\r\n        headerText.some((t) => t.includes(\"status\")));\r\n\r\n    debug.log({ id: \"findingTables.scanRoot\" }, \"Scanning root:\", {\r\n      headerCount: headerEls.length,\r\n      looksRight,\r\n      headerText,\r\n    });\r\n\r\n    if (!looksRight) continue;\r\n\r\n    const rows = $$(root, \"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row\");\r\n\r\n    debug.log({ id: \"findingTables.rows\" }, \"Rows found for matching root:\", rows.length);\r\n\r\n    if (rows.length) return { root, rows };\r\n  }\r\n\r\n  debug.log({ id: \"findingTables.none\" }, \"No matching table/grid found\");\r\n  return null;\r\n}\r\n","import { $$ } from \"../utilities/dom\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nimport { buildHeaderMaps } from \"./headerMaps.js\";\r\nimport { parseSectionLinkString, guessClassCode } from \"./sectionLinkInfo.js\";\r\nimport {\r\n  extractMeetingLinesFromCell,\r\n  extractMeetingLinesFromRow,\r\n  formatMeetingLineForPanel,\r\n  normalizeMeetingPatternsText,\r\n  extractStartDate,\r\n} from \"./meetingPatternsInfo.js\";\r\nimport { extractInstructorNamesFromCell } from \"./instructorInfo.js\";\r\nimport { onlineClassCheck } from \"./onlineClassCheck.js\";\r\nimport { findingTables } from \"./findingTables.js\";\r\n\r\nconst debug = debugFor(\"courseExtraction\");\r\n\r\nexport async function extractAllCourses() {\r\n  debug.log({ id: \"extractAllCourses.start\" }, \"Starting course extraction\");\r\n\r\n  const found = findingTables();\r\n  let courses = [];\r\n\r\n  debug.log(\r\n    { id: \"extractAllCourses.tables\" },\r\n    \"findingTables() result:\",\r\n    found\r\n      ? {\r\n          hasRoot: !!found.root,\r\n          rowCount: found.rows?.length || 0,\r\n        }\r\n      : null\r\n  );\r\n\r\n  if (found) {\r\n    const headerMaps = buildHeaderMaps(found.root);\r\n\r\n    debug.log({ id: \"extractAllCourses.headerMaps\" }, \"Built header maps:\", headerMaps);\r\n\r\n    for (const row of found.rows) {\r\n      const c = extractFromRow(row, headerMaps);\r\n      if ((c.code || c.title) && Object.values(c).join(\"\").trim()) courses.push(c);\r\n    }\r\n  }\r\n\r\n  const unique = findUniqueCourses(courses);\r\n  debug.log({ id: \"extractAllCourses.done\" }, \"Extraction complete:\", {\r\n    total: courses.length,\r\n    unique: unique.length,\r\n  });\r\n\r\n  return unique;\r\n}\r\n\r\nfunction findUniqueCourses(list) {\r\n  const key = (c) => [c.code, c.title, c.section_number].join(\"|\").toLowerCase();\r\n  const seen = new Set();\r\n  const out = [];\r\n\r\n  for (const c of list) {\r\n    const k = key(c);\r\n    if (!seen.has(k)) {\r\n      seen.add(k);\r\n      out.push(c);\r\n    }\r\n  }\r\n\r\n  debug.log({ id: \"findUniqueCourses\" }, \"Deduped courses:\", {\r\n    in: list.length,\r\n    out: out.length,\r\n    removed: list.length - out.length,\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\nexport function extractFromRow(row, headerMaps) {\r\n  const { colMap, posMap } = headerMaps;\r\n\r\n  const cells = $$(row, \"td, [role='gridcell']\");\r\n  const allText = (row.innerText || \"\").trim();\r\n\r\n  debug.log({ id: \"extractFromRow.start\" }, \"Extracting row:\", {\r\n    cellCount: cells.length,\r\n    textLen: allText.length,\r\n  });\r\n\r\n  // map row cells by position (1-based)\r\n  function getCellKey(cell) {\r\n    // looks inside the cell for the container with id like \"gen-dwr-comp-252.9-640\"\r\n    const inner = cell.querySelector('[id^=\"gen-dwr-comp-\"]');\r\n    const id = inner?.id || \"\";\r\n    const m = id.match(/^gen-dwr-comp-(\\d+\\.\\d+)-/);\r\n    return m ? m[1] : null; // \"252.9\"\r\n  }\r\n\r\n  // map row cells by Workday key (e.g., \"252.9\"), not by position\r\n  const cellByCol = new Map();\r\n  cells.forEach((cell) => {\r\n    const key = getCellKey(cell);\r\n    if (key && !cellByCol.has(key)) cellByCol.set(key, cell);\r\n  });\r\n\r\n  const getCellEl = (keyName) => {\r\n    const key = colMap[keyName]; // e.g., \"252.9\"\r\n    if (key != null && cellByCol.has(key)) return cellByCol.get(key);\r\n\r\n    const pos = posMap[keyName];\r\n    if (pos != null && pos >= 0 && pos < cells.length) return cells[pos];\r\n\r\n    return null;\r\n  };\r\n\r\n  const readByKey = (key) => {\r\n    const col = colMap[key];\r\n    if (col != null && cellByCol.has(col)) {\r\n      return (cellByCol.get(col).innerText || \"\").trim();\r\n    }\r\n\r\n    const pos = posMap[key];\r\n    if (pos != null && pos >= 0 && pos < cells.length) {\r\n      return (cells[pos].innerText || \"\").trim();\r\n    }\r\n    return \"\";\r\n  };\r\n\r\n  // ✅ Search the entire row for the promptOption link (most reliable)\r\n  const allPromptOptions = $$(row, '[data-automation-id=\"promptOption\"]');\r\n  let sectionLinkEl = null;\r\n\r\n  for (const el of allPromptOptions) {\r\n    const text =\r\n      el.getAttribute(\"data-automation-label\") ||\r\n      el.getAttribute(\"title\") ||\r\n      el.getAttribute(\"aria-label\") ||\r\n      el.textContent ||\r\n      \"\";\r\n    if (/^[A-Z][A-Z0-9_]*\\s*\\d{2,3}-/.test(text)) {\r\n      sectionLinkEl = el;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!sectionLinkEl && allPromptOptions.length > 0) {\r\n    sectionLinkEl = allPromptOptions[0];\r\n  }\r\n\r\n  const sectionLinkString =\r\n    (sectionLinkEl &&\r\n      (sectionLinkEl.getAttribute(\"data-automation-label\") ||\r\n        sectionLinkEl.getAttribute(\"title\") ||\r\n        sectionLinkEl.getAttribute(\"aria-label\") ||\r\n        sectionLinkEl.textContent)) ||\r\n    \"\";\r\n\r\n  debug.log({ id: \"extractFromRow.sectionLink\" }, \"Section link:\", {\r\n    promptOptions: allPromptOptions.length,\r\n    hasMatch: !!sectionLinkEl,\r\n    sectionLinkString,\r\n  });\r\n\r\n  const titleCell = readByKey(\"title\");\r\n  const codeCell = readByKey(\"code\");\r\n  const sectCell = readByKey(\"section\");\r\n  const meetingCell = readByKey(\"meeting\");\r\n  const instructionalFormatCell = readByKey(\"instructionalFormat\");\r\n  const startDateCell = readByKey(\"startDate\");\r\n\r\n  // ---------- Core parse: (code + section + title) from the same string ----------\r\n  let code = \"\";\r\n  let title = titleCell || \"\";\r\n  let section_number = \"\";\r\n\r\n  const parsed = parseSectionLinkString(sectionLinkString);\r\n  if (parsed) {\r\n    code = parsed.code;\r\n    section_number = parsed.section_number;\r\n    title = parsed.title;\r\n  }\r\n\r\n  if (!code) code = guessClassCode(codeCell) || guessClassCode(titleCell) || guessClassCode(allText) || \"\";\r\n\r\n  debug.log({ id: \"extractFromRow.coreParse\" }, \"Core parse result:\", {\r\n    code,\r\n    title,\r\n    section_number,\r\n    titleCell,\r\n    codeCell,\r\n    sectCell,\r\n  });\r\n\r\n  // ---------- Lab / Seminar detection ----------\r\n  const labLike = (s) => /\\b(lab|laboratory|labratory)\\b/i.test(String(s || \"\"));\r\n  const seminarLike = (s) => /\\bseminar\\b/i.test(String(s || \"\"));\r\n  const discussionLike = (s) => /\\bdiscussion\\b/i.test(String(s || \"\"));\r\n\r\n  const isLab =\r\n    labLike(instructionalFormatCell) ||\r\n    labLike(sectCell) ||\r\n    labLike(title) ||\r\n    labLike(sectionLinkString) ||\r\n    labLike(allText);\r\n\r\n  const isSeminar =\r\n    seminarLike(instructionalFormatCell) ||\r\n    seminarLike(sectCell) ||\r\n    seminarLike(title) ||\r\n    seminarLike(sectionLinkString) ||\r\n    seminarLike(allText);\r\n\r\n  const isDiscussion =\r\n    discussionLike(instructionalFormatCell) ||\r\n    discussionLike(sectCell) ||\r\n    discussionLike(title) ||\r\n    discussionLike(sectionLinkString) ||\r\n    discussionLike(allText);\r\n\r\n  debug.log({ id: \"extractFromRow.typeDetection\" }, \"Type flags:\", {\r\n    isLab,\r\n    isSeminar,\r\n    isDiscussion,\r\n    instructionalFormatCell,\r\n  });\r\n\r\n  // ---------- Instructor ----------\r\n\r\n  const instructorEl = getCellEl(\"instructor\"); // uses colMap/posMap + cellByCol\r\n\r\n  let instructor = \"\";\r\n\r\n  if (isLab || isSeminar) {\r\n    instructor = \"N/A\";\r\n  } else {\r\n    instructor = extractInstructorNamesFromCell(instructorEl) || (readByKey(\"instructor\") || \"\").trim();\r\n  }\r\n\r\n  // ---------- Meeting ----------\r\n  let meeting;\r\n\r\n  const meetingCol = colMap.meeting;\r\n  let meetingEl = null;\r\n\r\n  if (meetingCol != null && cellByCol.has(meetingCol)) {\r\n    meetingEl = cellByCol.get(meetingCol);\r\n  } else if (posMap.meeting != null && posMap.meeting >= 0 && posMap.meeting < cells.length) {\r\n    meetingEl = cells[posMap.meeting];\r\n  }\r\n\r\n  let lines = meetingEl ? extractMeetingLinesFromCell(meetingEl) : [];\r\n  if (!lines.length) lines = extractMeetingLinesFromRow(row);\r\n\r\n  let meetingObj = { days: \"\", time: \"\", location: \"\" };\r\n  let startDate = extractStartDate(lines[0]) || extractStartDate(startDateCell);\r\n\r\n  if (lines.length) {\r\n    const firstLine = lines[0];\r\n    meetingObj = formatMeetingLineForPanel(firstLine);\r\n  } else {\r\n    meeting = (meetingCell || \"\").trim();\r\n  }\r\n\r\n  const deliveryModeCell = getCellEl(\"deliveryMode\");\r\n  const isOnlineDelivery = onlineClassCheck(deliveryModeCell);\r\n\r\n  if (isOnlineDelivery) {\r\n    meetingObj.location = \"Online\";\r\n  }\r\n\r\n  if (meetingObj.days || meetingObj.time || meetingObj.location) {\r\n    meeting = [meetingObj.days, meetingObj.time].filter(Boolean).join(\" | \");\r\n    if (meetingObj.location) meeting += `\\n${meetingObj.location}`;\r\n    else meeting += `\\nOnline`;\r\n  } else {\r\n    meeting = (meetingCell || \"\").trim();\r\n  }\r\n\r\n  debug.log({ id: \"extractFromRow.meeting\" }, \"Meeting parse:\", {\r\n    startDateCell,\r\n    startDate,\r\n    linesCount: lines.length,\r\n    isOnlineDelivery,\r\n    meetingObj,\r\n    meeting,\r\n  });\r\n\r\n  // ---------- Instructional Format (was \"status\") ----------\r\n  const instructionalFormat = (instructionalFormatCell || \"\").trim();\r\n\r\n  const result = {\r\n    code,\r\n    title,\r\n    section_number,\r\n    instructor,\r\n    meeting: normalizeMeetingPatternsText(meeting),\r\n    instructionalFormat,\r\n    startDate,\r\n    meetingLines: lines,\r\n    isLab,\r\n    isSeminar,\r\n    isDiscussion,\r\n  };\r\n\r\n  debug.log({ id: \"extractFromRow.result\" }, \"Extracted course:\", {\r\n    code: result.code,\r\n    title: result.title,\r\n    section_number: result.section_number,\r\n    instructor: result.instructor,\r\n    instructionalFormat: result.instructionalFormat,\r\n    startDate: result.startDate,\r\n    meetingLines: result.meetingLines?.length || 0,\r\n    isLab: result.isLab,\r\n    isSeminar: result.isSeminar,\r\n    isDiscussion: result.isDiscussion,\r\n  });\r\n\r\n  return result;\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"renderRows\");\r\n\r\nexport const escHTML = (s) => {\r\n  const result = String(s ?? \"\")\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n  debug.log(\"Escaped HTML:\", { input: s, output: result });\r\n  return result;\r\n};\r\n\r\nfunction cleanLines(text) {\r\n  const cleaned = String(text || \"\")\r\n    .replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \" \") // kill nbsp/zero-width\r\n    .replace(/[ \\t]+\\n/g, \"\\n\") // trailing spaces before newline\r\n    .replace(/\\n[ \\t]+/g, \"\\n\") // leading spaces after newline\r\n    .replace(/\\n{2,}/g, \"\\n\") // collapse multiple newlines\r\n    .trim();\r\n  debug.log(\"Cleaned text lines:\", { input: text, output: cleaned });\r\n  return cleaned;\r\n}\r\n\r\nexport function renderRows(ctx, rows) {\r\n  debug.log(\"Rendering rows:\", rows);\r\n  ctx.tableBody.innerHTML = \"\";\r\n  const frag = document.createDocumentFragment();\r\n\r\n  rows.forEach((c) => {\r\n    const tr = document.createElement(\"tr\");\r\n\r\n    const badge = c.isLab ? \"[Laboratory]\" : c.isSeminar ? \"[Seminar]\" : c.isDiscussion ? \"[Discussion]\" : \"\";\r\n\r\n    tr.innerHTML = `\r\n      <td class=\"title\">\r\n        <div class=\"title-main\">${c.title || \"\"}</div>\r\n        ${badge ? `<div class=\"muted\">${badge}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"code\">${c.code || \"\"}</td>\r\n      <td class=\"sect\">${(c.section_number || \"\").trim()}</td>\r\n      <td class=\"instructor\">${c.instructor || \"\"}</td>\r\n      <td class=\"meeting\">\r\n        ${(() => {\r\n          const parts = cleanLines(c.meeting).split(\"\\n\");\r\n          const main = (parts[0] || \"\").trim();\r\n          const sub = parts\r\n            .slice(1)\r\n            .map((s) => s.replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \"\").trim())\r\n            .filter(Boolean)\r\n            .join(\"\\n\");\r\n          debug.log(\"Processed meeting details:\", { main, sub });\r\n          return `\r\n            ${main ? `<span class=\"meeting-pill\">${escHTML(main).trim()}</span>` : \"\"}\r\n            ${sub ? `<div class=\"meeting-sub\">${escHTML(sub).trim()}</div>` : \"\"}\r\n          `;\r\n        })()}\r\n      </td>\r\n      <td class=\"instructionalFormat\">${c.instructionalFormat || \"\"}</td>\r\n    `;\r\n\r\n    frag.appendChild(tr);\r\n  });\r\n\r\n  ctx.tableBody.appendChild(frag);\r\n  debug.log(\"Rows rendered and added to table body.\");\r\n}\r\n","import { $$, on } from \"../utilities/dom.js\";\r\nimport { STATE } from \"../core/state.js\";\r\nimport { renderRows } from \"./renderRows.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"panelInteractions\");\r\n\r\nexport function applySearchFilter(q) {\r\n  q = (q || \"\").trim().toLowerCase();\r\n  debug.log(\"Search query received:\", q);\r\n\r\n  if (!q) {\r\n    STATE.filtered = [...STATE.courses];\r\n    debug.log(\"Search filter cleared, resetting filtered courses:\", STATE.filtered);\r\n    return;\r\n  }\r\n\r\n  STATE.filtered = STATE.courses.filter((c) => {\r\n    return [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"].some((k) =>\r\n      (c[k] || \"\").toLowerCase().includes(q)\r\n    );\r\n  });\r\n  debug.log(\"Search filter applied, filtered courses:\", STATE.filtered);\r\n}\r\n\r\nexport function sortBy(key) {\r\n  if (!key) return;\r\n\r\n  const dir = STATE.sort.key === key ? -STATE.sort.dir : 1;\r\n  STATE.sort = { key, dir };\r\n  debug.log(\"Sorting by key:\", key, \"Direction:\", dir);\r\n\r\n  const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: \"base\" });\r\n  STATE.filtered.sort((a, b) => dir * collator.compare(a[key] || \"\", b[key] || \"\"));\r\n  debug.log(\"Sorted filtered courses:\", STATE.filtered);\r\n}\r\n\r\nexport function wireSorting(ctx) {\r\n  const headCells = $$(ctx.tableHead, \"th[data-key]\");\r\n  debug.log(\"Table header cells with sorting keys:\", headCells);\r\n\r\n  headCells.forEach((th) => {\r\n    on(th, \"click\", () => {\r\n      const key = th.getAttribute(\"data-key\");\r\n      debug.log(\"Sorting header clicked, sorting by:\", key);\r\n      sortBy(key);\r\n      renderRows(ctx, STATE.filtered);\r\n\r\n      headCells.forEach((h) => h.classList.remove(\"sorted-asc\", \"sorted-desc\"));\r\n      th.classList.add(STATE.sort.dir === 1 ? \"sorted-asc\" : \"sorted-desc\");\r\n      debug.log(\"Updated sorting classes:\", {\r\n        sortedAsc: th.classList.contains(\"sorted-asc\"),\r\n        sortedDesc: th.classList.contains(\"sorted-desc\"),\r\n      });\r\n    });\r\n  });\r\n}\r\n","import { extractStartDate } from \"../extraction/meetingPatternsInfo.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"scheduleView\");\r\n\r\nconst DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"];\r\nconst START_HOUR = 8;\r\nconst END_HOUR = 21; // last visible hour (exclusive end)\r\nconst SLOT_MINUTES = 30;\r\n\r\n// Build slot start times: 8:00, 8:30, 9:00, ...\r\nconst SLOTS = [];\r\nfor (let h = START_HOUR; h < END_HOUR; h++) {\r\n  SLOTS.push(h * 60);\r\n  SLOTS.push(h * 60 + 30);\r\n}\r\nSLOTS.push(END_HOUR * 60);\r\n\r\nconst DAY_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\nconst TIME_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/gi;\r\n\r\nconst SEMESTER_MONTHS = {\r\n  first: [\"09\", \"08\"],\r\n  second: [\"01\", \"12\"],\r\n};\r\n\r\nfunction parseTimeToken(token) {\r\n  if (!token) return null;\r\n\r\n  const match = token.trim().match(/(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i);\r\n  if (!match) return null;\r\n\r\n  let hours = Number.parseInt(match[1], 10);\r\n  const minutes = Number.parseInt(match[2], 10);\r\n  const period = match[3].toLowerCase();\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return hours * 60 + minutes;\r\n}\r\n\r\nfunction parseMeetingLine(line) {\r\n  const days = String(line || \"\").match(DAY_REGEX) || [];\r\n  const timeTokens = String(line || \"\").match(TIME_REGEX) || [];\r\n\r\n  if (days.length === 0 || timeTokens.length < 2) return null;\r\n\r\n  const startMinutes = parseTimeToken(timeTokens[0]);\r\n  const endMinutes = parseTimeToken(timeTokens[1]);\r\n\r\n  if (startMinutes == null || endMinutes == null) return null;\r\n\r\n  if (endMinutes <= startMinutes) return null;\r\n\r\n  debug.log(\"Parsed meeting line:\", { days, timeTokens, startMinutes, endMinutes });\r\n\r\n  return {\r\n    days: [...new Set(days)],\r\n    startMinutes,\r\n    endMinutes,\r\n    timeLabel: `${timeTokens[0]} - ${timeTokens[1]}`,\r\n  };\r\n}\r\n\r\nfunction getSemester(startDate) {\r\n  if (!startDate) return null;\r\n\r\n  const month = startDate.split(\"-\")[1];\r\n\r\n  const semester = SEMESTER_MONTHS.first.includes(month)\r\n    ? \"first\"\r\n    : SEMESTER_MONTHS.second.includes(month)\r\n    ? \"second\"\r\n    : null;\r\n\r\n  debug.log(\"Determined semester for startDate:\", { startDate, semester });\r\n  return semester;\r\n}\r\n\r\nfunction clampToGrid(minutes) {\r\n  const min = START_HOUR * 60;\r\n  const max = END_HOUR * 60;\r\n  return Math.max(min, Math.min(max, minutes));\r\n}\r\n\r\nfunction snapDownToSlot(minutes) {\r\n  return Math.floor(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction snapUpToSlot(minutes) {\r\n  return Math.ceil(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction slotIndexOf(minutes) {\r\n  return SLOTS.indexOf(minutes);\r\n}\r\n\r\nfunction buildDayEvents(courses, semester) {\r\n  debug.log(\"Building day events for semester:\", semester);\r\n  const eventsByDay = new Map();\r\n  DAYS.forEach((d) => eventsByDay.set(d, []));\r\n\r\n  const seen = new Set();\r\n  let eventId = 0;\r\n\r\n  courses.forEach((course) => {\r\n    const startDate = course.startDate || extractStartDate(course.meetingLines?.[0]) || \"\";\r\n\r\n    const courseSemester = getSemester(startDate);\r\n\r\n    if (courseSemester !== semester) return;\r\n\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n\r\n    const label = course.isLab\r\n      ? \"[Laboratory]\"\r\n      : course.isSeminar\r\n      ? \"[Seminar]\"\r\n      : course.isDiscussion\r\n      ? \"[Discussion]\"\r\n      : \"\";\r\n\r\n    lines.forEach((line) => {\r\n      const parsed = parseMeetingLine(line);\r\n      if (!parsed) return;\r\n\r\n      let startMin = clampToGrid(parsed.startMinutes);\r\n      let endMin = clampToGrid(parsed.endMinutes);\r\n\r\n      startMin = snapDownToSlot(startMin);\r\n      endMin = snapUpToSlot(endMin);\r\n\r\n      const startIdx = slotIndexOf(startMin);\r\n      const endIdx = slotIndexOf(endMin);\r\n\r\n      if (startIdx === -1 || endIdx === -1 || endIdx <= startIdx) return;\r\n\r\n      const rowSpan = endIdx - startIdx;\r\n\r\n      parsed.days.forEach((day) => {\r\n        if (!eventsByDay.has(day)) return;\r\n\r\n        const key = [day, course.code || \"\", course.title || \"\", parsed.timeLabel, startIdx, rowSpan].join(\"|\");\r\n\r\n        if (seen.has(key)) return;\r\n        seen.add(key);\r\n\r\n        eventsByDay.get(day).push({\r\n          id: eventId++,\r\n          code: course.code || \"\",\r\n          title: course.title || \"\",\r\n          label,\r\n          timeLabel: parsed.timeLabel,\r\n\r\n          rowStart: startIdx,\r\n          rowSpan,\r\n\r\n          startIdx,\r\n          endIdx,\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  DAYS.forEach((day) => {\r\n    eventsByDay.get(day).sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n  });\r\n\r\n  debug.log(\"Built day events:\", eventsByDay);\r\n  return eventsByDay;\r\n}\r\n\r\nfunction addConflicts(eventsByDay) {\r\n  debug.log(\"Adding conflicts to events...\");\r\n  const groupedByDay = new Map();\r\n\r\n  DAYS.forEach((day) => {\r\n    const events = (eventsByDay.get(day) || []).slice().sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n\r\n    const groups = [];\r\n\r\n    let current = null;\r\n    let currentKey = null;\r\n\r\n    for (let r = 0; r < SLOTS.length - 1; r++) {\r\n      const active = events.filter((ev) => ev.startIdx <= r && ev.endIdx > r);\r\n      const key = active.length\r\n        ? active\r\n            .map((ev) => ev.id)\r\n            .sort((a, b) => a - b)\r\n            .join(\"|\")\r\n        : null;\r\n\r\n      if (!key) {\r\n        if (current) groups.push(current);\r\n        current = null;\r\n        currentKey = null;\r\n        continue;\r\n      }\r\n\r\n      if (current && key === currentKey) {\r\n        current.end = r + 1;\r\n        continue;\r\n      }\r\n\r\n      if (current) groups.push(current);\r\n\r\n      current = {\r\n        start: r,\r\n        end: r + 1,\r\n        events: active,\r\n        hasConflict: active.length > 1,\r\n      };\r\n      currentKey = key;\r\n    }\r\n\r\n    if (current) groups.push(current);\r\n\r\n    groupedByDay.set(day, groups);\r\n  });\r\n\r\n  debug.log(\"Grouped events with conflicts:\", groupedByDay);\r\n  return groupedByDay;\r\n}\r\n\r\nfunction getConflictSummaries(groupedByDay) {\r\n  const seen = new Set();\r\n  const conflicts = [];\r\n\r\n  groupedByDay.forEach((groups) => {\r\n    groups.forEach((group) => {\r\n      if (!group.hasConflict) return;\r\n\r\n      const codes = [...new Set(group.events.map((ev) => ev.code || ev.title).filter(Boolean))];\r\n\r\n      if (codes.length < 2) return;\r\n\r\n      codes.sort((a, b) => a.localeCompare(b));\r\n\r\n      const key = codes.join(\"|\");\r\n      if (seen.has(key)) return;\r\n      seen.add(key);\r\n      conflicts.push(codes);\r\n    });\r\n  });\r\n\r\n  debug.log(\"Conflict summaries:\", conflicts);\r\n  return conflicts;\r\n}\r\n\r\nfunction updateConflictFooter(ctx, conflicts) {\r\n  if (!ctx?.footerConflicts) return;\r\n\r\n  if (!conflicts.length) {\r\n    ctx.footerConflicts.textContent = \"\";\r\n    return;\r\n  }\r\n\r\n  const conflictList = conflicts.map((codes) => `[${codes.join(\", \")}]`).join(\" \");\r\n\r\n  ctx.footerConflicts.textContent = `⚠️ The following classes are in conflict: ${conflictList}`;\r\n}\r\n\r\nfunction formatSlotLabel(minutes) {\r\n  const h24 = Math.floor(minutes / 60);\r\n  const m = minutes % 60;\r\n\r\n  const hh = String(h24);\r\n  const mm = String(m).padStart(2, \"0\");\r\n  return `${hh}:${mm}`;\r\n}\r\n\r\nfunction buildScheduleTable() {\r\n  // Wrap so we can overlay blocks on top of the table\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.className = \"schedule-table-wrap\";\r\n\r\n  const table = document.createElement(\"table\");\r\n  table.className = \"schedule-table\";\r\n\r\n  const thead = document.createElement(\"thead\");\r\n  const headRow = document.createElement(\"tr\");\r\n\r\n  headRow.innerHTML = `\r\n    <th class=\"schedule-time\"></th>\r\n    ${DAYS.map((day) => `<th class=\"schedule-day-head\" data-day=\"${day}\">${day}</th>`).join(\"\")}\r\n  `;\r\n\r\n  thead.appendChild(headRow);\r\n  table.appendChild(thead);\r\n\r\n  const tbody = document.createElement(\"tbody\");\r\n\r\n  for (let r = 0; r < SLOTS.length; r++) {\r\n    const row = document.createElement(\"tr\");\r\n\r\n    // Time label column\r\n    const timeTd = document.createElement(\"td\");\r\n    timeTd.className = \"schedule-time\";\r\n    timeTd.textContent = formatSlotLabel(SLOTS[r]);\r\n    row.appendChild(timeTd);\r\n\r\n    // Day columns (NO MERGING / NO ROWSPAN)\r\n    DAYS.forEach((day) => {\r\n      const td = document.createElement(\"td\");\r\n      td.className = \"schedule-cell\";\r\n      td.dataset.day = day;\r\n      td.dataset.row = String(r);\r\n\r\n      // Optional: inner div if you want future per-cell stuff\r\n      const inner = document.createElement(\"div\");\r\n      inner.className = \"schedule-cell-inner\";\r\n      td.appendChild(inner);\r\n\r\n      row.appendChild(td);\r\n    });\r\n\r\n    tbody.appendChild(row);\r\n  }\r\n\r\n  table.appendChild(tbody);\r\n  wrap.appendChild(table);\r\n\r\n  // Overlay layer that will hold the floating blocks\r\n  const overlay = document.createElement(\"div\");\r\n  overlay.className = \"schedule-overlay\";\r\n  wrap.appendChild(overlay);\r\n\r\n  return wrap;\r\n}\r\n\r\nfunction rectFromBlock(el) {\r\n  return el.getBoundingClientRect();\r\n}\r\n\r\nfunction renderOverlayBlocks(wrap, eventsByDay, groupedByDay) {\r\n  const overlay = wrap.querySelector(\".schedule-overlay\");\r\n  overlay.innerHTML = \"\";\r\n\r\n  const table = wrap.querySelector(\".schedule-table\");\r\n\r\n  const firstBodyRow = table.querySelector(\"tbody tr\");\r\n  const firstDayCell = table.querySelector('tbody tr td.schedule-cell[data-day=\"Mon\"]');\r\n  const timeTh = table.querySelector(\"thead th.schedule-time\");\r\n\r\n  if (!firstBodyRow || !firstDayCell || !timeTh) return;\r\n\r\n  const timeColWidth = timeTh.getBoundingClientRect().width;\r\n  const dayColWidth = firstDayCell.getBoundingClientRect().width;\r\n  const headerHeight = table.querySelector(\"thead\").getBoundingClientRect().height;\r\n  const rowHeight = firstBodyRow.getBoundingClientRect().height;\r\n\r\n  // --- derive border from CSS (no magic numbers) ---\r\n  const cellStyles = getComputedStyle(firstDayCell);\r\n  const borderLeft = parseFloat(cellStyles.borderLeftWidth) || 0;\r\n  const borderTop = parseFloat(cellStyles.borderTopWidth) || 0;\r\n  const borderRight = parseFloat(cellStyles.borderRightWidth) || 0;\r\n  const borderBottom = parseFloat(cellStyles.borderBottomWidth) || 0;\r\n\r\n  // If borders are uniform, these will be the same; otherwise we keep X/Y separate.\r\n  const borderX = (borderLeft + borderRight) / 2;\r\n  const borderY = (borderTop + borderBottom) / 2;\r\n\r\n  // --- build blocks first (one per event), store rects for overlap detection ---\r\n  const placedBlocks = []; // { el, day, ev, rect, overlapLayerEl, overlaps: [] }\r\n\r\n  DAYS.forEach((day, dayIndex) => {\r\n    const events = eventsByDay.get(day) || [];\r\n\r\n    events.forEach((ev) => {\r\n      const left = timeColWidth + dayIndex * dayColWidth;\r\n      const top = headerHeight + ev.rowStart * rowHeight;\r\n      const height = ev.rowSpan * rowHeight;\r\n\r\n      const block = document.createElement(\"div\");\r\n      block.className = \"schedule-entry-float\";\r\n\r\n      // inset by borders so the block sits inside the cell gridlines\r\n      block.style.left = `${left + borderLeft}px`;\r\n      block.style.top = `${top + borderTop}px`;\r\n      block.style.width = `${dayColWidth - borderX}px`;\r\n      block.style.height = `${height - borderY}px`;\r\n\r\n      // overlap layer (red rectangles go here)\r\n      const overlapLayer = document.createElement(\"div\");\r\n      overlapLayer.className = \"schedule-entry-overlap-layer\";\r\n      block.appendChild(overlapLayer);\r\n\r\n      // text wrapper (MUST be above overlap layer)\r\n      const text = document.createElement(\"div\");\r\n      text.className = \"schedule-entry-text\";\r\n      const title = ev.code || ev.title;\r\n      const titleLabel = ev.label ? `${title} ${ev.label}` : title;\r\n      text.innerHTML = `\r\n        <div class=\"schedule-entry-title\">${titleLabel}</div>\r\n        <div class=\"schedule-entry-time\">${ev.timeLabel}</div>\r\n      `;\r\n      block.appendChild(text);\r\n\r\n      overlay.appendChild(block);\r\n\r\n      placedBlocks.push({\r\n        el: block,\r\n        day,\r\n        ev,\r\n        rect: rectFromBlock(block),\r\n        overlapLayerEl: overlapLayer,\r\n        overlaps: [],\r\n        textEl: text,\r\n      });\r\n    });\r\n  });\r\n\r\n  debug.log(\"Rendered overlay blocks:\", placedBlocks);\r\n}\r\n\r\nexport function renderSchedule(ctx, courses, semester) {\r\n  // pick the container in your panel where the schedule should render\r\n  const host =\r\n    ctx?.scheduleRoot ||\r\n    ctx?.schedulePanel ||\r\n    ctx?.scheduleContainer ||\r\n    ctx?.scheduleView ||\r\n    ctx?.schedule;\r\n\r\n  if (!host) {\r\n    debug.warn(\"renderSchedule: no schedule host found on ctx\");\r\n    return;\r\n  }\r\n\r\n  const eventsByDay = buildDayEvents(courses || [], semester);\r\n  const groupedByDay = addConflicts(eventsByDay);\r\n  const conflicts = getConflictSummaries(groupedByDay);\r\n\r\n  host.innerHTML = \"\";\r\n  const tableWrap = buildScheduleTable();\r\n  host.appendChild(tableWrap);\r\n\r\n  renderOverlayBlocks(tableWrap, eventsByDay, groupedByDay);\r\n  updateConflictFooter(ctx, conflicts);\r\n}\r\n","import { STATE } from \"../core/state\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"export-ics\");\r\n\r\n// calendar timezone for DTSTART/DTEND (local class times) and RRULE UNTIL (UTC \"Z\" per spec)\r\nconst TZID = \"America/Vancouver\";\r\n\r\n// converts a Date object into this format: YYYYMMDDTHHMMSSZ\r\nconst formatDateTimeUTC = (date) => {\r\n  const y = date.getUTCFullYear();\r\n  const m = pad(date.getUTCMonth() + 1);\r\n  const d = pad(date.getUTCDate());\r\n  const hh = pad(date.getUTCHours());\r\n  const mm = pad(date.getUTCMinutes());\r\n  const ss = pad(date.getUTCSeconds());\r\n  debug.log(\"Formatting UTC Date:\", { y, m, d, hh, mm, ss });\r\n  return `${y}${m}${d}T${hh}${mm}${ss}Z`;\r\n};\r\n\r\n// maps ui's day labels to iCalendar day codes\r\nconst DAY_CODES = {\r\n  Mon: \"MO\",\r\n  Tue: \"TU\",\r\n  Wed: \"WE\",\r\n  Thu: \"TH\",\r\n  Fri: \"FR\",\r\n  Sat: \"SA\",\r\n  Sun: \"SU\",\r\n};\r\n\r\n// used to extract dates, times, and days from a meeting line string\r\nconst date_range_REGEX = /(\\d{4}-\\d{2}-\\d{2})\\s*-\\s*(\\d{4}-\\d{2}-\\d{2})/;\r\nconst time_range_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?\\s*-\\s*(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i;\r\nconst days_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\n\r\n// forces numbers to two digits\r\nconst padNumbers = (value) => String(value).padStart(2, \"0\");\r\n\r\n// ICS date format: YYYYMMDD\r\nconst formatDate = (date) => {\r\n  const year = date.getFullYear();\r\n  const month = padNumbers(date.getMonth() + 1);\r\n  const day = padNumbers(date.getDate());\r\n  debug.log(\"Formatted Date:\", { year, month, day });\r\n  return `${year}${month}${day}`;\r\n};\r\n\r\n// ICS datetime format (local): YYYYMMDDTHHMMSS\r\nconst formatDateTime = (date) => {\r\n  const datePart = formatDate(date);\r\n  const hours = padNumbers(date.getHours());\r\n  const minutes = padNumbers(date.getMinutes());\r\n\r\n  debug.log(\"Formatted DateTime:\", { datePart, hours, minutes });\r\n  return `${datePart}T${hours}${minutes}00`;\r\n};\r\n\r\n// “p” adds 12, unless it’s 12pm already, “a” turns 12am into 0\r\n// eg. parseTime(\"11\",\"30\",\"p\") -> { hours: 23, minutes: 30 }\r\nconst parseTime = (hoursToken, minutesToken, periodToken) => {\r\n  let hours = Number.parseInt(hoursToken, 10);\r\n  const minutes = Number.parseInt(minutesToken, 10);\r\n  const period = periodToken.toLowerCase();\r\n\r\n  debug.log(\"Parsing Time:\", { hours, minutes, period });\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return { hours, minutes };\r\n};\r\n\r\n// parses meeting line into structured data\r\nconst parseMeetingLine = (line) => {\r\n  const dateMatch = String(line || \"\").match(date_range_REGEX);\r\n  const timeMatch = String(line || \"\").match(time_range_REGEX);\r\n  const days = String(line || \"\").match(days_REGEX) || [];\r\n\r\n  if (!dateMatch || !timeMatch || !days.length) return null;\r\n\r\n  debug.log(\"Parsed Meeting Line:\", { dateMatch, timeMatch, days });\r\n\r\n  const startDate = dateMatch[1];\r\n  const endDate = dateMatch[2];\r\n\r\n  const startTime = parseTime(timeMatch[1], timeMatch[2], timeMatch[3]);\r\n  const endTime = parseTime(timeMatch[4], timeMatch[5], timeMatch[6]);\r\n\r\n  const uniqueDays = [...new Set(days.map((day) => DAY_CODES[day]).filter(Boolean))];\r\n\r\n  return {\r\n    startDate,\r\n    endDate,\r\n    days: uniqueDays,\r\n    startTime,\r\n    endTime,\r\n  };\r\n};\r\n\r\n// finds location from meeting line\r\nconst extractLocation = (line) => {\r\n  const parts = String(line || \"\")\r\n    .split(\"|\")\r\n    .map((part) => part.trim())\r\n    .filter(Boolean);\r\n\r\n  const locationPart = parts.find((part) => /\\([A-Z]{2,}\\)/.test(part));\r\n  if (locationPart) return locationPart;\r\n\r\n  const onlinePart = parts.find((part) => /online/i.test(part));\r\n  if (onlinePart) return onlinePart;\r\n\r\n  return \"\";\r\n};\r\n\r\n// finds the first calendar date on/after startDate that matches one of the meeting days\r\nconst findFirstValidDate = (startDate, dayCodes) => {\r\n  const start = new Date(`${startDate}T00:00:00`);\r\n\r\n  for (let offset = 0; offset < 7; offset += 1) {\r\n    const date = new Date(start);\r\n    date.setDate(start.getDate() + offset);\r\n    const code = Object.values(DAY_CODES)[date.getDay() === 0 ? 6 : date.getDay() - 1];\r\n    if (dayCodes.includes(code)) return date;\r\n  }\r\n\r\n  return start;\r\n};\r\n\r\n// builds an event object from course and meeting line data\r\nconst buildClassEvent = (course, line) => {\r\n  const parsed = parseMeetingLine(line);\r\n  if (!parsed) return null;\r\n\r\n  const firstDate = findFirstValidDate(parsed.startDate, parsed.days);\r\n  const startDate = new Date(firstDate);\r\n  startDate.setHours(parsed.startTime.hours, parsed.startTime.minutes, 0, 0);\r\n\r\n  const endDate = new Date(firstDate);\r\n  endDate.setHours(parsed.endTime.hours, parsed.endTime.minutes, 0, 0);\r\n\r\n  const summaryParts = [course.code, course.title].filter(Boolean);\r\n  const descriptionLines = [\r\n    course.title ? `Title: ${course.title}` : null,\r\n    course.code ? `Code: ${course.code}` : null,\r\n    course.section_number ? `Section: ${course.section_number}` : null,\r\n    course.instructor ? `Instructor: ${course.instructor}` : null,\r\n    course.instructionalFormat ? `Format: ${course.instructionalFormat}` : null,\r\n    course.meeting ? `Meeting: ${course.meeting}` : null,\r\n  ].filter(Boolean);\r\n\r\n  const untilLocal = new Date(`${parsed.endDate}T23:59:59`);\r\n  const untilDate = formatDateTimeUTC(untilLocal);\r\n\r\n  debug.log(\"Built Class Event:\", { course, parsed, startDate, endDate, summaryParts, descriptionLines, untilDate });\r\n\r\n  return {\r\n    uid: `${course.code || \"course\"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,\r\n    summary: summaryParts.join(\" - \") || \"Scheduled Course\",\r\n    description: descriptionLines.join(\"\\\\n\"),\r\n    location: extractLocation(line),\r\n    dtstart: formatDateTime(startDate),\r\n    dtend: formatDateTime(endDate),\r\n    rrule: `FREQ=WEEKLY;BYDAY=${parsed.days.join(\",\")};UNTIL=${untilDate}`,\r\n  };\r\n};\r\n\r\n// loops through every course in the schedule and builds the full ICS file\r\nconst buildICSFile = (courses) => {\r\n  const events = [];\r\n\r\n  courses.forEach((course) => {\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n    lines.forEach((line) => {\r\n      const event = buildClassEvent(course, line);\r\n      if (event) events.push(event);\r\n    });\r\n  });\r\n\r\n  const lines = [\r\n    \"BEGIN:VCALENDAR\",\r\n    \"VERSION:2.0\",\r\n    \"PRODID:-//Workday Extension//Schedule Export//EN\",\r\n    \"CALSCALE:GREGORIAN\",\r\n    `X-WR-TIMEZONE:${TZID}`,\r\n  ];\r\n\r\n  events.forEach((event) => {\r\n    lines.push(\"BEGIN:VEVENT\");\r\n    lines.push(`UID:${event.uid}`);\r\n    lines.push(`SUMMARY:${event.summary}`);\r\n    if (event.description) lines.push(`DESCRIPTION:${event.description}`);\r\n    if (event.location) lines.push(`LOCATION:${event.location}`);\r\n    lines.push(`DTSTART;TZID=${TZID}:${event.dtstart}`);\r\n    lines.push(`DTEND;TZID=${TZID}:${event.dtend}`);\r\n    lines.push(`RRULE:${event.rrule}`);\r\n    lines.push(\"END:VEVENT\");\r\n  });\r\n\r\n  lines.push(\"END:VCALENDAR\");\r\n  debug.log(\"ICS File Generated:\", lines);\r\n  return lines.join(\"\\r\\n\");\r\n};\r\n\r\n// generates the ICS string from the current filtered courses, wraps it in a Blob (file-like object)\r\n// creates a temporary URL for it and a hidden <a> then “clicks” it to download\r\n// cleans up the URL + anchor afterward\r\nexport function exportICS() {\r\n  const ics = buildICSFile(STATE.filtered || []);\r\n  const blob = new Blob([ics], { type: \"text/calendar;charset=utf-8\" });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = \"workday-schedule.ics\";\r\n  document.body.appendChild(a);\r\n  a.click();\r\n\r\n  debug.log(\"Download Triggered for ICS file\");\r\n\r\n  setTimeout(() => {\r\n    URL.revokeObjectURL(url);\r\n    a.remove();\r\n  }, 100);\r\n}\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"scheduleStorage\");\r\n\r\nconst STORAGE_KEY = \"wdSavedSchedules\";\r\nconst MAX_SCHEDULES = 6;\r\n\r\nconst cloneCourses = (courses) => {\r\n  if (typeof structuredClone === \"function\") {\r\n    return structuredClone(courses);\r\n  }\r\n  return JSON.parse(JSON.stringify(courses || []));\r\n};\r\n\r\nconst sanitizeSchedules = (schedules) => {\r\n  if (!Array.isArray(schedules)) return [];\r\n  return schedules\r\n    .filter((schedule) => schedule && Array.isArray(schedule.courses))\r\n    .map((schedule) => ({\r\n      id: schedule.id,\r\n      name: schedule.name || \"Untitled\",\r\n      savedAt: schedule.savedAt || new Date().toISOString(),\r\n      courses: schedule.courses,\r\n    }));\r\n};\r\n\r\nconst useChromeStorage = typeof chrome !== \"undefined\" && chrome.storage && chrome.storage.local;\r\n\r\nexport async function loadSavedSchedules() {\r\n  debug.log(\"Loading saved schedules...\");\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.get([STORAGE_KEY], (result) => {\r\n        const sanitized = sanitizeSchedules(result?.[STORAGE_KEY] || []);\r\n        debug.log(\"Schedules loaded from Chrome Storage:\", sanitized);\r\n        resolve(sanitized);\r\n      });\r\n    });\r\n  }\r\n\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) {\r\n      debug.log(\"No schedules found in localStorage.\");\r\n      return [];\r\n    }\r\n    const sanitized = sanitizeSchedules(JSON.parse(raw));\r\n    debug.log(\"Schedules loaded from localStorage:\", sanitized);\r\n    return sanitized;\r\n  } catch (error) {\r\n    console.warn(\"[WD] Failed to load saved schedules\", error);\r\n    debug.error(\"Error loading schedules from localStorage:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function persistSavedSchedules(schedules) {\r\n  const sanitized = sanitizeSchedules(schedules);\r\n  debug.log(\"Persisting saved schedules:\", sanitized);\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.set({ [STORAGE_KEY]: sanitized }, () => {\r\n        debug.log(\"Schedules saved to Chrome Storage.\");\r\n        resolve();\r\n      });\r\n    });\r\n  }\r\n\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(sanitized));\r\n    debug.log(\"Schedules saved to localStorage.\");\r\n  } catch (error) {\r\n    console.warn(\"[WD] Failed to save schedules\", error);\r\n    debug.error(\"Error saving schedules to localStorage:\", error);\r\n  }\r\n}\r\n\r\nexport function createScheduleSnapshot(name, courses) {\r\n  const id =\r\n    typeof crypto !== \"undefined\" && crypto.randomUUID\r\n      ? crypto.randomUUID()\r\n      : `${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n\r\n  const snapshot = {\r\n    id,\r\n    name: name || \"Untitled\",\r\n    savedAt: new Date().toISOString(),\r\n    courses: cloneCourses(courses || []),\r\n  };\r\n  debug.log(\"Created schedule snapshot:\", snapshot);\r\n  return snapshot;\r\n}\r\n\r\nexport function formatScheduleMeta(schedule) {\r\n  const count = schedule.courses?.length || 0;\r\n  const savedDate = new Date(schedule.savedAt);\r\n  const dateLabel = Number.isNaN(savedDate.getTime())\r\n    ? schedule.savedAt\r\n    : savedDate.toLocaleDateString(undefined, {\r\n        year: \"numeric\",\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n      });\r\n  return `${count} courses · Saved ${dateLabel}`;\r\n}\r\n\r\nexport function renderSavedSchedules(ctx, schedules) {\r\n  debug.log(\"Rendering saved schedules:\", schedules);\r\n  if (!ctx.savedMenu) return;\r\n  ctx.savedMenu.innerHTML = \"\";\r\n\r\n  if (!schedules.length) {\r\n    const empty = document.createElement(\"div\");\r\n    empty.className = \"schedule-saved-empty\";\r\n    empty.textContent = \"No saved schedules yet.\";\r\n    ctx.savedMenu.appendChild(empty);\r\n    debug.log(\"No saved schedules to render.\");\r\n    return;\r\n  }\r\n\r\n  schedules.forEach((schedule) => {\r\n    const card = document.createElement(\"div\");\r\n    card.className = \"schedule-saved-card\";\r\n    card.dataset.id = schedule.id;\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"schedule-saved-card-header\";\r\n\r\n    const info = document.createElement(\"div\");\r\n    const title = document.createElement(\"div\");\r\n    title.className = \"schedule-saved-title\";\r\n    title.textContent = schedule.name;\r\n\r\n    const meta = document.createElement(\"div\");\r\n    meta.className = \"schedule-saved-meta\";\r\n    meta.textContent = formatScheduleMeta(schedule);\r\n\r\n    info.appendChild(title);\r\n    info.appendChild(meta);\r\n    header.appendChild(info);\r\n\r\n    const actions = document.createElement(\"div\");\r\n    actions.className = \"schedule-saved-actions\";\r\n\r\n    const loadButton = document.createElement(\"button\");\r\n    loadButton.type = \"button\";\r\n    loadButton.className = \"schedule-saved-action\";\r\n    loadButton.dataset.action = \"load\";\r\n    loadButton.textContent = \"Load\";\r\n\r\n    const deleteButton = document.createElement(\"button\");\r\n    deleteButton.type = \"button\";\r\n    deleteButton.className = \"schedule-saved-action delete\";\r\n    deleteButton.dataset.action = \"delete\";\r\n    deleteButton.textContent = \"Delete\";\r\n\r\n    actions.appendChild(loadButton);\r\n    actions.appendChild(deleteButton);\r\n\r\n    card.appendChild(header);\r\n    card.appendChild(actions);\r\n    ctx.savedMenu.appendChild(card);\r\n    debug.log(\"Rendered schedule card:\", schedule);\r\n  });\r\n}\r\n\r\nexport function canSaveMoreSchedules(schedules) {\r\n  debug.log(\"Checking if more schedules can be saved. Current count:\", schedules.length);\r\n  return schedules.length < MAX_SCHEDULES;\r\n}\r\n\r\nexport function getMaxScheduleCount() {\r\n  return MAX_SCHEDULES;\r\n}\r\n","import { on, debounce } from \"./utilities/dom.js\";\r\nimport { STATE } from \"./core/state.js\";\r\nimport { ensureMount } from \"./utilities/shadowMount.js\";\r\nimport { loadPanel } from \"./panel/loadPanel.js\";\r\nimport { extractAllCourses } from \"./extraction/courseExtraction.js\";\r\nimport { applySearchFilter, sortBy, wireSorting } from \"./panel/panelInteractions.js\";\r\nimport { renderRows } from \"./panel/renderRows.js\";\r\nimport { renderSchedule } from \"./panel/scheduleView.js\";\r\nimport { exportICS } from \"./export-logic/export-ics.js\";\r\nimport {\r\n  canSaveMoreSchedules,\r\n  createScheduleSnapshot,\r\n  getMaxScheduleCount,\r\n  loadSavedSchedules,\r\n  persistSavedSchedules,\r\n  renderSavedSchedules,\r\n} from \"./panel/scheduleStorage.js\";\r\nimport { debugFor } from \"./utilities/debugTool.js\";\r\nconst debug = debugFor(\"content\");\r\n\r\n(() => {\r\n  async function boot() {\r\n    const shadow = ensureMount();\r\n    const ctx = await loadPanel(shadow);\r\n    debug.log(\"Loaded panel context:\", ctx);\r\n    ctx.button.classList.toggle(\"is-collapsed\", ctx.widget.classList.contains(\"is-hidden\"));\r\n    const updateSchedule = () => {\r\n      renderSchedule(ctx, STATE.filtered, STATE.view.semester);\r\n      debug.log(\"Schedule updated with filtered data:\", STATE.filtered);\r\n    };\r\n\r\n    const setActivePanel = (panel) => {\r\n      STATE.view.panel = panel;\r\n      debug.log(\"Panel state changed:\", panel);\r\n      ctx.panels.forEach((el) => {\r\n        el.classList.toggle(\"is-active\", el.dataset.panel === panel);\r\n      });\r\n      ctx.tabButtons.forEach((btn) => {\r\n        btn.classList.toggle(\"is-active\", btn.dataset.panel === panel);\r\n      });\r\n      ctx.widget.classList.toggle(\"is-schedule-view\", panel === \"schedule\");\r\n      ctx.widget.classList.toggle(\"is-settings-view\", panel === \"settings\");\r\n      ctx.widget.classList.toggle(\"is-help-view\", panel === \"help\");\r\n    };\r\n\r\n    const toggleWidget = () => {\r\n      ctx.widget.classList.toggle(\"is-hidden\");\r\n      debug.log(\"Widget visibility toggled:\", ctx.widget.classList.contains(\"is-hidden\"));\r\n      ctx.button.classList.toggle(\"is-collapsed\", ctx.widget.classList.contains(\"is-hidden\"));\r\n    };\r\n\r\n    let resolveScheduleModal = null;\r\n    const closeScheduleModal = (value) => {\r\n      if (!ctx.saveModal) return;\r\n      ctx.saveModal.classList.add(\"is-hidden\");\r\n      ctx.saveModal.setAttribute(\"aria-hidden\", \"true\");\r\n\r\n      if (resolveScheduleModal) {\r\n        resolveScheduleModal(value);\r\n        resolveScheduleModal = null;\r\n      }\r\n      debug.log(\"Schedule modal closed with value:\", value);\r\n    };\r\n\r\n    const openScheduleModal = ({ title, message, confirmLabel = \"Save\", showInput = true, showCancel = true }) => {\r\n      if (!ctx.saveModal) return Promise.resolve(null);\r\n      ctx.saveModalTitle.textContent = title;\r\n      ctx.saveModalMessage.textContent = message;\r\n      ctx.saveModalConfirm.textContent = confirmLabel;\r\n      ctx.saveModalField.classList.toggle(\"is-hidden\", !showInput);\r\n      ctx.saveModalCancel.classList.toggle(\"is-hidden\", !showCancel);\r\n      ctx.saveModalInput.value = \"\";\r\n      ctx.saveModalInput.classList.remove(\"is-invalid\");\r\n      ctx.saveModal.classList.remove(\"is-hidden\");\r\n      ctx.saveModal.setAttribute(\"aria-hidden\", \"false\");\r\n      if (showInput) {\r\n        ctx.saveModalInput.focus();\r\n      } else {\r\n        ctx.saveModalConfirm.focus();\r\n      }\r\n      debug.log(\"Opened schedule modal with title:\", title);\r\n      return new Promise((resolve) => {\r\n        resolveScheduleModal = resolve;\r\n      });\r\n    };\r\n\r\n    if (ctx.saveModal) {\r\n      on(ctx.saveModal, \"click\", (event) => {\r\n        if (event.target === ctx.saveModal) {\r\n          closeScheduleModal(null);\r\n          return;\r\n        }\r\n        const action = event.target.closest(\"[data-action]\")?.dataset.action;\r\n        if (!action) return;\r\n        if (action === \"close\" || action === \"cancel\") {\r\n          closeScheduleModal(null);\r\n          return;\r\n        }\r\n        if (action === \"confirm\") {\r\n          if (!ctx.saveModalField.classList.contains(\"is-hidden\")) {\r\n            const value = ctx.saveModalInput.value.trim();\r\n            if (!value) {\r\n              ctx.saveModalInput.classList.add(\"is-invalid\");\r\n              ctx.saveModalInput.focus();\r\n              return;\r\n            }\r\n            closeScheduleModal(value);\r\n            return;\r\n          }\r\n          closeScheduleModal(true);\r\n        }\r\n      });\r\n\r\n      on(ctx.saveModalInput, \"input\", () => {\r\n        ctx.saveModalInput.classList.remove(\"is-invalid\");\r\n      });\r\n\r\n      on(ctx.saveModalInput, \"keydown\", (event) => {\r\n        if (event.key === \"Enter\") {\r\n          ctx.saveModalConfirm.click();\r\n        }\r\n      });\r\n\r\n      on(document, \"keydown\", (event) => {\r\n        if (event.key === \"Escape\" && ctx.saveModal && !ctx.saveModal.classList.contains(\"is-hidden\")) {\r\n          closeScheduleModal(null);\r\n        }\r\n      });\r\n    }\r\n\r\n    ctx.tabButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        setActivePanel(btn.dataset.panel);\r\n        if (btn.dataset.panel === \"schedule\") updateSchedule();\r\n      });\r\n    });\r\n\r\n    ctx.semesterButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        STATE.view.semester = btn.dataset.semester;\r\n        debug.log(\"Semester state changed:\", STATE.view.semester);\r\n        ctx.semesterButtons.forEach((semesterBtn) => {\r\n          semesterBtn.classList.toggle(\"is-active\", semesterBtn.dataset.semester === STATE.view.semester);\r\n        });\r\n        updateSchedule();\r\n      });\r\n    });\r\n\r\n    on(ctx.button, \"click\", toggleWidget);\r\n\r\n    const setExportOpen = (isOpen) => {\r\n      if (!ctx.exportDropdown || !ctx.exportButton) return;\r\n      ctx.exportDropdown.classList.toggle(\"is-open\", isOpen);\r\n      ctx.exportButton.setAttribute(\"aria-expanded\", String(isOpen));\r\n      debug.log(\"Export dropdown state changed:\", isOpen);\r\n    };\r\n\r\n    on(ctx.exportButton, \"click\", () => {\r\n      const isOpen = ctx.exportDropdown?.classList.contains(\"is-open\");\r\n      setExportOpen(!isOpen);\r\n    });\r\n\r\n    on(document, \"click\", (event) => {\r\n      if (!ctx.exportDropdown?.classList.contains(\"is-open\")) return;\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.exportDropdown)) return;\r\n      setExportOpen(false);\r\n    });\r\n\r\n    // Close Saved Schedules dropdown if user clicks outside\r\n    on(document, \"click\", (event) => {\r\n      if (!ctx.savedDropdown?.open) return;\r\n\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.savedDropdown)) return;\r\n\r\n      ctx.savedDropdown.open = false;\r\n    });\r\n\r\n    on(ctx.root, \"click\", (event) => {\r\n      if (!ctx.exportDropdown?.open) return;\r\n\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.exportDropdown)) return;\r\n\r\n      ctx.exportDropdown.open = false;\r\n    });\r\n\r\n    chrome.runtime.onMessage.addListener((message) => {\r\n      if (message?.type === \"TOGGLE_WIDGET\") {\r\n        toggleWidget();\r\n        debug.log(\"Widget toggled by runtime message\");\r\n      }\r\n    });\r\n\r\n    on(ctx.refresh, \"click\", async () => {\r\n      STATE.courses = await extractAllCourses();\r\n      applySearchFilter(ctx.search.value);\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n      debug.log(\"Courses refreshed and schedule updated\");\r\n    });\r\n\r\n    const handleExport = async (type) => {\r\n      if (type === \"ics\") {\r\n        exportICS();\r\n        debug.log(\"Export triggered for ICS file\");\r\n      }\r\n    };\r\n\r\n    on(ctx.exportMenu, \"click\", async (event) => {\r\n      const action = event.target.closest(\"[data-export]\");\r\n      if (!action) return;\r\n      setExportOpen(false);\r\n      await handleExport(action.dataset.export);\r\n    });\r\n\r\n    on(ctx.saveScheduleBtn, \"click\", async () => {\r\n      if (!canSaveMoreSchedules(STATE.savedSchedules)) {\r\n        await openScheduleModal({\r\n          title: \"Schedule limit reached\",\r\n          message: `You can only save up to ${getMaxScheduleCount()} schedules. Delete one to save another.`,\r\n          confirmLabel: \"Got it\",\r\n          showInput: false,\r\n          showCancel: false,\r\n        });\r\n        return;\r\n      }\r\n\r\n      const name = await openScheduleModal({\r\n        title: \"Save schedule\",\r\n        message: \"Name this schedule so you can find it later.\",\r\n        confirmLabel: \"Save\",\r\n        showInput: true,\r\n        showCancel: true,\r\n      });\r\n      if (!name) return;\r\n\r\n      const snapshot = createScheduleSnapshot(name, STATE.filtered);\r\n      STATE.savedSchedules = [snapshot, ...STATE.savedSchedules];\r\n      await persistSavedSchedules(STATE.savedSchedules);\r\n      renderSavedSchedules(ctx, STATE.savedSchedules);\r\n      if (ctx.savedDropdown) ctx.savedDropdown.open = true;\r\n    });\r\n\r\n    on(ctx.savedMenu, \"click\", async (event) => {\r\n      const actionButton = event.target.closest(\"[data-action]\");\r\n      if (!actionButton) return;\r\n\r\n      const card = actionButton.closest(\".schedule-saved-card\");\r\n      const scheduleId = card?.dataset.id;\r\n      if (!scheduleId) return;\r\n\r\n      if (actionButton.dataset.action === \"delete\") {\r\n        const selected = STATE.savedSchedules.find((schedule) => schedule.id === scheduleId);\r\n        if (!selected) return;\r\n        const confirmed = await openScheduleModal({\r\n          title: \"Permanently Delete Schedule?\",\r\n          message: `This action will permanently delete \"${selected.name}\".`,\r\n          confirmLabel: \"Delete\",\r\n          showInput: false,\r\n          showCancel: true,\r\n        });\r\n        if (!confirmed) return;\r\n        STATE.savedSchedules = STATE.savedSchedules.filter((schedule) => schedule.id !== scheduleId);\r\n        await persistSavedSchedules(STATE.savedSchedules);\r\n        renderSavedSchedules(ctx, STATE.savedSchedules);\r\n        return;\r\n      }\r\n\r\n      const selected = STATE.savedSchedules.find((schedule) => schedule.id === scheduleId);\r\n      if (!selected) return;\r\n\r\n      STATE.courses = [...selected.courses];\r\n      STATE.filtered = [...selected.courses];\r\n      ctx.search.value = \"\";\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n      setActivePanel(\"schedule\");\r\n      if (ctx.savedDropdown) ctx.savedDropdown.open = false;\r\n    });\r\n\r\n    on(ctx.settingsBtn, \"click\", () => {\r\n      ctx.widget.classList.remove(\"is-hidden\");\r\n      ctx.button.classList.remove(\"is-collapsed\");\r\n      setActivePanel(\"settings\");\r\n    });\r\n\r\n    on(ctx.helpBtn, \"click\", () => {\r\n      ctx.widget.classList.remove(\"is-hidden\");\r\n      ctx.button.classList.remove(\"is-collapsed\");\r\n      setActivePanel(\"help\");\r\n    });\r\n\r\n    on(\r\n      ctx.search,\r\n      \"input\",\r\n      debounce(() => {\r\n        applySearchFilter(ctx.search.value);\r\n        sortBy(STATE.sort.key || \"code\");\r\n        renderRows(ctx, STATE.filtered);\r\n        updateSchedule();\r\n      }, 100)\r\n    );\r\n\r\n    wireSorting(ctx);\r\n\r\n    STATE.savedSchedules = await loadSavedSchedules();\r\n    renderSavedSchedules(ctx, STATE.savedSchedules);\r\n\r\n    STATE.courses = await extractAllCourses();\r\n    STATE.filtered = [...STATE.courses];\r\n    sortBy(\"code\");\r\n    renderRows(ctx, STATE.filtered);\r\n    updateSchedule();\r\n    setActivePanel(STATE.view.panel);\r\n  }\r\n\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();\r\n"],"names":["debug","debugFor","$$","root","sel","on","el","ev","fn","opts","debounce","ms","t","a","STATE","EXT_ID","ensureMount","host","loadPanel","shadow","htmlUrl","cssFiles","html","cssParts","r","file","css","style","link","wrap","elements","normalizeText","s","getHeaderKey","m","buildHeaderMaps","gridRoot","headerEls","headers","pos","text","getHeaderText","key","h","findHeader","needles","ns","hit","n","KEYS","colMap","posMap","headerEl","btn","parseSectionLinkString","input","str","baseCode","rest","parts","p","sectionToken","parsedTitle","result","guessClassCode","out","extractMeetingLinesFromCell","meetingEl","lines","DATE_RE","TIME_RE","DAY_RE","filtered","extractMeetingLinesFromRow","rowEl","formatMeetingLineForPanel","line","raw","dayPart","timePart","buildingPart","floorMatch","roomMatch","floorPart","roomPart","formatted","normalizeMeetingPatternsText","normalized","extractStartDate","match","extractInstructorNamesFromCell","instructorEl","prompt","txt","onlineClassCheck","deliveryModeCellEl","prompts","matched","label","findingTables","roots","headerText","looksRight","rows","extractAllCourses","found","courses","headerMaps","row","c","extractFromRow","unique","findUniqueCourses","list","seen","k","cells","allText","getCellKey","cell","cellByCol","getCellEl","keyName","readByKey","col","allPromptOptions","sectionLinkEl","sectionLinkString","titleCell","codeCell","sectCell","meetingCell","instructionalFormatCell","startDateCell","code","title","section_number","parsed","labLike","seminarLike","discussionLike","isLab","isSeminar","isDiscussion","instructor","meeting","meetingCol","meetingObj","startDate","firstLine","deliveryModeCell","isOnlineDelivery","instructionalFormat","escHTML","cleanLines","cleaned","renderRows","ctx","frag","tr","badge","main","sub","applySearchFilter","q","sortBy","dir","collator","b","wireSorting","headCells","th","DAYS","START_HOUR","END_HOUR","SLOT_MINUTES","SLOTS","DAY_REGEX","TIME_REGEX","SEMESTER_MONTHS","parseTimeToken","token","hours","minutes","period","parseMeetingLine","days","timeTokens","startMinutes","endMinutes","getSemester","month","semester","clampToGrid","min","max","snapDownToSlot","snapUpToSlot","slotIndexOf","buildDayEvents","eventsByDay","d","eventId","course","startMin","endMin","startIdx","endIdx","rowSpan","day","addConflicts","groupedByDay","events","groups","current","currentKey","active","getConflictSummaries","conflicts","group","codes","updateConflictFooter","conflictList","formatSlotLabel","h24","hh","mm","buildScheduleTable","table","thead","headRow","tbody","timeTd","td","inner","overlay","rectFromBlock","renderOverlayBlocks","firstBodyRow","firstDayCell","timeTh","timeColWidth","dayColWidth","headerHeight","rowHeight","cellStyles","borderLeft","borderTop","borderRight","borderBottom","borderX","borderY","placedBlocks","dayIndex","left","top","height","block","overlapLayer","titleLabel","renderSchedule","tableWrap","TZID","formatDateTimeUTC","date","y","ss","DAY_CODES","date_range_REGEX","time_range_REGEX","days_REGEX","padNumbers","value","formatDate","year","formatDateTime","datePart","parseTime","hoursToken","minutesToken","periodToken","dateMatch","timeMatch","endDate","startTime","endTime","uniqueDays","extractLocation","part","locationPart","onlinePart","findFirstValidDate","dayCodes","start","offset","buildClassEvent","firstDate","summaryParts","descriptionLines","untilLocal","untilDate","buildICSFile","event","exportICS","ics","blob","url","STORAGE_KEY","MAX_SCHEDULES","cloneCourses","sanitizeSchedules","schedules","schedule","useChromeStorage","loadSavedSchedules","resolve","sanitized","error","persistSavedSchedules","createScheduleSnapshot","name","snapshot","formatScheduleMeta","count","savedDate","dateLabel","renderSavedSchedules","empty","card","header","info","meta","actions","loadButton","deleteButton","canSaveMoreSchedules","getMaxScheduleCount","boot","updateSchedule","setActivePanel","panel","toggleWidget","resolveScheduleModal","closeScheduleModal","openScheduleModal","message","confirmLabel","showInput","showCancel","action","semesterBtn","setExportOpen","isOpen","handleExport","type","actionButton","scheduleId","selected"],"mappings":"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"}