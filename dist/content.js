(function(){"use strict";const A=(t,e)=>Array.from(t.querySelectorAll(e)),x=(t,e,n,r)=>t&&t.addEventListener(e,n,r),V=(t,e=300)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>t(...r),e)}},u={courses:[],filtered:[],sort:{key:null,dir:1}},I="wd-courses-capture";function X(){let t=document.getElementById(I);return t||(t=document.createElement("div"),t.id=I,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function J(t){const e=chrome.runtime.getURL("src/panel.html"),n=chrome.runtime.getURL("src/panel.css"),[r,i]=await Promise.all([fetch(e).then(s=>s.text()),fetch(n).then(s=>s.text())]);t.innerHTML="";const c=document.createElement("style");c.textContent=i,t.appendChild(c);const o=document.createElement("div");o.innerHTML=r,t.appendChild(o);const a=t.querySelector("#wd-logo");return a&&(a.src=chrome.runtime.getURL("src/W.svg")),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead")}}const E=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function Q(t){const n=A(t,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map((a,s)=>{const d=O(a),m=_(a)??s+1;return{el:a,pos:s,col:m,text:d,norm:E(d)}}).filter(a=>a.text),r=a=>{const s=a.map(E);let d=n.find(m=>s.includes(m.norm));return d||(d=n.find(m=>s.some(y=>m.norm.includes(y))),d||null)},i={instructor:["instructor","instructors"],meeting:["meeting","meeting patterns","meeting pattern"],deliveryMode:["delivery mode","mode","modality"],title:["title","course listing","course name","course"],code:["class code","code","course code","course id"],section:["section","sect","sec"],instructionalFormat:["instructional format","format","component","type","status","registration status"]},c={},o={};for(const[a,s]of Object.entries(i)){const d=r(s);c[a]=d?d.col:null,o[a]=d?d.pos:-1}return{colMap:c,posMap:o}}function O(t){if(!t)return"";const e=t.querySelector("h4");return(t.getAttribute("title")||e&&e.textContent||t.textContent||"").trim()}function _(t){if(!t)return null;const e=t.getAttribute&&t.getAttribute("aria-colindex");if(e&&/^\d+$/.test(e))return parseInt(e,10);let n=t;for(let r=0;r<5&&n;r++){const i=n.getAttribute&&n.getAttribute("aria-colindex");if(i&&/^\d+$/.test(i))return parseInt(i,10);n=n.parentElement}return null}function tt(t){let e=String(t||"").replace(/\u00A0/g," ").trim();if(!e)return null;e=e.replace(/\s*\n\s*/g," ").trim();const n=e.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!n)return null;const r=n[1].trim(),c=n[2].trim().split(/\s*[-–—]\s*/).map(s=>s.trim()).filter(Boolean);let o="",a="";return o=c[0],a=c.slice(1).join(" - ").trim(),a=a.replace(/\s*:\s*/g,`:
`),{code:r,section_number:o,title:a,full:e}}function $(t){const e=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return e?e[0].replace(/\s+/g," ").trim():""}function et(t){if(!t)return console.log("extractMeetingLinesFromCell failed 1"),[];let n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(o=>(o.getAttribute("aria-label")||"").trim()).filter(Boolean);n.length||(n=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(a=>(a.getAttribute("data-automation-label")||a.getAttribute("title")||a.textContent||"").trim()).filter(Boolean)),n.length||(n=String(t.innerText||"").split(`
`).map(o=>o.trim()).filter(Boolean));const r=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,i=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(o=>r.test(o)&&i.test(o)&&c.test(o))}function nt(t){if(!t)return[];const n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(o=>(o.getAttribute("aria-label")||"").trim()).filter(Boolean),r=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,i=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(o=>r.test(o)&&i.test(o)&&c.test(o))}function rt(t){const e=String(t||"").split("|").map(s=>s.trim()).filter(Boolean),r=(e.find(s=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(s))||"").split(/\s+/).join(" / "),i=e.find(s=>/\d{1,2}:\d{2}/.test(s)&&/-/.test(s))||"",c=e.find(s=>/\([A-Z]{2,}\)/.test(s))||"",o=e.find(s=>/^Floor:/i.test(s))||"",a=e.find(s=>/^Room:/i.test(s))||"";return{days:r,time:i,location:[c,o,a].filter(Boolean).join(" | ")}}function ot(t){return String(t||"").split(/\r?\n/).map(e=>e.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function j(t){if(!t)return"";const e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(o=>(o.getAttribute("aria-label")||"").trim()).filter(Boolean),n=o=>/^\d{4}-\d{2}-\d{2}$/.test(o)||/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/.test(o)||/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i.test(o)||/\b\d{1,2}:\d{2}\b/.test(o),r=e.filter(o=>!n(o));if(r.length)return r.join(", ");const i=t.querySelector('[data-automation-id="promptOption"]'),c=(i&&(i.getAttribute("data-automation-label")||i.getAttribute("title")||i.textContent)||t.textContent||"").trim();return n(c)?"":c}function it(t){if(!t)return!1;const e=(t.innerText||t.textContent||"").trim();return/online learning/i.test(e)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(r=>{const i=(r.getAttribute("data-automation-label")||r.getAttribute("title")||r.textContent||"").trim();return/online learning/i.test(i)})}function st(){const t=A(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const e of t){const r=A(e,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(o=>E(O(o)));if(!(r.some(o=>o.includes("section"))&&(r.some(o=>o.includes("instructor"))||r.some(o=>o.includes("meeting"))||r.some(o=>o.includes("instructional format"))||r.some(o=>o.includes("format"))||r.some(o=>o.includes("status")))))continue;const c=A(e,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(c.length)return{root:e,rows:c}}return null}async function q(){const t=st();let e=[];if(t){const n=Q(t.root);for(const r of t.rows){const i=ct(r,n);(i.code||i.title)&&Object.values(i).join("").trim()&&e.push(i)}}return lt(e)}function lt(t){const e=i=>[i.code,i.title,i.section_number].join("|").toLowerCase(),n=new Set,r=[];for(const i of t){const c=e(i);n.has(c)||(n.add(c),r.push(i))}return r}function ct(t,e){const{colMap:n,posMap:r}=e,i=A(t,"td, [role='gridcell']"),c=(t.innerText||"").trim(),o=new Map;i.forEach((l,f)=>{const g=_(l)??f+1;o.has(g)||o.set(g,l)});const a=l=>{const f=n[l];if(f!=null&&o.has(f))return o.get(f);const g=r[l];return g!=null&&g>=0&&g<i.length?i[g]:null},s=l=>{const f=n[l];if(f!=null&&o.has(f))return(o.get(f).innerText||"").trim();const g=r[l];return g!=null&&g>=0&&g<i.length?(i[g].innerText||"").trim():""},d=A(t,'[data-automation-id="promptOption"]');let m=null;for(const l of d){const f=l.getAttribute("data-automation-label")||l.getAttribute("title")||l.getAttribute("aria-label")||l.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(f)){m=l;break}}!m&&d.length>0&&(m=d[0]);const y=m&&(m.getAttribute("data-automation-label")||m.getAttribute("title")||m.getAttribute("aria-label")||m.textContent)||"",Z=s("title"),mt=s("code"),U=s("section"),W=s("meeting"),ft=s("instructor"),B=s("instructionalFormat");let w="",S=Z||"",z="";const v=tt(y);v&&(w=v.code,z=v.section_number,S=v.title),w||(w=$(mt)||$(Z)||$(c)||"");const C=l=>/\b(lab|laboratory|labratory)\b/i.test(String(l||"")),L=l=>/\bseminar\b/i.test(String(l||"")),G=C(B)||C(U)||C(S)||C(y)||C(c),N=L(B)||L(U)||L(S)||L(y)||L(c);let p="",gt=(()=>{const l=n.instructor;return l!=null&&o.has(l)?o.get(l):r.instructor!=null&&r.instructor>=0&&r.instructor<i.length?i[r.instructor]:null})();const Y=l=>/^\d{4}-\d{2}-\d{2}$/.test(String(l||"").trim()),K=l=>/^[A-Z][a-z]+(?: [A-Z][a-z]+)+$/.test(String(l||"").trim());if(G||N)p="N/A";else if(p=j(gt)||(ft||"").trim(),!p||Y(p))for(const l of i){const f=j(l)||(l.innerText||"").trim();if(K(f)){p=f;break}}let b;const F=n.meeting;let M=null;F!=null&&o.has(F)?M=o.get(F):r.meeting!=null&&r.meeting>=0&&r.meeting<i.length&&(M=i[r.meeting]);let R=M?et(M):[];R.length||(R=nt(t));let h={days:"",time:"",location:""};if(R.length){const l=R[0];h=rt(l)}else b=(W||"").trim();const pt=a("deliveryMode");it(pt)&&(h.location="Online"),h.days||h.time||h.location?(b=[h.days,h.time].filter(Boolean).join(" | "),h.location?b+=`
${h.location}`:b+=`
Online`):b=(W||"").trim();const bt=(B||"").trim();if(!S&&y){const l=y.indexOf(" - ");l>=0&&(S=y.slice(l+3).trim())}if(Y(p)&&K(b)){const l=p;p=b,b=l}return{code:w,title:S,section_number:z,instructor:p,meeting:ot(b),instructionalFormat:bt,isLab:G,isSeminar:N}}const D=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function T(t,e){t.tableBody.innerHTML="";const n=document.createDocumentFragment();e.forEach(r=>{const i=document.createElement("tr"),c=r.isLab?"[Laboratory]":r.isSeminar?"[Seminar]":"";i.innerHTML=`
      <td class="title">
        <div class="title-main">${r.title||""}</div>
        ${c?`<div class="muted">${c}</div>`:""}
      </td>
      <td class="code">${r.code||""}</td>
      <td class="sect">${(r.section_number||"").trim()}</td>
      <td class="instructor">${r.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const o=String(r.meeting||"").split(`
`),a=(o[0]||"").trim(),s=(o[1]||"").trim();return`
            ${a?`<span class="meeting-pill">${D(a)}</span>`:""}
            ${s?`<div class="meeting-sub">${D(s)}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${r.instructionalFormat||""}</td>
    `,n.appendChild(i)}),t.tableBody.appendChild(n)}function P(t){if(t=(t||"").trim().toLowerCase(),!t){u.filtered=[...u.courses];return}u.filtered=u.courses.filter(e=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(n=>(e[n]||"").toLowerCase().includes(t)))}function k(t){if(!t)return;const e=u.sort.key===t?-u.sort.dir:1;u.sort={key:t,dir:e};const n=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});u.filtered.sort((r,i)=>e*n.compare(r[t]||"",i[t]||""))}function at(t){const e=A(t.tableHead,"th[data-key]");e.forEach(n=>{x(n,"click",()=>{const r=n.getAttribute("data-key");k(r),T(t,u.filtered),e.forEach(i=>i.classList.remove("sorted-asc","sorted-desc")),n.classList.add(u.sort.dir===1?"sorted-asc":"sorted-desc")})})}const H=t=>{if(t==null)return"";const e=String(t);return/[",\n]/.test(e)?`"${e.replace(/"/g,'""')}"`:e},ut=(t,e)=>{const n=e.map(H).join(","),r=t.map(i=>e.map(c=>H(i[c]??"")).join(",")).join(`
`);return n+`
`+r};function dt(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],e=ut(u.filtered,t),n=new Blob([e],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download="captured-courses.csv",document.body.appendChild(i),i.click(),setTimeout(()=>{URL.revokeObjectURL(r),i.remove()},100)}(()=>{console.log("[WD] content script loaded");async function t(){const e=X(),n=await J(e);x(n.button,"click",()=>{n.widget.classList.toggle("is-hidden")}),x(n.refresh,"click",async()=>{u.courses=await q(),P(n.search.value),k(u.sort.key||"code"),T(n,u.filtered)}),x(n.exportBtn,"click",dt),x(n.search,"input",V(()=>{P(n.search.value),k(u.sort.key||"code"),T(n,u.filtered)},100)),at(n),u.courses=await q(),u.filtered=[...u.courses],k("code"),T(n,u.filtered)}document.readyState==="complete"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})()})();
//# sourceMappingURL=content.js.map
