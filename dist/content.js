(function(){"use strict";const A=(t,n)=>Array.from(t.querySelectorAll(n)),L=(t,n,e,r)=>t&&t.addEventListener(n,e,r),it=(t,n=300)=>{let e;return(...r)=>{clearTimeout(e),e=setTimeout(()=>t(...r),n)}},u={courses:[],filtered:[],sort:{key:null,dir:1},view:{panel:"list",term:"first"}},N="wd-courses-capture";function st(){let t=document.getElementById(N);return t||(t=document.createElement("div"),t.id=N,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function ct(t){const n=chrome.runtime.getURL("src/panel.html"),e=chrome.runtime.getURL("src/panel.css"),[r,o]=await Promise.all([fetch(n).then(l=>l.text()),fetch(e).then(l=>l.text())]);t.innerHTML="";const s=document.createElement("style");s.textContent=o,t.appendChild(s);const i=document.createElement("div");i.innerHTML=r,t.appendChild(i);const c=t.querySelector("#wd-logo");return c&&(c.src=chrome.runtime.getURL("src/W.svg")),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead"),tabButtons:t.querySelectorAll(".tab-button"),panels:t.querySelectorAll(".widget-panel"),scheduleGrid:t.querySelector("#schedule-grid"),termButtons:t.querySelectorAll(".term-button")}}const q=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function lt(t){const e=(t?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return e?e[1]:null}function at(t){const e=Array.from(t.querySelectorAll('th[data-automation-id^="columnHeader"]')).map((c,l)=>{const a=G(c),f=lt(c);return{el:c,pos:l,key:f,text:a,norm:q(a)}}).filter(c=>c.text);function r(c){const l=c.map(q);let a=e.find(f=>l.includes(f.norm));return a||(a=e.find(f=>l.some(m=>f.norm.includes(m))),a||null)}const o={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},s={},i={};for(const[c,l]of Object.entries(o)){const a=r(l);s[c]=a?a.key:null,i[c]=a?a.pos:-1}return{colMap:s,posMap:i}}function G(t){if(!t)return"";const n=t.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(t.textContent||"").trim()}function ut(t){let n=String(t||"").replace(/\u00A0/g," ").trim();if(!n)return null;n=n.replace(/\s*\n\s*/g," ").trim();const e=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!e)return null;const r=e[1].trim(),s=e[2].trim().split(/\s*[-–—]\s*/).map(l=>l.trim()).filter(Boolean);let i="",c="";return i=s[0],c=s.slice(1).join(" - ").trim(),c=c.replace(/\s*:\s*/g,`:
`),{code:r,section_number:i,title:c,full:n}}function H(t){const n=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return n?n[0].replace(/\s+/g," ").trim():""}function dt(t){if(!t)return console.log("extractMeetingLinesFromCell failed 1"),[];let e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean);e.length||(e=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(c=>(c.getAttribute("data-automation-label")||c.getAttribute("title")||c.textContent||"").trim()).filter(Boolean)),e.length||(e=String(t.innerText||"").split(`
`).map(i=>i.trim()).filter(Boolean));const r=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,o=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,s=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(i=>r.test(i)&&o.test(i)&&s.test(i))}function mt(t){if(!t)return[];const e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(i=>(i.getAttribute("aria-label")||"").trim()).filter(Boolean),r=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,o=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,s=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(i=>r.test(i)&&o.test(i)&&s.test(i))}function ft(t){const n=String(t||"").split("|").map(l=>l.trim()).filter(Boolean),r=(n.find(l=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(l))||"").split(/\s+/).join(" / "),o=n.find(l=>/\d{1,2}:\d{2}/.test(l)&&/-/.test(l))||"",s=n.find(l=>/\([A-Z]{2,}\)/.test(l))||"",i=n.find(l=>/^Floor:/i.test(l))||"",c=n.find(l=>/^Room:/i.test(l))||"";return{days:r,time:o,location:[s,i,c].filter(Boolean).join(" | ")}}function pt(t){return String(t||"").split(/\r?\n/).map(n=>n.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function I(t){const n=String(t||"").match(/\b(\d{4}-\d{2}-\d{2})\b/);return n?n[1]:""}function gt(t){if(!t)return console.log("failed extracting instuctor name:",t),"";const n=t.querySelector('[data-automation-id="promptOption"]'),e=(n&&(n.getAttribute("data-automation-label")||n.getAttribute("title")||n.textContent)||t.textContent||"").trim();return console.log("sucsessfully extracted instuctor name:",t,e),e}function ht(t){if(!t)return!1;const n=(t.innerText||t.textContent||"").trim();return/online learning/i.test(n)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(r=>{const o=(r.getAttribute("data-automation-label")||r.getAttribute("title")||r.textContent||"").trim();return/online learning/i.test(o)})}function bt(){const t=A(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const n of t){const r=A(n,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(i=>q(G(i)));if(!(r.some(i=>i.includes("section"))&&(r.some(i=>i.includes("instructor"))||r.some(i=>i.includes("meeting"))||r.some(i=>i.includes("instructional format"))||r.some(i=>i.includes("format"))||r.some(i=>i.includes("status")))))continue;const s=A(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(s.length)return{root:n,rows:s}}return null}async function Z(){const t=bt();let n=[];if(t){const e=at(t.root);for(const r of t.rows){const o=yt(r,e);(o.code||o.title)&&Object.values(o).join("").trim()&&n.push(o)}}return St(n)}function St(t){const n=o=>[o.code,o.title,o.section_number].join("|").toLowerCase(),e=new Set,r=[];for(const o of t){const s=n(o);e.has(s)||(e.add(s),r.push(o))}return r}function yt(t,n){const{colMap:e,posMap:r}=n,o=A(t,"td, [role='gridcell']"),s=(t.innerText||"").trim();function i(d){const ot=(d.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return ot?ot[1]:null}const c=new Map;o.forEach(d=>{const g=i(d);g&&!c.has(g)&&c.set(g,d)});const l=d=>{const g=e[d];if(g!=null&&c.has(g))return c.get(g);const y=r[d];return y!=null&&y>=0&&y<o.length?o[y]:null},a=d=>{const g=e[d];if(g!=null&&c.has(g))return(c.get(g).innerText||"").trim();const y=r[d];return y!=null&&y>=0&&y<o.length?(o[y].innerText||"").trim():""},f=A(t,'[data-automation-id="promptOption"]');let m=null;for(const d of f){const g=d.getAttribute("data-automation-label")||d.getAttribute("title")||d.getAttribute("aria-label")||d.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(g)){m=d;break}}!m&&f.length>0&&(m=f[0]);const h=m&&(m.getAttribute("data-automation-label")||m.getAttribute("title")||m.getAttribute("aria-label")||m.textContent)||"",b=a("title"),p=a("code"),S=a("section"),x=a("meeting"),j=a("instructionalFormat"),Dt=a("startDate");let D="",_=b||"",et="";const F=ut(h);F&&(D=F.code,et=F.section_number,_=F.title),D||(D=H(p)||H(b)||H(s)||"");const M=d=>/\b(lab|laboratory|labratory)\b/i.test(String(d||"")),v=d=>/\bseminar\b/i.test(String(d||"")),nt=M(j)||M(S)||M(_)||M(h)||M(s),rt=v(j)||v(S)||v(_)||v(h)||v(s),_t=l("instructor");let U="";nt||rt?U="N/A":U=gt(_t)||(a("instructor")||"").trim();let C;const P=e.meeting;let O=null;P!=null&&c.has(P)?O=c.get(P):r.meeting!=null&&r.meeting>=0&&r.meeting<o.length&&(O=o[r.meeting]);let E=O?dt(O):[];E.length||(E=mt(t));let T={days:"",time:"",location:""},Ft=I(E[0])||I(Dt);if(E.length){const d=E[0];T=ft(d)}else C=(x||"").trim();const Ot=l("deliveryMode");ht(Ot)&&(T.location="Online"),T.days||T.time||T.location?(C=[T.days,T.time].filter(Boolean).join(" | "),T.location?C+=`
${T.location}`:C+=`
Online`):C=(x||"").trim();const qt=(j||"").trim();return{code:D,title:_,section_number:et,instructor:U,meeting:pt(C),instructionalFormat:qt,startDate:Ft,meetingLines:E,isLab:nt,isSeminar:rt}}const W=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function R(t,n){t.tableBody.innerHTML="";const e=document.createDocumentFragment();n.forEach(r=>{const o=document.createElement("tr"),s=r.isLab?"[Laboratory]":r.isSeminar?"[Seminar]":"";o.innerHTML=`
      <td class="title">
        <div class="title-main">${r.title||""}</div>
        ${s?`<div class="muted">${s}</div>`:""}
      </td>
      <td class="code">${r.code||""}</td>
      <td class="sect">${(r.section_number||"").trim()}</td>
      <td class="instructor">${r.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const i=String(r.meeting||"").split(`
`),c=(i[0]||"").trim(),l=(i[1]||"").trim();return`
            ${c?`<span class="meeting-pill">${W(c)}</span>`:""}
            ${l?`<div class="meeting-sub">${W(l)}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${r.instructionalFormat||""}</td>
    `,e.appendChild(o)}),t.tableBody.appendChild(e)}function K(t){if(t=(t||"").trim().toLowerCase(),!t){u.filtered=[...u.courses];return}u.filtered=u.courses.filter(n=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(e=>(n[e]||"").toLowerCase().includes(t)))}function $(t){if(!t)return;const n=u.sort.key===t?-u.sort.dir:1;u.sort={key:t,dir:n};const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});u.filtered.sort((r,o)=>n*e.compare(r[t]||"",o[t]||""))}function Tt(t){const n=A(t.tableHead,"th[data-key]");n.forEach(e=>{L(e,"click",()=>{const r=e.getAttribute("data-key");$(r),R(t,u.filtered),n.forEach(o=>o.classList.remove("sorted-asc","sorted-desc")),e.classList.add(u.sort.dir===1?"sorted-asc":"sorted-desc")})})}const k=["Mon","Tue","Wed","Thu","Fri"],Y=7,z=21,B=30,w=[];for(let t=Y;t<z;t++)w.push(t*60),w.push(t*60+30);const Lt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,At=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,X={first:"09",second:"01"};function V(t){if(!t)return null;const n=t.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let e=Number.parseInt(n[1],10);const r=Number.parseInt(n[2],10),o=n[3].toLowerCase();return o==="p"&&e!==12&&(e+=12),o==="a"&&e===12&&(e=0),e*60+r}function Ct(t){const n=String(t||"").match(Lt)||[],e=String(t||"").match(At)||[];if(n.length===0||e.length<2)return null;const r=V(e[0]),o=V(e[1]);return r==null||o==null||o<=r?null:{days:[...new Set(n)],startMinutes:r,endMinutes:o,timeLabel:`${e[0]} - ${e[1]}`}}function Et(t){if(!t)return null;const n=t.split("-")[1];return n===X.first?"first":n===X.second?"second":null}function J(t){const n=Y*60,e=z*60;return Math.max(n,Math.min(e,t))}function wt(t){return Math.floor(t/B)*B}function xt(t){return Math.ceil(t/B)*B}function Q(t){return w.indexOf(t)}function Mt(t,n){const e=new Map;k.forEach(o=>e.set(o,[]));const r=new Set;return t.forEach(o=>{const s=o.startDate||I(o.meetingLines?.[0])||"";if(Et(s)!==n)return;(o.meetingLines?.length?o.meetingLines:[]).forEach(l=>{const a=Ct(l);if(!a)return;let f=J(a.startMinutes),m=J(a.endMinutes);f=wt(f),m=xt(m);const h=Q(f),b=Q(m);if(h===-1||b===-1||b<=h)return;const p=b-h;a.days.forEach(S=>{if(!e.has(S))return;const x=[S,o.code||"",o.title||"",a.timeLabel,h,p].join("|");r.has(x)||(r.add(x),e.get(S).push({code:o.code||"",title:o.title||"",timeLabel:a.timeLabel,rowStart:h,rowSpan:p}))})})}),k.forEach(o=>{e.get(o).sort((s,i)=>s.rowStart-i.rowStart)}),e}function vt(t){const n=Math.floor(t/60),e=t%60,r=String(n).padStart(2,"0"),o=String(e).padStart(2,"0");return`${r}:${o}`}function Rt(t){const n=document.createElement("table");n.className="schedule-table";const e=new Set,r=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time">Time</th>
    ${k.map(i=>`<th>${i}</th>`).join("")}
  `,r.appendChild(o),n.appendChild(r);const s=document.createElement("tbody");for(let i=0;i<w.length;i++){const c=document.createElement("tr"),l=document.createElement("td");l.className="schedule-time",l.textContent=vt(w[i]),c.appendChild(l),k.forEach(a=>{const f=`${a}|${i}`;if(e.has(f))return;const m=document.createElement("td");m.className="schedule-cell";const h=t.get(a).filter(b=>b.rowStart===i);if(h.length>0){const b=Math.max(...h.map(p=>p.rowSpan));m.rowSpan=b;for(let p=1;p<b;p++)e.add(`${a}|${i+p}`);h.forEach(p=>{const S=document.createElement("div");S.className="schedule-entry",S.innerHTML=`
            <div class="schedule-entry-title">${p.code||p.title}</div>
            <div class="schedule-entry-time">${p.timeLabel}</div>
          `,m.appendChild(S)})}c.appendChild(m)}),s.appendChild(c)}return n.appendChild(s),n}function $t(t,n,e){if(!t.scheduleGrid)return;t.scheduleGrid.innerHTML="";const r=Mt(n,e);t.scheduleGrid.appendChild(Rt(r))}const tt=t=>{if(t==null)return"";const n=String(t);return/[",\n]/.test(n)?`"${n.replace(/"/g,'""')}"`:n},kt=(t,n)=>{const e=n.map(tt).join(","),r=t.map(o=>n.map(s=>tt(o[s]??"")).join(",")).join(`
`);return e+`
`+r};function Bt(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],n=kt(u.filtered,t),e=new Blob([n],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(e),o=document.createElement("a");o.href=r,o.download="captured-courses.csv",document.body.appendChild(o),o.click(),setTimeout(()=>{URL.revokeObjectURL(r),o.remove()},100)}(()=>{console.log("[WD] content script loaded");async function t(){const n=st(),e=await ct(n),r=()=>{$t(e,u.filtered,u.view.term)},o=s=>{u.view.panel=s,e.panels.forEach(i=>{i.classList.toggle("is-active",i.dataset.panel===s)}),e.tabButtons.forEach(i=>{i.classList.toggle("is-active",i.dataset.panel===s)}),e.widget.classList.toggle("is-schedule-view",s==="schedule")};e.tabButtons.forEach(s=>{L(s,"click",()=>{o(s.dataset.panel),s.dataset.panel==="schedule"&&r()})}),e.termButtons.forEach(s=>{L(s,"click",()=>{u.view.term=s.dataset.term,e.termButtons.forEach(i=>{i.classList.toggle("is-active",i.dataset.term===u.view.term)}),r()})}),L(e.button,"click",()=>{e.widget.classList.toggle("is-hidden")}),L(e.refresh,"click",async()=>{u.courses=await Z(),K(e.search.value),$(u.sort.key||"code"),R(e,u.filtered),r()}),L(e.exportBtn,"click",Bt),L(e.search,"input",it(()=>{K(e.search.value),$(u.sort.key||"code"),R(e,u.filtered),r()},100)),Tt(e),u.courses=await Z(),u.filtered=[...u.courses],$("code"),R(e,u.filtered),r(),o(u.view.panel)}document.readyState==="complete"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})()})();
//# sourceMappingURL=content.js.map
