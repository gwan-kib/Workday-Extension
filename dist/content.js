(function(){"use strict";const y=(t,e)=>Array.from(t.querySelectorAll(e)),x=(t,e,n,r)=>t&&t.addEventListener(e,n,r),N=(t,e=300)=>{let n;return(...r)=>{clearTimeout(n),n=setTimeout(()=>t(...r),e)}},u={courses:[],filtered:[],sort:{key:null,dir:1}},I="wd-courses-capture";function Y(){let t=document.getElementById(I);return t||(t=document.createElement("div"),t.id=I,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function K(t){const e=chrome.runtime.getURL("src/panel.html"),n=chrome.runtime.getURL("src/panel.css"),[r,i]=await Promise.all([fetch(e).then(s=>s.text()),fetch(n).then(s=>s.text())]);t.innerHTML="";const c=document.createElement("style");c.textContent=i,t.appendChild(c);const o=document.createElement("div");o.innerHTML=r,t.appendChild(o);const a=t.querySelector("#wd-logo");return a&&(a.src=chrome.runtime.getURL("src/W.svg")),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead")}}const E=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function V(t){const n=y(t,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map((a,s)=>{const d=O(a),m=_(a)??s+1;return{el:a,pos:s,col:m,text:d,norm:E(d)}}).filter(a=>a.text),r=a=>{const s=a.map(E);let d=n.find(m=>s.includes(m.norm));return d||(d=n.find(m=>s.some(h=>m.norm.includes(h))),d||null)},i={instructor:["instructor","instructors"],meeting:["meeting","meeting patterns","meeting pattern"],deliveryMode:["delivery mode","mode","modality"],title:["title","course listing","course name","course"],code:["class code","code","course code","course id"],section:["section","sect","sec"],instructionalFormat:["instructional format","format","component","type","status","registration status"]},c={},o={};for(const[a,s]of Object.entries(i)){const d=r(s);c[a]=d?d.col:null,o[a]=d?d.pos:-1}return{colMap:c,posMap:o}}function O(t){if(!t)return"";const e=t.querySelector("h4");return(t.getAttribute("title")||e&&e.textContent||t.textContent||"").trim()}function _(t){if(!t)return null;const e=t.getAttribute&&t.getAttribute("aria-colindex");if(e&&/^\d+$/.test(e))return parseInt(e,10);let n=t;for(let r=0;r<5&&n;r++){const i=n.getAttribute&&n.getAttribute("aria-colindex");if(i&&/^\d+$/.test(i))return parseInt(i,10);n=n.parentElement}return null}function X(t){let e=String(t||"").replace(/\u00A0/g," ").trim();if(!e)return null;e=e.replace(/\s*\n\s*/g," ").trim();const n=e.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!n)return null;const r=n[1].trim(),c=n[2].trim().split(/\s*[-–—]\s*/).map(s=>s.trim()).filter(Boolean);let o="",a="";return o=c[0],a=c.slice(1).join(" - ").trim(),a=a.replace(/\s*:\s*/g,`:
`),{code:r,section_number:o,title:a,full:e}}function $(t){const e=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return e?e[0].replace(/\s+/g," ").trim():""}function J(t){if(!t)return[];let n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(o=>(o.getAttribute("aria-label")||"").trim()).filter(Boolean);n.length||(n=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(a=>(a.getAttribute("data-automation-label")||a.getAttribute("title")||a.textContent||"").trim()).filter(Boolean)),n.length||(n=String(t.innerText||"").split(`
`).map(o=>o.trim()).filter(Boolean));const r=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,i=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(o=>r.test(o)&&i.test(o)&&c.test(o))}function Q(t){if(!t)return[];const n=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(o=>(o.getAttribute("aria-label")||"").trim()).filter(Boolean),r=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,i=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return n.filter(o=>r.test(o)&&i.test(o)&&c.test(o))}function tt(t){const e=String(t||"").split("|").map(s=>s.trim()).filter(Boolean),r=(e.find(s=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(s))||"").split(/\s+/).join(" / "),i=e.find(s=>/\d{1,2}:\d{2}/.test(s)&&/-/.test(s))||"",c=e.find(s=>/\([A-Z]{2,}\)/.test(s))||"",o=e.find(s=>/^Floor:/i.test(s))||"",a=e.find(s=>/^Room:/i.test(s))||"";return{days:r,time:i,location:[c,o,a].filter(Boolean).join(" | ")}}function et(t){return String(t||"").split(/\r?\n/).map(e=>e.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function nt(t){if(!t)return"";const e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(o=>(o.getAttribute("aria-label")||"").trim()).filter(Boolean),n=o=>/^\d{4}-\d{2}-\d{2}$/.test(o)||/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/.test(o)||/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i.test(o)||/\b\d{1,2}:\d{2}\b/.test(o),r=e.filter(o=>!n(o));if(r.length)return r.join(", ");const i=t.querySelector('[data-automation-id="promptOption"]'),c=(i&&(i.getAttribute("data-automation-label")||i.getAttribute("title")||i.textContent)||t.textContent||"").trim();return n(c)?"":c}function rt(t){if(!t)return!1;const e=(t.innerText||t.textContent||"").trim();return/online learning/i.test(e)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(r=>{const i=(r.getAttribute("data-automation-label")||r.getAttribute("title")||r.textContent||"").trim();return/online learning/i.test(i)})}function ot(){const t=y(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const e of t){const r=y(e,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(o=>E(O(o)));if(!(r.some(o=>o.includes("section"))&&(r.some(o=>o.includes("instructor"))||r.some(o=>o.includes("meeting"))||r.some(o=>o.includes("instructional format"))||r.some(o=>o.includes("format"))||r.some(o=>o.includes("status")))))continue;const c=y(e,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(c.length)return{root:e,rows:c}}return null}async function j(){const t=ot();let e=[];if(t){const n=V(t.root);for(const r of t.rows){const i=st(r,n);(i.code||i.title)&&Object.values(i).join("").trim()&&e.push(i)}}return it(e)}function it(t){const e=i=>[i.code,i.title,i.section_number].join("|").toLowerCase(),n=new Set,r=[];for(const i of t){const c=e(i);n.has(c)||(n.add(c),r.push(i))}return r}function st(t,e){const{colMap:n,posMap:r}=e,i=y(t,"td, [role='gridcell']"),c=(t.innerText||"").trim(),o=new Map;i.forEach((l,g)=>{const f=_(l)??g+1;o.has(f)||o.set(f,l)});const a=l=>{const g=n[l];if(g!=null&&o.has(g))return o.get(g);const f=r[l];return f!=null&&f>=0&&f<i.length?i[f]:null},s=l=>{const g=n[l];if(g!=null&&o.has(g))return(o.get(g).innerText||"").trim();const f=r[l];return f!=null&&f>=0&&f<i.length?(i[f].innerText||"").trim():""},d=y(t,'[data-automation-id="promptOption"]');let m=null;for(const l of d){const g=l.getAttribute("data-automation-label")||l.getAttribute("title")||l.getAttribute("aria-label")||l.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(g)){m=l;break}}!m&&d.length>0&&(m=d[0]);const h=m&&(m.getAttribute("data-automation-label")||m.getAttribute("title")||m.getAttribute("aria-label")||m.textContent)||"",H=s("title"),ut=s("code"),Z=s("section"),U=s("meeting"),dt=s("instructor"),B=s("instructionalFormat");let v="",A=H||"",W="";const k=X(h);k&&(v=k.code,W=k.section_number,A=k.title),v||(v=$(ut)||$(H)||$(c)||"");const C=l=>/\b(lab|laboratory|labratory)\b/i.test(String(l||"")),L=l=>/\bseminar\b/i.test(String(l||"")),z=C(B)||C(Z)||C(A)||C(h)||C(c),G=L(B)||L(Z)||L(A)||L(h)||L(c);let S="",mt=(()=>{const l=n.instructor;return l!=null&&o.has(l)?o.get(l):r.instructor!=null&&r.instructor>=0&&r.instructor<i.length?i[r.instructor]:null})();z||G?S="N/A":S=nt(mt)||(dt||"").trim();let p;const F=n.meeting;let M=null;F!=null&&o.has(F)?M=o.get(F):r.meeting!=null&&r.meeting>=0&&r.meeting<i.length&&(M=i[r.meeting]);let R=M?J(M):[];R.length||(R=Q(t));let b={days:"",time:"",location:""};if(R.length){const l=R[0];b=tt(l)}else p=(U||"").trim();const ft=a("deliveryMode");rt(ft)&&(b.location="Online"),b.days||b.time||b.location?(p=[b.days,b.time].filter(Boolean).join(" | "),b.location?p+=`
${b.location}`:p+=`
Online`):p=(U||"").trim();const gt=(B||"").trim();if(!A&&h){const l=h.indexOf(" - ");l>=0&&(A=h.slice(l+3).trim())}const pt=l=>/^\d{4}-\d{2}-\d{2}$/.test(String(l||"").trim()),bt=l=>/^[A-Z][a-z]+(?: [A-Z][a-z]+)+$/.test(String(l||"").trim());if(pt(S)&&bt(p)){const l=S;S=p,p=l}return{code:v,title:A,section_number:W,instructor:S,meeting:et(p),instructionalFormat:gt,isLab:z,isSeminar:G}}const q=t=>{String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};function T(t,e){t.tableBody.innerHTML="";const n=document.createDocumentFragment();e.forEach(r=>{const i=document.createElement("tr"),c=r.isLab?"[Laboratory]":r.isSeminar?"[Seminar]":"";i.innerHTML=`
      <td class="title">
        <div class="title-main">${r.title||""}</div>
        ${c?`<div class="muted">${c}</div>`:""}
      </td>
      <td class="code">${r.code||""}</td>
      <td class="sect">${(r.section_number||"").trim()}</td>
      <td class="instructor">${r.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const o=String(r.meeting||"").split(`
`),a=(o[0]||"").trim(),s=(o[1]||"").trim();return`
            ${a?`<span class="meeting-pill">${q(a)}</span>`:""}
            ${s?`<div class="meeting-sub">${q(s)}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${r.instructionalFormat||""}</td>
    `,n.appendChild(i)}),t.tableBody.appendChild(n)}function D(t){if(t=(t||"").trim().toLowerCase(),!t){u.filtered=[...u.courses];return}u.filtered=u.courses.filter(e=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(n=>(e[n]||"").toLowerCase().includes(t)))}function w(t){if(!t)return;const e=u.sort.key===t?-u.sort.dir:1;u.sort={key:t,dir:e};const n=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});u.filtered.sort((r,i)=>e*n.compare(r[t]||"",i[t]||""))}function lt(t){const e=y(t.tableHead,"th[data-key]");e.forEach(n=>{x(n,"click",()=>{const r=n.getAttribute("data-key");w(r),T(t,u.filtered),e.forEach(i=>i.classList.remove("sorted-asc","sorted-desc")),n.classList.add(u.sort.dir===1?"sorted-asc":"sorted-desc")})})}const P=t=>{if(t==null)return"";const e=String(t);return/[",\n]/.test(e)?`"${e.replace(/"/g,'""')}"`:e},ct=(t,e)=>{const n=e.map(P).join(","),r=t.map(i=>e.map(c=>P(i[c]??"")).join(",")).join(`
`);return n+`
`+r};function at(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],e=ct(u.filtered,t),n=new Blob([e],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download="captured-courses.csv",document.body.appendChild(i),i.click(),setTimeout(()=>{URL.revokeObjectURL(r),i.remove()},100)}(()=>{console.log("[WD] content script loaded");async function t(){const e=Y(),n=await K(e);x(n.button,"click",()=>{n.widget.classList.toggle("is-hidden")}),x(n.refresh,"click",async()=>{u.courses=await j(),D(n.search.value),w(u.sort.key||"code"),T(n,u.filtered)}),x(n.exportBtn,"click",at),x(n.search,"input",N(()=>{D(n.search.value),w(u.sort.key||"code"),T(n,u.filtered)},100)),lt(n),u.courses=await j(),u.filtered=[...u.courses],w("code"),T(n,u.filtered)}document.readyState==="complete"?t():document.addEventListener("DOMContentLoaded",t,{once:!0})})()})();
//# sourceMappingURL=content.js.map
