{"version":3,"file":"content.js","sources":["../src/utilities/debugTool.js","../src/utilities/dom.js","../src/core/state.js","../src/utilities/shadowMount.js","../src/mainPanel/loadMainPanel.js","../src/extraction/grid.js","../src/extraction/parsers/sectionLinkInfo.js","../src/extraction/parsers/meetingPatternsInfo.js","../src/extraction/rowCellReader.js","../src/extraction/extractCourses.js","../src/mainPanel/renderCourseRows.js","../src/mainPanel/mainPanelInteractions.js","../src/mainPanel/scheduleView.js","../src/export-logic/export-ics.js","../src/mainPanel/scheduleStorage.js","../src/content.js"],"sourcesContent":["const logConfiguration = {\r\n  global: true, // master switch (all logs everywhere)\r\n  local: {}, // per-scope switch: { \"schedule\": true/false, ... }\r\n  log: {}, // per-log switch: { \"schedule.render\": true/false, ... }\r\n};\r\n\r\n// this function updates the logging configuration state:\r\n// debugLog({ global: false })                    -> turns ALL logs off (global control)\r\n// debugLog({ local: { schedule: true } })        -> turns logs ON for the \"schedule\" module (local control)\r\n// debugLog({ log: { \"schedule.render\": false }}) -> disables logging for the \"schedule.render\" function (specific log control)\r\nexport const debugLog = ({ global, local, log } = {}) => {\r\n  if (typeof global === \"boolean\") logConfiguration.global = global;\r\n\r\n  if (local && typeof local === \"object\") {\r\n    for (const [k, v] of Object.entries(local)) {\r\n      if (typeof v === \"boolean\") logConfiguration.local[k] = v;\r\n    }\r\n  }\r\n\r\n  if (log && typeof log === \"object\") {\r\n    for (const [k, v] of Object.entries(log)) {\r\n      if (typeof v === \"boolean\") logConfiguration.log[k] = v;\r\n    }\r\n  }\r\n};\r\n\r\n// quick read of current config settings (for debugging this file)\r\nexport const getLogConfiguration = () => ({\r\n  global: logConfiguration.global,\r\n  local: { ...logConfiguration.local },\r\n  log: { ...logConfiguration.log },\r\n});\r\n\r\n// logic to decide if a log should print\r\nconst loggingIsOn = (scope, id) => {\r\n  if (!logConfiguration.global) return false; // If global logging is off, return immediately\r\n\r\n  if (scope && logConfiguration.local[scope] === false) return false; // Local control check\r\n  if (id && logConfiguration.log[id] === false) return false; // Specific log control\r\n\r\n  return true; // Default: logs are ON\r\n};\r\n\r\n// main logger factory for a given scope (file/module), eg. const D = debugFor(\"schedule\");\r\nexport const debugFor = (scope) => {\r\n  const prefix = scope ? `[Workday - Schedule Tool (file: ${scope})]\\n` : \"[Workday - Schedule Tool]\\n\"; // prefix at the start of all logs\r\n\r\n  // .log can either be the message (string), .log(\"message\"), or a meta object, .log({ id: \"schedule.render\" }, \"message\"),\r\n  // or both, .log({ id: \"schedule.render\", on: false }, \"message\")\r\n  // ...rest means it can also take in any additional arguments (an object, an array, etc.)\r\n  const log = (metaOrMsg, ...rest) => {\r\n    let meta = null;\r\n    let args = null;\r\n\r\n    if (metaOrMsg && typeof metaOrMsg === \"object\" && !Array.isArray(metaOrMsg)) {\r\n      meta = metaOrMsg;\r\n      args = rest;\r\n    } else {\r\n      meta = null;\r\n      args = [metaOrMsg, ...rest];\r\n    }\r\n\r\n    const id = meta?.id;\r\n    const forceOn = meta?.on === true; // if forceOn is true, this forces the log to show regardless of global/local/log settings.\r\n    const forceOff = meta?.on === false; // if forceOff is true, immediately return (log is disabled for this specific call).\r\n\r\n    if (forceOff) return;\r\n    if (!forceOn && !loggingIsOn(scope, id)) return;\r\n\r\n    console.log(prefix, ...args);\r\n  };\r\n\r\n  // same as log but for warnings\r\n  const warning = (metaOrMsg, ...rest) => {\r\n    let meta = null;\r\n    let args = null;\r\n\r\n    if (metaOrMsg && typeof metaOrMsg === \"object\" && !Array.isArray(metaOrMsg)) {\r\n      meta = metaOrMsg;\r\n      args = rest;\r\n    } else {\r\n      args = [metaOrMsg, ...rest];\r\n    }\r\n\r\n    const id = meta?.id;\r\n    const forceOn = meta?.on === true;\r\n    const forceOff = meta?.on === false;\r\n\r\n    if (forceOff) return;\r\n    if (!forceOn && !loggingIsOn(scope, id)) return;\r\n\r\n    console.log(\"‚ö†Ô∏è\", prefix, ...args);\r\n  };\r\n\r\n  // same as log but for errors\r\n  const error = (metaOrMsg, ...rest) => {\r\n    let meta = null;\r\n    let args = null;\r\n\r\n    if (metaOrMsg && typeof metaOrMsg === \"object\" && !Array.isArray(metaOrMsg)) {\r\n      meta = metaOrMsg;\r\n      args = rest;\r\n    } else {\r\n      args = [metaOrMsg, ...rest];\r\n    }\r\n\r\n    const id = meta?.id;\r\n    const forceOn = meta?.on === true;\r\n    const forceOff = meta?.on === false;\r\n\r\n    if (forceOff) return;\r\n    if (!forceOn && !loggingIsOn(scope, id)) return;\r\n\r\n    console.log(\"üö©\", prefix, ...args);\r\n  };\r\n\r\n  // Convenience toggles for this scope (still goes through debugLog under the hood)\r\n  const on = () => debugLog({ local: { [scope]: true } });\r\n  const off = () => debugLog({ local: { [scope]: false } });\r\n\r\n  return { log, warn: warning, error, on, off };\r\n};\r\n","import { debugFor } from \"./debugTool.js\";\r\nconst debug = debugFor(\"dom\");\r\n\r\n// shortcut for querySelector in shadowDom\r\nexport const $ = (root, sel) => {\r\n  debug.log(\"Querying single element:\", { root, sel });\r\n  return root.querySelector(sel);\r\n};\r\n\r\n// shortcut for querySelectorAll in shadowDom, turns result into an array\r\nexport const $$ = (root, sel) => {\r\n  debug.log(\"Querying multiple elements:\", { root, sel });\r\n  return Array.from(root.querySelectorAll(sel));\r\n};\r\n\r\n// if el exists, attaches event listener to el\r\nexport const on = (el, ev, fn, opts) => {\r\n  if (el) {\r\n    debug.log(\"Attaching event listener:\", { el, ev, opts });\r\n    el.addEventListener(ev, fn, opts);\r\n  }\r\n};\r\n\r\n// limits how often a function is called, sets a timer and function can only be called again after timer is complete\r\nexport const debounce = (fn, ms = 300) => {\r\n  let t;\r\n  return (...a) => {\r\n    debug.log(\"Debouncing function call with delay:\", { fn, ms, args: a });\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n};\r\n","import { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"state\");\r\n\r\nexport const STATE = {\r\n  // list of courses extracted from workday\r\n  courses: [],\r\n\r\n  // list of filtered courses, used for searching and sorting\r\n  filtered: [],\r\n\r\n  // list of user saved schedules\r\n  savedSchedules: [],\r\n\r\n  // tracks current sorting state, key: field name, dir: 1 ascending, -1 descending eg. STATE.sort = { key: \"startTime\", dir: -1 };\r\n  sort: { key: null, dir: 1 },\r\n\r\n  // tracks viewing state, panel: current extension page, semester: current semester tab\r\n  view: {\r\n    panel: \"list\",\r\n    semester: \"first\",\r\n  },\r\n\r\n  setCourses(newCourses) {\r\n    this.courses = newCourses;\r\n    debug.log(\"Courses updated:\", newCourses);\r\n  },\r\n\r\n  setFiltered(filteredCourses) {\r\n    this.filtered = filteredCourses;\r\n    debug.log(\"Filtered courses updated:\", filteredCourses);\r\n  },\r\n\r\n  setSavedSchedules(saved) {\r\n    this.savedSchedules = saved;\r\n    debug.log(\"Saved schedules updated:\", saved);\r\n  },\r\n\r\n  setSort(sortState) {\r\n    this.sort = sortState;\r\n    debug.log(\"Sorting state updated:\", sortState);\r\n  },\r\n\r\n  setView(viewState) {\r\n    this.view = viewState;\r\n    debug.log(\"View state updated:\", viewState);\r\n  },\r\n};\r\n","import { debugFor } from \"./debugTool.js\";\r\nconst debug = debugFor(\"shadowMount\");\r\n\r\n// extension ID\r\nconst EXT_ID = \"Workday - Schedule Tool\";\r\n\r\n// first time it's called it mounts the extension, in subsequent calls it returns the extension's shadow root\r\nexport function ensureMount() {\r\n  let host = document.getElementById(EXT_ID);\r\n\r\n  if (host) {\r\n    debug.log(\"Returning existing shadow root:\", host);\r\n    return host.shadowRoot;\r\n  }\r\n\r\n  // creates container for extension, sets styles, then appends extension to the page\r\n  host = document.createElement(\"div\");\r\n  host.id = EXT_ID;\r\n  host.style.all = \"initial\";\r\n  host.style.position = \"fixed\";\r\n  host.style.bottom = \"16px\";\r\n  host.style.right = \"16px\";\r\n  host.style.zIndex = \"999999999\";\r\n  host.attachShadow({ mode: \"open\" });\r\n  document.documentElement.appendChild(host);\r\n\r\n  debug.log(\"Mounted new extension container:\", host);\r\n  return host.shadowRoot;\r\n}\r\n","// src/mainPanel/loadMainPanel.js\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"loadMainPanel\");\r\n\r\nexport async function loadMainPanel(shadowRoot) {\r\n  const htmlUrl = chrome.runtime.getURL(\"src/panel.html\");\r\n\r\n  const cssFiles = [\r\n    \"formatting/general.css\",\r\n    \"formatting/widget-shell.css\",\r\n    \"formatting/widget-buttons.css\",\r\n    \"formatting/floating-button.css\",\r\n    \"formatting/course-list.css\",\r\n    \"formatting/schedule-view.css\",\r\n    \"formatting/schedule-view-events.css\",\r\n    \"formatting/settings.css\",\r\n    \r\n    \"colors/course-list-colors.css\",\r\n    \"colors/general-colors.css\",\r\n    \"colors/schedule-view-colors.css\",\r\n    \"colors/widget-functionality-colors.css\",\r\n    \"colors/settings-colors.css\",\r\n  ];\r\n\r\n  const [html, ...cssParts] = await Promise.all([\r\n    fetch(htmlUrl).then((r) => r.text()),\r\n    ...cssFiles.map((file) => fetch(chrome.runtime.getURL(`src/css/${file}`)).then((r) => r.text())),\r\n  ]);\r\n\r\n  const css = cssParts.join(\"\\n\");\r\n\r\n  shadowRoot.innerHTML = \"\";\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = css;\r\n  shadowRoot.appendChild(style);\r\n\r\n  // Material Symbols font (only once on the page)\r\n  if (!document.querySelector('link[href*=\"Material+Symbols\"]')) {\r\n    const link = document.createElement(\"link\");\r\n    link.rel = \"stylesheet\";\r\n    link.href =\r\n      \"https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\";\r\n    document.head.appendChild(link);\r\n  }\r\n\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.innerHTML = html;\r\n  shadowRoot.appendChild(wrap);\r\n\r\n  const ui = {\r\n    // Whole extension UI (this used to be ctx.widget)\r\n    mainPanel: shadowRoot.querySelector(\".widget\"),\r\n\r\n    // Core roots\r\n    root: shadowRoot,\r\n    floatingButton: shadowRoot.querySelector(\"#floating-button\"),\r\n\r\n    // Course table\r\n    tableBody: shadowRoot.querySelector(\"tbody\"),\r\n    tableHead: shadowRoot.querySelector(\"thead\"),\r\n\r\n    // Search + controls\r\n    searchInput: shadowRoot.querySelector(\"#widget-search\"),\r\n    refreshButton: shadowRoot.querySelector(\"#widget-refresh\"),\r\n    saveScheduleButton: shadowRoot.querySelector(\"#widget-save-schedule\"),\r\n\r\n    // Export dropdown\r\n    exportDropdown: shadowRoot.querySelector(\"#widget-export\"),\r\n    exportButton: shadowRoot.querySelector(\"#widget-export-button\"),\r\n    exportMenu: shadowRoot.querySelector(\"#widget-export-menu\"),\r\n\r\n    // Tabs / views\r\n    viewTabs: shadowRoot.querySelectorAll(\".tab-button\"),\r\n    views: shadowRoot.querySelectorAll(\".widget-panel\"),\r\n\r\n    // Schedule view\r\n    scheduleGrid: shadowRoot.querySelector(\"#schedule-grid\"),\r\n    semesterButtons: shadowRoot.querySelectorAll(\".semester-button\"),\r\n    footerConflicts: shadowRoot.querySelector(\"#widget-conflicts\"),\r\n\r\n    // Saved schedules dropdown\r\n    savedDropdown: shadowRoot.querySelector(\"#schedule-saved-dropdown\"),\r\n    savedMenu: shadowRoot.querySelector(\"#schedule-saved-menu\"),\r\n\r\n    // Modal\r\n    saveModal: shadowRoot.querySelector(\"#schedule-save-modal\"),\r\n    saveModalTitle: shadowRoot.querySelector(\"#schedule-modal-title\"),\r\n    saveModalMessage: shadowRoot.querySelector(\"#schedule-modal-message\"),\r\n    saveModalField: shadowRoot.querySelector(\"#schedule-modal-field\"),\r\n    saveModalInput: shadowRoot.querySelector(\"#schedule-modal-input\"),\r\n    saveModalCancel: shadowRoot.querySelector(\".schedule-modal-cancel\"),\r\n    saveModalConfirm: shadowRoot.querySelector(\".schedule-modal-confirm\"),\r\n\r\n    // Shortcuts\r\n    helpButton: shadowRoot.querySelector(\".help\"),\r\n    settingsButton: shadowRoot.querySelector(\".settings\"),\r\n  };\r\n\r\n  debug.log({ id: \"loadMainPanel.ui\" }, \"Loaded mainPanel UI refs\", {\r\n    hasMainPanel: !!ui.mainPanel,\r\n    hasFloatingButton: !!ui.floatingButton,\r\n    hasTable: !!ui.tableBody && !!ui.tableHead,\r\n  });\r\n\r\n  return ui;\r\n}\r\n","// src/extraction/grid.js\r\nimport { $$ } from \"../utilities/dom\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"grid\");\r\n\r\n// -------------------------\r\n// Text helpers\r\n// -------------------------\r\nexport const normalizeText = (s) =>\r\n  String(s || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .replace(/\\s+/g, \" \")\r\n    .trim()\r\n    .toLowerCase();\r\n\r\nexport function getHeaderText(headerEl) {\r\n  if (!headerEl) return \"\";\r\n\r\n  const btn = headerEl.querySelector(\"button[title]\");\r\n  if (btn) return (btn.getAttribute(\"title\") || \"\").trim();\r\n\r\n  return (headerEl.textContent || \"\").trim();\r\n}\r\n\r\n// -------------------------\r\n// Header maps\r\n// -------------------------\r\nfunction getHeaderKey(el) {\r\n  const a = el?.getAttribute?.(\"data-automation-id\") || \"\";\r\n  const m = a.match(/^columnHeader(\\d+\\.\\d+)$/);\r\n  return m ? m[1] : null; // \"252.9\"\r\n}\r\n\r\nexport function buildHeaderMaps(gridRoot) {\r\n  const headerEls = Array.from(gridRoot.querySelectorAll('th[data-automation-id^=\"columnHeader\"]'));\r\n\r\n  debug.log({ id: \"buildHeaderMaps.headers\" }, \"Header elements found:\", headerEls.length);\r\n\r\n  const headers = headerEls\r\n    .map((el, pos) => {\r\n      const text = getHeaderText(el);\r\n      const key = getHeaderKey(el); // \"252.9\"\r\n      return { el, pos, key, text, norm: normalizeText(text) };\r\n    })\r\n    .filter((h) => h.text);\r\n\r\n  debug.log(\r\n    { id: \"buildHeaderMaps.parsedHeaders\" },\r\n    \"Parsed headers:\",\r\n    headers.map((h) => ({ pos: h.pos, key: h.key, text: h.text, norm: h.norm }))\r\n  );\r\n\r\n  function findHeader(needles) {\r\n    const ns = needles.map(normalizeText);\r\n    let hit = headers.find((h) => ns.includes(h.norm));\r\n    if (hit) return hit;\r\n    hit = headers.find((h) => ns.some((n) => h.norm.includes(n)));\r\n    return hit || null;\r\n  }\r\n\r\n  const KEYS = {\r\n    instructor: [\"instructor\", \"instructors\"],\r\n    meeting: [\"meeting patterns\", \"meeting pattern\"],\r\n    deliveryMode: [\"delivery mode\"],\r\n    title: [\"title\", \"course listing\"],\r\n    section: [\"section\"],\r\n    instructionalFormat: [\"instructional format\"],\r\n    startDate: [\"start date\", \"start\"],\r\n  };\r\n\r\n  const colMap = {};\r\n  const posMap = {};\r\n\r\n  for (const [key, needles] of Object.entries(KEYS)) {\r\n    const hit = findHeader(needles);\r\n    colMap[key] = hit ? hit.key : null; // store \"252.9\"\r\n    posMap[key] = hit ? hit.pos : -1;\r\n\r\n    debug.log({ id: \"buildHeaderMaps.map\" }, \"Mapped header:\", {\r\n      key,\r\n      needles,\r\n      hit: hit ? { pos: hit.pos, colKey: hit.key, text: hit.text } : null,\r\n    });\r\n  }\r\n\r\n  return { colMap, posMap };\r\n}\r\n\r\n// -------------------------\r\n// Grid/table finding\r\n// -------------------------\r\nexport function findWorkdayGrid() {\r\n  const roots = $$(\r\n    document,\r\n    `\r\n  table,\r\n  [role=\"table\"],\r\n  [role=\"grid\"],\r\n  div[data-automation-id*=\"grid\"],\r\n  div[data-automation-id*=\"Grid\"],\r\n  div[data-automation-id=\"gridContainer\"],\r\n  div[data-automation-id=\"responsiveDataTable\"],\r\n  div[data-automation-id=\"tableContainer\"]\r\n`\r\n  );\r\n\r\n  debug.log({ id: \"findWorkdayGrid.roots\" }, \"Candidate roots found:\", roots.length);\r\n\r\n  for (const root of roots) {\r\n    const headerEls = $$(\r\n      root,\r\n      `\r\n  thead th,\r\n  [role=\"columnheader\"],\r\n  div[data-automation-id*=\"columnHeader\"],\r\n  .wd-GridHeaderCell,\r\n  .grid-column-header\r\n`\r\n    );\r\n\r\n    const headerText = headerEls.map((h) => normalizeText(getHeaderText(h)));\r\n\r\n    // still require \"section\" + at least one other expected header\r\n    const looksRight =\r\n      headerText.some((t) => t.includes(\"section\")) &&\r\n      (headerText.some((t) => t.includes(\"instructor\")) ||\r\n        headerText.some((t) => t.includes(\"meeting\")) ||\r\n        headerText.some((t) => t.includes(\"instructional format\")) ||\r\n        headerText.some((t) => t.includes(\"format\")) ||\r\n        headerText.some((t) => t.includes(\"status\")));\r\n\r\n    debug.log({ id: \"findWorkdayGrid.scanRoot\" }, \"Scanning root:\", {\r\n      headerCount: headerEls.length,\r\n      looksRight,\r\n      headerText,\r\n    });\r\n\r\n    if (!looksRight) continue;\r\n\r\n    const rows = $$(root, \"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row\");\r\n\r\n    debug.log({ id: \"findWorkdayGrid.rows\" }, \"Rows found for matching root:\", rows.length);\r\n\r\n    if (rows.length) return { root, rows };\r\n  }\r\n\r\n  debug.log({ id: \"findWorkdayGrid.none\" }, \"No matching table/grid found\");\r\n  return null;\r\n}\r\n","import { debugFor } from \"../../utilities/debugTool\";\r\n\r\nconst debug = debugFor(\"sectionLinkInfo\");\r\n\r\n/* Parse the Workday \"promptOption\" section link string. */\r\nexport function parseSectionLinkString(input) {\r\n  let str = String(input || \"\")\r\n    .replace(/\\u00A0/g, \" \")\r\n    .trim();\r\n\r\n  debug.log({ id: \"parseSectionLinkString.input\" }, \"Raw input:\", input);\r\n\r\n  if (!str) return null;\r\n\r\n  // keep ALL lines; Workday wraps titles with \\n\r\n  str = str.replace(/\\s*\\n\\s*/g, \" \").trim();\r\n\r\n  debug.log({ id: \"parseSectionLinkString.normalized\" }, \"Normalized string:\", str);\r\n\r\n  // REQUIRED pattern:\r\n  const m = str.match(/^\\s*([A-Z][A-Z0-9_]*\\s*\\d{3}[A-Z]?)\\s*-\\s*(.+?)\\s*$/);\r\n  if (!m) {\r\n    debug.log({ id: \"parseSectionLinkString.noMatch\" }, \"String did not match expected pattern\");\r\n    return null;\r\n  }\r\n\r\n  const baseCode = m[1].trim(); // \"COSC_O 222\"\r\n  const rest = m[2].trim(); // \"L2D - Data Structures\" or \"101 - Data Structures\"\r\n\r\n  debug.log({ id: \"parseSectionLinkString.match\" }, \"Regex match:\", { baseCode, rest });\r\n\r\n  // Split rest into section token + title\r\n  const parts = rest\r\n    .split(/\\s*[-‚Äì‚Äî]\\s*/)\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  let sectionToken = \"\";\r\n  let parsedTitle = \"\";\r\n\r\n  sectionToken = parts[0];\r\n  parsedTitle = parts.slice(1).join(\" - \").trim();\r\n\r\n  parsedTitle = parsedTitle.replace(/\\s*:\\s*/g, \":\\n\");\r\n\r\n  const result = {\r\n    code: baseCode,\r\n    section_number: sectionToken,\r\n    title: parsedTitle,\r\n    full: str,\r\n  };\r\n\r\n  debug.log({ id: \"parseSectionLinkString.result\" }, \"Parsed section link result:\", result);\r\n\r\n  return result;\r\n}\r\n\r\nexport function guessClassCode(text) {\r\n  const m = String(text || \"\").match(/[A-Z][A-Z0-9_]*\\s*\\d{2,3}[A-Z]?/);\r\n\r\n  const out = m ? m[0].replace(/\\s+/g, \" \").trim() : \"\";\r\n\r\n  debug.log({ id: \"guessClassCode\" }, \"Guessed class code:\", { input: text, out });\r\n\r\n  return out;\r\n}\r\n","import { debugFor } from \"../../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"meetingPatternsInfo\");\r\n\r\nconst DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\nconst TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\nconst DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\nexport function extractMeetingLines(containerEl) {\r\n  if (!containerEl) {\r\n    debug.log({ id: \"extractMeetingLines.missing\" }, \"No container element provided\");\r\n    return [];\r\n  }\r\n\r\n  const items = Array.from(containerEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n  const lines = items.map((el) => (el.getAttribute(\"aria-label\") || \"\").trim()).filter(Boolean);\r\n\r\n  debug.log({ id: \"extractMeetingLines.items\" }, \"Menu item lines:\", { count: lines.length });\r\n\r\n  const filtered = lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n\r\n  debug.log({ id: \"extractMeetingLines.filtered\" }, \"Filtered meeting lines:\", {\r\n    before: lines.length,\r\n    after: filtered.length,\r\n  });\r\n\r\n  return filtered;\r\n}\r\n\r\nexport function isOnlineDelivery(deliveryModeCellEl) {\r\n  if (!deliveryModeCellEl) {\r\n    debug.log({ id: \"isOnlineDelivery.missing\" }, \"No delivery mode cell provided\");\r\n    return false;\r\n  }\r\n\r\n  const txt = (deliveryModeCellEl.innerText || deliveryModeCellEl.textContent || \"\").trim();\r\n  if (/online learning/i.test(txt)) {\r\n    debug.log({ id: \"isOnlineDelivery.match.direct\" }, \"Matched online learning from cell text\", txt);\r\n    return true;\r\n  }\r\n\r\n  const prompts = Array.from(deliveryModeCellEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n\r\n  const matched = prompts.some((el) => {\r\n    const label = el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\";\r\n    return /online learning/i.test(label);\r\n  });\r\n\r\n  debug.log({ id: \"isOnlineDelivery.match.prompts\" }, \"Checked prompt options for online learning\", {\r\n    promptCount: prompts.length,\r\n    matched,\r\n  });\r\n\r\n  return matched;\r\n}\r\n\r\n// Back-compat exports (optional, but keeps other files working)\r\nexport function extractMeetingLinesFromCell(meetingEl) {\r\n  return extractMeetingLines(meetingEl);\r\n}\r\n\r\nexport function extractMeetingLinesFromRow(rowEl) {\r\n  return extractMeetingLines(rowEl);\r\n}\r\n\r\nexport function formatMeetingLineForPanel(line) {\r\n  const raw = String(line || \"\");\r\n\r\n  const parts = raw\r\n    .split(\"|\")\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  const dayPartRaw = parts.find((p) => /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/.test(p)) || \"\";\r\n  const dayPart = dayPartRaw.split(/\\s+/).join(\" / \");\r\n\r\n  const timePart = parts.find((p) => /\\d{1,2}:\\d{2}/.test(p) && /-/.test(p)) || \"\";\r\n\r\n  const buildingPart = parts.find((p) => /\\([A-Z]{2,}\\)/.test(p)) || \"\";\r\n\r\n  // ‚úÖ find Floor/Room anywhere in the full string (handles \"Floor 3\", \"Floor: 3\", \"Rm 210\", etc.)\r\n  const floorMatch = raw.match(/\\bfloor\\b\\s*[:\\-]?\\s*(-?[A-Za-z0-9]+)/i);\r\n  const roomMatch = raw.match(/\\b(room|rm)\\b\\s*[:\\-]?\\s*([A-Za-z0-9]+)/i);\r\n\r\n  const floorPart = floorMatch ? `Floor: ${floorMatch[1]}` : \"\";\r\n  const roomPart = roomMatch ? `Room: ${roomMatch[2]}` : \"\";\r\n\r\n  const formatted = {\r\n    days: dayPart,\r\n    time: timePart,\r\n    location: [buildingPart, [floorPart, roomPart].filter(Boolean).join(\" | \")].filter(Boolean).join(\"\\n\"),\r\n  };\r\n\r\n  debug.log({ id: \"formatMeetingLineForPanel\" }, \"Formatted meeting line:\", { raw, formatted });\r\n\r\n  return formatted;\r\n}\r\n\r\nexport function normalizeMeetingPatternsText(text) {\r\n  // preserve line breaks, normalize each line\r\n  const normalized = String(text || \"\")\r\n    .split(/\\r?\\n(.*)/s)\r\n    .slice(0, 2)\r\n    .map((line) => line.replace(/[ \\t]+/g, \" \").trim())\r\n    .filter(Boolean)\r\n    .join(\"\\n\");\r\n\r\n  debug.log({ id: \"normalizeMeetingPatternsText\" }, \"Normalized meeting patterns text:\", {\r\n    beforeLen: String(text || \"\").length,\r\n    afterLen: normalized.length,\r\n    ogText: text,\r\n    ogString: String(text || \"\"),\r\n    normalized,\r\n  });\r\n\r\n  return normalized;\r\n}\r\n\r\nexport function extractStartDate(line) {\r\n  const match = String(line || \"\").match(/\\b(\\d{4}-\\d{2}-\\d{2})\\b/);\r\n  const out = match ? match[1] : \"\";\r\n\r\n  debug.log({ id: \"extractStartDate\" }, \"Extracted start date:\", { line, out });\r\n\r\n  return out;\r\n}\r\n","// src/extraction/rowCellReader.js\r\nimport { $$ } from \"../utilities/dom\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"rowCellReader\");\r\n\r\n// maps row cells to Workday keys (e.g., \"252.9\" from \"<div id='gen-dwr-comp-252.9-...'>\")\r\nfunction getCellWorkdayKey(cell) {\r\n  const inner = cell.querySelector('[id^=\"gen-dwr-comp-\"]');\r\n  const id = inner?.id || \"\";\r\n  const m = id.match(/^gen-dwr-comp-(\\d+\\.\\d+)-/);\r\n  return m ? m[1] : null;\r\n}\r\n\r\nexport function createRowCellReader(rowEl, headerMaps) {\r\n  const { colMap: colHeaderMap } = headerMaps || {};\r\n\r\n  const cellsInRow = $$(rowEl, \"td, [role='gridcell']\");\r\n\r\n  debug.log({ id: \"createRowCellReader.start\" }, \"Creating row cell reader:\", {\r\n    cellCount: cellsInRow.length,\r\n  });\r\n\r\n  // store first cell for each Workday key\r\n  const cellByCol = new Map();\r\n  cellsInRow.forEach((cell) => {\r\n    const key = getCellWorkdayKey(cell);\r\n    if (key && !cellByCol.has(key)) cellByCol.set(key, cell);\r\n  });\r\n\r\n  // returns the cell element for a given header name\r\n  const getCellByHeader = (keyName) => {\r\n    const colKey = colHeaderMap?.[keyName];\r\n    if (colKey == null) return null;\r\n    return cellByCol.get(colKey) || null;\r\n  };\r\n\r\n  // returns the text of a cell element for a given header name\r\n  const readCellTextByHeader = (keyName) => {\r\n    const el = getCellByHeader(keyName);\r\n    return (el?.innerText || \"\").trim();\r\n  };\r\n\r\n  return {\r\n    cellsInRow,\r\n    cellByCol,\r\n    getCellByHeader,\r\n    readCellTextByHeader,\r\n  };\r\n}\r\n","// src/extraction/courseExtraction.js\r\nimport { $$ } from \"../utilities/dom.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nimport { buildHeaderMaps, findWorkdayGrid } from \"./grid.js\";\r\nimport { parseSectionLinkString } from \"./parsers/sectionLinkInfo.js\";\r\nimport {\r\n  extractMeetingLinesFromCell,\r\n  formatMeetingLineForPanel,\r\n  normalizeMeetingPatternsText,\r\n  extractStartDate,\r\n  isOnlineDelivery,\r\n} from \"./parsers/meetingPatternsInfo.js\";\r\nimport { createRowCellReader } from \"./rowCellReader.js\";\r\n\r\nconst debug = debugFor(\"courseExtraction\");\r\n\r\n// extracts course data from the table rows\r\nexport async function extractCoursesData() {\r\n  debug.log({ id: \"extractCoursesData.start\" }, \"Starting course extraction\");\r\n\r\n  const found = findWorkdayGrid();\r\n  let courses = [];\r\n\r\n  debug.log(\r\n    { id: \"extractCoursesData.tables\" },\r\n    \"findWorkdayGrid() result:\",\r\n    found\r\n      ? {\r\n          hasRoot: !!found.root,\r\n          rowCount: found.rows?.length || 0,\r\n        }\r\n      : null\r\n  );\r\n\r\n  // if tables exist, build position based header maps\r\n  if (found) {\r\n    const headerMaps = buildHeaderMaps(found.root);\r\n\r\n    debug.log({ id: \"extractCoursesData.headerMaps\" }, \"Built header maps:\", headerMaps);\r\n\r\n    for (const row of found.rows) {\r\n      const c = extractFromRow(row, headerMaps);\r\n      if (c && (c.code || c.title) && Object.values(c).join(\"\").trim()) courses.push(c);\r\n    }\r\n  }\r\n\r\n  // removes duplcicate courses\r\n  const unique = removeDuplicateCourses(courses);\r\n\r\n  debug.log({ id: \"extractCoursesData.done\" }, \"Extraction complete:\", {\r\n    total: courses.length,\r\n    unique: unique.length,\r\n  });\r\n\r\n  return unique; // returns a list of all unique course objects\r\n}\r\n\r\nfunction removeDuplicateCourses(allCourses) {\r\n  const key = (course) => [course.code, course.title, course.section_number].join(\"|\").toLowerCase();\r\n  const seen = new Set();\r\n  const uniqueCourses = [];\r\n\r\n  // only add course to seen list if its not already there\r\n  for (const course of allCourses) {\r\n    const courseKey = key(course);\r\n    if (!seen.has(courseKey)) {\r\n      seen.add(courseKey);\r\n      uniqueCourses.push(course);\r\n    }\r\n  }\r\n\r\n  debug.log({ id: \"removeDuplicateCourses\" }, \"Deduped courses:\", {\r\n    allCourses: allCourses,\r\n    UniqueCourses: uniqueCourses,\r\n    removed: allCourses.length - uniqueCourses.length,\r\n  });\r\n\r\n  return uniqueCourses; // returns a list of all unique course objects\r\n}\r\n\r\n// takes table row and turns it into a single course object\r\nexport function extractFromRow(row, headerMaps) {\r\n  const { getCellByHeader, readCellTextByHeader } = createRowCellReader(row, headerMaps);\r\n\r\n  debug.log({ id: \"extractFromRow.start\" }, \"Extracting row\");\r\n\r\n  // a list of all the links in the row\r\n  const allLinksInRow = $$(row, '[data-automation-id=\"promptOption\"]');\r\n\r\n  // returns first link to match expected section link format\r\n  const sectionLinkEl = allLinksInRow.find((el) => {\r\n    const text =\r\n      el.getAttribute(\"data-automation-label\") ||\r\n      el.getAttribute(\"title\") ||\r\n      el.getAttribute(\"aria-label\") ||\r\n      el.textContent ||\r\n      \"\";\r\n    return /^[A-Z][A-Z0-9_]*\\s*\\d{2,3}-/.test(text);\r\n  });\r\n\r\n  // finds text in the section link element\r\n  const sectionLinkText =\r\n    (sectionLinkEl &&\r\n      (sectionLinkEl.getAttribute(\"data-automation-label\") ||\r\n        sectionLinkEl.getAttribute(\"title\") ||\r\n        sectionLinkEl.getAttribute(\"aria-label\") ||\r\n        sectionLinkEl.textContent)) ||\r\n    \"\";\r\n\r\n  // if there are no links in the row, skip that row\r\n  const sectionDetails = parseSectionLinkString(sectionLinkText);\r\n  if (!sectionDetails) {\r\n    debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: no parsable promptOption\", {\r\n      promptOptions: allLinksInRow.length,\r\n      sectionLinkString: sectionLinkText,\r\n    });\r\n    return null;\r\n  }\r\n\r\n  debug.log({ id: \"extractFromRow.sectionLink\" }, \"Section link:\", {\r\n    promptOptions: allLinksInRow.length,\r\n    hasMatch: !!sectionLinkEl,\r\n    sectionLinkString: sectionLinkText,\r\n  });\r\n\r\n  const instructionalFormatText = readCellTextByHeader(\"instructionalFormat\");\r\n  const startDateText = readCellTextByHeader(\"startDate\");\r\n\r\n  // extracting infomation from the section link text\r\n  const code = sectionDetails.code;\r\n  const title = sectionDetails.title;\r\n  const section_number = sectionDetails.section_number;\r\n\r\n  debug.log({ id: \"extractFromRow.coreParse\" }, \"Core parse result:\", {\r\n    code,\r\n    title,\r\n    section_number,\r\n  });\r\n\r\n  // determine whether this row is for a course, lab, seminar, or discussion\r\n  const labLike = (s) => /\\b(laboratory)\\b/i.test(String(s || \"\"));\r\n  const seminarLike = (s) => /\\bseminar\\b/i.test(String(s || \"\"));\r\n  const discussionLike = (s) => /\\bdiscussion\\b/i.test(String(s || \"\"));\r\n\r\n  const isLab = labLike(instructionalFormatText);\r\n  const isSeminar = seminarLike(instructionalFormatText);\r\n  const isDiscussion = discussionLike(instructionalFormatText);\r\n\r\n  // if row is a lab or seminar, do not set instructor\r\n  let instructor = \"N/A\";\r\n\r\n  if (!isLab && !isSeminar) {\r\n    instructor = readCellTextByHeader(\"instructor\");\r\n\r\n    if (!instructor) {\r\n      debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: missing instructor cell\", {\r\n        code,\r\n        section_number,\r\n      });\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // find meeting cell\r\n  const meetingEl = getCellByHeader(\"meeting\");\r\n  if (!meetingEl) {\r\n    debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: missing meeting cell\", {\r\n      code,\r\n      section_number,\r\n    });\r\n    return null;\r\n  }\r\n\r\n  // extract meeting lines from the meeting cell\r\n  const meetingLines = extractMeetingLinesFromCell(meetingEl) || [];\r\n  if (!meetingLines.length) {\r\n    debug.warn({ id: \"extractFromRow.skip\" }, \"Skipping row: no meeting lines found in meeting cell\", {\r\n      code,\r\n      section_number,\r\n    });\r\n    return null;\r\n  }\r\n\r\n  const meetingObj = formatMeetingLineForPanel(meetingLines[0]);\r\n\r\n  // delivery mode is OPTIONAL (some grids don't have it)\r\n  const deliveryModeEl = getCellByHeader(\"deliveryMode\");\r\n\r\n  // ‚úÖ fix: only treat as online if we can actually detect it\r\n  const isOnline = deliveryModeEl ? isOnlineDelivery(deliveryModeEl) : false;\r\n\r\n  if (isOnline) meetingObj.location = \"Online\";\r\n\r\n  let meeting = [meetingObj.days, meetingObj.time].filter(Boolean).join(\" | \");\r\n  meeting += `\\n${meetingObj.location || (isOnline ? \"Online\" : \"\")}`;\r\n\r\n  const startDate = extractStartDate(meetingLines[0]) || extractStartDate(startDateText);\r\n\r\n  const result = {\r\n    code,\r\n    title,\r\n    section_number,\r\n    instructor,\r\n    meeting: normalizeMeetingPatternsText(meeting),\r\n    instructionalFormat: (instructionalFormatText || \"\").trim(),\r\n    startDate,\r\n    meetingLines: meetingLines,\r\n    isLab,\r\n    isSeminar,\r\n    isDiscussion,\r\n  };\r\n\r\n  debug.log({ id: \"extractFromRow.result\" }, \"Extracted course:\", {\r\n    code: result.code,\r\n    title: result.title,\r\n    section_number: result.section_number,\r\n    isLab: result.isLab,\r\n    isSeminar: result.isSeminar,\r\n    isDiscussion: result.isDiscussion,\r\n    isOnline,\r\n  });\r\n\r\n  return result;\r\n}\r\n","// src/mainPanel/renderCourseRows.js\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"renderCourseRows\");\r\n\r\nconst escHTML = (s) =>\r\n  String(s ?? \"\")\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n\r\nfunction cleanLines(text) {\r\n  return String(text || \"\")\r\n    .replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \" \")\r\n    .replace(/[ \\t]+\\n/g, \"\\n\")\r\n    .replace(/\\n[ \\t]+/g, \"\\n\")\r\n    .replace(/\\n{2,}/g, \"\\n\")\r\n    .trim();\r\n}\r\n\r\nfunction getBadge(course) {\r\n  if (course.isLab) return \"[Laboratory]\";\r\n  if (course.isSeminar) return \"[Seminar]\";\r\n  if (course.isDiscussion) return \"[Discussion]\";\r\n  return \"\";\r\n}\r\n\r\nfunction splitMeeting(meeting) {\r\n  const parts = cleanLines(meeting).split(\"\\n\");\r\n  const main = (parts[0] || \"\").trim();\r\n  const sub = parts\r\n    .slice(1)\r\n    .map((s) => s.replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \"\").trim())\r\n    .filter(Boolean)\r\n    .join(\"\\n\");\r\n\r\n  return { main, sub };\r\n}\r\n\r\nexport function renderCourseRows(ui, courses) {\r\n  ui.tableBody.innerHTML = \"\";\r\n  const frag = document.createDocumentFragment();\r\n\r\n  (courses || []).forEach((course) => {\r\n    const tr = document.createElement(\"tr\");\r\n    const badge = getBadge(course);\r\n\r\n    const { main: meetingMain, sub: meetingSub } = splitMeeting(course.meeting);\r\n\r\n    tr.innerHTML = `\r\n      <td class=\"title\">\r\n        <div class=\"title-main\">${escHTML(course.title || \"\")}</div>\r\n        ${badge ? `<div class=\"muted\">${escHTML(badge)}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"code\">${escHTML(course.code || \"\")}</td>\r\n      <td class=\"sect\">${escHTML((course.section_number || \"\").trim())}</td>\r\n      <td class=\"instructor\">${escHTML(course.instructor || \"\")}</td>\r\n      <td class=\"meeting\">\r\n        ${meetingMain ? `<span class=\"meeting-pill\">${escHTML(meetingMain)}</span>` : \"\"}\r\n        ${meetingSub ? `<div class=\"meeting-sub\">${escHTML(meetingSub)}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"instructionalFormat\">${escHTML(course.instructionalFormat || \"\")}</td>\r\n    `;\r\n\r\n    frag.appendChild(tr);\r\n  });\r\n\r\n  ui.tableBody.appendChild(frag);\r\n\r\n  debug.log({ id: \"renderCourseRows.done\" }, \"Rendered course rows\", {\r\n    count: (courses || []).length,\r\n  });\r\n}\r\n","// src/mainPanel/mainPanelInteractions.js\r\nimport { $$, on } from \"../utilities/dom.js\";\r\nimport { STATE } from \"../core/state.js\";\r\nimport { renderCourseRows } from \"./renderCourseRows.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"mainPanelInteractions\");\r\n\r\nexport function filterCourses(query) {\r\n  const q = (query || \"\").trim().toLowerCase();\r\n\r\n  if (!q) {\r\n    STATE.filtered = [...STATE.courses];\r\n    return;\r\n  }\r\n\r\n  const keys = [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"];\r\n\r\n  STATE.filtered = STATE.courses.filter((c) =>\r\n    keys.some((k) =>\r\n      String(c?.[k] || \"\")\r\n        .toLowerCase()\r\n        .includes(q)\r\n    )\r\n  );\r\n}\r\n\r\nexport function sortCourses(key) {\r\n  if (!key) return;\r\n\r\n  const dir = STATE.sort.key === key ? -STATE.sort.dir : 1;\r\n  STATE.sort = { key, dir };\r\n\r\n  const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: \"base\" });\r\n  STATE.filtered.sort((a, b) => dir * collator.compare(a?.[key] || \"\", b?.[key] || \"\"));\r\n}\r\n\r\nexport function wireTableSorting(ui) {\r\n  const headCells = $$(ui.tableHead, \"th[data-key]\");\r\n\r\n  headCells.forEach((th) => {\r\n    on(th, \"click\", () => {\r\n      const key = th.getAttribute(\"data-key\");\r\n      sortCourses(key);\r\n      renderCourseRows(ui, STATE.filtered);\r\n\r\n      headCells.forEach((h) => h.classList.remove(\"sorted-asc\", \"sorted-desc\"));\r\n      th.classList.add(STATE.sort.dir === 1 ? \"sorted-asc\" : \"sorted-desc\");\r\n\r\n      debug.log({ id: \"wireTableSorting.click\" }, \"Sorted via header\", { key, dir: STATE.sort.dir });\r\n    });\r\n  });\r\n}\r\n","// src/mainPanel/scheduleView.js\r\nimport { extractStartDate } from \"../extraction/parsers/meetingPatternsInfo.js\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"scheduleView\");\r\n\r\nconst DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"];\r\nconst START_HOUR = 8;\r\nconst END_HOUR = 21;\r\nconst SLOT_MINUTES = 30;\r\n\r\nconst SLOTS = [];\r\nfor (let h = START_HOUR; h < END_HOUR; h++) {\r\n  SLOTS.push(h * 60);\r\n  SLOTS.push(h * 60 + 30);\r\n}\r\nSLOTS.push(END_HOUR * 60);\r\n\r\nconst DAY_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\nconst TIME_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/gi;\r\n\r\nconst SEMESTER_MONTHS = {\r\n  first: [\"09\", \"08\"],\r\n  second: [\"01\", \"12\"],\r\n};\r\n\r\nfunction parseTimeToken(token) {\r\n  const match = String(token || \"\")\r\n    .trim()\r\n    .match(/(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i);\r\n  if (!match) return null;\r\n\r\n  let hours = Number.parseInt(match[1], 10);\r\n  const minutes = Number.parseInt(match[2], 10);\r\n  const period = match[3].toLowerCase();\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return hours * 60 + minutes;\r\n}\r\n\r\nfunction parseMeetingLine(line) {\r\n  const days = String(line || \"\").match(DAY_REGEX) || [];\r\n  const timeTokens = String(line || \"\").match(TIME_REGEX) || [];\r\n\r\n  if (days.length === 0 || timeTokens.length < 2) return null;\r\n\r\n  const startMinutes = parseTimeToken(timeTokens[0]);\r\n  const endMinutes = parseTimeToken(timeTokens[1]);\r\n  if (startMinutes == null || endMinutes == null) return null;\r\n  if (endMinutes <= startMinutes) return null;\r\n\r\n  return {\r\n    days: [...new Set(days)],\r\n    startMinutes,\r\n    endMinutes,\r\n    timeLabel: `${timeTokens[0]} - ${timeTokens[1]}`,\r\n  };\r\n}\r\n\r\nfunction getSemester(startDate) {\r\n  if (!startDate) return null;\r\n  const month = startDate.split(\"-\")[1];\r\n\r\n  if (SEMESTER_MONTHS.first.includes(month)) return \"first\";\r\n  if (SEMESTER_MONTHS.second.includes(month)) return \"second\";\r\n  return null;\r\n}\r\n\r\nfunction clampToGrid(minutes) {\r\n  const min = START_HOUR * 60;\r\n  const max = END_HOUR * 60;\r\n  return Math.max(min, Math.min(max, minutes));\r\n}\r\n\r\nfunction snapDownToSlot(minutes) {\r\n  return Math.floor(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction snapUpToSlot(minutes) {\r\n  return Math.ceil(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction slotIndexOf(minutes) {\r\n  return SLOTS.indexOf(minutes);\r\n}\r\n\r\nfunction buildDayEvents(courses, semester) {\r\n  const eventsByDay = new Map();\r\n  DAYS.forEach((d) => eventsByDay.set(d, []));\r\n\r\n  const seen = new Set();\r\n  let eventId = 0;\r\n\r\n  (courses || []).forEach((course) => {\r\n    const startDate = course.startDate || extractStartDate(course.meetingLines?.[0]) || \"\";\r\n    const courseSemester = getSemester(startDate);\r\n    if (courseSemester !== semester) return;\r\n\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n\r\n    const label = course.isLab\r\n      ? \"[Laboratory]\"\r\n      : course.isSeminar\r\n      ? \"[Seminar]\"\r\n      : course.isDiscussion\r\n      ? \"[Discussion]\"\r\n      : \"\";\r\n\r\n    lines.forEach((line) => {\r\n      const parsed = parseMeetingLine(line);\r\n      if (!parsed) return;\r\n\r\n      let startMin = snapDownToSlot(clampToGrid(parsed.startMinutes));\r\n      let endMin = snapUpToSlot(clampToGrid(parsed.endMinutes));\r\n\r\n      const startIdx = slotIndexOf(startMin);\r\n      const endIdx = slotIndexOf(endMin);\r\n      if (startIdx === -1 || endIdx === -1 || endIdx <= startIdx) return;\r\n\r\n      const rowSpan = endIdx - startIdx;\r\n\r\n      parsed.days.forEach((day) => {\r\n        if (!eventsByDay.has(day)) return;\r\n\r\n        const key = [day, course.code || \"\", course.title || \"\", parsed.timeLabel, startIdx, rowSpan].join(\"|\");\r\n        if (seen.has(key)) return;\r\n        seen.add(key);\r\n\r\n        eventsByDay.get(day).push({\r\n          id: eventId++,\r\n          code: course.code || \"\",\r\n          title: course.title || \"\",\r\n          label,\r\n          timeLabel: parsed.timeLabel,\r\n          rowStart: startIdx,\r\n          rowSpan,\r\n          startIdx,\r\n          endIdx,\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  DAYS.forEach((day) => {\r\n    eventsByDay.get(day).sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n  });\r\n\r\n  return eventsByDay;\r\n}\r\n\r\nfunction addConflicts(eventsByDay) {\r\n  const groupedByDay = new Map();\r\n\r\n  DAYS.forEach((day) => {\r\n    const events = (eventsByDay.get(day) || []).slice().sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n\r\n    const groups = [];\r\n    let current = null;\r\n    let currentKey = null;\r\n\r\n    for (let r = 0; r < SLOTS.length - 1; r++) {\r\n      const active = events.filter((ev) => ev.startIdx <= r && ev.endIdx > r);\r\n      const key = active.length\r\n        ? active\r\n            .map((ev) => ev.id)\r\n            .sort((a, b) => a - b)\r\n            .join(\"|\")\r\n        : null;\r\n\r\n      if (!key) {\r\n        if (current) groups.push(current);\r\n        current = null;\r\n        currentKey = null;\r\n        continue;\r\n      }\r\n\r\n      if (current && key === currentKey) {\r\n        current.end = r + 1;\r\n        continue;\r\n      }\r\n\r\n      if (current) groups.push(current);\r\n\r\n      current = { start: r, end: r + 1, events: active, hasConflict: active.length > 1 };\r\n      currentKey = key;\r\n    }\r\n\r\n    if (current) groups.push(current);\r\n    groupedByDay.set(day, groups);\r\n  });\r\n\r\n  return groupedByDay;\r\n}\r\n\r\nfunction getConflictSummaries(groupedByDay) {\r\n  const seen = new Set();\r\n  const conflicts = [];\r\n\r\n  groupedByDay.forEach((groups) => {\r\n    groups.forEach((group) => {\r\n      if (!group.hasConflict) return;\r\n\r\n      const codes = [...new Set(group.events.map((ev) => ev.code || ev.title).filter(Boolean))];\r\n      if (codes.length < 2) return;\r\n\r\n      codes.sort((a, b) => a.localeCompare(b));\r\n\r\n      const key = codes.join(\"|\");\r\n      if (seen.has(key)) return;\r\n\r\n      seen.add(key);\r\n      conflicts.push(codes);\r\n    });\r\n  });\r\n\r\n  return conflicts;\r\n}\r\n\r\nfunction updateConflictFooter(ui, conflicts) {\r\n  if (!ui?.footerConflicts) return;\r\n\r\n  if (!conflicts.length) {\r\n    ui.footerConflicts.textContent = \"\";\r\n    return;\r\n  }\r\n\r\n  const conflictList = conflicts.map((codes) => `[${codes.join(\", \")}]`).join(\" \");\r\n  ui.footerConflicts.textContent = `‚ö†Ô∏è The following classes are in conflict: ${conflictList}`;\r\n}\r\n\r\nfunction formatSlotLabel(minutes) {\r\n  const h24 = Math.floor(minutes / 60);\r\n  const m = minutes % 60;\r\n  return `${String(h24)}:${String(m).padStart(2, \"0\")}`;\r\n}\r\n\r\nfunction buildScheduleTable() {\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.className = \"schedule-table-wrap\";\r\n\r\n  const table = document.createElement(\"table\");\r\n  table.className = \"schedule-table\";\r\n\r\n  const thead = document.createElement(\"thead\");\r\n  const headRow = document.createElement(\"tr\");\r\n\r\n  headRow.innerHTML = `\r\n    <th class=\"schedule-time\"></th>\r\n    ${DAYS.map((day) => `<th class=\"schedule-day-head\" data-day=\"${day}\">${day}</th>`).join(\"\")}\r\n  `;\r\n\r\n  thead.appendChild(headRow);\r\n  table.appendChild(thead);\r\n\r\n  const tbody = document.createElement(\"tbody\");\r\n\r\n  for (let r = 0; r < SLOTS.length; r++) {\r\n    const row = document.createElement(\"tr\");\r\n\r\n    const timeTd = document.createElement(\"td\");\r\n    timeTd.className = \"schedule-time\";\r\n    timeTd.textContent = formatSlotLabel(SLOTS[r]);\r\n    row.appendChild(timeTd);\r\n\r\n    DAYS.forEach((day) => {\r\n      const td = document.createElement(\"td\");\r\n      td.className = \"schedule-cell\";\r\n      td.dataset.day = day;\r\n      td.dataset.row = String(r);\r\n\r\n      const inner = document.createElement(\"div\");\r\n      inner.className = \"schedule-cell-inner\";\r\n      td.appendChild(inner);\r\n\r\n      row.appendChild(td);\r\n    });\r\n\r\n    tbody.appendChild(row);\r\n  }\r\n\r\n  table.appendChild(tbody);\r\n  wrap.appendChild(table);\r\n\r\n  const overlay = document.createElement(\"div\");\r\n  overlay.className = \"schedule-overlay\";\r\n  wrap.appendChild(overlay);\r\n\r\n  return wrap;\r\n}\r\n\r\nfunction renderOverlayBlocks(wrap, eventsByDay) {\r\n  const overlay = wrap.querySelector(\".schedule-overlay\");\r\n  overlay.innerHTML = \"\";\r\n\r\n  const table = wrap.querySelector(\".schedule-table\");\r\n  const firstBodyRow = table.querySelector(\"tbody tr\");\r\n  const firstDayCell = table.querySelector('tbody tr td.schedule-cell[data-day=\"Mon\"]');\r\n  const timeTh = table.querySelector(\"thead th.schedule-time\");\r\n\r\n  if (!firstBodyRow || !firstDayCell || !timeTh) return;\r\n\r\n  const timeColWidth = timeTh.getBoundingClientRect().width;\r\n  const dayColWidth = firstDayCell.getBoundingClientRect().width;\r\n  const headerHeight = table.querySelector(\"thead\").getBoundingClientRect().height;\r\n  const rowHeight = firstBodyRow.getBoundingClientRect().height;\r\n\r\n  const cellStyles = getComputedStyle(firstDayCell);\r\n  const borderLeft = parseFloat(cellStyles.borderLeftWidth) || 0;\r\n  const borderTop = parseFloat(cellStyles.borderTopWidth) || 0;\r\n  const borderRight = parseFloat(cellStyles.borderRightWidth) || 0;\r\n  const borderBottom = parseFloat(cellStyles.borderBottomWidth) || 0;\r\n\r\n  const borderX = (borderLeft + borderRight) / 2;\r\n  const borderY = (borderTop + borderBottom) / 2;\r\n\r\n  DAYS.forEach((day, dayIndex) => {\r\n    const events = eventsByDay.get(day) || [];\r\n\r\n    events.forEach((ev) => {\r\n      const left = timeColWidth + dayIndex * dayColWidth;\r\n      const top = headerHeight + ev.rowStart * rowHeight;\r\n      const height = ev.rowSpan * rowHeight;\r\n\r\n      const block = document.createElement(\"div\");\r\n      block.className = \"schedule-entry-float\";\r\n      block.style.left = `${left + borderLeft}px`;\r\n      block.style.top = `${top + borderTop}px`;\r\n      block.style.width = `${dayColWidth - borderX}px`;\r\n      block.style.height = `${height - borderY}px`;\r\n\r\n      const overlapLayer = document.createElement(\"div\");\r\n      overlapLayer.className = \"schedule-entry-overlap-layer\";\r\n      block.appendChild(overlapLayer);\r\n\r\n      const text = document.createElement(\"div\");\r\n      text.className = \"schedule-entry-text\";\r\n      const title = ev.code || ev.title;\r\n      const titleLabel = ev.label ? `${title} ${ev.label}` : title;\r\n\r\n      text.innerHTML = `\r\n        <div class=\"schedule-entry-title\">${titleLabel}</div>\r\n        <div class=\"schedule-entry-time\">${ev.timeLabel}</div>\r\n      `;\r\n      block.appendChild(text);\r\n\r\n      overlay.appendChild(block);\r\n    });\r\n  });\r\n}\r\n\r\nexport function renderSchedule(ui, courses, semester) {\r\n  const host = ui?.scheduleGrid || ui?.schedulePanel || ui?.scheduleContainer || ui?.scheduleView || ui?.schedule;\r\n  if (!host) {\r\n    debug.warn(\"renderSchedule: no schedule host found on ui\");\r\n    return;\r\n  }\r\n\r\n  const eventsByDay = buildDayEvents(courses || [], semester);\r\n  const groupedByDay = addConflicts(eventsByDay);\r\n  const conflicts = getConflictSummaries(groupedByDay);\r\n\r\n  host.innerHTML = \"\";\r\n  const tableWrap = buildScheduleTable();\r\n  host.appendChild(tableWrap);\r\n\r\n  renderOverlayBlocks(tableWrap, eventsByDay);\r\n  updateConflictFooter(ui, conflicts);\r\n}\r\n","import { STATE } from \"../core/state\";\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\n\r\nconst debug = debugFor(\"export-ics\");\r\n\r\n// calendar timezone for DTSTART/DTEND (local class times) and RRULE UNTIL (UTC \"Z\" per spec)\r\nconst TZID = \"America/Vancouver\";\r\n\r\n// converts a Date object into this format: YYYYMMDDTHHMMSSZ\r\nconst formatDateTimeUTC = (date) => {\r\n  const y = date.getUTCFullYear();\r\n  const m = pad(date.getUTCMonth() + 1);\r\n  const d = pad(date.getUTCDate());\r\n  const hh = pad(date.getUTCHours());\r\n  const mm = pad(date.getUTCMinutes());\r\n  const ss = pad(date.getUTCSeconds());\r\n  debug.log(\"Formatting UTC Date:\", { y, m, d, hh, mm, ss });\r\n  return `${y}${m}${d}T${hh}${mm}${ss}Z`;\r\n};\r\n\r\n// maps ui's day labels to iCalendar day codes\r\nconst DAY_CODES = {\r\n  Mon: \"MO\",\r\n  Tue: \"TU\",\r\n  Wed: \"WE\",\r\n  Thu: \"TH\",\r\n  Fri: \"FR\",\r\n  Sat: \"SA\",\r\n  Sun: \"SU\",\r\n};\r\n\r\n// used to extract dates, times, and days from a meeting line string\r\nconst date_range_REGEX = /(\\d{4}-\\d{2}-\\d{2})\\s*-\\s*(\\d{4}-\\d{2}-\\d{2})/;\r\nconst time_range_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?\\s*-\\s*(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i;\r\nconst days_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\n\r\n// forces numbers to two digits\r\nconst padNumbers = (value) => String(value).padStart(2, \"0\");\r\n\r\n// ICS date format: YYYYMMDD\r\nconst formatDate = (date) => {\r\n  const year = date.getFullYear();\r\n  const month = padNumbers(date.getMonth() + 1);\r\n  const day = padNumbers(date.getDate());\r\n  debug.log(\"Formatted Date:\", { year, month, day });\r\n  return `${year}${month}${day}`;\r\n};\r\n\r\n// ICS datetime format (local): YYYYMMDDTHHMMSS\r\nconst formatDateTime = (date) => {\r\n  const datePart = formatDate(date);\r\n  const hours = padNumbers(date.getHours());\r\n  const minutes = padNumbers(date.getMinutes());\r\n\r\n  debug.log(\"Formatted DateTime:\", { datePart, hours, minutes });\r\n  return `${datePart}T${hours}${minutes}00`;\r\n};\r\n\r\n// ‚Äúp‚Äù adds 12, unless it‚Äôs 12pm already, ‚Äúa‚Äù turns 12am into 0\r\n// eg. parseTime(\"11\",\"30\",\"p\") -> { hours: 23, minutes: 30 }\r\nconst parseTime = (hoursToken, minutesToken, periodToken) => {\r\n  let hours = Number.parseInt(hoursToken, 10);\r\n  const minutes = Number.parseInt(minutesToken, 10);\r\n  const period = periodToken.toLowerCase();\r\n\r\n  debug.log(\"Parsing Time:\", { hours, minutes, period });\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return { hours, minutes };\r\n};\r\n\r\n// parses meeting line into structured data\r\nconst parseMeetingLine = (line) => {\r\n  const dateMatch = String(line || \"\").match(date_range_REGEX);\r\n  const timeMatch = String(line || \"\").match(time_range_REGEX);\r\n  const days = String(line || \"\").match(days_REGEX) || [];\r\n\r\n  if (!dateMatch || !timeMatch || !days.length) return null;\r\n\r\n  debug.log(\"Parsed Meeting Line:\", { dateMatch, timeMatch, days });\r\n\r\n  const startDate = dateMatch[1];\r\n  const endDate = dateMatch[2];\r\n\r\n  const startTime = parseTime(timeMatch[1], timeMatch[2], timeMatch[3]);\r\n  const endTime = parseTime(timeMatch[4], timeMatch[5], timeMatch[6]);\r\n\r\n  const uniqueDays = [...new Set(days.map((day) => DAY_CODES[day]).filter(Boolean))];\r\n\r\n  return {\r\n    startDate,\r\n    endDate,\r\n    days: uniqueDays,\r\n    startTime,\r\n    endTime,\r\n  };\r\n};\r\n\r\n// finds location from meeting line\r\nconst extractLocation = (line) => {\r\n  const parts = String(line || \"\")\r\n    .split(\"|\")\r\n    .map((part) => part.trim())\r\n    .filter(Boolean);\r\n\r\n  const locationPart = parts.find((part) => /\\([A-Z]{2,}\\)/.test(part));\r\n  if (locationPart) return locationPart;\r\n\r\n  const onlinePart = parts.find((part) => /online/i.test(part));\r\n  if (onlinePart) return onlinePart;\r\n\r\n  return \"\";\r\n};\r\n\r\n// finds the first calendar date on/after startDate that matches one of the meeting days\r\nconst findFirstValidDate = (startDate, dayCodes) => {\r\n  const start = new Date(`${startDate}T00:00:00`);\r\n\r\n  for (let offset = 0; offset < 7; offset += 1) {\r\n    const date = new Date(start);\r\n    date.setDate(start.getDate() + offset);\r\n    const code = Object.values(DAY_CODES)[date.getDay() === 0 ? 6 : date.getDay() - 1];\r\n    if (dayCodes.includes(code)) return date;\r\n  }\r\n\r\n  return start;\r\n};\r\n\r\n// builds an event object from course and meeting line data\r\nconst buildClassEvent = (course, line) => {\r\n  const parsed = parseMeetingLine(line);\r\n  if (!parsed) return null;\r\n\r\n  const firstDate = findFirstValidDate(parsed.startDate, parsed.days);\r\n  const startDate = new Date(firstDate);\r\n  startDate.setHours(parsed.startTime.hours, parsed.startTime.minutes, 0, 0);\r\n\r\n  const endDate = new Date(firstDate);\r\n  endDate.setHours(parsed.endTime.hours, parsed.endTime.minutes, 0, 0);\r\n\r\n  const summaryParts = [course.code, course.title].filter(Boolean);\r\n  const descriptionLines = [\r\n    course.title ? `Title: ${course.title}` : null,\r\n    course.code ? `Code: ${course.code}` : null,\r\n    course.section_number ? `Section: ${course.section_number}` : null,\r\n    course.instructor ? `Instructor: ${course.instructor}` : null,\r\n    course.instructionalFormat ? `Format: ${course.instructionalFormat}` : null,\r\n    course.meeting ? `Meeting: ${course.meeting}` : null,\r\n  ].filter(Boolean);\r\n\r\n  const untilLocal = new Date(`${parsed.endDate}T23:59:59`);\r\n  const untilDate = formatDateTimeUTC(untilLocal);\r\n\r\n  debug.log(\"Built Class Event:\", { course, parsed, startDate, endDate, summaryParts, descriptionLines, untilDate });\r\n\r\n  return {\r\n    uid: `${course.code || \"course\"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,\r\n    summary: summaryParts.join(\" - \") || \"Scheduled Course\",\r\n    description: descriptionLines.join(\"\\\\n\"),\r\n    location: extractLocation(line),\r\n    dtstart: formatDateTime(startDate),\r\n    dtend: formatDateTime(endDate),\r\n    rrule: `FREQ=WEEKLY;BYDAY=${parsed.days.join(\",\")};UNTIL=${untilDate}`,\r\n  };\r\n};\r\n\r\n// loops through every course in the schedule and builds the full ICS file\r\nconst buildICSFile = (courses) => {\r\n  const events = [];\r\n\r\n  courses.forEach((course) => {\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n    lines.forEach((line) => {\r\n      const event = buildClassEvent(course, line);\r\n      if (event) events.push(event);\r\n    });\r\n  });\r\n\r\n  const lines = [\r\n    \"BEGIN:VCALENDAR\",\r\n    \"VERSION:2.0\",\r\n    \"PRODID:-//Workday Extension//Schedule Export//EN\",\r\n    \"CALSCALE:GREGORIAN\",\r\n    `X-WR-TIMEZONE:${TZID}`,\r\n  ];\r\n\r\n  events.forEach((event) => {\r\n    lines.push(\"BEGIN:VEVENT\");\r\n    lines.push(`UID:${event.uid}`);\r\n    lines.push(`SUMMARY:${event.summary}`);\r\n    if (event.description) lines.push(`DESCRIPTION:${event.description}`);\r\n    if (event.location) lines.push(`LOCATION:${event.location}`);\r\n    lines.push(`DTSTART;TZID=${TZID}:${event.dtstart}`);\r\n    lines.push(`DTEND;TZID=${TZID}:${event.dtend}`);\r\n    lines.push(`RRULE:${event.rrule}`);\r\n    lines.push(\"END:VEVENT\");\r\n  });\r\n\r\n  lines.push(\"END:VCALENDAR\");\r\n  debug.log(\"ICS File Generated:\", lines);\r\n  return lines.join(\"\\r\\n\");\r\n};\r\n\r\n// generates the ICS string from the current filtered courses, wraps it in a Blob (file-like object)\r\n// creates a temporary URL for it and a hidden <a> then ‚Äúclicks‚Äù it to download\r\n// cleans up the URL + anchor afterward\r\nexport function exportICS() {\r\n  const ics = buildICSFile(STATE.filtered || []);\r\n  const blob = new Blob([ics], { type: \"text/calendar;charset=utf-8\" });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = \"workday-schedule.ics\";\r\n  document.body.appendChild(a);\r\n  a.click();\r\n\r\n  debug.log(\"Download Triggered for ICS file\");\r\n\r\n  setTimeout(() => {\r\n    URL.revokeObjectURL(url);\r\n    a.remove();\r\n  }, 100);\r\n}\r\n","// src/mainPanel/scheduleStorage.js\r\nimport { debugFor } from \"../utilities/debugTool.js\";\r\nconst debug = debugFor(\"scheduleStorage\");\r\n\r\nconst STORAGE_KEY = \"wdSavedSchedules\";\r\nconst MAX_SCHEDULES = 6;\r\n\r\nconst cloneCourses = (courses) => {\r\n  if (typeof structuredClone === \"function\") return structuredClone(courses);\r\n  return JSON.parse(JSON.stringify(courses || []));\r\n};\r\n\r\nconst sanitizeSchedules = (schedules) => {\r\n  if (!Array.isArray(schedules)) return [];\r\n  return schedules\r\n    .filter((s) => s && Array.isArray(s.courses))\r\n    .map((s) => ({\r\n      id: s.id,\r\n      name: s.name || \"Untitled\",\r\n      savedAt: s.savedAt || new Date().toISOString(),\r\n      courses: s.courses,\r\n    }));\r\n};\r\n\r\nconst useChromeStorage = typeof chrome !== \"undefined\" && chrome.storage && chrome.storage.local;\r\n\r\nexport async function loadSavedSchedules() {\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.get([STORAGE_KEY], (result) => {\r\n        resolve(sanitizeSchedules(result?.[STORAGE_KEY] || []));\r\n      });\r\n    });\r\n  }\r\n\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) return [];\r\n    return sanitizeSchedules(JSON.parse(raw));\r\n  } catch (error) {\r\n    debug.error(\"Failed to load schedules\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function persistSavedSchedules(schedules) {\r\n  const sanitized = sanitizeSchedules(schedules);\r\n\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.set({ [STORAGE_KEY]: sanitized }, () => resolve());\r\n    });\r\n  }\r\n\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(sanitized));\r\n  } catch (error) {\r\n    debug.error(\"Failed to save schedules\", error);\r\n  }\r\n}\r\n\r\nexport function createScheduleSnapshot(name, courses) {\r\n  const id =\r\n    typeof crypto !== \"undefined\" && crypto.randomUUID\r\n      ? crypto.randomUUID()\r\n      : `${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n\r\n  return {\r\n    id,\r\n    name: name || \"Untitled\",\r\n    savedAt: new Date().toISOString(),\r\n    courses: cloneCourses(courses || []),\r\n  };\r\n}\r\n\r\nexport function formatScheduleMeta(schedule) {\r\n  const count = schedule.courses?.length || 0;\r\n  const savedDate = new Date(schedule.savedAt);\r\n\r\n  const dateLabel = Number.isNaN(savedDate.getTime())\r\n    ? schedule.savedAt\r\n    : savedDate.toLocaleDateString(undefined, { year: \"numeric\", month: \"short\", day: \"numeric\" });\r\n\r\n  return `${count} courses ¬∑ Saved ${dateLabel}`;\r\n}\r\n\r\nexport function renderSavedSchedules(ui, schedules) {\r\n  if (!ui.savedMenu) return;\r\n\r\n  ui.savedMenu.innerHTML = \"\";\r\n\r\n  if (!schedules.length) {\r\n    const empty = document.createElement(\"div\");\r\n    empty.className = \"schedule-saved-empty\";\r\n    empty.textContent = \"No saved schedules yet.\";\r\n    ui.savedMenu.appendChild(empty);\r\n    return;\r\n  }\r\n\r\n  schedules.forEach((schedule) => {\r\n    const card = document.createElement(\"div\");\r\n    card.className = \"schedule-saved-card\";\r\n    card.dataset.id = schedule.id;\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"schedule-saved-card-header\";\r\n\r\n    const info = document.createElement(\"div\");\r\n\r\n    const title = document.createElement(\"div\");\r\n    title.className = \"schedule-saved-title\";\r\n    title.textContent = schedule.name;\r\n\r\n    const meta = document.createElement(\"div\");\r\n    meta.className = \"schedule-saved-meta\";\r\n    meta.textContent = formatScheduleMeta(schedule);\r\n\r\n    info.appendChild(title);\r\n    info.appendChild(meta);\r\n    header.appendChild(info);\r\n\r\n    const actions = document.createElement(\"div\");\r\n    actions.className = \"schedule-saved-actions\";\r\n\r\n    const loadButton = document.createElement(\"button\");\r\n    loadButton.type = \"button\";\r\n    loadButton.className = \"schedule-saved-action\";\r\n    loadButton.dataset.action = \"load\";\r\n    loadButton.textContent = \"Load\";\r\n\r\n    const deleteButton = document.createElement(\"button\");\r\n    deleteButton.type = \"button\";\r\n    deleteButton.className = \"schedule-saved-action delete\";\r\n    deleteButton.dataset.action = \"delete\";\r\n    deleteButton.textContent = \"Delete\";\r\n\r\n    actions.appendChild(loadButton);\r\n    actions.appendChild(deleteButton);\r\n\r\n    card.appendChild(header);\r\n    card.appendChild(actions);\r\n\r\n    ui.savedMenu.appendChild(card);\r\n  });\r\n\r\n  debug.log({ id: \"renderSavedSchedules.done\" }, \"Rendered saved schedules\", { count: schedules.length });\r\n}\r\n\r\nexport function canSaveMoreSchedules(schedules) {\r\n  return (schedules?.length || 0) < MAX_SCHEDULES;\r\n}\r\n\r\nexport function getMaxScheduleCount() {\r\n  return MAX_SCHEDULES;\r\n}\r\n","// src/content.js\r\nimport { on, debounce } from \"./utilities/dom.js\";\r\nimport { STATE } from \"./core/state.js\";\r\nimport { ensureMount } from \"./utilities/shadowMount.js\";\r\n\r\nimport { loadMainPanel } from \"./mainPanel/loadMainPanel.js\";\r\nimport { extractCoursesData } from \"./extraction/index.js\";\r\n\r\nimport { filterCourses, sortCourses, wireTableSorting } from \"./mainPanel/mainPanelInteractions.js\";\r\nimport { renderCourseRows } from \"./mainPanel/renderCourseRows.js\";\r\nimport { renderSchedule } from \"./mainPanel/scheduleView.js\";\r\n\r\nimport { exportICS } from \"./export-logic/export-ics.js\";\r\n\r\nimport {\r\n  canSaveMoreSchedules,\r\n  createScheduleSnapshot,\r\n  getMaxScheduleCount,\r\n  loadSavedSchedules,\r\n  persistSavedSchedules,\r\n  renderSavedSchedules,\r\n} from \"./mainPanel/scheduleStorage.js\";\r\n\r\n(() => {\r\n  console.log(\"[WD] content script loaded\");\r\n\r\n  async function boot() {\r\n    const shadowRoot = ensureMount();\r\n    const ui = await loadMainPanel(shadowRoot);\r\n\r\n    // ---------------------------\r\n    // Helpers\r\n    // ---------------------------\r\n    const updateScheduleView = () => {\r\n      renderSchedule(ui, STATE.filtered, STATE.view.semester);\r\n    };\r\n\r\n    const renderAll = () => {\r\n      sortCourses(STATE.sort.key || \"code\");\r\n      renderCourseRows(ui, STATE.filtered);\r\n      updateScheduleView();\r\n    };\r\n\r\n    const setActiveView = (viewKey) => {\r\n      STATE.view.panel = viewKey;\r\n\r\n      ui.views.forEach((el) => el.classList.toggle(\"is-active\", el.dataset.panel === viewKey));\r\n      ui.viewTabs.forEach((btn) => btn.classList.toggle(\"is-active\", btn.dataset.panel === viewKey));\r\n\r\n      ui.mainPanel.classList.toggle(\"is-schedule-view\", viewKey === \"schedule\");\r\n      ui.mainPanel.classList.toggle(\"is-settings-view\", viewKey === \"settings\");\r\n      ui.mainPanel.classList.toggle(\"is-help-view\", viewKey === \"help\");\r\n    };\r\n\r\n    const syncFloatingButtonState = () => {\r\n      ui.floatingButton.classList.toggle(\"is-collapsed\", ui.mainPanel.classList.contains(\"is-hidden\"));\r\n    };\r\n\r\n    const toggleMainPanel = () => {\r\n      ui.mainPanel.classList.toggle(\"is-hidden\");\r\n      syncFloatingButtonState();\r\n    };\r\n\r\n    syncFloatingButtonState();\r\n\r\n    // ---------------------------\r\n    // Modal (Save Schedule)\r\n    // ---------------------------\r\n    let resolveScheduleModal = null;\r\n\r\n    const closeScheduleModal = (value) => {\r\n      if (!ui.saveModal) return;\r\n\r\n      ui.saveModal.classList.add(\"is-hidden\");\r\n      ui.saveModal.setAttribute(\"aria-hidden\", \"true\");\r\n\r\n      if (resolveScheduleModal) {\r\n        resolveScheduleModal(value);\r\n        resolveScheduleModal = null;\r\n      }\r\n    };\r\n\r\n    const openScheduleModal = ({ title, message, confirmLabel = \"Save\", showInput = true, showCancel = true }) => {\r\n      if (!ui.saveModal) return Promise.resolve(null);\r\n\r\n      ui.saveModalTitle.textContent = title;\r\n      ui.saveModalMessage.textContent = message;\r\n      ui.saveModalConfirm.textContent = confirmLabel;\r\n\r\n      ui.saveModalField.classList.toggle(\"is-hidden\", !showInput);\r\n      ui.saveModalCancel.classList.toggle(\"is-hidden\", !showCancel);\r\n\r\n      ui.saveModalInput.value = \"\";\r\n      ui.saveModalInput.classList.remove(\"is-invalid\");\r\n\r\n      ui.saveModal.classList.remove(\"is-hidden\");\r\n      ui.saveModal.setAttribute(\"aria-hidden\", \"false\");\r\n\r\n      if (showInput) ui.saveModalInput.focus();\r\n      else ui.saveModalConfirm.focus();\r\n\r\n      return new Promise((resolve) => {\r\n        resolveScheduleModal = resolve;\r\n      });\r\n    };\r\n\r\n    if (ui.saveModal) {\r\n      on(ui.saveModal, \"click\", (event) => {\r\n        if (event.target === ui.saveModal) return closeScheduleModal(null);\r\n\r\n        const action = event.target.closest(\"[data-action]\")?.dataset.action;\r\n        if (!action) return;\r\n\r\n        if (action === \"close\" || action === \"cancel\") return closeScheduleModal(null);\r\n\r\n        if (action === \"confirm\") {\r\n          const needsInput = !ui.saveModalField.classList.contains(\"is-hidden\");\r\n          if (needsInput) {\r\n            const value = ui.saveModalInput.value.trim();\r\n            if (!value) {\r\n              ui.saveModalInput.classList.add(\"is-invalid\");\r\n              ui.saveModalInput.focus();\r\n              return;\r\n            }\r\n            return closeScheduleModal(value);\r\n          }\r\n          return closeScheduleModal(true);\r\n        }\r\n      });\r\n\r\n      on(ui.saveModalInput, \"input\", () => ui.saveModalInput.classList.remove(\"is-invalid\"));\r\n      on(ui.saveModalInput, \"keydown\", (event) => {\r\n        if (event.key === \"Enter\") ui.saveModalConfirm.click();\r\n      });\r\n\r\n      on(document, \"keydown\", (event) => {\r\n        if (event.key === \"Escape\" && !ui.saveModal.classList.contains(\"is-hidden\")) closeScheduleModal(null);\r\n      });\r\n    }\r\n\r\n    // ---------------------------\r\n    // Views + semester toggles\r\n    // ---------------------------\r\n    ui.viewTabs.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        setActiveView(btn.dataset.panel);\r\n        if (btn.dataset.panel === \"schedule\") updateScheduleView();\r\n      });\r\n    });\r\n\r\n    ui.semesterButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        STATE.view.semester = btn.dataset.semester;\r\n\r\n        ui.semesterButtons.forEach((b) => b.classList.toggle(\"is-active\", b.dataset.semester === STATE.view.semester));\r\n        updateScheduleView();\r\n      });\r\n    });\r\n\r\n    on(ui.floatingButton, \"click\", toggleMainPanel);\r\n\r\n    // ---------------------------\r\n    // Dropdowns (export + saved)\r\n    // ---------------------------\r\n    const setExportOpen = (isOpen) => {\r\n      if (!ui.exportDropdown || !ui.exportButton) return;\r\n      ui.exportDropdown.classList.toggle(\"is-open\", isOpen);\r\n      ui.exportButton.setAttribute(\"aria-expanded\", String(isOpen));\r\n    };\r\n\r\n    on(ui.exportButton, \"click\", () => {\r\n      const isOpen = ui.exportDropdown.classList.contains(\"is-open\");\r\n      setExportOpen(!isOpen);\r\n    });\r\n\r\n    // Single click-outside handler (closes both export + saved dropdowns)\r\n    on(document, \"click\", (event) => {\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n\r\n      // Export dropdown: class-based\r\n      if (ui.exportDropdown?.classList.contains(\"is-open\") && !path.includes(ui.exportDropdown)) {\r\n        setExportOpen(false);\r\n      }\r\n\r\n      // Saved dropdown: <details open>\r\n      if (ui.savedDropdown?.open && !path.includes(ui.savedDropdown)) {\r\n        ui.savedDropdown.open = false;\r\n      }\r\n    });\r\n\r\n    // ---------------------------\r\n    // Messages\r\n    // ---------------------------\r\n    chrome.runtime.onMessage.addListener((message) => {\r\n      if (message?.type === \"TOGGLE_WIDGET\") toggleMainPanel();\r\n    });\r\n\r\n    // ---------------------------\r\n    // Refresh (re-extract)\r\n    // ---------------------------\r\n    on(ui.refreshButton, \"click\", async () => {\r\n      STATE.courses = await extractCoursesData();\r\n      filterCourses(ui.searchInput.value);\r\n      renderAll();\r\n    });\r\n\r\n    // ---------------------------\r\n    // Export actions\r\n    // ---------------------------\r\n    const handleExport = async (type) => {\r\n      if (type === \"ics\") exportICS();\r\n    };\r\n\r\n    on(ui.exportMenu, \"click\", async (event) => {\r\n      const action = event.target.closest(\"[data-export]\");\r\n      if (!action) return;\r\n\r\n      setExportOpen(false);\r\n      await handleExport(action.dataset.export);\r\n    });\r\n\r\n    // ---------------------------\r\n    // Save schedules\r\n    // ---------------------------\r\n    on(ui.saveScheduleButton, \"click\", async () => {\r\n      if (!canSaveMoreSchedules(STATE.savedSchedules)) {\r\n        await openScheduleModal({\r\n          title: \"Schedule limit reached\",\r\n          message: `You can only save up to ${getMaxScheduleCount()} schedules. Delete one to save another.`,\r\n          confirmLabel: \"Got it\",\r\n          showInput: false,\r\n          showCancel: false,\r\n        });\r\n        return;\r\n      }\r\n\r\n      const name = await openScheduleModal({\r\n        title: \"Save schedule\",\r\n        message: \"Name this schedule so you can find it later.\",\r\n        confirmLabel: \"Save\",\r\n        showInput: true,\r\n        showCancel: true,\r\n      });\r\n\r\n      if (!name) return;\r\n\r\n      const snapshot = createScheduleSnapshot(name, STATE.filtered);\r\n      STATE.savedSchedules = [snapshot, ...STATE.savedSchedules];\r\n\r\n      await persistSavedSchedules(STATE.savedSchedules);\r\n      renderSavedSchedules(ui, STATE.savedSchedules);\r\n\r\n      if (ui.savedDropdown) ui.savedDropdown.open = true;\r\n    });\r\n\r\n    on(ui.savedMenu, \"click\", async (event) => {\r\n      const actionButton = event.target.closest(\"[data-action]\");\r\n      if (!actionButton) return;\r\n\r\n      const card = actionButton.closest(\".schedule-saved-card\");\r\n      const scheduleId = card?.dataset.id;\r\n      if (!scheduleId) return;\r\n\r\n      const selected = STATE.savedSchedules.find((s) => s.id === scheduleId);\r\n      if (!selected) return;\r\n\r\n      if (actionButton.dataset.action === \"delete\") {\r\n        const confirmed = await openScheduleModal({\r\n          title: \"Permanently Delete Schedule?\",\r\n          message: `This action will permanently delete \"${selected.name}\".`,\r\n          confirmLabel: \"Delete\",\r\n          showInput: false,\r\n          showCancel: true,\r\n        });\r\n        if (!confirmed) return;\r\n\r\n        STATE.savedSchedules = STATE.savedSchedules.filter((s) => s.id !== scheduleId);\r\n        await persistSavedSchedules(STATE.savedSchedules);\r\n        renderSavedSchedules(ui, STATE.savedSchedules);\r\n        return;\r\n      }\r\n\r\n      // Load\r\n      STATE.courses = [...selected.courses];\r\n      STATE.filtered = [...selected.courses];\r\n      ui.searchInput.value = \"\";\r\n\r\n      renderAll();\r\n      setActiveView(\"schedule\");\r\n      if (ui.savedDropdown) ui.savedDropdown.open = false;\r\n    });\r\n\r\n    // ---------------------------\r\n    // Settings/help shortcuts\r\n    // ---------------------------\r\n    on(ui.settingsButton, \"click\", () => {\r\n      ui.mainPanel.classList.remove(\"is-hidden\");\r\n      ui.floatingButton.classList.remove(\"is-collapsed\");\r\n      setActiveView(\"settings\");\r\n    });\r\n\r\n    on(ui.helpButton, \"click\", () => {\r\n      ui.mainPanel.classList.remove(\"is-hidden\");\r\n      ui.floatingButton.classList.remove(\"is-collapsed\");\r\n      setActiveView(\"help\");\r\n    });\r\n\r\n    // ---------------------------\r\n    // Search filter\r\n    // ---------------------------\r\n    on(\r\n      ui.searchInput,\r\n      \"input\",\r\n      debounce(() => {\r\n        filterCourses(ui.searchInput.value);\r\n        renderAll();\r\n      }, 100)\r\n    );\r\n\r\n    wireTableSorting(ui);\r\n\r\n    // ---------------------------\r\n    // Initial load\r\n    // ---------------------------\r\n    STATE.savedSchedules = await loadSavedSchedules();\r\n    renderSavedSchedules(ui, STATE.savedSchedules);\r\n\r\n    STATE.courses = await extractCoursesData();\r\n    STATE.filtered = [...STATE.courses];\r\n\r\n    STATE.sort = STATE.sort || { key: \"code\", dir: 1 };\r\n    sortCourses(\"code\");\r\n\r\n    renderCourseRows(ui, STATE.filtered);\r\n    updateScheduleView();\r\n\r\n    setActiveView(STATE.view.panel);\r\n  }\r\n\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();\r\n"],"names":["logConfiguration","debugLog","global","local","log","k","v","loggingIsOn","scope","id","debugFor","prefix","metaOrMsg","rest","meta","args","forceOn","debug","$$","root","sel","on","el","ev","fn","opts","debounce","ms","a","STATE","EXT_ID","ensureMount","host","loadMainPanel","shadowRoot","htmlUrl","cssFiles","html","cssParts","r","file","css","style","link","wrap","ui","normalizeText","s","getHeaderText","headerEl","btn","getHeaderKey","m","buildHeaderMaps","gridRoot","headerEls","headers","pos","text","key","h","findHeader","needles","ns","hit","n","KEYS","colMap","posMap","findWorkdayGrid","roots","headerText","looksRight","t","rows","parseSectionLinkString","input","str","baseCode","parts","p","sectionToken","parsedTitle","result","DATE_RE","TIME_RE","DAY_RE","extractMeetingLines","containerEl","lines","filtered","isOnlineDelivery","deliveryModeCellEl","txt","prompts","matched","label","extractMeetingLinesFromCell","meetingEl","formatMeetingLineForPanel","line","raw","dayPart","timePart","buildingPart","floorMatch","roomMatch","floorPart","roomPart","formatted","normalizeMeetingPatternsText","normalized","extractStartDate","match","out","getCellWorkdayKey","cell","createRowCellReader","rowEl","headerMaps","colHeaderMap","cellsInRow","cellByCol","getCellByHeader","keyName","colKey","extractCoursesData","found","courses","row","c","extractFromRow","unique","removeDuplicateCourses","allCourses","course","seen","uniqueCourses","courseKey","readCellTextByHeader","allLinksInRow","sectionLinkEl","sectionLinkText","sectionDetails","instructionalFormatText","startDateText","code","title","section_number","labLike","seminarLike","discussionLike","isLab","isSeminar","isDiscussion","instructor","meetingLines","meetingObj","deliveryModeEl","isOnline","meeting","startDate","escHTML","cleanLines","getBadge","splitMeeting","main","sub","renderCourseRows","frag","tr","badge","meetingMain","meetingSub","filterCourses","query","q","keys","sortCourses","dir","collator","b","wireTableSorting","headCells","th","DAYS","START_HOUR","END_HOUR","SLOT_MINUTES","SLOTS","DAY_REGEX","TIME_REGEX","SEMESTER_MONTHS","parseTimeToken","token","hours","minutes","period","parseMeetingLine","days","timeTokens","startMinutes","endMinutes","getSemester","month","clampToGrid","min","max","snapDownToSlot","snapUpToSlot","slotIndexOf","buildDayEvents","semester","eventsByDay","d","eventId","parsed","startMin","endMin","startIdx","endIdx","rowSpan","day","addConflicts","groupedByDay","events","groups","current","currentKey","active","getConflictSummaries","conflicts","group","codes","updateConflictFooter","conflictList","formatSlotLabel","h24","buildScheduleTable","table","thead","headRow","tbody","timeTd","td","inner","overlay","renderOverlayBlocks","firstBodyRow","firstDayCell","timeTh","timeColWidth","dayColWidth","headerHeight","rowHeight","cellStyles","borderLeft","borderTop","borderRight","borderBottom","borderX","borderY","dayIndex","left","top","height","block","overlapLayer","titleLabel","renderSchedule","tableWrap","TZID","formatDateTimeUTC","date","y","hh","mm","ss","DAY_CODES","date_range_REGEX","time_range_REGEX","days_REGEX","padNumbers","value","formatDate","year","formatDateTime","datePart","parseTime","hoursToken","minutesToken","periodToken","dateMatch","timeMatch","endDate","startTime","endTime","uniqueDays","extractLocation","part","locationPart","onlinePart","findFirstValidDate","dayCodes","start","offset","buildClassEvent","firstDate","summaryParts","descriptionLines","untilLocal","untilDate","buildICSFile","event","exportICS","ics","blob","url","STORAGE_KEY","MAX_SCHEDULES","cloneCourses","sanitizeSchedules","schedules","useChromeStorage","loadSavedSchedules","resolve","error","persistSavedSchedules","sanitized","createScheduleSnapshot","name","formatScheduleMeta","schedule","count","savedDate","dateLabel","renderSavedSchedules","empty","card","header","info","actions","loadButton","deleteButton","canSaveMoreSchedules","getMaxScheduleCount","boot","updateScheduleView","renderAll","setActiveView","viewKey","syncFloatingButtonState","toggleMainPanel","resolveScheduleModal","closeScheduleModal","openScheduleModal","message","confirmLabel","showInput","showCancel","action","setExportOpen","isOpen","path","handleExport","type","snapshot","actionButton","scheduleId","selected"],"mappings":"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"}