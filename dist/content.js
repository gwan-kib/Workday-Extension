(function(){"use strict";const C=(t,n)=>Array.from(t.querySelectorAll(n)),T=(t,n,e,o)=>t&&t.addEventListener(n,e,o),st=(t,n=300)=>{let e;return(...o)=>{clearTimeout(e),e=setTimeout(()=>t(...o),n)}},d={courses:[],filtered:[],sort:{key:null,dir:1},view:{panel:"list",term:"first"}},G="wd-courses-capture";function it(){let t=document.getElementById(G);return t||(t=document.createElement("div"),t.id=G,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function ct(t){const n=chrome.runtime.getURL("src/panel.html"),e=chrome.runtime.getURL("src/panel.css"),[o,r]=await Promise.all([fetch(n).then(l=>l.text()),fetch(e).then(l=>l.text())]);t.innerHTML="";const i=document.createElement("style");i.textContent=r,t.appendChild(i);const s=document.createElement("div");s.innerHTML=o,t.appendChild(s);const c=t.querySelector("#wd-logo");return c&&(c.src=chrome.runtime.getURL("src/W.svg")),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead"),tabButtons:t.querySelectorAll(".tab-button"),panels:t.querySelectorAll(".widget-panel"),scheduleGrid:t.querySelector("#schedule-grid"),termButtons:t.querySelectorAll(".term-button")}}const O=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function lt(t){const e=(t?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return e?e[1]:null}function at(t){const e=Array.from(t.querySelectorAll('th[data-automation-id^="columnHeader"]')).map((c,l)=>{const a=Z(c),p=lt(c);return{el:c,pos:l,key:p,text:a,norm:O(a)}}).filter(c=>c.text);function o(c){const l=c.map(O);let a=e.find(p=>l.includes(p.norm));return a||(a=e.find(p=>l.some(m=>p.norm.includes(m))),a||null)}const r={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},i={},s={};for(const[c,l]of Object.entries(r)){const a=o(l);i[c]=a?a.key:null,s[c]=a?a.pos:-1}return{colMap:i,posMap:s}}function Z(t){if(!t)return"";const n=t.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(t.textContent||"").trim()}function dt(t){let n=String(t||"").replace(/\u00A0/g," ").trim();if(!n)return null;n=n.replace(/\s*\n\s*/g," ").trim();const e=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!e)return null;const o=e[1].trim(),i=e[2].trim().split(/\s*[-–—]\s*/).map(l=>l.trim()).filter(Boolean);let s="",c="";return s=i[0],c=i.slice(1).join(" - ").trim(),c=c.replace(/\s*:\s*/g,`:
`),{code:o,section_number:s,title:c,full:n}}function q(t){const n=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return n?n[0].replace(/\s+/g," ").trim():""}function ut(t){if(!t)return console.log("extractMeetingLinesFromCell failed 1"),[];let e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean);e.length||(e=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(c=>(c.getAttribute("data-automation-label")||c.getAttribute("title")||c.textContent||"").trim()).filter(Boolean)),e.length||(e=String(t.innerText||"").split(`
`).map(s=>s.trim()).filter(Boolean));const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,i=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(s=>o.test(s)&&r.test(s)&&i.test(s))}function mt(t){if(!t)return[];const e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean),o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,i=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(s=>o.test(s)&&r.test(s)&&i.test(s))}function ft(t){const n=String(t||"").split("|").map(l=>l.trim()).filter(Boolean),o=(n.find(l=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(l))||"").split(/\s+/).join(" / "),r=n.find(l=>/\d{1,2}:\d{2}/.test(l)&&/-/.test(l))||"",i=n.find(l=>/\([A-Z]{2,}\)/.test(l))||"",s=n.find(l=>/^Floor:/i.test(l))||"",c=n.find(l=>/^Room:/i.test(l))||"";return{days:o,time:r,location:[i,s,c].filter(Boolean).join(" | ")}}function pt(t){return String(t||"").split(/\r?\n/).map(n=>n.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function H(t){const n=String(t||"").match(/\b(\d{4}-\d{2}-\d{2})\b/);return n?n[1]:""}function gt(t){if(!t)return console.log("failed extracting instuctor name:",t),"";const n=t.querySelector('[data-automation-id="promptOption"]'),e=(n&&(n.getAttribute("data-automation-label")||n.getAttribute("title")||n.textContent)||t.textContent||"").trim();return console.log("sucsessfully extracted instuctor name:",t,e),e}function ht(t){if(!t)return!1;const n=(t.innerText||t.textContent||"").trim();return/online learning/i.test(n)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(o=>{const r=(o.getAttribute("data-automation-label")||o.getAttribute("title")||o.textContent||"").trim();return/online learning/i.test(r)})}function bt(){const t=C(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const n of t){const o=C(n,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(s=>O(Z(s)));if(!(o.some(s=>s.includes("section"))&&(o.some(s=>s.includes("instructor"))||o.some(s=>s.includes("meeting"))||o.some(s=>s.includes("instructional format"))||o.some(s=>s.includes("format"))||o.some(s=>s.includes("status")))))continue;const i=C(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(i.length)return{root:n,rows:i}}return null}async function W(){const t=bt();let n=[];if(t){const e=at(t.root);for(const o of t.rows){const r=St(o,e);(r.code||r.title)&&Object.values(r).join("").trim()&&n.push(r)}}return yt(n)}function yt(t){const n=r=>[r.code,r.title,r.section_number].join("|").toLowerCase(),e=new Set,o=[];for(const r of t){const i=n(r);e.has(i)||(e.add(i),o.push(r))}return o}function St(t,n){const{colMap:e,posMap:o}=n,r=C(t,"td, [role='gridcell']"),i=(t.innerText||"").trim();function s(u){const ot=(u.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return ot?ot[1]:null}const c=new Map;r.forEach(u=>{const g=s(u);g&&!c.has(g)&&c.set(g,u)});const l=u=>{const g=e[u];if(g!=null&&c.has(g))return c.get(g);const S=o[u];return S!=null&&S>=0&&S<r.length?r[S]:null},a=u=>{const g=e[u];if(g!=null&&c.has(g))return(c.get(g).innerText||"").trim();const S=o[u];return S!=null&&S>=0&&S<r.length?(r[S].innerText||"").trim():""},p=C(t,'[data-automation-id="promptOption"]');let m=null;for(const u of p){const g=u.getAttribute("data-automation-label")||u.getAttribute("title")||u.getAttribute("aria-label")||u.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(g)){m=u;break}}!m&&p.length>0&&(m=p[0]);const f=m&&(m.getAttribute("data-automation-label")||m.getAttribute("title")||m.getAttribute("aria-label")||m.textContent)||"",h=a("title"),b=a("code"),y=a("section"),M=a("meeting"),U=a("instructionalFormat"),Dt=a("startDate");let B="",D=h||"",et="";const _=dt(f);_&&(B=_.code,et=_.section_number,D=_.title),B||(B=q(b)||q(h)||q(i)||"");const w=u=>/\b(lab|laboratory|labratory)\b/i.test(String(u||"")),R=u=>/\bseminar\b/i.test(String(u||"")),nt=w(U)||w(y)||w(D)||w(f)||w(i),rt=R(U)||R(y)||R(D)||R(f)||R(i),_t=l("instructor");let P="";nt||rt?P="N/A":P=gt(_t)||(a("instructor")||"").trim();let E;const N=e.meeting;let F=null;N!=null&&c.has(N)?F=c.get(N):o.meeting!=null&&o.meeting>=0&&o.meeting<r.length&&(F=r[o.meeting]);let A=F?ut(F):[];A.length||(A=mt(t));let x={days:"",time:"",location:""},Ft=H(A[0])||H(Dt);if(A.length){const u=A[0];x=ft(u)}else E=(M||"").trim();const Ot=l("deliveryMode");ht(Ot)&&(x.location="Online"),x.days||x.time||x.location?(E=[x.days,x.time].filter(Boolean).join(" | "),x.location?E+=`
${x.location}`:E+=`
Online`):E=(M||"").trim();const qt=(U||"").trim();return{code:B,title:D,section_number:et,instructor:P,meeting:pt(E),instructionalFormat:qt,startDate:Ft,meetingLines:A,isLab:nt,isSeminar:rt}}const K=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function $(t,n){t.tableBody.innerHTML="";const e=document.createDocumentFragment();n.forEach(o=>{const r=document.createElement("tr"),i=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":"";r.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${i?`<div class="muted">${i}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const s=String(o.meeting||"").split(`
`),c=(s[0]||"").trim(),l=(s[1]||"").trim();return`
            ${c?`<span class="meeting-pill">${K(c)}</span>`:""}
            ${l?`<div class="meeting-sub">${K(l)}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,e.appendChild(r)}),t.tableBody.appendChild(e)}function Y(t){if(t=(t||"").trim().toLowerCase(),!t){d.filtered=[...d.courses];return}d.filtered=d.courses.filter(n=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(e=>(n[e]||"").toLowerCase().includes(t)))}function k(t){if(!t)return;const n=d.sort.key===t?-d.sort.dir:1;d.sort={key:t,dir:n};const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});d.filtered.sort((o,r)=>n*e.compare(o[t]||"",r[t]||""))}function xt(t){const n=C(t.tableHead,"th[data-key]");n.forEach(e=>{T(e,"click",()=>{const o=e.getAttribute("data-key");k(o),$(t,d.filtered),n.forEach(r=>r.classList.remove("sorted-asc","sorted-desc")),e.classList.add(d.sort.dir===1?"sorted-asc":"sorted-desc")})})}const v=["Mon","Tue","Wed","Thu","Fri"],z=8,j=22,I=30,L=[];for(let t=z;t<j;t++)L.push(t*60),L.push(t*60+30);L.push(j*60);const Tt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,Ct=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,X={first:"09",second:"01"};function V(t){if(!t)return null;const n=t.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let e=Number.parseInt(n[1],10);const o=Number.parseInt(n[2],10),r=n[3].toLowerCase();return r==="p"&&e!==12&&(e+=12),r==="a"&&e===12&&(e=0),e*60+o}function Lt(t){const n=String(t||"").match(Tt)||[],e=String(t||"").match(Ct)||[];if(n.length===0||e.length<2)return null;const o=V(e[0]),r=V(e[1]);return o==null||r==null||r<=o?null:{days:[...new Set(n)],startMinutes:o,endMinutes:r,timeLabel:`${e[0]} - ${e[1]}`}}function Et(t){if(!t)return null;const n=t.split("-")[1];return n===X.first?"first":n===X.second?"second":null}function J(t){const n=z*60,e=j*60;return Math.max(n,Math.min(e,t))}function At(t){return Math.floor(t/I)*I}function vt(t){return Math.ceil(t/I)*I}function Q(t){return L.indexOf(t)}function Mt(t,n){const e=new Map;v.forEach(r=>e.set(r,[]));const o=new Set;return t.forEach(r=>{const i=r.startDate||H(r.meetingLines?.[0])||"";if(Et(i)!==n)return;(r.meetingLines?.length?r.meetingLines:[]).forEach(l=>{const a=Lt(l);if(!a)return;let p=J(a.startMinutes),m=J(a.endMinutes);p=At(p),m=vt(m);const f=Q(p),h=Q(m);if(f===-1||h===-1||h<=f)return;const b=h-f;a.days.forEach(y=>{if(!e.has(y))return;const M=[y,r.code||"",r.title||"",a.timeLabel,f,b].join("|");o.has(M)||(o.add(M),e.get(y).push({code:r.code||"",title:r.title||"",timeLabel:a.timeLabel,rowStart:f,rowSpan:b,startIdx:f,endIdx:h}))})})}),v.forEach(r=>{e.get(r).sort((i,s)=>i.startIdx-s.startIdx||i.endIdx-s.endIdx)}),e}function wt(t){const n=new Map;return v.forEach(e=>{const o=(t.get(e)||[]).slice().sort((i,s)=>i.startIdx-s.startIdx||i.endIdx-s.endIdx),r=[];for(const i of o){const s=i.startIdx,c=i.endIdx,l=r[r.length-1];!l||s>=l.end?r.push({start:s,end:c,events:[i],hasConflict:!1}):(l.end=Math.max(l.end,c),l.events.push(i))}r.forEach(i=>{i.hasConflict=i.events.length>1}),n.set(e,r)}),n}function Rt(t){const n=Math.floor(t/60),e=t%60,o=String(n),r=String(e).padStart(2,"0");return`${o}:${r}`}function $t(t){const n=document.createElement("table");n.className="schedule-table";const e=new Set,o=document.createElement("thead"),r=document.createElement("tr");r.innerHTML=`
    <th class="schedule-time">Time</th>
    ${v.map(s=>`<th>${s}</th>`).join("")}
  `,o.appendChild(r),n.appendChild(o);const i=document.createElement("tbody");for(let s=0;s<L.length;s++){const c=document.createElement("tr"),l=document.createElement("td");l.className="schedule-time",l.textContent=Rt(L[s]),c.appendChild(l),v.forEach(a=>{const p=`${a}|${s}`;if(e.has(p))return;const m=document.createElement("td");m.className="schedule-cell";const f=(t.get(a)||[]).find(h=>h.start===s);if(f){const h=f.end-f.start;m.rowSpan=h;for(let b=1;b<h;b++)e.add(`${a}|${s+b}`);f.hasConflict&&m.classList.add("has-conflict"),f.events.forEach(b=>{const y=document.createElement("div");y.className="schedule-entry",y.innerHTML=`
            <div class="schedule-entry-title">${b.code||b.title}</div>
            <div class="schedule-entry-time">${b.timeLabel}</div>
          `,m.appendChild(y)})}c.appendChild(m)}),i.appendChild(c)}return n.appendChild(i),n}function kt(t,n,e){if(!t.scheduleGrid)return;t.scheduleGrid.innerHTML="";const o=Mt(n,e),r=wt(o);t.scheduleGrid.appendChild($t(r))}const tt=t=>{if(t==null)return"";const n=String(t);return/[",\n]/.test(n)?`"${n.replace(/"/g,'""')}"`:n},It=(t,n)=>{const e=n.map(tt).join(","),o=t.map(r=>n.map(i=>tt(r[i]??"")).join(",")).join(`
`);return e+`
`+o};function Bt(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],n=It(d.filtered,t),e=new Blob([n],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download="captured-courses.csv",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(o),r.remove()},100)}(()=>{console.log("[WD] content script loaded");async function t(){const n=it(),e=await ct(n),o=()=>{kt(e,d.filtered,d.view.term)},r=i=>{d.view.panel=i,e.panels.forEach(s=>{s.classList.toggle("is-active",s.dataset.panel===i)}),e.tabButtons.forEach(s=>{s.classList.toggle("is-active",s.dataset.panel===i)}),e.widget.classList.toggle("is-schedule-view",i==="schedule")};e.tabButtons.forEach(i=>{T(i,"click",()=>{r(i.dataset.panel),i.dataset.panel==="schedule"&&o()})}),e.termButtons.forEach(i=>{T(i,"click",()=>{d.view.term=i.dataset.term,e.termButtons.forEach(s=>{s.classList.toggle("is-active",s.dataset.term===d.view.term)}),o()})}),T(e.button,"click",()=>{e.widget.classList.toggle("is-hidden")}),T(e.refresh,"click",async()=>{d.courses=await W(),Y(e.search.value),k(d.sort.key||"code"),$(e,d.filtered),o()}),T(e.exportBtn,"click",Bt),T(e.search,"input",st(()=>{Y(e.search.value),k(d.sort.key||"code"),$(e,d.filtered),o()},100)),xt(e),d.courses=await W(),d.filtered=[...d.courses],k("code"),$(e,d.filtered),o(),r(d.view.panel)}document.readyState==="complete"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})()})();
//# sourceMappingURL=content.js.map
