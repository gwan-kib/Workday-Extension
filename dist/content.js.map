{"version":3,"file":"content.js","sources":["../src/utilities/dom.js","../src/core/state.js","../src/utilities/shadowMount.js","../src/panel/loadPanel.js","../src/extraction/headerMaps.js","../src/extraction/sectionLinkInfo.js","../src/extraction/meetingPatternsInfo.js","../src/extraction/instructorInfo.js","../src/extraction/onlineClassCheck.js","../src/extraction/findingTables.js","../src/extraction/courseExtraction.js","../src/panel/renderRows.js","../src/panel/panelInteractions.js","../src/exporting/cvs.js","../src/content.js"],"sourcesContent":["export const $ = (root, sel) => root.querySelector(sel);\r\n\r\nexport const $$ = (root, sel) =>\r\n  Array.from(root.querySelectorAll(sel));\r\n\r\nexport const on = (el, ev, fn, opts) =>\r\n  el && el.addEventListener(ev, fn, opts);\r\n\r\nexport const debounce = (fn, ms = 300) => {\r\n  let t;\r\n  return (...a) => {\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n};","export const STATE = {\r\n    courses: [],\r\n    filtered: [],\r\n    sort: { key: null, dir: 1 }, // 1 asc, -1 desc\r\n};","const EXT_ID = \"wd-courses-capture\";\r\n\r\nexport function ensureMount() {\r\n  let host = document.getElementById(EXT_ID);\r\n  if (host) return host.shadowRoot;\r\n\r\n  host = document.createElement(\"div\");\r\n  host.id = EXT_ID;\r\n  host.style.all = \"initial\";\r\n  host.style.position = \"fixed\";\r\n  host.style.bottom = \"16px\";\r\n  host.style.right = \"16px\";\r\n  host.style.zIndex = \"2147483647\";\r\n  host.attachShadow({ mode: \"open\" });\r\n  document.documentElement.appendChild(host);\r\n\r\n  return host.shadowRoot;\r\n}\r\n","export async function loadPanel(shadow) {\r\n  const htmlUrl = chrome.runtime.getURL(\"src/panel.html\");\r\n  const cssUrl = chrome.runtime.getURL(\"src/panel.css\");\r\n\r\n  const [html, css] = await Promise.all([\r\n    fetch(htmlUrl).then((r) => r.text()),\r\n    fetch(cssUrl).then((r) => r.text()),\r\n  ]);\r\n\r\n  shadow.innerHTML = \"\";\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = css;\r\n  shadow.appendChild(style);\r\n\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.innerHTML = html;\r\n  shadow.appendChild(wrap);\r\n\r\n  const logoImg = shadow.querySelector(\"#wd-logo\");\r\n  if (logoImg)\r\n    logoImg.src = chrome.runtime.getURL(\"src/W.svg\");\r\n\r\n  return {\r\n    button: shadow.querySelector(\"#floating-button\"),\r\n    widget: shadow.querySelector(\".widget\"),\r\n    search: shadow.querySelector(\"#widget-search\"),\r\n    refresh: shadow.querySelector(\"#widget-refresh\"),\r\n    exportBtn: shadow.querySelector(\"#widget-export\"),\r\n    tableBody: shadow.querySelector(\"tbody\"),\r\n    tableHead: shadow.querySelector(\"thead\"),\r\n  };\r\n}","import { $$ } from \"../utilities/dom\"\r\n\r\nexport const normalizeText = (s) => String(s || \"\")\r\n      .replace(/\\u00A0/g, \" \")\r\n      .replace(/\\s+/g, \" \")\r\n      .trim()\r\n      .toLowerCase();\r\n\r\n// Build a map: key -> aria-colindex (preferred), and key -> positional index fallback.\r\nexport function buildHeaderMaps(gridRoot) {\r\n    const headerEls = $$(\r\n      gridRoot,\r\n      \"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header\"\r\n    );\r\n\r\n    const headers = headerEls\r\n      .map((el, pos) => {\r\n        const text = getHeaderText(el);\r\n        const col = getColIndex(el) ?? (pos + 1);\r\n\r\n        return { el, pos, col, text, norm: normalizeText(text) };\r\n      })\r\n      .filter((h) => h.text);\r\n\r\n    const findByIncludes = (needles) => {\r\n      const ns = needles.map(normalizeText);\r\n      // prefer exact match, then includes\r\n      let hit = headers.find((h) => ns.includes(h.norm));\r\n      if (hit)\r\n        return hit;\r\n\r\n      hit = headers.find((h) => ns.some((n) => h.norm.includes(n)));\r\n\r\n      return hit || null;\r\n    };\r\n\r\n    // IMPORTANT: rename status -> instructionalFormat to match what it actually contains\r\n    const KEYS = {\r\n      instructor: [\"instructor\", \"instructors\"],\r\n      meeting: [\"meeting\", \"meeting patterns\", \"meeting pattern\"],\r\n      deliveryMode: [\"delivery mode\", \"mode\", \"modality\"],\r\n      title: [\"title\", \"course listing\", \"course name\", \"course\"],\r\n      code: [\"class code\", \"code\", \"course code\", \"course id\"],\r\n      section: [\"section\", \"sect\", \"sec\"],\r\n\r\n      // What you were calling \"Status\" is actually reading Instructional Format\r\n      instructionalFormat: [\r\n        \"instructional format\",\r\n        \"format\",\r\n        \"component\",\r\n        \"type\",\r\n        // keep these as fallbacks in case Workday labels vary:\r\n        \"status\",\r\n        \"registration status\",\r\n      ],\r\n    };\r\n\r\n    const colMap = {};\r\n    const posMap = {};\r\n\r\n    for (const [k, needles] of Object.entries(KEYS)) {\r\n      const hit = findByIncludes(needles);\r\n      colMap[k] = hit ? hit.col : null;\r\n      posMap[k] = hit ? hit.pos : -1;\r\n    }\r\n\r\n    return { colMap, posMap };\r\n}\r\n\r\nexport function getHeaderText(headerEl) {\r\n    if (!headerEl) \r\n        return \"\";\r\n\r\n    const h4 = headerEl.querySelector(\"h4\");\r\n\r\n    return (\r\n        (headerEl.getAttribute(\"title\") || (h4 && h4.textContent) || headerEl.textContent || \"\").trim()\r\n    );\r\n}\r\n\r\nexport function getColIndex(el) {\r\n    if (!el)\r\n        return null;\r\n\r\n    const direct = el.getAttribute && el.getAttribute(\"aria-colindex\");\r\n\r\n    if (direct && /^\\d+$/.test(direct))\r\n        return parseInt(direct, 10);\r\n\r\n    // sometimes aria-colindex is on a parent wrapper\r\n    let cur = el;\r\n    for (let i = 0; i < 5 && cur; i++) {\r\n      const v = cur.getAttribute && cur.getAttribute(\"aria-colindex\");\r\n\r\n      if (v && /^\\d+$/.test(v))\r\n        return parseInt(v, 10);\r\n\r\n      cur = cur.parentElement;\r\n    }\r\n\r\n    return null;\r\n}","/* Parse the Workday \"promptOption\" section link string. */\r\nexport function parseSectionLinkString(input) {\r\n    let str = String(input || \"\").replace(/\\u00A0/g, \" \").trim();\r\n\r\n    if (!str)\r\n        return null;\r\n\r\n    // keep ALL lines; Workday wraps titles with \\n\r\n    str = str.replace(/\\s*\\n\\s*/g, \" \").trim();\r\n\r\n    // REQUIRED pattern:\r\n    const m = str.match(/^\\s*([A-Z][A-Z0-9_]*\\s*\\d{3}[A-Z]?)\\s*-\\s*(.+?)\\s*$/);\r\n    if (!m)\r\n        return null;\r\n\r\n    const baseCode = m[1].trim(); // \"COSC_O 222\"\r\n    const rest = m[2].trim();     // \"L2D - Data Structures\" or \"101 - Data Structures\"\r\n\r\n    // Split rest into section token + title\r\n    const parts = rest.split(/\\s*[-–—]\\s*/).map((p) => p.trim()).filter(Boolean);\r\n\r\n    let sectionToken = \"\";\r\n    let parsedTitle = \"\";\r\n\r\n    sectionToken = parts[0];\r\n    parsedTitle = parts.slice(1).join(\" - \").trim();\r\n\r\n    parsedTitle = parsedTitle.replace(/\\s*:\\s*/g, \":\\n\");\r\n\r\n    return {\r\n      code: baseCode,\r\n      section_number: sectionToken,\r\n      title: parsedTitle,\r\n      full: str,\r\n    };\r\n}\r\n\r\nexport function guessClassCode(text) {\r\n    const m = String(text || \"\").match(/[A-Z][A-Z0-9_]*\\s*\\d{2,3}[A-Z]?/);\r\n    \r\n    return m ? m[0].replace(/\\s+/g, \" \").trim() : \"\";\r\n}","export function extractMeetingLinesFromCell(meetingEl) {\r\n    if (!meetingEl) {\r\n      console.log(\"extractMeetingLinesFromCell failed 1\");\r\n      return [];\r\n    }\r\n\r\n    // BEST SOURCE: menu items expose full meeting strings in aria-label\r\n    const menuItems = Array.from(\r\n      meetingEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]')\r\n    );\r\n\r\n    let lines = menuItems\r\n      .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n      .filter(Boolean);\r\n\r\n    // fallback: promptOption text (sometimes present)\r\n    if (!lines.length) {\r\n      const prompts = Array.from(\r\n        meetingEl.querySelectorAll('[data-automation-id=\"promptOption\"]')\r\n      );\r\n      lines = prompts\r\n        .map((el) =>\r\n          (\r\n            el.getAttribute(\"data-automation-label\") ||\r\n            el.getAttribute(\"title\") ||\r\n            el.textContent ||\r\n            \"\"\r\n          ).trim()\r\n        )\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // final fallback: innerText split\r\n    if (!lines.length) {\r\n      lines = String(meetingEl.innerText || \"\")\r\n        .split(\"\\n\")\r\n        .map((s) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // only keep real meeting sentences\r\n    const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n    const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n    const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n    return lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n}\r\n\r\nexport function extractMeetingLinesFromRow(rowEl) {\r\n    if (!rowEl)\r\n        return [];\r\n\r\n    const items = Array.from(rowEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n    const lines = items\r\n        .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n        .filter(Boolean);\r\n\r\n    const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n    const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n    const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n    return lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n}\r\n\r\nexport function formatMeetingLineForPanel(line) {\r\n    const parts = String(line || \"\")\r\n      .split(\"|\")\r\n      .map((p) => p.trim())\r\n      .filter(Boolean);\r\n\r\n    const dayPartRaw = parts.find((p) => /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/.test(p)) || \"\";\r\n    const dayPart = dayPartRaw.split(/\\s+/).join(\" / \");\r\n\r\n    const timePart = parts.find((p) => /\\d{1,2}:\\d{2}/.test(p) && /-/.test(p)) || \"\";\r\n    const buildingPart = parts.find((p) => /\\([A-Z]{2,}\\)/.test(p)) || \"\"; // \"Library (LIB)\"\r\n    const floorPart = parts.find((p) => /^Floor:/i.test(p)) || \"\";\r\n    const roomPart = parts.find((p) => /^Room:/i.test(p)) || \"\";\r\n\r\n    return {\r\n      days: dayPart,\r\n      time: timePart,\r\n      location: [buildingPart, floorPart, roomPart].filter(Boolean).join(\" | \"),\r\n    };\r\n}\r\n\r\nexport function normalizeMeetingPatternsText(text) {\r\n    // preserve line breaks, normalize each line\r\n    return String(text || \"\")\r\n      .split(/\\r?\\n/)\r\n      .map((line) => line.replace(/\\s+/g, \" \").trim())\r\n      .filter(Boolean)\r\n      .join(\"\\n\");\r\n}","export function extractInstructorNamesFromCell(instructorEl) {\r\n    if (!instructorEl)\r\n        return \"\";\r\n\r\n    const items = Array.from(instructorEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'))\r\n      .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n      .filter(Boolean);\r\n\r\n    const looksLikeDateOrMeeting = (s) =>\r\n      /^\\d{4}-\\d{2}-\\d{2}$/.test(s) ||\r\n      /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/.test(s) ||\r\n      /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i.test(s) ||\r\n      /\\b\\d{1,2}:\\d{2}\\b/.test(s);\r\n\r\n    const names = items.filter((s) => !looksLikeDateOrMeeting(s));\r\n    if (names.length)\r\n        return names.join(\", \");\r\n\r\n    const prompt = instructorEl.querySelector('[data-automation-id=\"promptOption\"]');\r\n    const txt = (\r\n      (prompt && (prompt.getAttribute(\"data-automation-label\") || prompt.getAttribute(\"title\") || prompt.textContent)) ||\r\n      instructorEl.textContent ||\r\n      \"\"\r\n    ).trim();\r\n\r\n    return looksLikeDateOrMeeting(txt) ? \"\" : txt;\r\n}","export function onlineClassCheck(deliveryModeCellEl) {\r\n    if (!deliveryModeCellEl) return false;\r\n\r\n    const txt = (deliveryModeCellEl.innerText || deliveryModeCellEl.textContent || \"\").trim();\r\n    if (/online learning/i.test(txt)) return true;\r\n\r\n    const prompts = Array.from(deliveryModeCellEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n    return prompts.some((el) => {\r\n      const label = (el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\").trim();\r\n      return /online learning/i.test(label);\r\n    });\r\n  }","import { $$ } from \"../utilities/dom\"\r\nimport { normalizeText, getHeaderText } from \"./headerMaps.js\"\r\n\r\n// Find any likely Workday grid/table on the page\r\nexport function findingTables() {\r\n    const roots = $$(\r\n      document,\r\n      'table, [role=\"table\"], div[data-automation-id*=\"grid\"], div[role=\"grid\"]'\r\n    );\r\n\r\n    for (const root of roots) {\r\n      const headerEls = $$(\r\n        root,\r\n        \"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header\"\r\n      );\r\n\r\n      const headerText = headerEls.map((h) => normalizeText(getHeaderText(h)));\r\n\r\n      // still require \"section\" + at least one other expected header\r\n      const looksRight =\r\n        headerText.some((t) => t.includes(\"section\")) &&\r\n        (headerText.some((t) => t.includes(\"instructor\")) ||\r\n          headerText.some((t) => t.includes(\"meeting\")) ||\r\n          headerText.some((t) => t.includes(\"instructional format\")) ||\r\n          headerText.some((t) => t.includes(\"format\")) ||\r\n          headerText.some((t) => t.includes(\"status\")));\r\n\r\n      if (!looksRight) \r\n        continue;\r\n\r\n      const rows = $$(\r\n        root,\r\n        \"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row\"\r\n      );\r\n\r\n      if (rows.length)\r\n        return { root, rows };\r\n    }\r\n\r\n    return null;\r\n  }","import { $$ } from \"../utilities/dom\"\r\nimport { buildHeaderMaps, getColIndex } from \"./headerMaps.js\"\r\nimport { parseSectionLinkString, guessClassCode } from \"./sectionLinkInfo.js\"\r\nimport { extractMeetingLinesFromCell, extractMeetingLinesFromRow, formatMeetingLineForPanel, normalizeMeetingPatternsText } from \"./meetingPatternsInfo.js\"\r\nimport { extractInstructorNamesFromCell } from \"./instructorInfo.js\"\r\nimport { onlineClassCheck } from \"./onlineClassCheck.js\"\r\nimport { findingTables } from \"./findingTables.js\"\r\n\r\nexport async function extractAllCourses() {\r\n    const found = findingTables();\r\n    let courses = [];\r\n\r\n    if (found) {\r\n      const headerMaps = buildHeaderMaps(found.root);\r\n\r\n      for (const row of found.rows) {\r\n        const c = extractFromRow(row, headerMaps);\r\n        if ((c.code || c.title)\r\n            && Object.values(c).join(\"\").trim()) courses.push(c);\r\n      }\r\n    }\r\n\r\n    return findUniqueCourses(courses);\r\n}\r\n\r\nfunction findUniqueCourses(list) {\r\n    const key = (c) => [c.code, c.title, c.section_number].join(\"|\").toLowerCase();\r\n    const seen = new Set();\r\n    const out = [];\r\n\r\n    for (const c of list) {\r\n      const k = key(c);\r\n      if (!seen.has(k)) {\r\n        seen.add(k);\r\n        out.push(c);\r\n      }\r\n    }\r\n\r\n    return out;\r\n  }\r\n\r\nexport function extractFromRow(row, headerMaps) {\r\n    const { colMap, posMap } = headerMaps;\r\n\r\n    const cells = $$(row, \"td, [role='gridcell']\");\r\n    const allText = (row.innerText || \"\").trim();\r\n\r\n    // map row cells by aria-colindex (preferred)\r\n    const cellByCol = new Map();\r\n    cells.forEach((cell, i) => {\r\n      const col = getColIndex(cell) ?? (i + 1);\r\n\r\n      if (!cellByCol.has(col))\r\n        cellByCol.set(col, cell);\r\n    });\r\n\r\n    const getCellEl = (key) => {\r\n      const col = colMap[key];\r\n      if (col != null && cellByCol.has(col))\r\n        return cellByCol.get(col);\r\n\r\n      const pos = posMap[key];\r\n      if (pos != null && pos >= 0 && pos < cells.length)\r\n        return cells[pos];\r\n\r\n      return null;\r\n    };\r\n\r\n    const readByKey = (key) => {\r\n      const col = colMap[key];\r\n      if (col != null && cellByCol.has(col)) {\r\n        return (cellByCol.get(col).innerText || \"\").trim();\r\n      }\r\n\r\n      const pos = posMap[key];\r\n      if (pos != null && pos >= 0 && pos < cells.length) {\r\n        return (cells[pos].innerText || \"\").trim();\r\n      }\r\n      return \"\";\r\n    };\r\n\r\n    // ✅ Search the entire row for the promptOption link (most reliable)\r\n    const allPromptOptions = $$(row, '[data-automation-id=\"promptOption\"]');\r\n    let sectionLinkEl = null;\r\n\r\n    for (const el of allPromptOptions) {\r\n      const text =\r\n        el.getAttribute(\"data-automation-label\") ||\r\n        el.getAttribute(\"title\") ||\r\n        el.getAttribute(\"aria-label\") ||\r\n        el.textContent ||\r\n        \"\";\r\n      if (/^[A-Z][A-Z0-9_]*\\s*\\d{2,3}-/.test(text)) {\r\n        sectionLinkEl = el;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!sectionLinkEl && allPromptOptions.length > 0) {\r\n      sectionLinkEl = allPromptOptions[0];\r\n    }\r\n\r\n    const sectionLinkString =\r\n      (sectionLinkEl &&\r\n        (sectionLinkEl.getAttribute(\"data-automation-label\") ||\r\n          sectionLinkEl.getAttribute(\"title\") ||\r\n          sectionLinkEl.getAttribute(\"aria-label\") ||\r\n          sectionLinkEl.textContent)) ||\r\n      \"\";\r\n\r\n    const titleCell = readByKey(\"title\");\r\n    const codeCell = readByKey(\"code\");\r\n    const sectCell = readByKey(\"section\");\r\n    const meetingCell = readByKey(\"meeting\");\r\n    const instructorCell = readByKey(\"instructor\");\r\n    const instructionalFormatCell = readByKey(\"instructionalFormat\"); // ✅ renamed\r\n\r\n    // ---------- Core parse: (code + section + title) from the same string ----------\r\n    let code = \"\";\r\n    let title = titleCell || \"\";\r\n    let section_number = \"\";\r\n\r\n    const parsed = parseSectionLinkString(sectionLinkString);\r\n    if (parsed) {\r\n      code = parsed.code;\r\n      section_number = parsed.section_number;\r\n      title = parsed.title;\r\n    }\r\n\r\n    if (!code)\r\n        code = guessClassCode(codeCell) || guessClassCode(titleCell) || guessClassCode(allText) || \"\";\r\n\r\n    // ---------- Lab / Seminar detection ----------\r\n    const labLike = (s) => /\\b(lab|laboratory|labratory)\\b/i.test(String(s || \"\"));\r\n    const seminarLike = (s) => /\\bseminar\\b/i.test(String(s || \"\"));\r\n\r\n    const isLab =\r\n      labLike(instructionalFormatCell) ||\r\n      labLike(sectCell) ||\r\n      labLike(title) ||\r\n      labLike(sectionLinkString) ||\r\n      labLike(allText)\r\n\r\n    const isSeminar =\r\n      seminarLike(instructionalFormatCell) ||\r\n      seminarLike(sectCell) ||\r\n      seminarLike(title) ||\r\n      seminarLike(sectionLinkString) ||\r\n      seminarLike(allText)\r\n\r\n    // ---------- Instructor ----------\r\n    let instructor = \"\";\r\n\r\n    let instructorEl =\r\n      (() => {\r\n        const instructorCol = colMap.instructor;\r\n        if (instructorCol != null && cellByCol.has(instructorCol))\r\n            return cellByCol.get(instructorCol);\r\n\r\n        if (posMap.instructor != null && posMap.instructor >= 0 && posMap.instructor < cells.length)\r\n          return cells[posMap.instructor];\r\n\r\n        return null;\r\n      })();\r\n\r\n    const looksLikeDate = (s) => /^\\d{4}-\\d{2}-\\d{2}$/.test(String(s || \"\").trim());\r\n    const looksLikeName = (s) => /^[A-Z][a-z]+(?: [A-Z][a-z]+)+$/.test(String(s || \"\").trim());\r\n\r\n\r\n    if (isLab || isSeminar) {\r\n      instructor = \"N/A\";\r\n    } else {\r\n      instructor = extractInstructorNamesFromCell(instructorEl) || (instructorCell || \"\").trim();\r\n      if (!instructor || looksLikeDate(instructor)) {\r\n        for (const cell of cells) {\r\n          const fallback = extractInstructorNamesFromCell(cell) || (cell.innerText || \"\").trim();\r\n          if (looksLikeName(fallback)) {\r\n            instructor = fallback;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // ---------- Meeting ----------\r\n    let meeting;\r\n\r\n    const meetingCol = colMap.meeting;\r\n    let meetingEl = null;\r\n\r\n    if (meetingCol != null && cellByCol.has(meetingCol)) {\r\n      meetingEl = cellByCol.get(meetingCol);\r\n    } else if (posMap.meeting != null && posMap.meeting >= 0 && posMap.meeting < cells.length) {\r\n      meetingEl = cells[posMap.meeting];\r\n    }\r\n\r\n    let lines = meetingEl ? extractMeetingLinesFromCell(meetingEl) : [];\r\n    if (!lines.length)\r\n        lines = extractMeetingLinesFromRow(row);\r\n\r\n    let meetingObj = { days: \"\", time: \"\", location: \"\" };\r\n\r\n    if (lines.length) {\r\n      const firstLine = lines[0];\r\n      meetingObj = formatMeetingLineForPanel(firstLine);\r\n    } else {\r\n      meeting = (meetingCell || \"\").trim();\r\n    }\r\n\r\n    const deliveryModeCell = getCellEl(\"deliveryMode\");\r\n    const isOnlineDelivery = onlineClassCheck(deliveryModeCell);\r\n\r\n    if (isOnlineDelivery) {\r\n      meetingObj.location = \"Online\";\r\n    }\r\n\r\n    if (meetingObj.days || meetingObj.time || meetingObj.location) {\r\n      meeting = [meetingObj.days, meetingObj.time].filter(Boolean).join(\" | \");\r\n      if (meetingObj.location)\r\n        meeting += `\\n${meetingObj.location}`;\r\n      else meeting += `\\nOnline`;\r\n    } else {\r\n      meeting = (meetingCell || \"\").trim();\r\n    }\r\n\r\n    // ---------- Instructional Format (was \"status\") ----------\r\n    const instructionalFormat = (instructionalFormatCell || \"\").trim();\r\n\r\n    // Final title fallback\r\n    if (!title && sectionLinkString) {\r\n      const idx = sectionLinkString.indexOf(\" - \");\r\n      if (idx >= 0)\r\n        title = sectionLinkString.slice(idx + 3).trim();\r\n    }\r\n\r\n    // ---------- Sanity swap ----------\r\n    if (looksLikeDate(instructor) && looksLikeName(meeting)) {\r\n      const tmp = instructor;\r\n      instructor = meeting;\r\n      meeting = tmp;\r\n    }\r\n\r\n    return {\r\n      code,\r\n      title,\r\n      section_number,\r\n      instructor,\r\n      meeting: normalizeMeetingPatternsText(meeting),\r\n      instructionalFormat, // ✅ renamed field\r\n      isLab,\r\n      isSeminar,\r\n    };\r\n}","export const escHTML = (s) => {\r\n  return String(s ?? \"\")\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n}\r\n\r\n\r\nexport function renderRows(ctx, rows) {\r\n  ctx.tableBody.innerHTML = \"\";\r\n  const frag = document.createDocumentFragment();\r\n\r\n  rows.forEach((c) => {\r\n    const tr = document.createElement(\"tr\");\r\n\r\n    const badge =\r\n      c.isLab ? \"[Laboratory]\" :\r\n      c.isSeminar ? \"[Seminar]\" :\r\n      \"\";\r\n\r\n    tr.innerHTML = `\r\n      <td class=\"title\">\r\n        <div class=\"title-main\">${c.title || \"\"}</div>\r\n        ${badge ? `<div class=\"muted\">${badge}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"code\">${c.code || \"\"}</td>\r\n      <td class=\"sect\">${(c.section_number || \"\").trim()}</td>\r\n      <td class=\"instructor\">${c.instructor || \"\"}</td>\r\n      <td class=\"meeting\">\r\n        ${(() => {\r\n          const parts = String(c.meeting || \"\").split(\"\\n\");\r\n          const main = (parts[0] || \"\").trim();   // \"Wed / Fri | 12:30 p.m. - 2:00 p.m.\"\r\n          const sub  = (parts[1] || \"\").trim();   // \"Online\" OR \"Library (LIB) | Floor: 3 | Room: 317\"\r\n\r\n          return `\r\n            ${main ? `<span class=\"meeting-pill\">${escHTML(main)}</span>` : \"\"}\r\n            ${sub  ? `<div class=\"meeting-sub\">${escHTML(sub)}</div>` : \"\"}\r\n          `;\r\n        })()}\r\n      </td>\r\n      <td class=\"instructionalFormat\">${c.instructionalFormat || \"\"}</td>\r\n    `;\r\n\r\n    frag.appendChild(tr);\r\n  });\r\n\r\n  ctx.tableBody.appendChild(frag);\r\n}","import { $$, on } from \"../utilities/dom.js\"\r\nimport { STATE } from \"../core/state.js\"\r\nimport { renderRows } from \"./renderRows.js\"\r\n\r\nexport function applySearchFilter(q) {\r\n    q = (q || \"\").trim().toLowerCase();\r\n    if (!q) {\r\n      STATE.filtered = [...STATE.courses];\r\n\r\n      return;\r\n    }\r\n    STATE.filtered = STATE.courses.filter((c) => {\r\n      return [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"].some(\r\n        (k) => (c[k] || \"\").toLowerCase().includes(q)\r\n      );\r\n    });\r\n}\r\n\r\nexport function sortBy(key) {\r\n    if (!key)\r\n        return;\r\n    \r\n    const dir = STATE.sort.key === key ? -STATE.sort.dir : 1;\r\n    STATE.sort = { key, dir };\r\n\r\n    const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: \"base\" });\r\n    STATE.filtered.sort((a, b) => dir * collator.compare(a[key] || \"\", b[key] || \"\"));\r\n}\r\n\r\nexport function wireSorting(ctx) {\r\n    const headCells = $$(ctx.tableHead, \"th[data-key]\");\r\n    headCells.forEach((th) => {\r\n      on(th, \"click\", () => {\r\n        const key = th.getAttribute(\"data-key\");\r\n        sortBy(key);\r\n        renderRows(ctx, STATE.filtered);\r\n\r\n        headCells.forEach((h) => h.classList.remove(\"sorted-asc\", \"sorted-desc\"));\r\n        th.classList.add(STATE.sort.dir === 1 ? \"sorted-asc\" : \"sorted-desc\");\r\n      });\r\n    });\r\n}","import { STATE } from \"../core/state\"\r\n\r\nexport const csvEscape = (v) => {\r\n    if (v == null)\r\n        return \"\";\r\n\r\n    const s = String(v);\r\n    \r\n    return /[\",\\n]/.test(s) ? `\"${s.replace(/\"/g, '\"\"')}\"` : s;\r\n};\r\n  \r\nexport const toCSV = (rows, headers) => {\r\n    const head = headers.map(csvEscape).join(\",\");\r\n    const body = rows\r\n      .map((r) => headers.map((h) => csvEscape(r[h] ?? \"\")).join(\",\"))\r\n      .join(\"\\n\");\r\n\r\n    return head + \"\\n\" + body;\r\n};\r\n\r\nexport function exportCSV() {\r\n    const headers = [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"];\r\n    const csv = toCSV(STATE.filtered, headers);\r\n\r\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = \"captured-courses.csv\";\r\n    document.body.appendChild(a);\r\n    a.click();\r\n\r\n    setTimeout(() => {\r\n      URL.revokeObjectURL(url);\r\n      a.remove();\r\n    }, 100);\r\n}","import { on, debounce } from \"./utilities/dom.js\"\r\nimport { STATE } from \"./core/state.js\"\r\nimport { ensureMount } from \"./utilities/shadowMount.js\"\r\nimport { loadPanel } from \"./panel/loadPanel.js\"\r\nimport { extractAllCourses } from \"./extraction/courseExtraction.js\"\r\nimport { applySearchFilter, sortBy, wireSorting } from \"./panel/panelInteractions.js\"\r\nimport { renderRows } from \"./panel/renderRows.js\"\r\nimport { exportCSV } from \"./exporting/cvs.js\"\r\n\r\n(() => {\r\n  console.log(\"[WD] content script loaded\");\r\n  async function boot() {\r\n    const shadow = ensureMount();\r\n    const ctx = await loadPanel(shadow);\r\n\r\n    on(ctx.button, \"click\", () => {\r\n      ctx.widget.classList.toggle(\"is-hidden\");\r\n    });\r\n\r\n    on(ctx.refresh, \"click\", async () => {\r\n      STATE.courses = await extractAllCourses();\r\n      applySearchFilter(ctx.search.value);\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n    });\r\n\r\n    on(ctx.exportBtn, \"click\", exportCSV);\r\n\r\n    on(\r\n      ctx.search,\r\n      \"input\",\r\n      debounce(() => {\r\n        applySearchFilter(ctx.search.value);\r\n        sortBy(STATE.sort.key || \"code\");\r\n        renderRows(ctx, STATE.filtered);\r\n      }, 100)\r\n    );\r\n\r\n    wireSorting(ctx);\r\n\r\n    STATE.courses = await extractAllCourses();\r\n    STATE.filtered = [...STATE.courses];\r\n    sortBy(\"code\");\r\n    renderRows(ctx, STATE.filtered);\r\n  }\r\n\r\n  if (document.readyState === \"complete\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();"],"names":["$$","root","sel","on","el","ev","fn","opts","debounce","ms","t","a","STATE","EXT_ID","ensureMount","host","loadPanel","shadow","htmlUrl","cssUrl","html","css","r","style","wrap","logoImg","normalizeText","s","buildHeaderMaps","gridRoot","headers","pos","text","getHeaderText","col","getColIndex","h","findByIncludes","needles","ns","hit","n","KEYS","colMap","posMap","k","headerEl","h4","direct","cur","i","v","parseSectionLinkString","input","str","m","baseCode","parts","p","sectionToken","parsedTitle","guessClassCode","extractMeetingLinesFromCell","meetingEl","lines","DATE_RE","TIME_RE","DAY_RE","extractMeetingLinesFromRow","rowEl","formatMeetingLineForPanel","line","dayPart","timePart","buildingPart","floorPart","roomPart","normalizeMeetingPatternsText","extractInstructorNamesFromCell","instructorEl","items","looksLikeDateOrMeeting","names","prompt","txt","onlineClassCheck","deliveryModeCellEl","label","findingTables","roots","headerText","rows","extractAllCourses","found","courses","headerMaps","row","c","extractFromRow","findUniqueCourses","list","key","seen","out","cells","allText","cellByCol","cell","getCellEl","readByKey","allPromptOptions","sectionLinkEl","sectionLinkString","titleCell","codeCell","sectCell","meetingCell","instructorCell","instructionalFormatCell","code","title","section_number","parsed","labLike","seminarLike","isLab","isSeminar","instructor","instructorCol","looksLikeDate","looksLikeName","fallback","meeting","meetingCol","meetingObj","firstLine","deliveryModeCell","instructionalFormat","idx","tmp","escHTML","renderRows","ctx","frag","tr","badge","main","sub","applySearchFilter","q","sortBy","dir","collator","b","wireSorting","headCells","th","csvEscape","toCSV","head","body","exportCSV","csv","blob","url","boot"],"mappings":"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"}