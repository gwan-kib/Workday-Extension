{"version":3,"file":"content.js","sources":["../src/utilities/dom.js","../src/core/state.js","../src/utilities/shadowMount.js","../src/panel/loadPanel.js","../src/extraction/headerMaps.js","../src/extraction/sectionLinkInfo.js","../src/extraction/meetingPatternsInfo.js","../src/extraction/instructorInfo.js","../src/extraction/onlineClassCheck.js","../src/extraction/findingTables.js","../src/extraction/courseExtraction.js","../src/panel/renderRows.js","../src/panel/panelInteractions.js","../src/panel/scheduleView.js","../src/exporting/ics.js","../src/exporting/png.js","../src/panel/scheduleStorage.js","../src/content.js"],"sourcesContent":["export const $ = (root, sel) => root.querySelector(sel);\r\n\r\nexport const $$ = (root, sel) =>\r\n  Array.from(root.querySelectorAll(sel));\r\n\r\nexport const on = (el, ev, fn, opts) =>\r\n  el && el.addEventListener(ev, fn, opts);\r\n\r\nexport const debounce = (fn, ms = 300) => {\r\n  let t;\r\n  return (...a) => {\r\n    clearTimeout(t);\r\n    t = setTimeout(() => fn(...a), ms);\r\n  };\r\n};","export const STATE = {\r\n    courses: [],\r\n    filtered: [],\r\n    savedSchedules: [],\r\n    sort: { key: null, dir: 1 },\r\n    view: {\r\n            panel: \"list\",\r\n            semester: \"first\",\r\n        },\r\n};","const EXT_ID = \"wd-courses-capture\";\r\n\r\nexport function ensureMount() {\r\n  let host = document.getElementById(EXT_ID);\r\n  if (host) return host.shadowRoot;\r\n\r\n  host = document.createElement(\"div\");\r\n  host.id = EXT_ID;\r\n  host.style.all = \"initial\";\r\n  host.style.position = \"fixed\";\r\n  host.style.bottom = \"16px\";\r\n  host.style.right = \"16px\";\r\n  host.style.zIndex = \"2147483647\";\r\n  host.attachShadow({ mode: \"open\" });\r\n  document.documentElement.appendChild(host);\r\n\r\n  return host.shadowRoot;\r\n}\r\n","export async function loadPanel(shadow) {\r\n  const htmlUrl = chrome.runtime.getURL(\"src/panel.html\");\r\n  const cssFiles = [\r\n    \"formatting/general.css\",\r\n    \"formatting/widget-shell.css\",\r\n    \"formatting/widget-buttons.css\",\r\n    \"formatting/floating-button.css\",\r\n    \"formatting/course-list.css\",\r\n    \"formatting/schedule-view.css\",\r\n    \"formatting/schedule-view-events.css\",\r\n    \"formatting/settings.css\",\r\n\r\n    \"colors/course-list-colors.css\",\r\n    \"colors/general-colors.css\",\r\n    \"colors/schedule-view-colors.css\",\r\n    \"colors/widget-functionality-colors.css\",\r\n    \"colors/settings-colors.css\",\r\n  ];\r\n  const [html, ...cssParts] = await Promise.all([\r\n    fetch(htmlUrl).then((r) => r.text()),\r\n    ...cssFiles.map((file) =>\r\n      fetch(chrome.runtime.getURL(`src/css/${file}`)).then((r) => r.text())\r\n    ),\r\n  ]);\r\n  const css = cssParts.join(\"\\n\");\r\n\r\n  shadow.innerHTML = \"\";\r\n\r\n  const style = document.createElement(\"style\");\r\n  style.textContent = css;\r\n  shadow.appendChild(style);\r\n\r\n  if (!document.querySelector('link[href*=\"Material+Symbols\"]')) {\r\n    const link = document.createElement(\"link\");\r\n    link.rel = \"stylesheet\";\r\n    link.href =\r\n      \"https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200\";\r\n    document.head.appendChild(link);\r\n  }\r\n\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.innerHTML = html;\r\n  shadow.appendChild(wrap);\r\n\r\n  return {\r\n    button: shadow.querySelector(\"#floating-button\"),\r\n    widget: shadow.querySelector(\".widget\"),\r\n    root: shadow,\r\n    search: shadow.querySelector(\"#widget-search\"),\r\n    saveScheduleBtn: shadow.querySelector(\"#widget-save-schedule\"),\r\n    refresh: shadow.querySelector(\"#widget-refresh\"),\r\n    exportDropdown: shadow.querySelector(\"#widget-export\"),\r\n    exportMenu: shadow.querySelector(\"#widget-export-menu\"),\r\n      helpBtn: shadow.querySelector(\".help\"),\r\n    settingsBtn: shadow.querySelector(\".settings\"),\r\n    tableBody: shadow.querySelector(\"tbody\"),\r\n    tableHead: shadow.querySelector(\"thead\"),\r\n    tabButtons: shadow.querySelectorAll(\".tab-button\"),\r\n    panels: shadow.querySelectorAll(\".widget-panel\"),\r\n    scheduleGrid: shadow.querySelector(\"#schedule-grid\"),\r\n    semesterButtons: shadow.querySelectorAll(\".semester-button\"),\r\n    savedDropdown: shadow.querySelector(\"#schedule-saved-dropdown\"),\r\n    savedMenu: shadow.querySelector(\"#schedule-saved-menu\"),\r\n    footerConflicts: shadow.querySelector(\"#widget-conflicts\"),\r\n    saveModal: shadow.querySelector(\"#schedule-save-modal\"),\r\n    saveModalTitle: shadow.querySelector(\"#schedule-modal-title\"),\r\n    saveModalMessage: shadow.querySelector(\"#schedule-modal-message\"),\r\n    saveModalField: shadow.querySelector(\"#schedule-modal-field\"),\r\n    saveModalInput: shadow.querySelector(\"#schedule-modal-input\"),\r\n    saveModalCancel: shadow.querySelector(\".schedule-modal-cancel\"),\r\n    saveModalConfirm: shadow.querySelector(\".schedule-modal-confirm\"),\r\n  };\r\n}\r\n","export const normalizeText = (s) => String(s || \"\")\r\n      .replace(/\\u00A0/g, \" \")\r\n      .replace(/\\s+/g, \" \")\r\n      .trim()\r\n      .toLowerCase();\r\n\r\nfunction getHeaderKey(el) {\r\n  const a = el?.getAttribute?.(\"data-automation-id\") || \"\";\r\n  const m = a.match(/^columnHeader(\\d+\\.\\d+)$/);\r\n  return m ? m[1] : null; // \"252.9\"\r\n}\r\n\r\nexport function buildHeaderMaps(gridRoot) {\r\n  const headerEls = Array.from(\r\n    gridRoot.querySelectorAll('th[data-automation-id^=\"columnHeader\"]')\r\n  );\r\n\r\n  const headers = headerEls\r\n    .map((el, pos) => {\r\n      const text = getHeaderText(el);\r\n      const key = getHeaderKey(el); // <-- \"252.9\"\r\n      return { el, pos, key, text, norm: normalizeText(text) };\r\n    })\r\n    .filter((h) => h.text);\r\n\r\n  function findHeader(needles) {\r\n    const ns = needles.map(normalizeText);\r\n    let hit = headers.find(h => ns.includes(h.norm));\r\n    if (hit) return hit;\r\n    hit = headers.find(h => ns.some(n => h.norm.includes(n)));\r\n    return hit || null;\r\n  }\r\n\r\n  const KEYS = {\r\n    instructor: [\"instructor\", \"instructors\"],\r\n    meeting: [\"meeting patterns\", \"meeting pattern\"],\r\n    deliveryMode: [\"delivery mode\"],\r\n    title: [\"title\", \"course listing\"],\r\n    section: [\"section\"],\r\n    instructionalFormat: [\"instructional format\"],\r\n     startDate: [\"start date\", \"start\"],\r\n  };\r\n\r\n  const colMap = {};\r\n  const posMap = {};\r\n\r\n  for (const [key, needles] of Object.entries(KEYS)) {\r\n    const hit = findHeader(needles);\r\n    colMap[key] = hit ? hit.key : null; // <-- store \"252.9\"\r\n    posMap[key] = hit ? hit.pos : -1;\r\n  }\r\n\r\n  return { colMap, posMap };\r\n}\r\n\r\nexport function getHeaderText(headerEl) {\r\n  if (!headerEl) return \"\";\r\n\r\n  const btn = headerEl.querySelector(\"button[title]\");\r\n  if (btn) return (btn.getAttribute(\"title\") || \"\").trim();\r\n\r\n  return (headerEl.textContent || \"\").trim();\r\n}","/* Parse the Workday \"promptOption\" section link string. */\r\nexport function parseSectionLinkString(input) {\r\n    let str = String(input || \"\").replace(/\\u00A0/g, \" \").trim();\r\n\r\n    if (!str)\r\n        return null;\r\n\r\n    // keep ALL lines; Workday wraps titles with \\n\r\n    str = str.replace(/\\s*\\n\\s*/g, \" \").trim();\r\n\r\n    // REQUIRED pattern:\r\n    const m = str.match(/^\\s*([A-Z][A-Z0-9_]*\\s*\\d{3}[A-Z]?)\\s*-\\s*(.+?)\\s*$/);\r\n    if (!m)\r\n        return null;\r\n\r\n    const baseCode = m[1].trim(); // \"COSC_O 222\"\r\n    const rest = m[2].trim();     // \"L2D - Data Structures\" or \"101 - Data Structures\"\r\n\r\n    // Split rest into section token + title\r\n    const parts = rest.split(/\\s*[-–—]\\s*/).map((p) => p.trim()).filter(Boolean);\r\n\r\n    let sectionToken = \"\";\r\n    let parsedTitle = \"\";\r\n\r\n    sectionToken = parts[0];\r\n    parsedTitle = parts.slice(1).join(\" - \").trim();\r\n\r\n    parsedTitle = parsedTitle.replace(/\\s*:\\s*/g, \":\\n\");\r\n\r\n    return {\r\n      code: baseCode,\r\n      section_number: sectionToken,\r\n      title: parsedTitle,\r\n      full: str,\r\n    };\r\n}\r\n\r\nexport function guessClassCode(text) {\r\n    const m = String(text || \"\").match(/[A-Z][A-Z0-9_]*\\s*\\d{2,3}[A-Z]?/);\r\n    \r\n    return m ? m[0].replace(/\\s+/g, \" \").trim() : \"\";\r\n}","export function extractMeetingLinesFromCell(meetingEl) {\r\n    if (!meetingEl) {\r\n      return [];\r\n    }\r\n\r\n    // BEST SOURCE: menu items expose full meeting strings in aria-label\r\n    const menuItems = Array.from(\r\n      meetingEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]')\r\n    );\r\n\r\n    let lines = menuItems\r\n      .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n      .filter(Boolean);\r\n\r\n    // fallback: promptOption text (sometimes present)\r\n    if (!lines.length) {\r\n      const prompts = Array.from(\r\n        meetingEl.querySelectorAll('[data-automation-id=\"promptOption\"]')\r\n      );\r\n      lines = prompts\r\n        .map((el) =>\r\n          (\r\n            el.getAttribute(\"data-automation-label\") ||\r\n            el.getAttribute(\"title\") ||\r\n            el.textContent ||\r\n            \"\"\r\n          ).trim()\r\n        )\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // final fallback: innerText split\r\n    if (!lines.length) {\r\n      lines = String(meetingEl.innerText || \"\")\r\n        .split(\"\\n\")\r\n        .map((s) => s.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    // only keep real meeting sentences\r\n    const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n    const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n    const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n    return lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n}\r\n\r\nexport function extractMeetingLinesFromRow(rowEl) {\r\n    if (!rowEl)\r\n        return [];\r\n\r\n    const items = Array.from(rowEl.querySelectorAll('[data-automation-id=\"menuItem\"][aria-label]'));\r\n    const lines = items\r\n        .map((el) => (el.getAttribute(\"aria-label\") || \"\").trim())\r\n        .filter(Boolean);\r\n\r\n    const DATE_RE = /\\b\\d{4}-\\d{2}-\\d{2}\\s*-\\s*\\d{4}-\\d{2}-\\d{2}\\b/;\r\n    const TIME_RE = /\\b\\d{1,2}:\\d{2}\\s*[ap]\\.?m\\.?\\b/i;\r\n    const DAY_RE = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/i;\r\n\r\n    return lines.filter((s) => DATE_RE.test(s) && TIME_RE.test(s) && DAY_RE.test(s));\r\n}\r\n\r\nexport function formatMeetingLineForPanel(line) {\r\n  const raw = String(line || \"\");\r\n\r\n  const parts = raw\r\n    .split(\"|\")\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n\r\n  const dayPartRaw = parts.find((p) => /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/.test(p)) || \"\";\r\n  const dayPart = dayPartRaw.split(/\\s+/).join(\" / \");\r\n\r\n  const timePart = parts.find((p) => /\\d{1,2}:\\d{2}/.test(p) && /-/.test(p)) || \"\";\r\n\r\n  const buildingPart = parts.find((p) => /\\([A-Z]{2,}\\)/.test(p)) || \"\";\r\n\r\n  // ✅ find Floor/Room anywhere in the full string (handles \"Floor 3\", \"Floor: 3\", \"Rm 210\", etc.)\r\n  const floorMatch = raw.match(/\\bfloor\\b\\s*[:\\-]?\\s*(-?[A-Za-z0-9]+)/i);\r\n  const roomMatch  = raw.match(/\\b(room|rm)\\b\\s*[:\\-]?\\s*([A-Za-z0-9]+)/i);\r\n\r\n  const floorPart = floorMatch ? `Floor: ${floorMatch[1]}` : \"\";\r\n  const roomPart  = roomMatch  ? `Room: ${roomMatch[2]}`  : \"\";\r\n\r\n  return {\r\n    days: dayPart,\r\n    time: timePart,\r\n    location: [\r\n      buildingPart,\r\n      [floorPart, roomPart].filter(Boolean).join(\" | \"),\r\n    ].filter(Boolean).join(\"\\n\"),\r\n  };\r\n}\r\n\r\n\r\nexport function normalizeMeetingPatternsText(text) {\r\n    // preserve line breaks, normalize each line\r\n    return String(text || \"\")\r\n      .split(/\\r?\\n/)\r\n      .map((line) => line.replace(/\\s+/g, \" \").trim())\r\n      .filter(Boolean)\r\n      .join(\"\\n\");\r\n}\r\n\r\nexport function extractStartDate(line) {\r\n    const match = String(line || \"\").match(/\\b(\\d{4}-\\d{2}-\\d{2})\\b/);\r\n    return match ? match[1] : \"\";\r\n}","export function extractInstructorNamesFromCell(instructorEl) {\r\n    if (!instructorEl) {\r\n      return \"\";\r\n    }\r\n    \r\n    const prompt = instructorEl.querySelector('[data-automation-id=\"promptOption\"]');\r\n    const txt = (\r\n      (prompt && (prompt.getAttribute(\"data-automation-label\") || prompt.getAttribute(\"title\") || prompt.textContent)) ||\r\n      instructorEl.textContent || \"\").trim();\r\n    return txt;\r\n}","export function onlineClassCheck(deliveryModeCellEl) {\r\n    if (!deliveryModeCellEl) return false;\r\n\r\n    const txt = (deliveryModeCellEl.innerText || deliveryModeCellEl.textContent || \"\").trim();\r\n    if (/online learning/i.test(txt)) return true;\r\n\r\n    const prompts = Array.from(deliveryModeCellEl.querySelectorAll('[data-automation-id=\"promptOption\"]'));\r\n    return prompts.some((el) => {\r\n      const label = (el.getAttribute(\"data-automation-label\") || el.getAttribute(\"title\") || el.textContent || \"\").trim();\r\n      return /online learning/i.test(label);\r\n    });\r\n  }","import { $$ } from \"../utilities/dom\"\r\nimport { normalizeText, getHeaderText } from \"./headerMaps.js\"\r\n\r\n// Find any likely Workday grid/table on the page\r\nexport function findingTables() {\r\n    const roots = $$(\r\n      document,\r\n      'table, [role=\"table\"], div[data-automation-id*=\"grid\"], div[role=\"grid\"]'\r\n    );\r\n\r\n    for (const root of roots) {\r\n      const headerEls = $$(\r\n        root,\r\n        \"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header\"\r\n      );\r\n\r\n      const headerText = headerEls.map((h) => normalizeText(getHeaderText(h)));\r\n\r\n      // still require \"section\" + at least one other expected header\r\n      const looksRight =\r\n        headerText.some((t) => t.includes(\"section\")) &&\r\n        (headerText.some((t) => t.includes(\"instructor\")) ||\r\n          headerText.some((t) => t.includes(\"meeting\")) ||\r\n          headerText.some((t) => t.includes(\"instructional format\")) ||\r\n          headerText.some((t) => t.includes(\"format\")) ||\r\n          headerText.some((t) => t.includes(\"status\")));\r\n\r\n      if (!looksRight) \r\n        continue;\r\n\r\n      const rows = $$(\r\n        root,\r\n        \"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row\"\r\n      );\r\n\r\n      if (rows.length)\r\n        return { root, rows };\r\n    }\r\n\r\n    return null;\r\n  }","import { $$ } from \"../utilities/dom\";\r\nimport { buildHeaderMaps } from \"./headerMaps.js\";\r\nimport { parseSectionLinkString, guessClassCode } from \"./sectionLinkInfo.js\";\r\nimport {\r\n  extractMeetingLinesFromCell,\r\n  extractMeetingLinesFromRow,\r\n  formatMeetingLineForPanel,\r\n  normalizeMeetingPatternsText,\r\n  extractStartDate,\r\n} from \"./meetingPatternsInfo.js\";\r\nimport { extractInstructorNamesFromCell } from \"./instructorInfo.js\";\r\nimport { onlineClassCheck } from \"./onlineClassCheck.js\";\r\nimport { findingTables } from \"./findingTables.js\";\r\n\r\nexport async function extractAllCourses() {\r\n  const found = findingTables();\r\n  let courses = [];\r\n\r\n  if (found) {\r\n    const headerMaps = buildHeaderMaps(found.root);\r\n\r\n    for (const row of found.rows) {\r\n      const c = extractFromRow(row, headerMaps);\r\n      if ((c.code || c.title) && Object.values(c).join(\"\").trim())\r\n        courses.push(c);\r\n    }\r\n  }\r\n\r\n  return findUniqueCourses(courses);\r\n}\r\n\r\nfunction findUniqueCourses(list) {\r\n  const key = (c) =>\r\n    [c.code, c.title, c.section_number].join(\"|\").toLowerCase();\r\n  const seen = new Set();\r\n  const out = [];\r\n\r\n  for (const c of list) {\r\n    const k = key(c);\r\n    if (!seen.has(k)) {\r\n      seen.add(k);\r\n      out.push(c);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport function extractFromRow(row, headerMaps) {\r\n  const { colMap, posMap } = headerMaps;\r\n\r\n  const cells = $$(row, \"td, [role='gridcell']\");\r\n  const allText = (row.innerText || \"\").trim();\r\n\r\n  // map row cells by position (1-based)\r\n  function getCellKey(cell) {\r\n    // looks inside the cell for the container with id like \"gen-dwr-comp-252.9-640\"\r\n    const inner = cell.querySelector('[id^=\"gen-dwr-comp-\"]');\r\n    const id = inner?.id || \"\";\r\n    const m = id.match(/^gen-dwr-comp-(\\d+\\.\\d+)-/);\r\n    return m ? m[1] : null; // \"252.9\"\r\n  }\r\n\r\n  // map row cells by Workday key (e.g., \"252.9\"), not by position\r\n  const cellByCol = new Map();\r\n  cells.forEach((cell) => {\r\n    const key = getCellKey(cell);\r\n    if (key && !cellByCol.has(key)) cellByCol.set(key, cell);\r\n  });\r\n\r\n  const getCellEl = (keyName) => {\r\n    const key = colMap[keyName]; // e.g., \"252.9\"\r\n    if (key != null && cellByCol.has(key)) return cellByCol.get(key);\r\n\r\n    const pos = posMap[keyName];\r\n    if (pos != null && pos >= 0 && pos < cells.length) return cells[pos];\r\n\r\n    return null;\r\n  };\r\n\r\n  const readByKey = (key) => {\r\n    const col = colMap[key];\r\n    if (col != null && cellByCol.has(col)) {\r\n      return (cellByCol.get(col).innerText || \"\").trim();\r\n    }\r\n\r\n    const pos = posMap[key];\r\n    if (pos != null && pos >= 0 && pos < cells.length) {\r\n      return (cells[pos].innerText || \"\").trim();\r\n    }\r\n    return \"\";\r\n  };\r\n\r\n  // ✅ Search the entire row for the promptOption link (most reliable)\r\n  const allPromptOptions = $$(row, '[data-automation-id=\"promptOption\"]');\r\n  let sectionLinkEl = null;\r\n\r\n  for (const el of allPromptOptions) {\r\n    const text =\r\n      el.getAttribute(\"data-automation-label\") ||\r\n      el.getAttribute(\"title\") ||\r\n      el.getAttribute(\"aria-label\") ||\r\n      el.textContent ||\r\n      \"\";\r\n    if (/^[A-Z][A-Z0-9_]*\\s*\\d{2,3}-/.test(text)) {\r\n      sectionLinkEl = el;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!sectionLinkEl && allPromptOptions.length > 0) {\r\n    sectionLinkEl = allPromptOptions[0];\r\n  }\r\n\r\n  const sectionLinkString =\r\n    (sectionLinkEl &&\r\n      (sectionLinkEl.getAttribute(\"data-automation-label\") ||\r\n        sectionLinkEl.getAttribute(\"title\") ||\r\n        sectionLinkEl.getAttribute(\"aria-label\") ||\r\n        sectionLinkEl.textContent)) ||\r\n    \"\";\r\n\r\n  const titleCell = readByKey(\"title\");\r\n  const codeCell = readByKey(\"code\");\r\n  const sectCell = readByKey(\"section\");\r\n  const meetingCell = readByKey(\"meeting\");\r\n  const instructionalFormatCell = readByKey(\"instructionalFormat\");\r\n  const startDateCell = readByKey(\"startDate\");\r\n\r\n  // ---------- Core parse: (code + section + title) from the same string ----------\r\n  let code = \"\";\r\n  let title = titleCell || \"\";\r\n  let section_number = \"\";\r\n\r\n  const parsed = parseSectionLinkString(sectionLinkString);\r\n  if (parsed) {\r\n    code = parsed.code;\r\n    section_number = parsed.section_number;\r\n    title = parsed.title;\r\n  }\r\n\r\n  if (!code)\r\n    code =\r\n      guessClassCode(codeCell) ||\r\n      guessClassCode(titleCell) ||\r\n      guessClassCode(allText) ||\r\n      \"\";\r\n\r\n  // ---------- Lab / Seminar detection ----------\r\n  const labLike = (s) =>\r\n    /\\b(lab|laboratory|labratory)\\b/i.test(String(s || \"\"));\r\n  const seminarLike = (s) => /\\bseminar\\b/i.test(String(s || \"\"));\r\n  const discussionLike = (s) => /\\bdiscussion\\b/i.test(String(s || \"\"));\r\n\r\n  const isLab =\r\n    labLike(instructionalFormatCell) ||\r\n    labLike(sectCell) ||\r\n    labLike(title) ||\r\n    labLike(sectionLinkString) ||\r\n    labLike(allText);\r\n\r\n  const isSeminar =\r\n    seminarLike(instructionalFormatCell) ||\r\n    seminarLike(sectCell) ||\r\n    seminarLike(title) ||\r\n    seminarLike(sectionLinkString) ||\r\n    seminarLike(allText);\r\n\r\n    const isDiscussion =\r\n      discussionLike(instructionalFormatCell) ||\r\n      discussionLike(sectCell) ||\r\n      discussionLike(title) ||\r\n      discussionLike(sectionLinkString) ||\r\n      discussionLike(allText)\r\n\r\n  // ---------- Instructor ----------\r\n\r\n  const instructorEl = getCellEl(\"instructor\"); // uses colMap/posMap + cellByCol\r\n\r\n  let instructor = \"\";\r\n\r\n  if (isLab || isSeminar) {\r\n    instructor = \"N/A\";\r\n  } else {\r\n    instructor =\r\n      extractInstructorNamesFromCell(instructorEl) ||\r\n      (readByKey(\"instructor\") || \"\").trim();\r\n  }\r\n\r\n  // ---------- Meeting ----------\r\n  let meeting;\r\n\r\n  const meetingCol = colMap.meeting;\r\n  let meetingEl = null;\r\n\r\n  if (meetingCol != null && cellByCol.has(meetingCol)) {\r\n    meetingEl = cellByCol.get(meetingCol);\r\n  } else if (\r\n    posMap.meeting != null &&\r\n    posMap.meeting >= 0 &&\r\n    posMap.meeting < cells.length\r\n  ) {\r\n    meetingEl = cells[posMap.meeting];\r\n  }\r\n\r\n  let lines = meetingEl ? extractMeetingLinesFromCell(meetingEl) : [];\r\n  if (!lines.length) lines = extractMeetingLinesFromRow(row);\r\n\r\n  let meetingObj = { days: \"\", time: \"\", location: \"\" };\r\n  let startDate = extractStartDate(lines[0]) || extractStartDate(startDateCell);\r\n\r\n  if (lines.length) {\r\n    const firstLine = lines[0];\r\n    meetingObj = formatMeetingLineForPanel(firstLine);\r\n  } else {\r\n    meeting = (meetingCell || \"\").trim();\r\n  }\r\n\r\n  const deliveryModeCell = getCellEl(\"deliveryMode\");\r\n  const isOnlineDelivery = onlineClassCheck(deliveryModeCell);\r\n\r\n  if (isOnlineDelivery) {\r\n    meetingObj.location = \"Online\";\r\n  }\r\n\r\n  if (meetingObj.days || meetingObj.time || meetingObj.location) {\r\n    meeting = [meetingObj.days, meetingObj.time].filter(Boolean).join(\" | \");\r\n    if (meetingObj.location) meeting += `\\n${meetingObj.location}`;\r\n    else meeting += `\\nOnline`;\r\n  } else {\r\n    meeting = (meetingCell || \"\").trim();\r\n  }\r\n\r\n  // ---------- Instructional Format (was \"status\") ----------\r\n  const instructionalFormat = (instructionalFormatCell || \"\").trim();\r\n\r\n  return {\r\n    code,\r\n    title,\r\n    section_number,\r\n    instructor,\r\n    meeting: normalizeMeetingPatternsText(meeting),\r\n    instructionalFormat, // ✅ renamed field\r\n    startDate,\r\n    meetingLines: lines,\r\n    isLab,\r\n    isSeminar,\r\n    isDiscussion,\r\n  };\r\n}\r\n","export const escHTML = (s) => {\r\n  return String(s ?? \"\")\r\n    .replace(/&/g, \"&amp;\")\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#39;\");\r\n}\r\nfunction cleanLines(text) {\r\n  return String(text || \"\")\r\n    .replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \" \")  // kill nbsp/zero-width\r\n    .replace(/[ \\t]+\\n/g, \"\\n\")                   // trailing spaces before newline\r\n    .replace(/\\n[ \\t]+/g, \"\\n\")                   // leading spaces after newline\r\n    .replace(/\\n{2,}/g, \"\\n\")                     // collapse multiple newlines\r\n    .trim();\r\n}\r\n\r\n\r\nexport function renderRows(ctx, rows) {\r\n  ctx.tableBody.innerHTML = \"\";\r\n  const frag = document.createDocumentFragment();\r\n\r\n  rows.forEach((c) => {\r\n    const tr = document.createElement(\"tr\");\r\n\r\n    const badge =\r\n      c.isLab ? \"[Laboratory]\" :\r\n      c.isSeminar ? \"[Seminar]\" :\r\n       c.isDiscussion ? \"[Discussion]\" :\r\n      \"\";\r\n\r\n    tr.innerHTML = `\r\n      <td class=\"title\">\r\n        <div class=\"title-main\">${c.title || \"\"}</div>\r\n        ${badge ? `<div class=\"muted\">${badge}</div>` : \"\"}\r\n      </td>\r\n      <td class=\"code\">${c.code || \"\"}</td>\r\n      <td class=\"sect\">${(c.section_number || \"\").trim()}</td>\r\n      <td class=\"instructor\">${c.instructor || \"\"}</td>\r\n      <td class=\"meeting\">\r\n        ${(() => {\r\n          const parts = cleanLines(c.meeting).split(\"\\n\");\r\n          const main = (parts[0] || \"\").trim();\r\n          const sub = parts.slice(1).map((s) => s.replace(/[\\u00A0\\u200B-\\u200D\\uFEFF]/g, \"\").trim()).filter(Boolean).join(\"\\n\");\r\n          return `\r\n            ${main ? `<span class=\"meeting-pill\">${escHTML(main).trim()}</span>` : \"\"}\r\n            ${sub  ? `<div class=\"meeting-sub\">${escHTML(sub).trim()}</div>` : \"\"}\r\n          `;\r\n        })()}\r\n      </td>\r\n      <td class=\"instructionalFormat\">${c.instructionalFormat || \"\"}</td>\r\n    `;\r\n\r\n    frag.appendChild(tr);\r\n  });\r\n\r\n  ctx.tableBody.appendChild(frag);\r\n}","import { $$, on } from \"../utilities/dom.js\"\r\nimport { STATE } from \"../core/state.js\"\r\nimport { renderRows } from \"./renderRows.js\"\r\n\r\nexport function applySearchFilter(q) {\r\n    q = (q || \"\").trim().toLowerCase();\r\n    if (!q) {\r\n      STATE.filtered = [...STATE.courses];\r\n\r\n      return;\r\n    }\r\n    STATE.filtered = STATE.courses.filter((c) => {\r\n      return [\"code\", \"title\", \"section_number\", \"instructor\", \"meeting\", \"instructionalFormat\"].some(\r\n        (k) => (c[k] || \"\").toLowerCase().includes(q)\r\n      );\r\n    });\r\n}\r\n\r\nexport function sortBy(key) {\r\n    if (!key)\r\n        return;\r\n    \r\n    const dir = STATE.sort.key === key ? -STATE.sort.dir : 1;\r\n    STATE.sort = { key, dir };\r\n\r\n    const collator = new Intl.Collator(undefined, { numeric: true, sensitivity: \"base\" });\r\n    STATE.filtered.sort((a, b) => dir * collator.compare(a[key] || \"\", b[key] || \"\"));\r\n}\r\n\r\nexport function wireSorting(ctx) {\r\n    const headCells = $$(ctx.tableHead, \"th[data-key]\");\r\n    headCells.forEach((th) => {\r\n      on(th, \"click\", () => {\r\n        const key = th.getAttribute(\"data-key\");\r\n        sortBy(key);\r\n        renderRows(ctx, STATE.filtered);\r\n\r\n        headCells.forEach((h) => h.classList.remove(\"sorted-asc\", \"sorted-desc\"));\r\n        th.classList.add(STATE.sort.dir === 1 ? \"sorted-asc\" : \"sorted-desc\");\r\n      });\r\n    });\r\n}","import { extractStartDate } from \"../extraction/meetingPatternsInfo.js\";\r\n\r\nconst DAYS = [\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\"];\r\n\r\n// 30-min grid so 12:30 fits naturally\r\nconst START_HOUR = 8;\r\nconst END_HOUR = 21; // last visible hour (exclusive end)\r\nconst SLOT_MINUTES = 30;\r\n\r\n// Build slot start times: 8:00, 8:30, 9:00, ...\r\nconst SLOTS = [];\r\nfor (let h = START_HOUR; h < END_HOUR; h++) {\r\n  SLOTS.push(h * 60);\r\n  SLOTS.push(h * 60 + 30);\r\n}\r\nSLOTS.push(END_HOUR * 60);\r\n\r\nconst DAY_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\nconst TIME_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/gi;\r\n\r\nconst SEMESTER_MONTHS = {\r\n  first: [\"09\", \"08\"],\r\n  second: [\"01\", \"12\"],\r\n};\r\n\r\nfunction parseTimeToken(token) {\r\n  if (!token) return null;\r\n\r\n  const match = token.trim().match(/(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i);\r\n  if (!match) return null;\r\n\r\n  let hours = Number.parseInt(match[1], 10);\r\n  const minutes = Number.parseInt(match[2], 10);\r\n  const period = match[3].toLowerCase();\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return hours * 60 + minutes;\r\n}\r\n\r\nfunction parseMeetingLine(line) {\r\n  const days = String(line || \"\").match(DAY_REGEX) || [];\r\n  const timeTokens = String(line || \"\").match(TIME_REGEX) || [];\r\n\r\n  if (days.length === 0 || timeTokens.length < 2) return null;\r\n\r\n  const startMinutes = parseTimeToken(timeTokens[0]);\r\n  const endMinutes = parseTimeToken(timeTokens[1]);\r\n\r\n  if (startMinutes == null || endMinutes == null) return null;\r\n\r\n  if (endMinutes <= startMinutes) return null;\r\n\r\n  return {\r\n    days: [...new Set(days)],\r\n    startMinutes,\r\n    endMinutes,\r\n    timeLabel: `${timeTokens[0]} - ${timeTokens[1]}`,\r\n  };\r\n}\r\n\r\nfunction getSemester(startDate) {\r\n  if (!startDate) return null;\r\n\r\n  const month = startDate.split(\"-\")[1];\r\n\r\n  if (SEMESTER_MONTHS.first.includes(month)) return \"first\";\r\n  if (SEMESTER_MONTHS.second.includes(month)) return \"second\";\r\n\r\n  return null;\r\n}\r\n\r\nfunction clampToGrid(minutes) {\r\n  const min = START_HOUR * 60;\r\n  const max = END_HOUR * 60;\r\n  return Math.max(min, Math.min(max, minutes));\r\n}\r\n\r\nfunction snapDownToSlot(minutes) {\r\n  return Math.floor(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction snapUpToSlot(minutes) {\r\n  return Math.ceil(minutes / SLOT_MINUTES) * SLOT_MINUTES;\r\n}\r\n\r\nfunction slotIndexOf(minutes) {\r\n  return SLOTS.indexOf(minutes);\r\n}\r\n\r\nfunction buildDayEvents(courses, semester) {\r\n  const eventsByDay = new Map();\r\n  DAYS.forEach((d) => eventsByDay.set(d, []));\r\n\r\n  const seen = new Set();\r\n  let eventId = 0;\r\n\r\n  courses.forEach((course) => {\r\n    const startDate =\r\n      course.startDate || extractStartDate(course.meetingLines?.[0]) || \"\";\r\n    const semester = getSemester(startDate);\r\n\r\n    if (semester !== semester) return;\r\n\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n\r\n    const label = course.isLab\r\n      ? \"[Laboratory]\"\r\n      : course.isSeminar\r\n      ? \"[Seminar]\"\r\n      : course.isDiscussion\r\n      ? \"[Discussion]\"\r\n      : \"\";\r\n\r\n    lines.forEach((line) => {\r\n      const parsed = parseMeetingLine(line);\r\n      if (!parsed) return;\r\n\r\n      let startMin = clampToGrid(parsed.startMinutes);\r\n      let endMin = clampToGrid(parsed.endMinutes);\r\n\r\n      startMin = snapDownToSlot(startMin);\r\n      endMin = snapUpToSlot(endMin);\r\n\r\n      const startIdx = slotIndexOf(startMin);\r\n      const endIdx = slotIndexOf(endMin);\r\n\r\n      if (startIdx === -1 || endIdx === -1 || endIdx <= startIdx) return;\r\n\r\n      const rowSpan = endIdx - startIdx;\r\n\r\n      parsed.days.forEach((day) => {\r\n        if (!eventsByDay.has(day)) return;\r\n\r\n        const key = [\r\n          day,\r\n          course.code || \"\",\r\n          course.title || \"\",\r\n          parsed.timeLabel,\r\n          startIdx,\r\n          rowSpan,\r\n        ].join(\"|\");\r\n\r\n        if (seen.has(key)) return;\r\n        seen.add(key);\r\n\r\n        eventsByDay.get(day).push({\r\n          id: eventId++,\r\n          code: course.code || \"\",\r\n          title: course.title || \"\",\r\n          label,\r\n          timeLabel: parsed.timeLabel,\r\n\r\n          rowStart: startIdx,\r\n          rowSpan,\r\n\r\n          startIdx,\r\n          endIdx,\r\n        });\r\n      });\r\n    });\r\n  });\r\n\r\n  DAYS.forEach((day) => {\r\n    eventsByDay\r\n      .get(day)\r\n      .sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n  });\r\n\r\n  return eventsByDay;\r\n}\r\n\r\n// Build overlap groups per DAY column.\r\n// Each group becomes ONE rowspan cell; if group has 2+ events, it’s a conflict cluster.\r\nfunction addConflicts(eventsByDay) {\r\n  const groupedByDay = new Map();\r\n\r\n  DAYS.forEach((day) => {\r\n    const events = (eventsByDay.get(day) || [])\r\n      .slice()\r\n      .sort((a, b) => a.startIdx - b.startIdx || a.endIdx - b.endIdx);\r\n\r\n    const groups = [];\r\n\r\n    let current = null;\r\n    let currentKey = null;\r\n\r\n    for (let r = 0; r < SLOTS.length - 1; r++) {\r\n      const active = events.filter((ev) => ev.startIdx <= r && ev.endIdx > r);\r\n      const key = active.length\r\n        ? active\r\n            .map((ev) => ev.id)\r\n            .sort((a, b) => a - b)\r\n            .join(\"|\")\r\n        : null;\r\n\r\n      if (!key) {\r\n        if (current) groups.push(current);\r\n        current = null;\r\n        currentKey = null;\r\n        continue;\r\n      }\r\n\r\n      if (current && key === currentKey) {\r\n        current.end = r + 1;\r\n        continue;\r\n      }\r\n\r\n      if (current) groups.push(current);\r\n\r\n      current = {\r\n        start: r,\r\n        end: r + 1,\r\n        events: active,\r\n        hasConflict: active.length > 1,\r\n      };\r\n      currentKey = key;\r\n    }\r\n\r\n    if (current) groups.push(current);\r\n\r\n    groupedByDay.set(day, groups);\r\n  });\r\n\r\n  return groupedByDay;\r\n}\r\n\r\nfunction getConflictSummaries(groupedByDay) {\r\n  const seen = new Set();\r\n  const conflicts = [];\r\n\r\n  groupedByDay.forEach((groups) => {\r\n    groups.forEach((group) => {\r\n      if (!group.hasConflict) return;\r\n\r\n      const codes = [\r\n        ...new Set(\r\n          group.events.map((ev) => ev.code || ev.title).filter(Boolean)\r\n        ),\r\n      ];\r\n\r\n      if (codes.length < 2) return;\r\n\r\n      codes.sort((a, b) => a.localeCompare(b));\r\n\r\n      const key = codes.join(\"|\");\r\n      if (seen.has(key)) return;\r\n      seen.add(key);\r\n      conflicts.push(codes);\r\n    });\r\n  });\r\n\r\n  return conflicts;\r\n}\r\n\r\nfunction updateConflictFooter(ctx, conflicts) {\r\n  if (!ctx?.footerConflicts) return;\r\n\r\n  if (!conflicts.length) {\r\n    ctx.footerConflicts.textContent = \"\";\r\n    return;\r\n  }\r\n\r\n  const conflictList = conflicts\r\n    .map((codes) => `[${codes.join(\", \")}]`)\r\n    .join(\" \");\r\n\r\n  ctx.footerConflicts.textContent = `⚠️ The following classes are in conflict: ${conflictList}`;\r\n}\r\n\r\nfunction formatSlotLabel(minutes) {\r\n  const h24 = Math.floor(minutes / 60);\r\n  const m = minutes % 60;\r\n\r\n  const hh = String(h24);\r\n  const mm = String(m).padStart(2, \"0\");\r\n  return `${hh}:${mm}`;\r\n}\r\n\r\nfunction buildScheduleTable() {\r\n  // Wrap so we can overlay blocks on top of the table\r\n  const wrap = document.createElement(\"div\");\r\n  wrap.className = \"schedule-table-wrap\";\r\n\r\n  const table = document.createElement(\"table\");\r\n  table.className = \"schedule-table\";\r\n\r\n  const thead = document.createElement(\"thead\");\r\n  const headRow = document.createElement(\"tr\");\r\n\r\n  headRow.innerHTML = `\r\n    <th class=\"schedule-time\"></th>\r\n    ${DAYS.map(\r\n      (day) => `<th class=\"schedule-day-head\" data-day=\"${day}\">${day}</th>`\r\n    ).join(\"\")}\r\n  `;\r\n\r\n  thead.appendChild(headRow);\r\n  table.appendChild(thead);\r\n\r\n  const tbody = document.createElement(\"tbody\");\r\n\r\n  for (let r = 0; r < SLOTS.length; r++) {\r\n    const row = document.createElement(\"tr\");\r\n\r\n    // Time label column\r\n    const timeTd = document.createElement(\"td\");\r\n    timeTd.className = \"schedule-time\";\r\n    timeTd.textContent = formatSlotLabel(SLOTS[r]);\r\n    row.appendChild(timeTd);\r\n\r\n    // Day columns (NO MERGING / NO ROWSPAN)\r\n    DAYS.forEach((day) => {\r\n      const td = document.createElement(\"td\");\r\n      td.className = \"schedule-cell\";\r\n      td.dataset.day = day;\r\n      td.dataset.row = String(r);\r\n\r\n      // Optional: inner div if you want future per-cell stuff\r\n      const inner = document.createElement(\"div\");\r\n      inner.className = \"schedule-cell-inner\";\r\n      td.appendChild(inner);\r\n\r\n      row.appendChild(td);\r\n    });\r\n\r\n    tbody.appendChild(row);\r\n  }\r\n\r\n  table.appendChild(tbody);\r\n  wrap.appendChild(table);\r\n\r\n  // Overlay layer that will hold the floating blocks\r\n  const overlay = document.createElement(\"div\");\r\n  overlay.className = \"schedule-overlay\";\r\n  wrap.appendChild(overlay);\r\n\r\n  return wrap;\r\n}\r\n\r\nfunction rectsOverlap(a, b) {\r\n  return !(\r\n    a.right <= b.left ||\r\n    a.left >= b.right ||\r\n    a.bottom <= b.top ||\r\n    a.top >= b.bottom\r\n  );\r\n}\r\n\r\nfunction rectIntersection(a, b) {\r\n  const left = Math.max(a.left, b.left);\r\n  const right = Math.min(a.right, b.right);\r\n  const top = Math.max(a.top, b.top);\r\n  const bottom = Math.min(a.bottom, b.bottom);\r\n  if (right <= left || bottom <= top) return null;\r\n  return {\r\n    left,\r\n    right,\r\n    top,\r\n    bottom,\r\n    width: right - left,\r\n    height: bottom - top,\r\n  };\r\n}\r\n\r\nfunction rectFromBlock(block) {\r\n  const x = parseFloat(block.style.left) || 0;\r\n  const y = parseFloat(block.style.top) || 0;\r\n  const w = parseFloat(block.style.width) || 0;\r\n  const h = parseFloat(block.style.height) || 0;\r\n  return { left: x, top: y, right: x + w, bottom: y + h, width: w, height: h };\r\n}\r\n\r\n// text collision check (within overlay coordinate space)\r\nfunction textBoxOverlapsAny(candidate, existing) {\r\n  for (const r of existing) {\r\n    if (rectsOverlap(candidate, r)) return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction renderOverlayBlocks(wrap, eventsByDay, groupedByDay, ctx) {\r\n  const overlay = wrap.querySelector(\".schedule-overlay\");\r\n  overlay.innerHTML = \"\";\r\n\r\n  const table = wrap.querySelector(\".schedule-table\");\r\n\r\n  const firstBodyRow = table.querySelector(\"tbody tr\");\r\n  const firstDayCell = table.querySelector(\r\n    'tbody tr td.schedule-cell[data-day=\"Mon\"]'\r\n  );\r\n  const timeTh = table.querySelector(\"thead th.schedule-time\");\r\n\r\n  if (!firstBodyRow || !firstDayCell || !timeTh) return;\r\n\r\n  const timeColWidth = timeTh.getBoundingClientRect().width;\r\n  const dayColWidth = firstDayCell.getBoundingClientRect().width;\r\n  const headerHeight = table\r\n    .querySelector(\"thead\")\r\n    .getBoundingClientRect().height;\r\n  const rowHeight = firstBodyRow.getBoundingClientRect().height;\r\n\r\n  // --- derive border from CSS (no magic numbers) ---\r\n  const cellStyles = getComputedStyle(firstDayCell);\r\n  const borderLeft = parseFloat(cellStyles.borderLeftWidth) || 0;\r\n  const borderTop = parseFloat(cellStyles.borderTopWidth) || 0;\r\n  const borderRight = parseFloat(cellStyles.borderRightWidth) || 0;\r\n  const borderBottom = parseFloat(cellStyles.borderBottomWidth) || 0;\r\n\r\n  // If borders are uniform, these will be the same; otherwise we keep X/Y separate.\r\n  const borderX = (borderLeft + borderRight) / 2;\r\n  const borderY = (borderTop + borderBottom) / 2;\r\n\r\n  // --- build blocks first (one per event), store rects for overlap detection ---\r\n  const placedBlocks = []; // { el, day, ev, rect, overlapLayerEl, overlaps: [] }\r\n\r\n  DAYS.forEach((day, dayIndex) => {\r\n    const events = eventsByDay.get(day) || [];\r\n\r\n    events.forEach((ev) => {\r\n      const left = timeColWidth + dayIndex * dayColWidth;\r\n      const top = headerHeight + ev.rowStart * rowHeight;\r\n      const height = ev.rowSpan * rowHeight;\r\n\r\n      const block = document.createElement(\"div\");\r\n      block.className = \"schedule-entry-float\";\r\n\r\n      // inset by borders so the block sits inside the cell gridlines\r\n      block.style.left = `${left + borderLeft}px`;\r\n      block.style.top = `${top + borderTop}px`;\r\n      block.style.width = `${dayColWidth - borderX}px`;\r\n      block.style.height = `${height - borderY}px`;\r\n\r\n      // overlap layer (red rectangles go here)\r\n      const overlapLayer = document.createElement(\"div\");\r\n      overlapLayer.className = \"schedule-entry-overlap-layer\";\r\n      block.appendChild(overlapLayer);\r\n\r\n      // text wrapper (MUST be above overlap layer)\r\n      const text = document.createElement(\"div\");\r\n      text.className = \"schedule-entry-text\";\r\n      const title = ev.code || ev.title;\r\n      const titleLabel = ev.label ? `${title} ${ev.label}` : title;\r\n      text.innerHTML = `\r\n        <div class=\"schedule-entry-title\">${titleLabel}</div>\r\n        <div class=\"schedule-entry-time\">${ev.timeLabel}</div>\r\n      `;\r\n      block.appendChild(text);\r\n\r\n      overlay.appendChild(block);\r\n\r\n      placedBlocks.push({\r\n        el: block,\r\n        day,\r\n        ev,\r\n        rect: rectFromBlock(block),\r\n        overlapLayerEl: overlapLayer,\r\n        overlaps: [],\r\n        textEl: text,\r\n      });\r\n    });\r\n  });\r\n\r\n  const footerConflicts = ctx?.footerConflicts;\r\n  let conflictHoverCount = 0;\r\n  const updateFooterConflictHover = () => {\r\n    if (!footerConflicts) return;\r\n    footerConflicts.classList.toggle(\"is-hover\", conflictHoverCount > 0);\r\n  };\r\n  const attachConflictHover = (blockEl) => {\r\n    if (!footerConflicts || blockEl.dataset.conflictHoverBound === \"true\") {\r\n      return;\r\n    }\r\n\r\n    blockEl.dataset.conflictHoverBound = \"true\";\r\n    blockEl.addEventListener(\"mouseenter\", () => {\r\n      conflictHoverCount += 1;\r\n      updateFooterConflictHover();\r\n    });\r\n    blockEl.addEventListener(\"mouseleave\", () => {\r\n      conflictHoverCount = Math.max(0, conflictHoverCount - 1);\r\n      updateFooterConflictHover();\r\n    });\r\n  };\r\n\r\n  // --- detect overlaps + apply opacity + add red intersection rects ---\r\n  for (let i = 0; i < placedBlocks.length; i++) {\r\n    for (let j = i + 1; j < placedBlocks.length; j++) {\r\n      const A = placedBlocks[i];\r\n      const B = placedBlocks[j];\r\n\r\n      // only compare blocks in same day column (since different columns can't overlap)\r\n      if (A.day !== B.day) continue;\r\n\r\n      if (!rectsOverlap(A.rect, B.rect)) continue;\r\n\r\n      const inter = rectIntersection(A.rect, B.rect);\r\n      if (!inter) continue;\r\n\r\n      // mark both as conflicted\r\n      A.el.style.opacity = \"0.75\";\r\n      B.el.style.opacity = \"0.75\";\r\n\r\n      A.el.classList.add(\"is-overlap\");\r\n      B.el.classList.add(\"is-overlap\");\r\n\r\n      attachConflictHover(A.el);\r\nattachConflictHover(B.el);\r\n\r\n      // intersection rect coordinates relative to each block\r\n      const aLocal = {\r\n        left: inter.left - A.rect.left,\r\n        top: inter.top - A.rect.top,\r\n        width: inter.width,\r\n        height: inter.height,\r\n      };\r\n      const bLocal = {\r\n        left: inter.left - B.rect.left,\r\n        top: inter.top - B.rect.top,\r\n        width: inter.width,\r\n        height: inter.height,\r\n      };\r\n\r\n      const aRed = document.createElement(\"div\");\r\n      aRed.className = \"schedule-entry-overlap-rect\";\r\n      aRed.style.left = `${aLocal.left}px`;\r\n      aRed.style.top = `${aLocal.top}px`;\r\n      aRed.style.width = `${aLocal.width}px`;\r\n      aRed.style.height = `${aLocal.height}px`;\r\n      A.overlapLayerEl.appendChild(aRed);\r\n\r\n      const bRed = document.createElement(\"div\");\r\n      bRed.className = \"schedule-entry-overlap-rect\";\r\n      bRed.style.left = `${bLocal.left}px`;\r\n      bRed.style.top = `${bLocal.top}px`;\r\n      bRed.style.width = `${bLocal.width}px`;\r\n      bRed.style.height = `${bLocal.height}px`;\r\n      B.overlapLayerEl.appendChild(bRed);\r\n    }\r\n  }\r\n\r\n  // --- text placement: push down if text area overlaps already-placed text ---\r\n  // We do this per-day so text collisions only matter inside a column.\r\n  const TEXT_STEP_PX = 25; // \"preset amount\" height of box\r\n  const MAX_TRIES = 30; // prevents infinite loops\r\n  const H_PAD = 6; // match your block padding roughly\r\n  const V_PAD = 0;\r\n\r\n  DAYS.forEach((day) => {\r\n    const blocks = placedBlocks\r\n      .filter((b) => b.day === day)\r\n      .sort((a, b) => a.rect.top - b.rect.top);\r\n\r\n    const usedTextRects = []; // in overlay coords\r\n\r\n    blocks.forEach((b) => {\r\n      // base text box estimate (good enough without measuring)\r\n      const baseX = b.rect.left + H_PAD;\r\n      let y = b.rect.top + V_PAD;\r\n\r\n      // We will position the text wrapper inside the block by translateY\r\n      // but collision checking is in absolute overlay coords.\r\n      let tries = 0;\r\n\r\n      // Estimate width/height of text area; if you want exact, swap to getBoundingClientRect after layout.\r\n      const estW = b.rect.width - H_PAD * 2;\r\n      const estH = 26; // title + time on 10px font\r\n\r\n      while (tries < MAX_TRIES) {\r\n        const candidate = {\r\n          left: baseX,\r\n          top: y,\r\n          right: baseX + estW,\r\n          bottom: y + estH,\r\n        };\r\n\r\n        // must also stay inside the block vertically\r\n        if (candidate.bottom > b.rect.bottom - V_PAD) break;\r\n\r\n        if (!textBoxOverlapsAny(candidate, usedTextRects)) {\r\n          // place it: move text wrapper down inside the block\r\n          const localY = y - b.rect.top;\r\n          b.textEl.style.transform = `translateY(${localY}px)`;\r\n          usedTextRects.push(candidate);\r\n          return;\r\n        }\r\n\r\n        y += TEXT_STEP_PX;\r\n        tries++;\r\n      }\r\n\r\n      // fallback: just keep at top if no free spot found\r\n      b.textEl.style.transform = `translateY(${V_PAD}px)`;\r\n      usedTextRects.push({\r\n        left: baseX,\r\n        top: b.rect.top + V_PAD,\r\n        right: baseX + estW,\r\n        bottom: b.rect.top + V_PAD + estH,\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\nexport function renderSchedule(ctx, courses, semester) {\r\n  if (!ctx.scheduleGrid) return;\r\n\r\n  ctx.scheduleGrid.innerHTML = \"\";\r\n\r\n  const eventsByDay = buildDayEvents(courses, semester);\r\n  const groupedByDay = addConflicts(eventsByDay);\r\n  const conflicts = getConflictSummaries(groupedByDay);\r\n\r\n  const wrap = buildScheduleTable();\r\n  ctx.scheduleGrid.appendChild(wrap);\r\n\r\n  // overlay needs DOM measurements, so do it after append\r\n  renderOverlayBlocks(wrap, eventsByDay, groupedByDay);\r\n  updateConflictFooter(ctx, conflicts);\r\n}\r\n","import { STATE } from \"../core/state\";\r\n\r\nconst DAY_CODES = {\r\n  Mon: \"MO\",\r\n  Tue: \"TU\",\r\n  Wed: \"WE\",\r\n  Thu: \"TH\",\r\n  Fri: \"FR\",\r\n  Sat: \"SA\",\r\n  Sun: \"SU\",\r\n};\r\n\r\nconst DATE_RANGE_REGEX = /(\\d{4}-\\d{2}-\\d{2})\\s*-\\s*(\\d{4}-\\d{2}-\\d{2})/;\r\nconst TIME_RANGE_REGEX = /(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?\\s*-\\s*(\\d{1,2}):(\\d{2})\\s*([ap])\\.?m\\.?/i;\r\nconst DAY_REGEX = /\\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\\b/g;\r\n\r\nconst pad = (value) => String(value).padStart(2, \"0\");\r\n\r\nconst formatDate = (date) => {\r\n  const year = date.getFullYear();\r\n  const month = pad(date.getMonth() + 1);\r\n  const day = pad(date.getDate());\r\n  return `${year}${month}${day}`;\r\n};\r\n\r\nconst formatDateTime = (date) => {\r\n  const datePart = formatDate(date);\r\n  const hours = pad(date.getHours());\r\n  const minutes = pad(date.getMinutes());\r\n  return `${datePart}T${hours}${minutes}00`;\r\n};\r\n\r\nconst parseTime = (hoursToken, minutesToken, periodToken) => {\r\n  let hours = Number.parseInt(hoursToken, 10);\r\n  const minutes = Number.parseInt(minutesToken, 10);\r\n  const period = periodToken.toLowerCase();\r\n\r\n  if (period === \"p\" && hours !== 12) hours += 12;\r\n  if (period === \"a\" && hours === 12) hours = 0;\r\n\r\n  return { hours, minutes };\r\n};\r\n\r\nconst parseMeetingLine = (line) => {\r\n  const dateMatch = String(line || \"\").match(DATE_RANGE_REGEX);\r\n  const timeMatch = String(line || \"\").match(TIME_RANGE_REGEX);\r\n  const days = String(line || \"\").match(DAY_REGEX) || [];\r\n\r\n  if (!dateMatch || !timeMatch || !days.length) return null;\r\n\r\n  const startDate = dateMatch[1];\r\n  const endDate = dateMatch[2];\r\n\r\n  const startTime = parseTime(timeMatch[1], timeMatch[2], timeMatch[3]);\r\n  const endTime = parseTime(timeMatch[4], timeMatch[5], timeMatch[6]);\r\n\r\n  const uniqueDays = [...new Set(days.map((day) => DAY_CODES[day]).filter(Boolean))];\r\n\r\n  return {\r\n    startDate,\r\n    endDate,\r\n    days: uniqueDays,\r\n    startTime,\r\n    endTime,\r\n  };\r\n};\r\n\r\nconst extractLocation = (line) => {\r\n  const parts = String(line || \"\")\r\n    .split(\"|\")\r\n    .map((part) => part.trim())\r\n    .filter(Boolean);\r\n\r\n  const locationPart = parts.find((part) => /\\([A-Z]{2,}\\)/.test(part));\r\n  if (locationPart) return locationPart;\r\n\r\n  const onlinePart = parts.find((part) => /online/i.test(part));\r\n  if (onlinePart) return onlinePart;\r\n\r\n  return \"\";\r\n};\r\n\r\nconst findFirstOccurrence = (startDate, dayCodes) => {\r\n  const start = new Date(`${startDate}T00:00:00`);\r\n  for (let offset = 0; offset < 7; offset += 1) {\r\n    const date = new Date(start);\r\n    date.setDate(start.getDate() + offset);\r\n    const code = Object.values(DAY_CODES)[date.getDay() === 0 ? 6 : date.getDay() - 1];\r\n    if (dayCodes.includes(code)) return date;\r\n  }\r\n  return start;\r\n};\r\n\r\nconst buildEvent = (course, line) => {\r\n  const parsed = parseMeetingLine(line);\r\n  if (!parsed) return null;\r\n\r\n  const firstDate = findFirstOccurrence(parsed.startDate, parsed.days);\r\n  const startDate = new Date(firstDate);\r\n  startDate.setHours(parsed.startTime.hours, parsed.startTime.minutes, 0, 0);\r\n\r\n  const endDate = new Date(firstDate);\r\n  endDate.setHours(parsed.endTime.hours, parsed.endTime.minutes, 0, 0);\r\n\r\n  const summaryParts = [course.code, course.title].filter(Boolean);\r\n  const descriptionLines = [\r\n    course.title ? `Title: ${course.title}` : null,\r\n    course.code ? `Code: ${course.code}` : null,\r\n    course.section_number ? `Section: ${course.section_number}` : null,\r\n    course.instructor ? `Instructor: ${course.instructor}` : null,\r\n    course.instructionalFormat ? `Format: ${course.instructionalFormat}` : null,\r\n    course.meeting ? `Meeting: ${course.meeting}` : null,\r\n  ].filter(Boolean);\r\n\r\n  const untilDate = `${parsed.endDate.replace(/-/g, \"\")}T235959`;\r\n\r\n  return {\r\n    uid: `${course.code || \"course\"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,\r\n    summary: summaryParts.join(\" - \") || \"Scheduled Course\",\r\n    description: descriptionLines.join(\"\\\\n\"),\r\n    location: extractLocation(line),\r\n    dtstart: formatDateTime(startDate),\r\n    dtend: formatDateTime(endDate),\r\n    rrule: `FREQ=WEEKLY;BYDAY=${parsed.days.join(\",\")};UNTIL=${untilDate}`,\r\n  };\r\n};\r\n\r\nconst buildICS = (courses) => {\r\n  const events = [];\r\n\r\n  courses.forEach((course) => {\r\n    const lines = course.meetingLines?.length ? course.meetingLines : [];\r\n    lines.forEach((line) => {\r\n      const event = buildEvent(course, line);\r\n      if (event) events.push(event);\r\n    });\r\n  });\r\n\r\n  const lines = [\r\n    \"BEGIN:VCALENDAR\",\r\n    \"VERSION:2.0\",\r\n    \"PRODID:-//Workday Extension//Schedule Export//EN\",\r\n    \"CALSCALE:GREGORIAN\",\r\n  ];\r\n\r\n  events.forEach((event) => {\r\n    lines.push(\"BEGIN:VEVENT\");\r\n    lines.push(`UID:${event.uid}`);\r\n    lines.push(`SUMMARY:${event.summary}`);\r\n    if (event.description) lines.push(`DESCRIPTION:${event.description}`);\r\n    if (event.location) lines.push(`LOCATION:${event.location}`);\r\n    lines.push(`DTSTART:${event.dtstart}`);\r\n    lines.push(`DTEND:${event.dtend}`);\r\n    lines.push(`RRULE:${event.rrule}`);\r\n    lines.push(\"END:VEVENT\");\r\n  });\r\n\r\n  lines.push(\"END:VCALENDAR\");\r\n  return lines.join(\"\\r\\n\");\r\n};\r\n\r\nexport function exportICS() {\r\n  const ics = buildICS(STATE.filtered || []);\r\n  const blob = new Blob([ics], { type: \"text/calendar;charset=utf-8\" });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const a = document.createElement(\"a\");\r\n  a.href = url;\r\n  a.download = \"workday-schedule.ics\";\r\n  document.body.appendChild(a);\r\n  a.click();\r\n\r\n  setTimeout(() => {\r\n    URL.revokeObjectURL(url);\r\n    a.remove();\r\n  }, 100);\r\n}","const buildExportContainer = ({ schedulePanel, listPanel, styleText }) => {\r\n  const container = document.createElement(\"div\");\r\n  container.className = \"export-image\";\r\n  container.style.display = \"flex\";\r\n  container.style.flexDirection = \"column\";\r\n  container.style.gap = \"18px\";\r\n  container.style.padding = \"18px\";\r\n  container.style.background = \"#ffffff\";\r\n  container.style.color = \"#111827\";\r\n\r\n  const title = document.createElement(\"h2\");\r\n  title.textContent = \"Schedule View\";\r\n  title.style.margin = \"0\";\r\n  title.style.fontSize = \"18px\";\r\n  title.style.fontWeight = \"700\";\r\n\r\n  const scheduleClone = schedulePanel.cloneNode(true);\r\n  scheduleClone.classList.add(\"is-active\");\r\n  scheduleClone.style.display = \"flex\";\r\n  scheduleClone.style.flexDirection = \"column\";\r\n  scheduleClone.style.height = \"auto\";\r\n  scheduleClone.style.minHeight = \"auto\";\r\n\r\n  const scheduleGrid = scheduleClone.querySelector(\".schedule-grid\");\r\n  if (scheduleGrid) {\r\n    scheduleGrid.style.overflow = \"visible\";\r\n    scheduleGrid.style.maxHeight = \"none\";\r\n  }\r\n\r\n  const courseTitle = document.createElement(\"h2\");\r\n  courseTitle.textContent = \"Course List\";\r\n  courseTitle.style.margin = \"8px 0 0\";\r\n  courseTitle.style.fontSize = \"18px\";\r\n  courseTitle.style.fontWeight = \"700\";\r\n\r\n  const listClone = listPanel.cloneNode(true);\r\n  listClone.classList.add(\"is-active\");\r\n  listClone.style.display = \"block\";\r\n\r\n  const styleTag = document.createElement(\"style\");\r\n  styleTag.textContent = styleText;\r\n\r\n  const wrapper = document.createElement(\"div\");\r\n  wrapper.setAttribute(\"xmlns\", \"http://www.w3.org/1999/xhtml\");\r\n  wrapper.appendChild(styleTag);\r\n  wrapper.appendChild(container);\r\n  container.appendChild(title);\r\n  container.appendChild(scheduleClone);\r\n  container.appendChild(courseTitle);\r\n  container.appendChild(listClone);\r\n\r\n  return { wrapper, container };\r\n};\r\n\r\nconst createPNGFromNode = async ({ wrapper, container }) => {\r\n  const tempHost = document.createElement(\"div\");\r\n  tempHost.style.position = \"fixed\";\r\n  tempHost.style.top = \"-99999px\";\r\n  tempHost.style.left = \"-99999px\";\r\n  tempHost.style.pointerEvents = \"none\";\r\n  tempHost.style.opacity = \"0\";\r\n  tempHost.appendChild(wrapper);\r\n  document.body.appendChild(tempHost);\r\n\r\n  const width = Math.ceil(container.scrollWidth);\r\n  const height = Math.ceil(container.scrollHeight);\r\n\r\n  const serialized = new XMLSerializer().serializeToString(wrapper);\r\n  const svg = `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\">\r\n      <foreignObject width=\"100%\" height=\"100%\">\r\n        ${serialized}\r\n      </foreignObject>\r\n    </svg>\r\n  `;\r\n\r\n  const svgBlob = new Blob([svg], { type: \"image/svg+xml;charset=utf-8\" });\r\n  const url = URL.createObjectURL(svgBlob);\r\n  const image = new Image();\r\n\r\n  const pngUrl = await new Promise((resolve, reject) => {\r\n    image.onload = () => {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = width;\r\n      canvas.height = height;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      if (!ctx) {\r\n        reject(new Error(\"Unable to create canvas context.\"));\r\n        return;\r\n      }\r\n      ctx.fillStyle = \"#ffffff\";\r\n      ctx.fillRect(0, 0, width, height);\r\n      ctx.drawImage(image, 0, 0);\r\n      resolve(canvas.toDataURL(\"image/png\"));\r\n    };\r\n    image.onerror = () => reject(new Error(\"Unable to render export image.\"));\r\n    image.src = url;\r\n  });\r\n\r\n  URL.revokeObjectURL(url);\r\n  tempHost.remove();\r\n\r\n  return pngUrl;\r\n};\r\n\r\nexport async function exportSchedulePNG(ctx) {\r\n  const schedulePanel = ctx.root.querySelector('[data-panel=\"schedule\"]');\r\n  const listPanel = ctx.root.querySelector('[data-panel=\"list\"]');\r\n  const styleText = Array.from(ctx.root.querySelectorAll(\"style\"))\r\n    .map((style) => style.textContent)\r\n    .join(\"\\n\");\r\n\r\n  if (!schedulePanel || !listPanel) return;\r\n\r\n  const { wrapper, container } = buildExportContainer({\r\n    schedulePanel,\r\n    listPanel,\r\n    styleText,\r\n  });\r\n\r\n  const pngUrl = await createPNGFromNode({ wrapper, container });\r\n\r\n  const link = document.createElement(\"a\");\r\n  link.href = pngUrl;\r\n  link.download = \"workday-schedule.png\";\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  link.remove();\r\n}","const STORAGE_KEY = \"wdSavedSchedules\";\r\nconst MAX_SCHEDULES = 6;\r\n\r\nconst cloneCourses = (courses) => {\r\n  if (typeof structuredClone === \"function\") {\r\n    return structuredClone(courses);\r\n  }\r\n  return JSON.parse(JSON.stringify(courses || []));\r\n};\r\n\r\nconst sanitizeSchedules = (schedules) => {\r\n  if (!Array.isArray(schedules)) return [];\r\n  return schedules\r\n    .filter((schedule) => schedule && Array.isArray(schedule.courses))\r\n    .map((schedule) => ({\r\n      id: schedule.id,\r\n      name: schedule.name || \"Untitled\",\r\n      savedAt: schedule.savedAt || new Date().toISOString(),\r\n      courses: schedule.courses,\r\n    }));\r\n};\r\n\r\nconst useChromeStorage =\r\n  typeof chrome !== \"undefined\" && chrome.storage && chrome.storage.local;\r\n\r\nexport async function loadSavedSchedules() {\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.get([STORAGE_KEY], (result) => {\r\n        resolve(sanitizeSchedules(result?.[STORAGE_KEY] || []));\r\n      });\r\n    });\r\n  }\r\n\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (!raw) return [];\r\n    return sanitizeSchedules(JSON.parse(raw));\r\n  } catch (error) {\r\n    console.warn(\"[WD] Failed to load saved schedules\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function persistSavedSchedules(schedules) {\r\n  const sanitized = sanitizeSchedules(schedules);\r\n  if (useChromeStorage) {\r\n    return new Promise((resolve) => {\r\n      chrome.storage.local.set({ [STORAGE_KEY]: sanitized }, resolve);\r\n    });\r\n  }\r\n\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(sanitized));\r\n  } catch (error) {\r\n    console.warn(\"[WD] Failed to save schedules\", error);\r\n  }\r\n}\r\n\r\nexport function createScheduleSnapshot(name, courses) {\r\n  const id =\r\n    typeof crypto !== \"undefined\" && crypto.randomUUID\r\n      ? crypto.randomUUID()\r\n      : `${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n\r\n  return {\r\n    id,\r\n    name: name || \"Untitled\",\r\n    savedAt: new Date().toISOString(),\r\n    courses: cloneCourses(courses || []),\r\n  };\r\n}\r\n\r\nexport function formatScheduleMeta(schedule) {\r\n  const count = schedule.courses?.length || 0;\r\n  const savedDate = new Date(schedule.savedAt);\r\n  const dateLabel = Number.isNaN(savedDate.getTime())\r\n    ? schedule.savedAt\r\n    : savedDate.toLocaleDateString(undefined, {\r\n        year: \"numeric\",\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n      });\r\n  return `${count} courses · Saved ${dateLabel}`;\r\n}\r\n\r\nexport function renderSavedSchedules(ctx, schedules) {\r\n  if (!ctx.savedMenu) return;\r\n  ctx.savedMenu.innerHTML = \"\";\r\n\r\n  if (!schedules.length) {\r\n    const empty = document.createElement(\"div\");\r\n    empty.className = \"schedule-saved-empty\";\r\n    empty.textContent = \"No saved schedules yet.\";\r\n    ctx.savedMenu.appendChild(empty);\r\n    return;\r\n  }\r\n\r\n  schedules.forEach((schedule) => {\r\n    const card = document.createElement(\"div\");\r\n    card.className = \"schedule-saved-card\";\r\n    card.dataset.id = schedule.id;\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.className = \"schedule-saved-card-header\";\r\n\r\n    const info = document.createElement(\"div\");\r\n    const title = document.createElement(\"div\");\r\n    title.className = \"schedule-saved-title\";\r\n    title.textContent = schedule.name;\r\n\r\n    const meta = document.createElement(\"div\");\r\n    meta.className = \"schedule-saved-meta\";\r\n    meta.textContent = formatScheduleMeta(schedule);\r\n\r\n    info.appendChild(title);\r\n    info.appendChild(meta);\r\n    header.appendChild(info);\r\n\r\n    const actions = document.createElement(\"div\");\r\n    actions.className = \"schedule-saved-actions\";\r\n\r\n    const loadButton = document.createElement(\"button\");\r\n    loadButton.type = \"button\";\r\n    loadButton.className = \"schedule-saved-action\";\r\n    loadButton.dataset.action = \"load\";\r\n    loadButton.textContent = \"Load\";\r\n\r\n    const deleteButton = document.createElement(\"button\");\r\n    deleteButton.type = \"button\";\r\n    deleteButton.className = \"schedule-saved-action delete\";\r\n    deleteButton.dataset.action = \"delete\";\r\n    deleteButton.textContent = \"Delete\";\r\n\r\n    actions.appendChild(loadButton);\r\n    actions.appendChild(deleteButton);\r\n\r\n    card.appendChild(header);\r\n    card.appendChild(actions);\r\n    ctx.savedMenu.appendChild(card);\r\n  });\r\n}\r\n\r\nexport function canSaveMoreSchedules(schedules) {\r\n  return schedules.length < MAX_SCHEDULES;\r\n}\r\n\r\nexport function getMaxScheduleCount() {\r\n  return MAX_SCHEDULES;\r\n}","import { on, debounce } from \"./utilities/dom.js\";\r\nimport { STATE } from \"./core/state.js\";\r\nimport { ensureMount } from \"./utilities/shadowMount.js\";\r\nimport { loadPanel } from \"./panel/loadPanel.js\";\r\nimport { extractAllCourses } from \"./extraction/courseExtraction.js\";\r\nimport {\r\n  applySearchFilter,\r\n  sortBy,\r\n  wireSorting,\r\n} from \"./panel/panelInteractions.js\";\r\nimport { renderRows } from \"./panel/renderRows.js\";\r\nimport { renderSchedule } from \"./panel/scheduleView.js\";\r\nimport { exportICS } from \"./exporting/ics.js\";\r\nimport { exportSchedulePNG } from \"./exporting/png.js\";\r\nimport {\r\n  canSaveMoreSchedules,\r\n  createScheduleSnapshot,\r\n  getMaxScheduleCount,\r\n  loadSavedSchedules,\r\n  persistSavedSchedules,\r\n  renderSavedSchedules,\r\n} from \"./panel/scheduleStorage.js\";\r\n\r\n(() => {\r\n  console.log(\"[WD] content script loaded\");\r\n  async function boot() {\r\n    const shadow = ensureMount();\r\n    const ctx = await loadPanel(shadow);\r\n    ctx.button.classList.toggle(\r\n      \"is-collapsed\",\r\n      ctx.widget.classList.contains(\"is-hidden\")\r\n    );\r\n    const updateSchedule = () => {\r\n      renderSchedule(ctx, STATE.filtered, STATE.view.semester);\r\n    };\r\n\r\n    const setActivePanel = (panel) => {\r\n      STATE.view.panel = panel;\r\n      ctx.panels.forEach((el) => {\r\n        el.classList.toggle(\"is-active\", el.dataset.panel === panel);\r\n      });\r\n      ctx.tabButtons.forEach((btn) => {\r\n        btn.classList.toggle(\"is-active\", btn.dataset.panel === panel);\r\n      });\r\n      ctx.widget.classList.toggle(\"is-schedule-view\", panel === \"schedule\");\r\n      ctx.widget.classList.toggle(\"is-settings-view\", panel === \"settings\");\r\n      ctx.widget.classList.toggle(\"is-help-view\", panel === \"help\");\r\n    };\r\n\r\n    const toggleWidget = () => {\r\n      ctx.widget.classList.toggle(\"is-hidden\");\r\n      ctx.button.classList.toggle(\r\n        \"is-collapsed\",\r\n        ctx.widget.classList.contains(\"is-hidden\")\r\n      );\r\n    };\r\n\r\n    let resolveScheduleModal = null;\r\n    const closeScheduleModal = (value) => {\r\n      if (!ctx.saveModal) return;\r\n      ctx.saveModal.classList.add(\"is-hidden\");\r\n      ctx.saveModal.setAttribute(\"aria-hidden\", \"true\");\r\n\r\n      if (resolveScheduleModal) {\r\n        resolveScheduleModal(value);\r\n        resolveScheduleModal = null;\r\n      }\r\n    };\r\n\r\n    const openScheduleModal = ({\r\n      title,\r\n      message,\r\n      confirmLabel = \"Save\",\r\n      showInput = true,\r\n      showCancel = true,\r\n    }) => {\r\n      if (!ctx.saveModal) return Promise.resolve(null);\r\n      ctx.saveModalTitle.textContent = title;\r\n      ctx.saveModalMessage.textContent = message;\r\n      ctx.saveModalConfirm.textContent = confirmLabel;\r\n      ctx.saveModalField.classList.toggle(\"is-hidden\", !showInput);\r\n      ctx.saveModalCancel.classList.toggle(\"is-hidden\", !showCancel);\r\n      ctx.saveModalInput.value = \"\";\r\n      ctx.saveModalInput.classList.remove(\"is-invalid\");\r\n      ctx.saveModal.classList.remove(\"is-hidden\");\r\n      ctx.saveModal.setAttribute(\"aria-hidden\", \"false\");\r\n      if (showInput) {\r\n        ctx.saveModalInput.focus();\r\n      } else {\r\n        ctx.saveModalConfirm.focus();\r\n      }\r\n      return new Promise((resolve) => {\r\n        resolveScheduleModal = resolve;\r\n      });\r\n    };\r\n\r\n    if (ctx.saveModal) {\r\n      on(ctx.saveModal, \"click\", (event) => {\r\n        if (event.target === ctx.saveModal) {\r\n          closeScheduleModal(null);\r\n          return;\r\n        }\r\n        const action = event.target.closest(\"[data-action]\")?.dataset.action;\r\n        if (!action) return;\r\n        if (action === \"close\" || action === \"cancel\") {\r\n          closeScheduleModal(null);\r\n          return;\r\n        }\r\n        if (action === \"confirm\") {\r\n          if (!ctx.saveModalField.classList.contains(\"is-hidden\")) {\r\n            const value = ctx.saveModalInput.value.trim();\r\n            if (!value) {\r\n              ctx.saveModalInput.classList.add(\"is-invalid\");\r\n              ctx.saveModalInput.focus();\r\n              return;\r\n            }\r\n            closeScheduleModal(value);\r\n            return;\r\n          }\r\n          closeScheduleModal(true);\r\n        }\r\n      });\r\n\r\n      on(ctx.saveModalInput, \"input\", () => {\r\n        ctx.saveModalInput.classList.remove(\"is-invalid\");\r\n      });\r\n\r\n      on(ctx.saveModalInput, \"keydown\", (event) => {\r\n        if (event.key === \"Enter\") {\r\n          ctx.saveModalConfirm.click();\r\n        }\r\n      });\r\n\r\n      on(document, \"keydown\", (event) => {\r\n        if (\r\n          event.key === \"Escape\" &&\r\n          ctx.saveModal &&\r\n          !ctx.saveModal.classList.contains(\"is-hidden\")\r\n        ) {\r\n          closeScheduleModal(null);\r\n        }\r\n      });\r\n    }\r\n\r\n    ctx.tabButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        setActivePanel(btn.dataset.panel);\r\n        if (btn.dataset.panel === \"schedule\") updateSchedule();\r\n      });\r\n    });\r\n\r\n    ctx.semesterButtons.forEach((btn) => {\r\n      on(btn, \"click\", () => {\r\n        STATE.view.semester = btn.dataset.semester;\r\n        ctx.semesterButtons.forEach((semesterBtn) => {\r\n          semesterBtn.classList.toggle(\r\n            \"is-active\",\r\n            semesterBtn.dataset.semester === STATE.view.semester\r\n          );\r\n        });\r\n        updateSchedule();\r\n      });\r\n    });\r\n\r\n    on(ctx.button, \"click\", toggleWidget);\r\n\r\n    on(document, \"click\", (event) => {\r\n      if (!ctx.savedDropdown?.open) return;\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.savedDropdown)) return;\r\n      if (!path.length && ctx.savedDropdown.contains(event.target)) return;\r\n      ctx.savedDropdown.open = false;\r\n    });\r\n\r\n    on(document, \"click\", (event) => {\r\n      if (!ctx.exportDropdown?.open) return;\r\n      const path = event.composedPath ? event.composedPath() : [];\r\n      if (path.includes(ctx.exportDropdown)) return;\r\n      if (!path.length && ctx.exportDropdown.contains(event.target)) return;\r\n      ctx.exportDropdown.open = false;\r\n    });\r\n\r\n    chrome.runtime.onMessage.addListener((message) => {\r\n      if (message?.type === \"TOGGLE_WIDGET\") {\r\n        toggleWidget();\r\n      }\r\n    });\r\n\r\n    on(ctx.refresh, \"click\", async () => {\r\n      STATE.courses = await extractAllCourses();\r\n      applySearchFilter(ctx.search.value);\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n    });\r\n\r\n    const handleExport = async (type) => {\r\n      if (type === \"ics\") {\r\n        exportICS();\r\n      }\r\n      if (type === \"png\") {\r\n        await exportSchedulePNG(ctx);\r\n      }\r\n    };\r\n\r\n    on(ctx.exportMenu, \"click\", async (event) => {\r\n      const action = event.target.closest(\"[data-export]\");\r\n      if (!action) return;\r\n      if (ctx.exportDropdown) ctx.exportDropdown.open = false;\r\n      await handleExport(action.dataset.export);\r\n    });\r\n\r\n    on(ctx.saveScheduleBtn, \"click\", async () => {\r\n      if (!canSaveMoreSchedules(STATE.savedSchedules)) {\r\n        await openScheduleModal({\r\n          title: \"Schedule limit reached\",\r\n          message: `You can only save up to ${getMaxScheduleCount()} schedules. Delete one to save another.`,\r\n          confirmLabel: \"Got it\",\r\n          showInput: false,\r\n          showCancel: false,\r\n        });\r\n        return;\r\n      }\r\n\r\n      const name = await openScheduleModal({\r\n        title: \"Save schedule\",\r\n        message: \"Name this schedule so you can find it later.\",\r\n        confirmLabel: \"Save\",\r\n        showInput: true,\r\n        showCancel: true,\r\n      });\r\n      if (!name) return;\r\n\r\n      const snapshot = createScheduleSnapshot(name, STATE.filtered);\r\n      STATE.savedSchedules = [snapshot, ...STATE.savedSchedules];\r\n      await persistSavedSchedules(STATE.savedSchedules);\r\n      renderSavedSchedules(ctx, STATE.savedSchedules);\r\n      if (ctx.savedDropdown) ctx.savedDropdown.open = true;\r\n    });\r\n\r\n    on(ctx.savedMenu, \"click\", async (event) => {\r\n      const actionButton = event.target.closest(\"[data-action]\");\r\n      if (!actionButton) return;\r\n\r\n      const card = actionButton.closest(\".schedule-saved-card\");\r\n      const scheduleId = card?.dataset.id;\r\n      if (!scheduleId) return;\r\n\r\n      if (actionButton.dataset.action === \"delete\") {\r\n        const selected = STATE.savedSchedules.find(\r\n          (schedule) => schedule.id === scheduleId\r\n        );\r\n        if (!selected) return;\r\n        const confirmed = await openScheduleModal({\r\n          title: \"Permanently Delete Schedule?\",\r\n          message: `This action will permanently delete \"${selected.name}\".`,\r\n          confirmLabel: \"Delete\",\r\n          showInput: false,\r\n          showCancel: true,\r\n        });\r\n        if (!confirmed) return;\r\n        STATE.savedSchedules = STATE.savedSchedules.filter(\r\n          (schedule) => schedule.id !== scheduleId\r\n        );\r\n        await persistSavedSchedules(STATE.savedSchedules);\r\n        renderSavedSchedules(ctx, STATE.savedSchedules);\r\n        return;\r\n      }\r\n\r\n      const selected = STATE.savedSchedules.find(\r\n        (schedule) => schedule.id === scheduleId\r\n      );\r\n      if (!selected) return;\r\n\r\n      STATE.courses = [...selected.courses];\r\n      STATE.filtered = [...selected.courses];\r\n      ctx.search.value = \"\";\r\n      sortBy(STATE.sort.key || \"code\");\r\n      renderRows(ctx, STATE.filtered);\r\n      updateSchedule();\r\n      setActivePanel(\"schedule\");\r\n      if (ctx.savedDropdown) ctx.savedDropdown.open = false;\r\n    });\r\n\r\n    on(ctx.settingsBtn, \"click\", () => {\r\n      ctx.widget.classList.remove(\"is-hidden\");\r\n      ctx.button.classList.remove(\"is-collapsed\");\r\n      setActivePanel(\"settings\");\r\n    });\r\n\r\n    on(ctx.helpBtn, \"click\", () => {\r\n      ctx.widget.classList.remove(\"is-hidden\");\r\n      ctx.button.classList.remove(\"is-collapsed\");\r\n      setActivePanel(\"help\");\r\n    });\r\n\r\n    on(\r\n      ctx.search,\r\n      \"input\",\r\n      debounce(() => {\r\n        applySearchFilter(ctx.search.value);\r\n        sortBy(STATE.sort.key || \"code\");\r\n        renderRows(ctx, STATE.filtered);\r\n        updateSchedule();\r\n      }, 100)\r\n    );\r\n\r\n    wireSorting(ctx);\r\n\r\n    STATE.savedSchedules = await loadSavedSchedules();\r\n    renderSavedSchedules(ctx, STATE.savedSchedules);\r\n\r\n    STATE.courses = await extractAllCourses();\r\n    STATE.filtered = [...STATE.courses];\r\n    sortBy(\"code\");\r\n    renderRows(ctx, STATE.filtered);\r\n    updateSchedule();\r\n    setActivePanel(STATE.view.panel);\r\n  }\r\n\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();\r\n"],"names":["$$","root","sel","on","el","ev","fn","opts","debounce","ms","t","a","STATE","EXT_ID","ensureMount","host","loadPanel","shadow","htmlUrl","cssFiles","html","cssParts","r","file","css","style","link","wrap","normalizeText","s","getHeaderKey","m","buildHeaderMaps","gridRoot","headers","pos","text","getHeaderText","key","h","findHeader","needles","ns","hit","n","KEYS","colMap","posMap","headerEl","btn","parseSectionLinkString","input","str","baseCode","parts","p","sectionToken","parsedTitle","guessClassCode","extractMeetingLinesFromCell","meetingEl","lines","DATE_RE","TIME_RE","DAY_RE","extractMeetingLinesFromRow","rowEl","formatMeetingLineForPanel","line","raw","dayPart","timePart","buildingPart","floorMatch","roomMatch","floorPart","roomPart","normalizeMeetingPatternsText","extractStartDate","match","extractInstructorNamesFromCell","instructorEl","prompt","onlineClassCheck","deliveryModeCellEl","txt","label","findingTables","roots","headerText","rows","extractAllCourses","found","courses","headerMaps","row","c","extractFromRow","findUniqueCourses","list","seen","out","k","cells","allText","getCellKey","cell","cellByCol","getCellEl","keyName","readByKey","col","allPromptOptions","sectionLinkEl","sectionLinkString","titleCell","codeCell","sectCell","meetingCell","instructionalFormatCell","startDateCell","code","title","section_number","parsed","labLike","seminarLike","discussionLike","isLab","isSeminar","isDiscussion","instructor","meeting","meetingCol","meetingObj","startDate","firstLine","deliveryModeCell","instructionalFormat","escHTML","cleanLines","renderRows","ctx","frag","tr","badge","main","sub","applySearchFilter","q","sortBy","dir","collator","b","wireSorting","headCells","th","DAYS","START_HOUR","END_HOUR","SLOT_MINUTES","SLOTS","DAY_REGEX","TIME_REGEX","SEMESTER_MONTHS","parseTimeToken","token","hours","minutes","period","parseMeetingLine","days","timeTokens","startMinutes","endMinutes","getSemester","month","clampToGrid","min","max","snapDownToSlot","snapUpToSlot","slotIndexOf","buildDayEvents","semester","eventsByDay","d","eventId","course","startMin","endMin","startIdx","endIdx","rowSpan","day","addConflicts","groupedByDay","events","groups","current","currentKey","active","getConflictSummaries","conflicts","group","codes","updateConflictFooter","conflictList","formatSlotLabel","h24","hh","mm","buildScheduleTable","table","thead","headRow","tbody","timeTd","td","inner","overlay","rectsOverlap","rectIntersection","left","right","top","bottom","rectFromBlock","block","x","y","w","textBoxOverlapsAny","candidate","existing","renderOverlayBlocks","firstBodyRow","firstDayCell","timeTh","timeColWidth","dayColWidth","headerHeight","rowHeight","cellStyles","borderLeft","borderTop","borderRight","borderBottom","borderX","borderY","placedBlocks","dayIndex","height","overlapLayer","titleLabel","attachConflictHover","blockEl","i","j","A","B","inter","aLocal","bLocal","aRed","bRed","TEXT_STEP_PX","MAX_TRIES","H_PAD","V_PAD","blocks","usedTextRects","baseX","tries","estW","estH","localY","renderSchedule","DAY_CODES","DATE_RANGE_REGEX","TIME_RANGE_REGEX","pad","value","formatDate","date","year","formatDateTime","datePart","parseTime","hoursToken","minutesToken","periodToken","dateMatch","timeMatch","endDate","startTime","endTime","uniqueDays","extractLocation","part","locationPart","onlinePart","findFirstOccurrence","dayCodes","start","offset","buildEvent","firstDate","summaryParts","descriptionLines","untilDate","buildICS","event","exportICS","ics","blob","url","buildExportContainer","schedulePanel","listPanel","styleText","container","scheduleClone","scheduleGrid","courseTitle","listClone","styleTag","wrapper","createPNGFromNode","tempHost","width","serialized","svg","svgBlob","image","pngUrl","resolve","reject","canvas","exportSchedulePNG","STORAGE_KEY","MAX_SCHEDULES","cloneCourses","sanitizeSchedules","schedules","schedule","useChromeStorage","loadSavedSchedules","result","error","persistSavedSchedules","sanitized","createScheduleSnapshot","name","formatScheduleMeta","count","savedDate","dateLabel","renderSavedSchedules","empty","card","header","info","meta","actions","loadButton","deleteButton","canSaveMoreSchedules","getMaxScheduleCount","boot","updateSchedule","setActivePanel","panel","toggleWidget","resolveScheduleModal","closeScheduleModal","openScheduleModal","message","confirmLabel","showInput","showCancel","action","semesterBtn","path","handleExport","type","snapshot","actionButton","scheduleId","selected"],"mappings":"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"}