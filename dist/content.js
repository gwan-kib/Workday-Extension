const P=(t,n)=>Array.from(t.querySelectorAll(n)),F=(t,n,e,o)=>t&&t.addEventListener(n,e,o),St=(t,n=300)=>{let e;return(...o)=>{clearTimeout(e),e=setTimeout(()=>t(...o),n)}},d={courses:[],filtered:[],savedSchedules:[],sort:{key:null,dir:1},view:{panel:"list",semester:"first"}},et="wd-courses-capture";function vt(){let t=document.getElementById(et);return t||(t=document.createElement("div"),t.id=et,t.style.all="initial",t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.zIndex="2147483647",t.attachShadow({mode:"open"}),document.documentElement.appendChild(t)),t.shadowRoot}async function Ct(t){const n=chrome.runtime.getURL("src/panel.html"),e=["formatting/general.css","formatting/widget-shell.css","formatting/widget-buttons.css","formatting/floating-button.css","formatting/course-list.css","formatting/schedule-view.css","formatting/schedule-view-events.css","formatting/settings.css","colors/course-list-colors.css","colors/general-colors.css","colors/schedule-view-colors.css","colors/widget-functionality-colors.css","colors/settings-colors.css"],[o,...r]=await Promise.all([fetch(n).then(a=>a.text()),...e.map(a=>fetch(chrome.runtime.getURL(`src/css/${a}`)).then(l=>l.text()))]),c=r.join(`
`);t.innerHTML="";const s=document.createElement("style");if(s.textContent=c,t.appendChild(s),!document.querySelector('link[href*="Material+Symbols"]')){const a=document.createElement("link");a.rel="stylesheet",a.href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200",document.head.appendChild(a)}const i=document.createElement("div");return i.innerHTML=o,t.appendChild(i),{button:t.querySelector("#floating-button"),widget:t.querySelector(".widget"),search:t.querySelector("#widget-search"),saveScheduleBtn:t.querySelector("#widget-save-schedule"),refresh:t.querySelector("#widget-refresh"),exportBtn:t.querySelector("#widget-export"),settingsBtn:t.querySelector(".settings"),tableBody:t.querySelector("tbody"),tableHead:t.querySelector("thead"),tabButtons:t.querySelectorAll(".tab-button"),panels:t.querySelectorAll(".widget-panel"),scheduleGrid:t.querySelector("#schedule-grid"),semesterButtons:t.querySelectorAll(".semester-button"),savedDropdown:t.querySelector("#schedule-saved-dropdown"),savedMenu:t.querySelector("#schedule-saved-menu"),footerConflicts:t.querySelector("#widget-conflicts")}}const K=t=>String(t||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function wt(t){const e=(t?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return e?e[1]:null}function Et(t){const e=Array.from(t.querySelectorAll('th[data-automation-id^="columnHeader"]')).map((i,a)=>{const l=ut(i),u=wt(i);return{el:i,pos:a,key:u,text:l,norm:K(l)}}).filter(i=>i.text);function o(i){const a=i.map(K);let l=e.find(u=>a.includes(u.norm));return l||(l=e.find(u=>a.some(m=>u.norm.includes(m))),l||null)}const r={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},c={},s={};for(const[i,a]of Object.entries(r)){const l=o(a);c[i]=l?l.key:null,s[i]=l?l.pos:-1}return{colMap:c,posMap:s}}function ut(t){if(!t)return"";const n=t.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(t.textContent||"").trim()}function Lt(t){let n=String(t||"").replace(/\u00A0/g," ").trim();if(!n)return null;n=n.replace(/\s*\n\s*/g," ").trim();const e=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!e)return null;const o=e[1].trim(),c=e[2].trim().split(/\s*[-–—]\s*/).map(a=>a.trim()).filter(Boolean);let s="",i="";return s=c[0],i=c.slice(1).join(" - ").trim(),i=i.replace(/\s*:\s*/g,`:
`),{code:o,section_number:s,title:i,full:n}}function X(t){const n=String(t||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/);return n?n[0].replace(/\s+/g," ").trim():""}function xt(t){if(!t)return[];let e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean);e.length||(e=Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).map(i=>(i.getAttribute("data-automation-label")||i.getAttribute("title")||i.textContent||"").trim()).filter(Boolean)),e.length||(e=String(t.innerText||"").split(`
`).map(s=>s.trim()).filter(Boolean));const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(s=>o.test(s)&&r.test(s)&&c.test(s))}function At(t){if(!t)return[];const e=Array.from(t.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean),o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,c=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i;return e.filter(s=>o.test(s)&&r.test(s)&&c.test(s))}function Tt(t){const n=String(t||""),e=n.split("|").map(m=>m.trim()).filter(Boolean),r=(e.find(m=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(m))||"").split(/\s+/).join(" / "),c=e.find(m=>/\d{1,2}:\d{2}/.test(m)&&/-/.test(m))||"",s=e.find(m=>/\([A-Z]{2,}\)/.test(m))||"",i=n.match(/\bfloor\b\s*[:\-]?\s*(-?[A-Za-z0-9]+)/i),a=n.match(/\b(room|rm)\b\s*[:\-]?\s*([A-Za-z0-9]+)/i),l=i?`Floor: ${i[1]}`:"",u=a?`Room: ${a[2]}`:"";return{days:r,time:c,location:[s,[l,u].filter(Boolean).join(" | ")].filter(Boolean).join(`
`)}}function Mt(t){return String(t||"").split(/\r?\n/).map(n=>n.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`)}function J(t){const n=String(t||"").match(/\b(\d{4}-\d{2}-\d{2})\b/);return n?n[1]:""}function Dt(t){if(!t)return"";const n=t.querySelector('[data-automation-id="promptOption"]');return(n&&(n.getAttribute("data-automation-label")||n.getAttribute("title")||n.textContent)||t.textContent||"").trim()}function Bt(t){if(!t)return!1;const n=(t.innerText||t.textContent||"").trim();return/online learning/i.test(n)?!0:Array.from(t.querySelectorAll('[data-automation-id="promptOption"]')).some(o=>{const r=(o.getAttribute("data-automation-label")||o.getAttribute("title")||o.textContent||"").trim();return/online learning/i.test(r)})}function $t(){const t=P(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');for(const n of t){const o=P(n,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header").map(s=>K(ut(s)));if(!(o.some(s=>s.includes("section"))&&(o.some(s=>s.includes("instructor"))||o.some(s=>s.includes("meeting"))||o.some(s=>s.includes("instructional format"))||o.some(s=>s.includes("format"))||o.some(s=>s.includes("status")))))continue;const c=P(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(c.length)return{root:n,rows:c}}return null}async function nt(){const t=$t();let n=[];if(t){const e=Et(t.root);for(const o of t.rows){const r=kt(o,e);(r.code||r.title)&&Object.values(r).join("").trim()&&n.push(r)}}return Rt(n)}function Rt(t){const n=r=>[r.code,r.title,r.section_number].join("|").toLowerCase(),e=new Set,o=[];for(const r of t){const c=n(r);e.has(c)||(e.add(c),o.push(r))}return o}function kt(t,n){const{colMap:e,posMap:o}=n,r=P(t,"td, [role='gridcell']"),c=(t.innerText||"").trim();function s(p){const tt=(p.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return tt?tt[1]:null}const i=new Map;r.forEach(p=>{const v=s(p);v&&!i.has(v)&&i.set(v,p)});const a=p=>{const v=e[p];if(v!=null&&i.has(v))return i.get(v);const k=o[p];return k!=null&&k>=0&&k<r.length?r[k]:null},l=p=>{const v=e[p];if(v!=null&&i.has(v))return(i.get(v).innerText||"").trim();const k=o[p];return k!=null&&k>=0&&k<r.length?(r[k].innerText||"").trim():""},u=P(t,'[data-automation-id="promptOption"]');let m=null;for(const p of u){const v=p.getAttribute("data-automation-label")||p.getAttribute("title")||p.getAttribute("aria-label")||p.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(v)){m=p;break}}!m&&u.length>0&&(m=u[0]);const C=m&&(m.getAttribute("data-automation-label")||m.getAttribute("title")||m.getAttribute("aria-label")||m.textContent)||"",I=l("title"),A=l("code"),$=l("section"),N=l("meeting"),R=l("instructionalFormat"),j=l("startDate");let T="",O=I||"",Y="";const q=Lt(C);q&&(T=q.code,Y=q.section_number,O=q.title),T||(T=X(A)||X(I)||X(c)||"");const M=p=>/\b(lab|laboratory|labratory)\b/i.test(String(p||"")),S=p=>/\bseminar\b/i.test(String(p||"")),w=p=>/\bdiscussion\b/i.test(String(p||"")),b=M(R)||M($)||M(O)||M(C)||M(c),f=S(R)||S($)||S(O)||S(C)||S(c),g=w(R)||w($)||w(O)||w(C)||w(c),E=a("instructor");let L="";b||f?L="N/A":L=Dt(E)||(l("instructor")||"").trim();let h;const y=e.meeting;let x=null;y!=null&&i.has(y)?x=i.get(y):o.meeting!=null&&o.meeting>=0&&o.meeting<r.length&&(x=r[o.meeting]);let D=x?xt(x):[];D.length||(D=At(t));let B={days:"",time:"",location:""},gt=J(D[0])||J(j);if(D.length){const p=D[0];B=Tt(p)}else h=(N||"").trim();const yt=a("deliveryMode");Bt(yt)&&(B.location="Online"),B.days||B.time||B.location?(h=[B.days,B.time].filter(Boolean).join(" | "),B.location?h+=`
${B.location}`:h+=`
Online`):h=(N||"").trim();const bt=(R||"").trim();return{code:T,title:O,section_number:Y,instructor:L,meeting:Mt(h),instructionalFormat:bt,startDate:gt,meetingLines:D,isLab:b,isSeminar:f,isDiscussion:g}}const ot=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function Ft(t){return String(t||"").replace(/[\u00A0\u200B-\u200D\uFEFF]/g," ").replace(/[ \t]+\n/g,`
`).replace(/\n[ \t]+/g,`
`).replace(/\n{2,}/g,`
`).trim()}function U(t,n){t.tableBody.innerHTML="";const e=document.createDocumentFragment();n.forEach(o=>{const r=document.createElement("tr"),c=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":o.isDiscussion?"[Discussion]":"";r.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${c?`<div class="muted">${c}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const s=Ft(o.meeting).split(`
`),i=(s[0]||"").trim(),a=s.slice(1).map(l=>l.replace(/[\u00A0\u200B-\u200D\uFEFF]/g,"").trim()).filter(Boolean).join(`
`);return`
            ${i?`<span class="meeting-pill">${ot(i).trim()}</span>`:""}
            ${a?`<div class="meeting-sub">${ot(a).trim()}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,e.appendChild(r)}),t.tableBody.appendChild(e)}function st(t){if(t=(t||"").trim().toLowerCase(),!t){d.filtered=[...d.courses];return}d.filtered=d.courses.filter(n=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(e=>(n[e]||"").toLowerCase().includes(t)))}function W(t){if(!t)return;const n=d.sort.key===t?-d.sort.dir:1;d.sort={key:t,dir:n};const e=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});d.filtered.sort((o,r)=>n*e.compare(o[t]||"",r[t]||""))}function It(t){const n=P(t.tableHead,"th[data-key]");n.forEach(e=>{F(e,"click",()=>{const o=e.getAttribute("data-key");W(o),U(t,d.filtered),n.forEach(r=>r.classList.remove("sorted-asc","sorted-desc")),e.classList.add(d.sort.dir===1?"sorted-asc":"sorted-desc")})})}const _=["Mon","Tue","Wed","Thu","Fri"],mt=8,Q=21,Z=30,H=[];for(let t=mt;t<Q;t++)H.push(t*60),H.push(t*60+30);H.push(Q*60);const Nt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,Ot=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,rt={first:["09","08"],second:["01","12"]};function it(t){if(!t)return null;const n=t.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let e=Number.parseInt(n[1],10);const o=Number.parseInt(n[2],10),r=n[3].toLowerCase();return r==="p"&&e!==12&&(e+=12),r==="a"&&e===12&&(e=0),e*60+o}function qt(t){const n=String(t||"").match(Nt)||[],e=String(t||"").match(Ot)||[];if(n.length===0||e.length<2)return null;const o=it(e[0]),r=it(e[1]);return o==null||r==null||r<=o?null:{days:[...new Set(n)],startMinutes:o,endMinutes:r,timeLabel:`${e[0]} - ${e[1]}`}}function _t(t){if(!t)return null;const n=t.split("-")[1];return rt.first.includes(n)?"first":rt.second.includes(n)?"second":null}function ct(t){const n=mt*60,e=Q*60;return Math.max(n,Math.min(e,t))}function Ht(t){return Math.floor(t/Z)*Z}function jt(t){return Math.ceil(t/Z)*Z}function at(t){return H.indexOf(t)}function Pt(t,n){const e=new Map;_.forEach(c=>e.set(c,[]));const o=new Set;let r=0;return t.forEach(c=>{const s=c.startDate||J(c.meetingLines?.[0])||"",i=_t(s);if(i!==i)return;const a=c.meetingLines?.length?c.meetingLines:[],l=c.isLab?"[Laboratory]":c.isSeminar?"[Seminar]":c.isDiscussion?"[Discussion]":"";a.forEach(u=>{const m=qt(u);if(!m)return;let C=ct(m.startMinutes),I=ct(m.endMinutes);C=Ht(C),I=jt(I);const A=at(C),$=at(I);if(A===-1||$===-1||$<=A)return;const N=$-A;m.days.forEach(R=>{if(!e.has(R))return;const j=[R,c.code||"",c.title||"",m.timeLabel,A,N].join("|");o.has(j)||(o.add(j),e.get(R).push({id:r++,code:c.code||"",title:c.title||"",label:l,timeLabel:m.timeLabel,rowStart:A,rowSpan:N,startIdx:A,endIdx:$}))})})}),_.forEach(c=>{e.get(c).sort((s,i)=>s.startIdx-i.startIdx||s.endIdx-i.endIdx)}),e}function Ut(t){const n=new Map;return _.forEach(e=>{const o=(t.get(e)||[]).slice().sort((i,a)=>i.startIdx-a.startIdx||i.endIdx-a.endIdx),r=[];let c=null,s=null;for(let i=0;i<H.length-1;i++){const a=o.filter(u=>u.startIdx<=i&&u.endIdx>i),l=a.length?a.map(u=>u.id).sort((u,m)=>u-m).join("|"):null;if(!l){c&&r.push(c),c=null,s=null;continue}if(c&&l===s){c.end=i+1;continue}c&&r.push(c),c={start:i,end:i+1,events:a,hasConflict:a.length>1},s=l}c&&r.push(c),n.set(e,r)}),n}function Wt(t){const n=new Set,e=[];return t.forEach(o=>{o.forEach(r=>{if(!r.hasConflict)return;const c=[...new Set(r.events.map(i=>i.code||i.title).filter(Boolean))];if(c.length<2)return;c.sort((i,a)=>i.localeCompare(a));const s=c.join("|");n.has(s)||(n.add(s),e.push(c))})}),e}function Gt(t,n){if(!t?.footerConflicts)return;if(!n.length){t.footerConflicts.textContent="";return}const e=n.map(o=>`[${o.join(", ")}]`).join(" ");t.footerConflicts.textContent=`⚠️ The following classes are in conflict: ${e}`}function Yt(t){const n=Math.floor(t/60),e=t%60,o=String(n),r=String(e).padStart(2,"0");return`${o}:${r}`}function Zt(){const t=document.createElement("div");t.className="schedule-table-wrap";const n=document.createElement("table");n.className="schedule-table";const e=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time"></th>
    ${_.map(s=>`<th class="schedule-day-head" data-day="${s}">${s}</th>`).join("")}
  `,e.appendChild(o),n.appendChild(e);const r=document.createElement("tbody");for(let s=0;s<H.length;s++){const i=document.createElement("tr"),a=document.createElement("td");a.className="schedule-time",a.textContent=Yt(H[s]),i.appendChild(a),_.forEach(l=>{const u=document.createElement("td");u.className="schedule-cell",u.dataset.day=l,u.dataset.row=String(s);const m=document.createElement("div");m.className="schedule-cell-inner",u.appendChild(m),i.appendChild(u)}),r.appendChild(i)}n.appendChild(r),t.appendChild(n);const c=document.createElement("div");return c.className="schedule-overlay",t.appendChild(c),t}function ft(t,n){return!(t.right<=n.left||t.left>=n.right||t.bottom<=n.top||t.top>=n.bottom)}function Xt(t,n){const e=Math.max(t.left,n.left),o=Math.min(t.right,n.right),r=Math.max(t.top,n.top),c=Math.min(t.bottom,n.bottom);return o<=e||c<=r?null:{left:e,right:o,top:r,bottom:c,width:o-e,height:c-r}}function zt(t){const n=parseFloat(t.style.left)||0,e=parseFloat(t.style.top)||0,o=parseFloat(t.style.width)||0,r=parseFloat(t.style.height)||0;return{left:n,top:e,right:n+o,bottom:e+r,width:o,height:r}}function Kt(t,n){for(const e of n)if(ft(t,e))return!0;return!1}function Jt(t,n,e){const o=t.querySelector(".schedule-overlay");o.innerHTML="";const r=t.querySelector(".schedule-table"),c=r.querySelector("tbody tr"),s=r.querySelector('tbody tr td.schedule-cell[data-day="Mon"]'),i=r.querySelector("thead th.schedule-time");if(!c||!s||!i)return;const a=i.getBoundingClientRect().width,l=s.getBoundingClientRect().width,u=r.querySelector("thead").getBoundingClientRect().height,m=c.getBoundingClientRect().height,C=getComputedStyle(s),I=parseFloat(C.borderLeftWidth)||0,A=parseFloat(C.borderTopWidth)||0,$=parseFloat(C.borderRightWidth)||0,N=parseFloat(C.borderBottomWidth)||0,R=(I+$)/2,j=(A+N)/2,T=[];_.forEach((S,w)=>{(n.get(S)||[]).forEach(f=>{const g=a+w*l,E=u+f.rowStart*m,L=f.rowSpan*m,h=document.createElement("div");h.className="schedule-entry-float",h.style.left=`${g+I}px`,h.style.top=`${E+A}px`,h.style.width=`${l-R}px`,h.style.height=`${L-j}px`;const y=document.createElement("div");y.className="schedule-entry-overlap-layer",h.appendChild(y);const x=document.createElement("div");x.className="schedule-entry-text";const D=f.code||f.title,B=f.label?`${D} ${f.label}`:D;x.innerHTML=`
        <div class="schedule-entry-title">${B}</div>
        <div class="schedule-entry-time">${f.timeLabel}</div>
      `,h.appendChild(x),o.appendChild(h),T.push({el:h,day:S,ev:f,rect:zt(h),overlapLayerEl:y,overlaps:[],textEl:x})})});for(let S=0;S<T.length;S++)for(let w=S+1;w<T.length;w++){const b=T[S],f=T[w];if(b.day!==f.day||!ft(b.rect,f.rect))continue;const g=Xt(b.rect,f.rect);if(!g)continue;b.el.style.opacity="0.75",f.el.style.opacity="0.75",b.el.classList.add("is-overlap"),f.el.classList.add("is-overlap");const E={left:g.left-b.rect.left,top:g.top-b.rect.top,width:g.width,height:g.height},L={left:g.left-f.rect.left,top:g.top-f.rect.top,width:g.width,height:g.height},h=document.createElement("div");h.className="schedule-entry-overlap-rect",h.style.left=`${E.left}px`,h.style.top=`${E.top}px`,h.style.width=`${E.width}px`,h.style.height=`${E.height}px`,b.overlapLayerEl.appendChild(h);const y=document.createElement("div");y.className="schedule-entry-overlap-rect",y.style.left=`${L.left}px`,y.style.top=`${L.top}px`,y.style.width=`${L.width}px`,y.style.height=`${L.height}px`,f.overlapLayerEl.appendChild(y)}const O=25,Y=30,q=6,M=0;_.forEach(S=>{const w=T.filter(f=>f.day===S).sort((f,g)=>f.rect.top-g.rect.top),b=[];w.forEach(f=>{const g=f.rect.left+q;let E=f.rect.top+M,L=0;const h=f.rect.width-q*2,y=26;for(;L<Y;){const x={left:g,top:E,right:g+h,bottom:E+y};if(x.bottom>f.rect.bottom-M)break;if(!Kt(x,b)){const D=E-f.rect.top;f.textEl.style.transform=`translateY(${D}px)`,b.push(x);return}E+=O,L++}f.textEl.style.transform=`translateY(${M}px)`,b.push({left:g,top:f.rect.top+M,right:g+h,bottom:f.rect.top+M+y})})})}function Vt(t,n,e){if(!t.scheduleGrid)return;t.scheduleGrid.innerHTML="";const o=Pt(n),r=Ut(o),c=Wt(r),s=Zt();t.scheduleGrid.appendChild(s),Jt(s,o),Gt(t,c)}const lt=t=>{if(t==null)return"";const n=String(t);return/[",\n]/.test(n)?`"${n.replace(/"/g,'""')}"`:n},Qt=(t,n)=>{const e=n.map(lt).join(","),o=t.map(r=>n.map(c=>lt(r[c]??"")).join(",")).join(`
`);return e+`
`+o};function te(){const t=["code","title","section_number","instructor","meeting","instructionalFormat"],n=Qt(d.filtered,t),e=new Blob([n],{type:"text/csv;charset=utf-8"}),o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download="captured-courses.csv",document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(o),r.remove()},100)}const G="wdSavedSchedules",ht=6,ee=t=>typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t||[])),V=t=>Array.isArray(t)?t.filter(n=>n&&Array.isArray(n.courses)).map(n=>({id:n.id,name:n.name||"Untitled",savedAt:n.savedAt||new Date().toISOString(),courses:n.courses})):[],pt=typeof chrome<"u"&&chrome.storage&&chrome.storage.local;async function ne(){if(pt)return new Promise(t=>{chrome.storage.local.get([G],n=>{t(V(n?.[G]||[]))})});try{const t=localStorage.getItem(G);return t?V(JSON.parse(t)):[]}catch(t){return console.warn("[WD] Failed to load saved schedules",t),[]}}async function dt(t){const n=V(t);if(pt)return new Promise(e=>{chrome.storage.local.set({[G]:n},e)});try{localStorage.setItem(G,JSON.stringify(n))}catch(e){console.warn("[WD] Failed to save schedules",e)}}function oe(t,n){return{id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,name:t||"Untitled",savedAt:new Date().toISOString(),courses:ee(n||[])}}function se(t){const n=t.courses?.length||0,e=new Date(t.savedAt),o=Number.isNaN(e.getTime())?t.savedAt:e.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return`${n} courses · Saved ${o}`}function z(t,n){if(t.savedMenu){if(t.savedMenu.innerHTML="",!n.length){const e=document.createElement("div");e.className="schedule-saved-empty",e.textContent="No saved schedules yet.",t.savedMenu.appendChild(e);return}n.forEach(e=>{const o=document.createElement("div");o.className="schedule-saved-card",o.dataset.id=e.id;const r=document.createElement("div");r.className="schedule-saved-card-header";const c=document.createElement("div"),s=document.createElement("div");s.className="schedule-saved-title",s.textContent=e.name;const i=document.createElement("div");i.className="schedule-saved-meta",i.textContent=se(e),c.appendChild(s),c.appendChild(i),r.appendChild(c);const a=document.createElement("div");a.className="schedule-saved-actions";const l=document.createElement("button");l.type="button",l.className="schedule-saved-action",l.dataset.action="load",l.textContent="Load";const u=document.createElement("button");u.type="button",u.className="schedule-saved-action delete",u.dataset.action="delete",u.textContent="Delete",a.appendChild(l),a.appendChild(u),o.appendChild(r),o.appendChild(a),t.savedMenu.appendChild(o)})}}function re(t){return t.length<ht}function ie(){return ht}(()=>{console.log("[WD] content script loaded");async function t(){const n=vt(),e=await Ct(n);e.button.classList.toggle("is-collapsed",e.widget.classList.contains("is-hidden"));const o=()=>{Vt(e,d.filtered)},r=s=>{d.view.panel=s,e.panels.forEach(i=>{i.classList.toggle("is-active",i.dataset.panel===s)}),e.tabButtons.forEach(i=>{i.classList.toggle("is-active",i.dataset.panel===s)}),e.widget.classList.toggle("is-schedule-view",s==="schedule")},c=()=>{e.widget.classList.toggle("is-hidden"),e.button.classList.toggle("is-collapsed",e.widget.classList.contains("is-hidden"))};e.tabButtons.forEach(s=>{F(s,"click",()=>{r(s.dataset.panel),s.dataset.panel==="schedule"&&o()})}),e.semesterButtons.forEach(s=>{F(s,"click",()=>{d.view.semester=s.dataset.semester,e.semesterButtons.forEach(i=>{i.classList.toggle("is-active",i.dataset.semester===d.view.semester)}),o()})}),F(e.button,"click",c),chrome.runtime.onMessage.addListener(s=>{s?.type==="TOGGLE_WIDGET"&&c()}),F(e.refresh,"click",async()=>{d.courses=await nt(),st(e.search.value),W(d.sort.key||"code"),U(e,d.filtered),o()}),F(e.exportBtn,"click",te),F(e.saveScheduleBtn,"click",async()=>{if(!re(d.savedSchedules)){alert(`You can only save up to ${ie()} schedules. Delete one to save another.`);return}const s=window.prompt("Name this schedule:")?.trim();if(!s)return;const i=oe(s,d.filtered);d.savedSchedules=[i,...d.savedSchedules],await dt(d.savedSchedules),z(e,d.savedSchedules),e.savedDropdown&&(e.savedDropdown.open=!0)}),F(e.savedMenu,"click",async s=>{const i=s.target.closest("[data-action]");if(!i)return;const l=i.closest(".schedule-saved-card")?.dataset.id;if(!l)return;if(i.dataset.action==="delete"){d.savedSchedules=d.savedSchedules.filter(m=>m.id!==l),await dt(d.savedSchedules),z(e,d.savedSchedules);return}const u=d.savedSchedules.find(m=>m.id===l);u&&(d.courses=[...u.courses],d.filtered=[...u.courses],e.search.value="",W(d.sort.key||"code"),U(e,d.filtered),o(),r("schedule"),e.savedDropdown&&(e.savedDropdown.open=!1))}),F(e.settingsBtn,"click",()=>{e.widget.classList.remove("is-hidden"),e.button.classList.remove("is-collapsed"),r("settings")}),F(e.search,"input",St(()=>{st(e.search.value),W(d.sort.key||"code"),U(e,d.filtered),o()},100)),It(e),d.savedSchedules=await ne(),z(e,d.savedSchedules),d.courses=await nt(),d.filtered=[...d.courses],W("code"),U(e,d.filtered),o(),r(d.view.panel)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();
//# sourceMappingURL=content.js.map
