(function(){"use strict";const j={global:!0,local:{},log:{}},ve=({global:e,local:n,log:t}={})=>{if(typeof e=="boolean"&&(j.global=e),n&&typeof n=="object")for(const[o,r]of Object.entries(n))typeof r=="boolean"&&(j.local[o]=r);if(t&&typeof t=="object")for(const[o,r]of Object.entries(t))typeof r=="boolean"&&(j.log[o]=r)},ae=(e,n)=>!(!j.global||e&&j.local[e]===!1||n&&j.log[n]===!1),y=e=>{const n=e?`[Workday - Schedule Tool:${e}]`:"[Workday - Schedule Tool]";return{log:(s,...d)=>{let c=null,m=null;s&&typeof s=="object"&&!Array.isArray(s)?(c=s,m=d):(c=null,m=[s,...d]);const l=c?.id,u=c?.on===!0;c?.on!==!1&&(!u&&!ae(e,l)||console.log(n,...m))},warn:(s,...d)=>{let c=null,m=null;s&&typeof s=="object"&&!Array.isArray(s)?(c=s,m=d):m=[s,...d];const l=c?.id,u=c?.on===!0;c?.on!==!1&&(!u&&!ae(e,l)||console.log("‚ö†Ô∏è",n,...m))},error:(s,...d)=>{let c=null,m=null;s&&typeof s=="object"&&!Array.isArray(s)?(c=s,m=d):m=[s,...d];const l=c?.id,u=c?.on===!0;c?.on!==!1&&(!u&&!ae(e,l)||console.log("üö©",n,...m))},on:()=>ve({local:{[e]:!0}}),off:()=>ve({local:{[e]:!1}})}},ce=y("dom"),W=(e,n)=>(ce.log("Querying multiple elements:",{root:e,sel:n}),Array.from(e.querySelectorAll(n))),p=(e,n,t,o)=>{e&&(ce.log("Attaching event listener:",{el:e,ev:n,opts:o}),e.addEventListener(n,t,o))},_e=(e,n=300)=>{let t;return(...o)=>{ce.log("Debouncing function call with delay:",{fn:e,ms:n,args:o}),clearTimeout(t),t=setTimeout(()=>e(...o),n)}},g={courses:[],filtered:[],savedSchedules:[],sort:{key:null,dir:1},view:{panel:"list",semester:"first"}},Ce=y("shadowMount"),we="Workday - Schedule Tool";function je(){let e=document.getElementById(we);return e?(Ce.log("Returning existing shadow root:",e),e.shadowRoot):(e=document.createElement("div"),e.id=we,e.style.all="initial",e.style.position="fixed",e.style.bottom="16px",e.style.right="16px",e.style.zIndex="999999999",e.attachShadow({mode:"open"}),document.documentElement.appendChild(e),Ce.log("Mounted new extension container:",e),e.shadowRoot)}const G=y("loadPanel");async function We(e){const n=chrome.runtime.getURL("src/panel.html"),t=["formatting/general.css","formatting/widget-shell.css","formatting/widget-buttons.css","formatting/floating-button.css","formatting/course-list.css","formatting/schedule-view.css","formatting/schedule-view-events.css","formatting/settings.css","colors/course-list-colors.css","colors/general-colors.css","colors/schedule-view-colors.css","colors/widget-functionality-colors.css","colors/settings-colors.css"];G.log("Fetching HTML and CSS files...");const[o,...r]=await Promise.all([fetch(n).then(c=>c.text()),...t.map(c=>fetch(chrome.runtime.getURL(`src/css/${c}`)).then(m=>m.text()))]),i=r.join(`
`);G.log("CSS files fetched and concatenated:",{cssParts:r}),e.innerHTML="";const a=document.createElement("style");if(a.textContent=i,e.appendChild(a),G.log("Appended styles to shadow DOM."),!document.querySelector('link[href*="Material+Symbols"]')){const c=document.createElement("link");c.rel="stylesheet",c.href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200",document.head.appendChild(c),G.log("Appended Material Symbols font to document head.")}const s=document.createElement("div");s.innerHTML=o,e.appendChild(s),G.log("Appended HTML content to shadow DOM.");const d={button:e.querySelector("#floating-button"),widget:e.querySelector(".widget"),root:e,search:e.querySelector("#widget-search"),saveScheduleBtn:e.querySelector("#widget-save-schedule"),refresh:e.querySelector("#widget-refresh"),exportDropdown:e.querySelector("#widget-export"),exportButton:e.querySelector("#widget-export-button"),exportMenu:e.querySelector("#widget-export-menu"),helpBtn:e.querySelector(".help"),settingsBtn:e.querySelector(".settings"),tableBody:e.querySelector("tbody"),tableHead:e.querySelector("thead"),tabButtons:e.querySelectorAll(".tab-button"),panels:e.querySelectorAll(".widget-panel"),scheduleGrid:e.querySelector("#schedule-grid"),semesterButtons:e.querySelectorAll(".semester-button"),savedDropdown:e.querySelector("#schedule-saved-dropdown"),savedMenu:e.querySelector("#schedule-saved-menu"),footerConflicts:e.querySelector("#widget-conflicts"),saveModal:e.querySelector("#schedule-save-modal"),saveModalTitle:e.querySelector("#schedule-modal-title"),saveModalMessage:e.querySelector("#schedule-modal-message"),saveModalField:e.querySelector("#schedule-modal-field"),saveModalInput:e.querySelector("#schedule-modal-input"),saveModalCancel:e.querySelector(".schedule-modal-cancel"),saveModalConfirm:e.querySelector(".schedule-modal-confirm")};return G.log("DOM elements loaded:",d),d}const de=y("headerMaps"),ue=e=>String(e||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase();function Ge(e){const t=(e?.getAttribute?.("data-automation-id")||"").match(/^columnHeader(\d+\.\d+)$/);return t?t[1]:null}function Ze(e){const n=Array.from(e.querySelectorAll('th[data-automation-id^="columnHeader"]'));de.log({id:"buildHeaderMaps.headers"},"Header elements found:",n.length);const t=n.map((s,d)=>{const c=Le(s),m=Ge(s);return{el:s,pos:d,key:m,text:c,norm:ue(c)}}).filter(s=>s.text);de.log({id:"buildHeaderMaps.parsedHeaders"},"Parsed headers:",t.map(s=>({pos:s.pos,key:s.key,text:s.text,norm:s.norm})));function o(s){const d=s.map(ue);let c=t.find(m=>d.includes(m.norm));return c||(c=t.find(m=>d.some(l=>m.norm.includes(l))),c||null)}const r={instructor:["instructor","instructors"],meeting:["meeting patterns","meeting pattern"],deliveryMode:["delivery mode"],title:["title","course listing"],section:["section"],instructionalFormat:["instructional format"],startDate:["start date","start"]},i={},a={};for(const[s,d]of Object.entries(r)){const c=o(d);i[s]=c?c.key:null,a[s]=c?c.pos:-1,de.log({id:"buildHeaderMaps.map"},"Mapped header:",{key:s,needles:d,hit:c?{pos:c.pos,colKey:c.key,text:c.text}:null})}return{colMap:i,posMap:a}}function Le(e){if(!e)return"";const n=e.querySelector("button[title]");return n?(n.getAttribute("title")||"").trim():(e.textContent||"").trim()}const Z=y("sectionLinkInfo");function ze(e){let n=String(e||"").replace(/\u00A0/g," ").trim();if(Z.log({id:"parseSectionLinkString.input"},"Raw input:",e),!n)return null;n=n.replace(/\s*\n\s*/g," ").trim(),Z.log({id:"parseSectionLinkString.normalized"},"Normalized string:",n);const t=n.match(/^\s*([A-Z][A-Z0-9_]*\s*\d{3}[A-Z]?)\s*-\s*(.+?)\s*$/);if(!t)return Z.log({id:"parseSectionLinkString.noMatch"},"String did not match expected pattern"),null;const o=t[1].trim(),r=t[2].trim();Z.log({id:"parseSectionLinkString.match"},"Regex match:",{baseCode:o,rest:r});const i=r.split(/\s*[-‚Äì‚Äî]\s*/).map(c=>c.trim()).filter(Boolean);let a="",s="";a=i[0],s=i.slice(1).join(" - ").trim(),s=s.replace(/\s*:\s*/g,`:
`);const d={code:o,section_number:a,title:s,full:n};return Z.log({id:"parseSectionLinkString.result"},"Parsed section link result:",d),d}function me(e){const n=String(e||"").match(/[A-Z][A-Z0-9_]*\s*\d{2,3}[A-Z]?/),t=n?n[0].replace(/\s+/g," ").trim():"";return Z.log({id:"guessClassCode"},"Guessed class code:",{input:e,out:t}),t}const $=y("meetingPatternsInfo");function Ye(e){if(!e)return $.log({id:"extractMeetingLinesFromCell.missing"},"No meeting element provided"),[];let t=Array.from(e.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean);$.log({id:"extractMeetingLinesFromCell.menuItems"},"Menu item lines:",{count:t.length}),t.length||(t=Array.from(e.querySelectorAll('[data-automation-id="promptOption"]')).map(d=>(d.getAttribute("data-automation-label")||d.getAttribute("title")||d.textContent||"").trim()).filter(Boolean),$.log({id:"extractMeetingLinesFromCell.prompts"},"PromptOption lines (fallback):",{count:t.length})),t.length||(t=String(e.innerText||"").split(`
`).map(s=>s.trim()).filter(Boolean),$.log({id:"extractMeetingLinesFromCell.innerText"},"InnerText lines (final fallback):",{count:t.length}));const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,i=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i,a=t.filter(s=>o.test(s)&&r.test(s)&&i.test(s));return $.log({id:"extractMeetingLinesFromCell.filtered"},"Filtered meeting lines:",{before:t.length,after:a.length}),a}function Ve(e){if(!e)return[];const t=Array.from(e.querySelectorAll('[data-automation-id="menuItem"][aria-label]')).map(s=>(s.getAttribute("aria-label")||"").trim()).filter(Boolean);$.log({id:"extractMeetingLinesFromRow.items"},"Row menu item lines:",{count:t.length});const o=/\b\d{4}-\d{2}-\d{2}\s*-\s*\d{4}-\d{2}-\d{2}\b/,r=/\b\d{1,2}:\d{2}\s*[ap]\.?m\.?\b/i,i=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/i,a=t.filter(s=>o.test(s)&&r.test(s)&&i.test(s));return $.log({id:"extractMeetingLinesFromRow.filtered"},"Filtered row meeting lines:",{before:t.length,after:a.length}),a}function Xe(e){const n=String(e||""),t=n.split("|").map(u=>u.trim()).filter(Boolean),r=(t.find(u=>/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/.test(u))||"").split(/\s+/).join(" / "),i=t.find(u=>/\d{1,2}:\d{2}/.test(u)&&/-/.test(u))||"",a=t.find(u=>/\([A-Z]{2,}\)/.test(u))||"",s=n.match(/\bfloor\b\s*[:\-]?\s*(-?[A-Za-z0-9]+)/i),d=n.match(/\b(room|rm)\b\s*[:\-]?\s*([A-Za-z0-9]+)/i),c=s?`Floor: ${s[1]}`:"",m=d?`Room: ${d[2]}`:"",l={days:r,time:i,location:[a,[c,m].filter(Boolean).join(" | ")].filter(Boolean).join(`
`)};return $.log({id:"formatMeetingLineForPanel"},"Formatted meeting line:",{raw:n,formatted:l}),l}function Ke(e){const n=String(e||"").split(/\r?\n/).map(t=>t.replace(/\s+/g," ").trim()).filter(Boolean).join(`
`);return $.log({id:"normalizeMeetingPatternsText"},"Normalized meeting patterns text:",{beforeLen:String(e||"").length,afterLen:n.length}),n}function ge(e){const n=String(e||"").match(/\b(\d{4}-\d{2}-\d{2})\b/),t=n?n[1]:"";return $.log({id:"extractStartDate"},"Extracted start date:",{line:e,out:t}),t}const Me=y("instructorInfo");function Je(e){if(!e)return Me.log({id:"extractInstructorNamesFromCell.missing"},"No instructor element provided"),"";const n=e.querySelector('[data-automation-id="promptOption"]'),t=(n&&(n.getAttribute("data-automation-label")||n.getAttribute("title")||n.textContent)||e.textContent||"").trim();return Me.log({id:"extractInstructorNamesFromCell.result"},"Extracted instructor text:",{hasPrompt:!!n,txt:t}),t}const fe=y("onlineClassCheck");function Qe(e){if(!e)return fe.log({id:"onlineClassCheck.missing"},"No delivery mode cell provided"),!1;const n=(e.innerText||e.textContent||"").trim();if(/online learning/i.test(n))return fe.log({id:"onlineClassCheck.match.direct"},"Matched online learning from cell text",n),!0;const t=Array.from(e.querySelectorAll('[data-automation-id="promptOption"]')),o=t.some(r=>{const i=(r.getAttribute("data-automation-label")||r.getAttribute("title")||r.textContent||"").trim();return/online learning/i.test(i)});return fe.log({id:"onlineClassCheck.match.prompts"},"Checked prompt options for online learning",{promptCount:t.length,matched:o}),o}const se=y("findingTables");function et(){const e=W(document,'table, [role="table"], div[data-automation-id*="grid"], div[role="grid"]');se.log({id:"findingTables.roots"},"Candidate roots found:",e.length);for(const n of e){const t=W(n,"thead th, [role='columnheader'], .wd-GridHeaderCell, .grid-column-header"),o=t.map(a=>ue(Le(a))),r=o.some(a=>a.includes("section"))&&(o.some(a=>a.includes("instructor"))||o.some(a=>a.includes("meeting"))||o.some(a=>a.includes("instructional format"))||o.some(a=>a.includes("format"))||o.some(a=>a.includes("status")));if(se.log({id:"findingTables.scanRoot"},"Scanning root:",{headerCount:t.length,looksRight:r,headerText:o}),!r)continue;const i=W(n,"tbody tr, [role='rowgroup'] [role='row'], .wd-GridRow, .grid-row");if(se.log({id:"findingTables.rows"},"Rows found for matching root:",i.length),i.length)return{root:n,rows:i}}return se.log({id:"findingTables.none"},"No matching table/grid found"),null}const E=y("courseExtraction");async function xe(){E.log({id:"extractAllCourses.start"},"Starting course extraction");const e=et();let n=[];if(E.log({id:"extractAllCourses.tables"},"findingTables() result:",e?{hasRoot:!!e.root,rowCount:e.rows?.length||0}:null),e){const o=Ze(e.root);E.log({id:"extractAllCourses.headerMaps"},"Built header maps:",o);for(const r of e.rows){const i=nt(r,o);(i.code||i.title)&&Object.values(i).join("").trim()&&n.push(i)}}const t=tt(n);return E.log({id:"extractAllCourses.done"},"Extraction complete:",{total:n.length,unique:t.length}),t}function tt(e){const n=r=>[r.code,r.title,r.section_number].join("|").toLowerCase(),t=new Set,o=[];for(const r of e){const i=n(r);t.has(i)||(t.add(i),o.push(r))}return E.log({id:"findUniqueCourses"},"Deduped courses:",{in:e.length,out:o.length,removed:e.length-o.length}),o}function nt(e,n){const{colMap:t,posMap:o}=n,r=W(e,"td, [role='gridcell']"),i=(e.innerText||"").trim();E.log({id:"extractFromRow.start"},"Extracting row:",{cellCount:r.length,textLen:i.length});function a(f){const Ue=(f.querySelector('[id^="gen-dwr-comp-"]')?.id||"").match(/^gen-dwr-comp-(\d+\.\d+)-/);return Ue?Ue[1]:null}const s=new Map;r.forEach(f=>{const M=a(f);M&&!s.has(M)&&s.set(M,f)});const d=f=>{const M=t[f];if(M!=null&&s.has(M))return s.get(M);const I=o[f];return I!=null&&I>=0&&I<r.length?r[I]:null},c=f=>{const M=t[f];if(M!=null&&s.has(M))return(s.get(M).innerText||"").trim();const I=o[f];return I!=null&&I>=0&&I<r.length?(r[I].innerText||"").trim():""},m=W(e,'[data-automation-id="promptOption"]');let l=null;for(const f of m){const M=f.getAttribute("data-automation-label")||f.getAttribute("title")||f.getAttribute("aria-label")||f.textContent||"";if(/^[A-Z][A-Z0-9_]*\s*\d{2,3}-/.test(M)){l=f;break}}!l&&m.length>0&&(l=m[0]);const u=l&&(l.getAttribute("data-automation-label")||l.getAttribute("title")||l.getAttribute("aria-label")||l.textContent)||"";E.log({id:"extractFromRow.sectionLink"},"Section link:",{promptOptions:m.length,hasMatch:!!l,sectionLinkString:u});const S=c("title"),h=c("code"),b=c("section"),C=c("meeting"),x=c("instructionalFormat"),D=c("startDate");let O="",F=S||"",te="";const ne=ze(u);ne&&(O=ne.code,te=ne.section_number,F=ne.title),O||(O=me(h)||me(S)||me(i)||""),E.log({id:"extractFromRow.coreParse"},"Core parse result:",{code:O,title:F,section_number:te,titleCell:S,codeCell:h,sectCell:b});const w=f=>/\b(lab|laboratory|labratory)\b/i.test(String(f||"")),H=f=>/\bseminar\b/i.test(String(f||"")),U=f=>/\bdiscussion\b/i.test(String(f||"")),oe=w(x)||w(b)||w(F)||w(u)||w(i),L=H(x)||H(b)||H(F)||H(u)||H(i),Y=U(x)||U(b)||U(F)||U(u)||U(i);E.log({id:"extractFromRow.typeDetection"},"Type flags:",{isLab:oe,isSeminar:L,isDiscussion:Y,instructionalFormatCell:x});const V=d("instructor");let X="";oe||L?X="N/A":X=Je(V)||(c("instructor")||"").trim();let B;const ye=t.meeting;let le=null;ye!=null&&s.has(ye)?le=s.get(ye):o.meeting!=null&&o.meeting>=0&&o.meeting<r.length&&(le=r[o.meeting]);let _=le?Ye(le):[];_.length||(_=Ve(e));let k={days:"",time:"",location:""},qe=ge(_[0])||ge(D);if(_.length){const f=_[0];k=Xe(f)}else B=(C||"").trim();const Pt=d("deliveryMode"),He=Qe(Pt);He&&(k.location="Online"),k.days||k.time||k.location?(B=[k.days,k.time].filter(Boolean).join(" | "),k.location?B+=`
${k.location}`:B+=`
Online`):B=(C||"").trim(),E.log({id:"extractFromRow.meeting"},"Meeting parse:",{startDateCell:D,startDate:qe,linesCount:_.length,isOnlineDelivery:He,meetingObj:k,meeting:B});const Ot=(x||"").trim(),A={code:O,title:F,section_number:te,instructor:X,meeting:Ke(B),instructionalFormat:Ot,startDate:qe,meetingLines:_,isLab:oe,isSeminar:L,isDiscussion:Y};return E.log({id:"extractFromRow.result"},"Extracted course:",{code:A.code,title:A.title,section_number:A.section_number,instructor:A.instructor,instructionalFormat:A.instructionalFormat,startDate:A.startDate,meetingLines:A.meetingLines?.length||0,isLab:A.isLab,isSeminar:A.isSeminar,isDiscussion:A.isDiscussion}),A}const K=y("renderRows"),Ee=e=>{const n=String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");return K.log("Escaped HTML:",{input:e,output:n}),n};function ot(e){const n=String(e||"").replace(/[\u00A0\u200B-\u200D\uFEFF]/g," ").replace(/[ \t]+\n/g,`
`).replace(/\n[ \t]+/g,`
`).replace(/\n{2,}/g,`
`).trim();return K.log("Cleaned text lines:",{input:e,output:n}),n}function J(e,n){K.log("Rendering rows:",n),e.tableBody.innerHTML="";const t=document.createDocumentFragment();n.forEach(o=>{const r=document.createElement("tr"),i=o.isLab?"[Laboratory]":o.isSeminar?"[Seminar]":o.isDiscussion?"[Discussion]":"";r.innerHTML=`
      <td class="title">
        <div class="title-main">${o.title||""}</div>
        ${i?`<div class="muted">${i}</div>`:""}
      </td>
      <td class="code">${o.code||""}</td>
      <td class="sect">${(o.section_number||"").trim()}</td>
      <td class="instructor">${o.instructor||""}</td>
      <td class="meeting">
        ${(()=>{const a=ot(o.meeting).split(`
`),s=(a[0]||"").trim(),d=a.slice(1).map(c=>c.replace(/[\u00A0\u200B-\u200D\uFEFF]/g,"").trim()).filter(Boolean).join(`
`);return K.log("Processed meeting details:",{main:s,sub:d}),`
            ${s?`<span class="meeting-pill">${Ee(s).trim()}</span>`:""}
            ${d?`<div class="meeting-sub">${Ee(d).trim()}</div>`:""}
          `})()}
      </td>
      <td class="instructionalFormat">${o.instructionalFormat||""}</td>
    `,t.appendChild(r)}),e.tableBody.appendChild(t),K.log("Rows rendered and added to table body.")}const N=y("panelInteractions");function Te(e){if(e=(e||"").trim().toLowerCase(),N.log("Search query received:",e),!e){g.filtered=[...g.courses],N.log("Search filter cleared, resetting filtered courses:",g.filtered);return}g.filtered=g.courses.filter(n=>["code","title","section_number","instructor","meeting","instructionalFormat"].some(t=>(n[t]||"").toLowerCase().includes(e))),N.log("Search filter applied, filtered courses:",g.filtered)}function Q(e){if(!e)return;const n=g.sort.key===e?-g.sort.dir:1;g.sort={key:e,dir:n},N.log("Sorting by key:",e,"Direction:",n);const t=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});g.filtered.sort((o,r)=>n*t.compare(o[e]||"",r[e]||"")),N.log("Sorted filtered courses:",g.filtered)}function st(e){const n=W(e.tableHead,"th[data-key]");N.log("Table header cells with sorting keys:",n),n.forEach(t=>{p(t,"click",()=>{const o=t.getAttribute("data-key");N.log("Sorting header clicked, sorting by:",o),Q(o),J(e,g.filtered),n.forEach(r=>r.classList.remove("sorted-asc","sorted-desc")),t.classList.add(g.sort.dir===1?"sorted-asc":"sorted-desc"),N.log("Updated sorting classes:",{sortedAsc:t.classList.contains("sorted-asc"),sortedDesc:t.classList.contains("sorted-desc")})})})}const R=y("scheduleView"),z=["Mon","Tue","Wed","Thu","Fri"],De=8,he=21,re=30,q=[];for(let e=De;e<he;e++)q.push(e*60),q.push(e*60+30);q.push(he*60);const rt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,it=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/gi,Ae={first:["09","08"],second:["01","12"]};function $e(e){if(!e)return null;const n=e.trim().match(/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i);if(!n)return null;let t=Number.parseInt(n[1],10);const o=Number.parseInt(n[2],10),r=n[3].toLowerCase();return r==="p"&&t!==12&&(t+=12),r==="a"&&t===12&&(t=0),t*60+o}function lt(e){const n=String(e||"").match(rt)||[],t=String(e||"").match(it)||[];if(n.length===0||t.length<2)return null;const o=$e(t[0]),r=$e(t[1]);return o==null||r==null||r<=o?null:(R.log("Parsed meeting line:",{days:n,timeTokens:t,startMinutes:o,endMinutes:r}),{days:[...new Set(n)],startMinutes:o,endMinutes:r,timeLabel:`${t[0]} - ${t[1]}`})}function at(e){if(!e)return null;const n=e.split("-")[1],t=Ae.first.includes(n)?"first":Ae.second.includes(n)?"second":null;return R.log("Determined semester for startDate:",{startDate:e,semester:t}),t}function ke(e){const n=De*60,t=he*60;return Math.max(n,Math.min(t,e))}function ct(e){return Math.floor(e/re)*re}function dt(e){return Math.ceil(e/re)*re}function Ie(e){return q.indexOf(e)}function ut(e,n){R.log("Building day events for semester:",n);const t=new Map;z.forEach(i=>t.set(i,[]));const o=new Set;let r=0;return e.forEach(i=>{const a=i.startDate||ge(i.meetingLines?.[0])||"";if(at(a)!==n)return;const d=i.meetingLines?.length?i.meetingLines:[],c=i.isLab?"[Laboratory]":i.isSeminar?"[Seminar]":i.isDiscussion?"[Discussion]":"";d.forEach(m=>{const l=lt(m);if(!l)return;let u=ke(l.startMinutes),S=ke(l.endMinutes);u=ct(u),S=dt(S);const h=Ie(u),b=Ie(S);if(h===-1||b===-1||b<=h)return;const C=b-h;l.days.forEach(x=>{if(!t.has(x))return;const D=[x,i.code||"",i.title||"",l.timeLabel,h,C].join("|");o.has(D)||(o.add(D),t.get(x).push({id:r++,code:i.code||"",title:i.title||"",label:c,timeLabel:l.timeLabel,rowStart:h,rowSpan:C,startIdx:h,endIdx:b}))})})}),z.forEach(i=>{t.get(i).sort((a,s)=>a.startIdx-s.startIdx||a.endIdx-s.endIdx)}),R.log("Built day events:",t),t}function mt(e){R.log("Adding conflicts to events...");const n=new Map;return z.forEach(t=>{const o=(e.get(t)||[]).slice().sort((s,d)=>s.startIdx-d.startIdx||s.endIdx-d.endIdx),r=[];let i=null,a=null;for(let s=0;s<q.length-1;s++){const d=o.filter(m=>m.startIdx<=s&&m.endIdx>s),c=d.length?d.map(m=>m.id).sort((m,l)=>m-l).join("|"):null;if(!c){i&&r.push(i),i=null,a=null;continue}if(i&&c===a){i.end=s+1;continue}i&&r.push(i),i={start:s,end:s+1,events:d,hasConflict:d.length>1},a=c}i&&r.push(i),n.set(t,r)}),R.log("Grouped events with conflicts:",n),n}function gt(e){const n=new Set,t=[];return e.forEach(o=>{o.forEach(r=>{if(!r.hasConflict)return;const i=[...new Set(r.events.map(s=>s.code||s.title).filter(Boolean))];if(i.length<2)return;i.sort((s,d)=>s.localeCompare(d));const a=i.join("|");n.has(a)||(n.add(a),t.push(i))})}),R.log("Conflict summaries:",t),t}function ft(e,n){if(!e?.footerConflicts)return;if(!n.length){e.footerConflicts.textContent="";return}const t=n.map(o=>`[${o.join(", ")}]`).join(" ");e.footerConflicts.textContent=`‚ö†Ô∏è The following classes are in conflict: ${t}`}function ht(e){const n=Math.floor(e/60),t=e%60,o=String(n),r=String(t).padStart(2,"0");return`${o}:${r}`}function pt(){const e=document.createElement("div");e.className="schedule-table-wrap";const n=document.createElement("table");n.className="schedule-table";const t=document.createElement("thead"),o=document.createElement("tr");o.innerHTML=`
    <th class="schedule-time"></th>
    ${z.map(a=>`<th class="schedule-day-head" data-day="${a}">${a}</th>`).join("")}
  `,t.appendChild(o),n.appendChild(t);const r=document.createElement("tbody");for(let a=0;a<q.length;a++){const s=document.createElement("tr"),d=document.createElement("td");d.className="schedule-time",d.textContent=ht(q[a]),s.appendChild(d),z.forEach(c=>{const m=document.createElement("td");m.className="schedule-cell",m.dataset.day=c,m.dataset.row=String(a);const l=document.createElement("div");l.className="schedule-cell-inner",m.appendChild(l),s.appendChild(m)}),r.appendChild(s)}n.appendChild(r),e.appendChild(n);const i=document.createElement("div");return i.className="schedule-overlay",e.appendChild(i),e}function St(e){return e.getBoundingClientRect()}function bt(e,n,t){const o=e.querySelector(".schedule-overlay");o.innerHTML="";const r=e.querySelector(".schedule-table"),i=r.querySelector("tbody tr"),a=r.querySelector('tbody tr td.schedule-cell[data-day="Mon"]'),s=r.querySelector("thead th.schedule-time");if(!i||!a||!s)return;const d=s.getBoundingClientRect().width,c=a.getBoundingClientRect().width,m=r.querySelector("thead").getBoundingClientRect().height,l=i.getBoundingClientRect().height,u=getComputedStyle(a),S=parseFloat(u.borderLeftWidth)||0,h=parseFloat(u.borderTopWidth)||0,b=parseFloat(u.borderRightWidth)||0,C=parseFloat(u.borderBottomWidth)||0,x=(S+b)/2,D=(h+C)/2,O=[];z.forEach((F,te)=>{(n.get(F)||[]).forEach(w=>{const H=d+te*c,U=m+w.rowStart*l,oe=w.rowSpan*l,L=document.createElement("div");L.className="schedule-entry-float",L.style.left=`${H+S}px`,L.style.top=`${U+h}px`,L.style.width=`${c-x}px`,L.style.height=`${oe-D}px`;const Y=document.createElement("div");Y.className="schedule-entry-overlap-layer",L.appendChild(Y);const V=document.createElement("div");V.className="schedule-entry-text";const X=w.code||w.title,B=w.label?`${X} ${w.label}`:X;V.innerHTML=`
        <div class="schedule-entry-title">${B}</div>
        <div class="schedule-entry-time">${w.timeLabel}</div>
      `,L.appendChild(V),o.appendChild(L),O.push({el:L,day:F,ev:w,rect:St(L),overlapLayerEl:Y,overlaps:[],textEl:V})})}),R.log("Rendered overlay blocks:",O)}function yt(e,n,t){const o=e?.scheduleRoot||e?.schedulePanel||e?.scheduleContainer||e?.scheduleView||e?.schedule;if(!o){R.warn("renderSchedule: no schedule host found on ctx");return}const r=ut(n||[],t),i=mt(r),a=gt(i);o.innerHTML="";const s=pt();o.appendChild(s),bt(s,r),ft(e,a)}const P=y("export-ics"),pe="America/Vancouver",vt=e=>{const n=e.getUTCFullYear(),t=pad(e.getUTCMonth()+1),o=pad(e.getUTCDate()),r=pad(e.getUTCHours()),i=pad(e.getUTCMinutes()),a=pad(e.getUTCSeconds());return P.log("Formatting UTC Date:",{y:n,m:t,d:o,hh:r,mm:i,ss:a}),`${n}${t}${o}T${r}${i}${a}Z`},Re={Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA",Sun:"SU"},Ct=/(\d{4}-\d{2}-\d{2})\s*-\s*(\d{4}-\d{2}-\d{2})/,wt=/(\d{1,2}):(\d{2})\s*([ap])\.?m\.?\s*-\s*(\d{1,2}):(\d{2})\s*([ap])\.?m\.?/i,Lt=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\b/g,ie=e=>String(e).padStart(2,"0"),Mt=e=>{const n=e.getFullYear(),t=ie(e.getMonth()+1),o=ie(e.getDate());return P.log("Formatted Date:",{year:n,month:t,day:o}),`${n}${t}${o}`},Fe=e=>{const n=Mt(e),t=ie(e.getHours()),o=ie(e.getMinutes());return P.log("Formatted DateTime:",{datePart:n,hours:t,minutes:o}),`${n}T${t}${o}00`},Be=(e,n,t)=>{let o=Number.parseInt(e,10);const r=Number.parseInt(n,10),i=t.toLowerCase();return P.log("Parsing Time:",{hours:o,minutes:r,period:i}),i==="p"&&o!==12&&(o+=12),i==="a"&&o===12&&(o=0),{hours:o,minutes:r}},xt=e=>{const n=String(e||"").match(Ct),t=String(e||"").match(wt),o=String(e||"").match(Lt)||[];if(!n||!t||!o.length)return null;P.log("Parsed Meeting Line:",{dateMatch:n,timeMatch:t,days:o});const r=n[1],i=n[2],a=Be(t[1],t[2],t[3]),s=Be(t[4],t[5],t[6]),d=[...new Set(o.map(c=>Re[c]).filter(Boolean))];return{startDate:r,endDate:i,days:d,startTime:a,endTime:s}},Et=e=>{const n=String(e||"").split("|").map(r=>r.trim()).filter(Boolean),t=n.find(r=>/\([A-Z]{2,}\)/.test(r));if(t)return t;const o=n.find(r=>/online/i.test(r));return o||""},Tt=(e,n)=>{const t=new Date(`${e}T00:00:00`);for(let o=0;o<7;o+=1){const r=new Date(t);r.setDate(t.getDate()+o);const i=Object.values(Re)[r.getDay()===0?6:r.getDay()-1];if(n.includes(i))return r}return t},Dt=(e,n)=>{const t=xt(n);if(!t)return null;const o=Tt(t.startDate,t.days),r=new Date(o);r.setHours(t.startTime.hours,t.startTime.minutes,0,0);const i=new Date(o);i.setHours(t.endTime.hours,t.endTime.minutes,0,0);const a=[e.code,e.title].filter(Boolean),s=[e.title?`Title: ${e.title}`:null,e.code?`Code: ${e.code}`:null,e.section_number?`Section: ${e.section_number}`:null,e.instructor?`Instructor: ${e.instructor}`:null,e.instructionalFormat?`Format: ${e.instructionalFormat}`:null,e.meeting?`Meeting: ${e.meeting}`:null].filter(Boolean),d=new Date(`${t.endDate}T23:59:59`),c=vt(d);return P.log("Built Class Event:",{course:e,parsed:t,startDate:r,endDate:i,summaryParts:a,descriptionLines:s,untilDate:c}),{uid:`${e.code||"course"}-${Date.now()}-${Math.random().toString(16).slice(2)}`,summary:a.join(" - ")||"Scheduled Course",description:s.join("\\n"),location:Et(n),dtstart:Fe(r),dtend:Fe(i),rrule:`FREQ=WEEKLY;BYDAY=${t.days.join(",")};UNTIL=${c}`}},At=e=>{const n=[];e.forEach(o=>{(o.meetingLines?.length?o.meetingLines:[]).forEach(i=>{const a=Dt(o,i);a&&n.push(a)})});const t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Workday Extension//Schedule Export//EN","CALSCALE:GREGORIAN",`X-WR-TIMEZONE:${pe}`];return n.forEach(o=>{t.push("BEGIN:VEVENT"),t.push(`UID:${o.uid}`),t.push(`SUMMARY:${o.summary}`),o.description&&t.push(`DESCRIPTION:${o.description}`),o.location&&t.push(`LOCATION:${o.location}`),t.push(`DTSTART;TZID=${pe}:${o.dtstart}`),t.push(`DTEND;TZID=${pe}:${o.dtend}`),t.push(`RRULE:${o.rrule}`),t.push("END:VEVENT")}),t.push("END:VCALENDAR"),P.log("ICS File Generated:",t),t.join(`\r
`)};function $t(){const e=At(g.filtered||[]),n=new Blob([e],{type:"text/calendar;charset=utf-8"}),t=URL.createObjectURL(n),o=document.createElement("a");o.href=t,o.download="workday-schedule.ics",document.body.appendChild(o),o.click(),P.log("Download Triggered for ICS file"),setTimeout(()=>{URL.revokeObjectURL(t),o.remove()},100)}const v=y("scheduleStorage"),ee="wdSavedSchedules",Ne=6,kt=e=>typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e||[])),Se=e=>Array.isArray(e)?e.filter(n=>n&&Array.isArray(n.courses)).map(n=>({id:n.id,name:n.name||"Untitled",savedAt:n.savedAt||new Date().toISOString(),courses:n.courses})):[],Pe=typeof chrome<"u"&&chrome.storage&&chrome.storage.local;async function It(){if(v.log("Loading saved schedules..."),Pe)return new Promise(e=>{chrome.storage.local.get([ee],n=>{const t=Se(n?.[ee]||[]);v.log("Schedules loaded from Chrome Storage:",t),e(t)})});try{const e=localStorage.getItem(ee);if(!e)return v.log("No schedules found in localStorage."),[];const n=Se(JSON.parse(e));return v.log("Schedules loaded from localStorage:",n),n}catch(e){return console.warn("[WD] Failed to load saved schedules",e),v.error("Error loading schedules from localStorage:",e),[]}}async function Oe(e){const n=Se(e);if(v.log("Persisting saved schedules:",n),Pe)return new Promise(t=>{chrome.storage.local.set({[ee]:n},()=>{v.log("Schedules saved to Chrome Storage."),t()})});try{localStorage.setItem(ee,JSON.stringify(n)),v.log("Schedules saved to localStorage.")}catch(t){console.warn("[WD] Failed to save schedules",t),v.error("Error saving schedules to localStorage:",t)}}function Rt(e,n){const o={id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,name:e||"Untitled",savedAt:new Date().toISOString(),courses:kt(n||[])};return v.log("Created schedule snapshot:",o),o}function Ft(e){const n=e.courses?.length||0,t=new Date(e.savedAt),o=Number.isNaN(t.getTime())?e.savedAt:t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return`${n} courses ¬∑ Saved ${o}`}function be(e,n){if(v.log("Rendering saved schedules:",n),!!e.savedMenu){if(e.savedMenu.innerHTML="",!n.length){const t=document.createElement("div");t.className="schedule-saved-empty",t.textContent="No saved schedules yet.",e.savedMenu.appendChild(t),v.log("No saved schedules to render.");return}n.forEach(t=>{const o=document.createElement("div");o.className="schedule-saved-card",o.dataset.id=t.id;const r=document.createElement("div");r.className="schedule-saved-card-header";const i=document.createElement("div"),a=document.createElement("div");a.className="schedule-saved-title",a.textContent=t.name;const s=document.createElement("div");s.className="schedule-saved-meta",s.textContent=Ft(t),i.appendChild(a),i.appendChild(s),r.appendChild(i);const d=document.createElement("div");d.className="schedule-saved-actions";const c=document.createElement("button");c.type="button",c.className="schedule-saved-action",c.dataset.action="load",c.textContent="Load";const m=document.createElement("button");m.type="button",m.className="schedule-saved-action delete",m.dataset.action="delete",m.textContent="Delete",d.appendChild(c),d.appendChild(m),o.appendChild(r),o.appendChild(d),e.savedMenu.appendChild(o),v.log("Rendered schedule card:",t)})}}function Bt(e){return v.log("Checking if more schedules can be saved. Current count:",e.length),e.length<Ne}function Nt(){return Ne}const T=y("content");(()=>{async function e(){const n=je(),t=await We(n);T.log("Loaded panel context:",t),t.button.classList.toggle("is-collapsed",t.widget.classList.contains("is-hidden"));const o=()=>{yt(t,g.filtered,g.view.semester),T.log("Schedule updated with filtered data:",g.filtered)},r=l=>{g.view.panel=l,T.log("Panel state changed:",l),t.panels.forEach(u=>{u.classList.toggle("is-active",u.dataset.panel===l)}),t.tabButtons.forEach(u=>{u.classList.toggle("is-active",u.dataset.panel===l)}),t.widget.classList.toggle("is-schedule-view",l==="schedule"),t.widget.classList.toggle("is-settings-view",l==="settings"),t.widget.classList.toggle("is-help-view",l==="help")},i=()=>{t.widget.classList.toggle("is-hidden"),T.log("Widget visibility toggled:",t.widget.classList.contains("is-hidden")),t.button.classList.toggle("is-collapsed",t.widget.classList.contains("is-hidden"))};let a=null;const s=l=>{t.saveModal&&(t.saveModal.classList.add("is-hidden"),t.saveModal.setAttribute("aria-hidden","true"),a&&(a(l),a=null),T.log("Schedule modal closed with value:",l))},d=({title:l,message:u,confirmLabel:S="Save",showInput:h=!0,showCancel:b=!0})=>t.saveModal?(t.saveModalTitle.textContent=l,t.saveModalMessage.textContent=u,t.saveModalConfirm.textContent=S,t.saveModalField.classList.toggle("is-hidden",!h),t.saveModalCancel.classList.toggle("is-hidden",!b),t.saveModalInput.value="",t.saveModalInput.classList.remove("is-invalid"),t.saveModal.classList.remove("is-hidden"),t.saveModal.setAttribute("aria-hidden","false"),h?t.saveModalInput.focus():t.saveModalConfirm.focus(),T.log("Opened schedule modal with title:",l),new Promise(C=>{a=C})):Promise.resolve(null);t.saveModal&&(p(t.saveModal,"click",l=>{if(l.target===t.saveModal){s(null);return}const u=l.target.closest("[data-action]")?.dataset.action;if(u){if(u==="close"||u==="cancel"){s(null);return}if(u==="confirm"){if(!t.saveModalField.classList.contains("is-hidden")){const S=t.saveModalInput.value.trim();if(!S){t.saveModalInput.classList.add("is-invalid"),t.saveModalInput.focus();return}s(S);return}s(!0)}}}),p(t.saveModalInput,"input",()=>{t.saveModalInput.classList.remove("is-invalid")}),p(t.saveModalInput,"keydown",l=>{l.key==="Enter"&&t.saveModalConfirm.click()}),p(document,"keydown",l=>{l.key==="Escape"&&t.saveModal&&!t.saveModal.classList.contains("is-hidden")&&s(null)})),t.tabButtons.forEach(l=>{p(l,"click",()=>{r(l.dataset.panel),l.dataset.panel==="schedule"&&o()})}),t.semesterButtons.forEach(l=>{p(l,"click",()=>{g.view.semester=l.dataset.semester,T.log("Semester state changed:",g.view.semester),t.semesterButtons.forEach(u=>{u.classList.toggle("is-active",u.dataset.semester===g.view.semester)}),o()})}),p(t.button,"click",i);const c=l=>{!t.exportDropdown||!t.exportButton||(t.exportDropdown.classList.toggle("is-open",l),t.exportButton.setAttribute("aria-expanded",String(l)),T.log("Export dropdown state changed:",l))};p(t.exportButton,"click",()=>{const l=t.exportDropdown?.classList.contains("is-open");c(!l)}),p(document,"click",l=>{!t.exportDropdown?.classList.contains("is-open")||(l.composedPath?l.composedPath():[]).includes(t.exportDropdown)||c(!1)}),p(document,"click",l=>{!t.savedDropdown?.open||(l.composedPath?l.composedPath():[]).includes(t.savedDropdown)||(t.savedDropdown.open=!1)}),p(t.root,"click",l=>{!t.exportDropdown?.open||(l.composedPath?l.composedPath():[]).includes(t.exportDropdown)||(t.exportDropdown.open=!1)}),chrome.runtime.onMessage.addListener(l=>{l?.type==="TOGGLE_WIDGET"&&(i(),T.log("Widget toggled by runtime message"))}),p(t.refresh,"click",async()=>{g.courses=await xe(),Te(t.search.value),Q(g.sort.key||"code"),J(t,g.filtered),o(),T.log("Courses refreshed and schedule updated")});const m=async l=>{l==="ics"&&($t(),T.log("Export triggered for ICS file"))};p(t.exportMenu,"click",async l=>{const u=l.target.closest("[data-export]");u&&(c(!1),await m(u.dataset.export))}),p(t.saveScheduleBtn,"click",async()=>{if(!Bt(g.savedSchedules)){await d({title:"Schedule limit reached",message:`You can only save up to ${Nt()} schedules. Delete one to save another.`,confirmLabel:"Got it",showInput:!1,showCancel:!1});return}const l=await d({title:"Save schedule",message:"Name this schedule so you can find it later.",confirmLabel:"Save",showInput:!0,showCancel:!0});if(!l)return;const u=Rt(l,g.filtered);g.savedSchedules=[u,...g.savedSchedules],await Oe(g.savedSchedules),be(t,g.savedSchedules),t.savedDropdown&&(t.savedDropdown.open=!0)}),p(t.savedMenu,"click",async l=>{const u=l.target.closest("[data-action]");if(!u)return;const h=u.closest(".schedule-saved-card")?.dataset.id;if(!h)return;if(u.dataset.action==="delete"){const C=g.savedSchedules.find(D=>D.id===h);if(!C||!await d({title:"Permanently Delete Schedule?",message:`This action will permanently delete "${C.name}".`,confirmLabel:"Delete",showInput:!1,showCancel:!0}))return;g.savedSchedules=g.savedSchedules.filter(D=>D.id!==h),await Oe(g.savedSchedules),be(t,g.savedSchedules);return}const b=g.savedSchedules.find(C=>C.id===h);b&&(g.courses=[...b.courses],g.filtered=[...b.courses],t.search.value="",Q(g.sort.key||"code"),J(t,g.filtered),o(),r("schedule"),t.savedDropdown&&(t.savedDropdown.open=!1))}),p(t.settingsBtn,"click",()=>{t.widget.classList.remove("is-hidden"),t.button.classList.remove("is-collapsed"),r("settings")}),p(t.helpBtn,"click",()=>{t.widget.classList.remove("is-hidden"),t.button.classList.remove("is-collapsed"),r("help")}),p(t.search,"input",_e(()=>{Te(t.search.value),Q(g.sort.key||"code"),J(t,g.filtered),o()},100)),st(t),g.savedSchedules=await It(),be(t,g.savedSchedules),g.courses=await xe(),g.filtered=[...g.courses],Q("code"),J(t,g.filtered),o(),r(g.view.panel)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})()})();
//# sourceMappingURL=content.js.map
